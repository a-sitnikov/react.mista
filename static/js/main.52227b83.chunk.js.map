{"version":3,"sources":["registerServiceWorker.js","utils.js","api.js","actions/topics_list.js","reducers/topics_list.js","reducers/topic.js","reducers/login.js","reducers/sections.js","reducers/bookmark.js","reducers/new_topic.js","reducers/new_message.js","reducers/tooltips.js","reducers/topic_preview.js","reducers/options.js","reducers/index.js","components/common/search.js","components/nav_bar.js","actions/login.js","components/login/logged_user.js","components/login/login_form.js","components/common/error.js","components/login/index.js","actions/sections.js","components/topics_list/section_select.js","components/topics_list/header.js","components/topics_list/row/pages.js","components/topics_list/row/topic_name_cell.js","actions/tooltips.js","components/extensions/link_to_post.js","components/topics_list/row/preview_link.js","components/topics_list/row/index.js","components/common/pages.js","actions/new_topic.js","components/common/text_editor.js","components/topics_list/new_topic.js","components/extensions/code_highlight.js","components/extensions/code1c.js","components/extensions/link_to_user.js","components/extensions/youtube_link.js","components/extensions/custom_link.js","components/topic/row/vote_item.js","components/topic/row/vote_chart.js","components/topic/row/vote.js","components/topic/row/msg_text.js","components/preview/preview_header.js","components/preview/topic_preview.js","components/topics_list/index.js","actions/topic.js","components/topic/header.js","components/topic/topic_info.js","actions/new_message.js","components/topic/row/user_info.js","components/topic/row/index.js","actions/bookmark.js","components/topic/footer.js","components/topic/new_message.js","components/topic/index.js","components/options/radio_option.js","components/options/string_option.js","components/options/index.js","actions/options.js","components/container.js","components/nav_bar_footer.js","components/tooltips/tooltip_header.js","components/tooltips/tooltip_body.js","components/tooltips/tooltip_window.js","components/tooltips/tooltip.js","components/tooltips/tooltips_list.js","App.js","index.js"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","catch","error","groupBy","xs","key","reduce","rv","x","push","parseJSON","text","JSON","parse","e","replace","message","getMaxPage","answ","Math","min","ceil","childrenToText","children","map","value","type","displayName","props","number","domain","localStorage","getItem","urlTopicsList","urlTopicInfo","urlTopicMessages","urlLogin","urlLogout","urlCookies","urlSections","urlNewMessage","urlNewTopic","urlAddBookmark","getTopicsList","params","a","fetchAndGetJson","json","defaultInfo","id","answers_count","getTopicInfo","getTopicMessages","getMessage","n","from","to","length","data","find","val","String","getTopicMessagesCount","info","getLogin","fetch","method","body","paramsToString","user_name","username","user_password","password","mode","credentials","headers","redirect","getLogout","fullUrl","getCookies","fetchJsonpAndGetJson","getSections","postNewMessage","url","topic_id","result","postNewTopic","postBookmark","paramsPrefix","arr","undefined","join","fetchJsonp","response","responseJson","utils","options","REQUEST_TOPICS_LIST","RECEIVE_TOPICS_LIST","RECEIVE_TOPICS_LIST_FAILED","TOGGLE_PREVIEW","receiveTopicsList","items","receivedAt","Date","fetchTopicsListIfNeeded","dispatch","getState","topicsList","isFetching","shouldFetchTopicsList","page","reqestParams","topicsPerPage","topicsCount","topics","section","section_short_name","forum","user_id","mytopics","API","slice","action","fetchTopicsList","defaultTopicsListState","lastUpdated","ind","findIndex","item","topicId","Object","assign","showPreview","defaultTopicState","topic","item0","concat","defaultLoginState","logged","login","userid","hashkey","defaultSectionsState","tree","sections","forEach","shortn","fulln","defaultBookmarkState","bookmark","defaultNewTopicState","subject","isVoting","newTopic","toLowerCase","defaultNewMessageState","newMessage","defaultTooltipsState","tooltips","hash","tooltip","stringify","keys","i","coords","filter","defaultTopicPreviewState","topicPreview","user","userId","utime","vote","defaultOptionsState","voteColors","theme","autoRefreshTopicsList","autoRefreshTopicsListInterval","autoRefreshTopic","autoRefreshTopicInterval","showTooltips","tooltipDelay","showTooltipOnTopicsList","showTooltipOnPostLink","showYoutubeVideoTitle","replaceCatalogMista","fixBrokenLinks","readOption","name","defaultValue","readOptions","setItem","rootReducer","combineReducers","Search","useState","searchEngine","setSearchEngine","setText","doSearch","open","InputGroup","size","Prepend","DropdownButton","title","style","marginRight","className","variant","Dropdown","Item","eventKey","onSelect","FormControl","placeholder","paddingRight","onKeyPress","onChange","target","Append","marginLeft","marginTop","marginBottom","cursor","onClick","zIndex","NavBar","locationParams","queryString","search","menuItems","link","Nav","Link","href","Navbar","bg","expand","fixed","Brand","this","Toggle","aria-controls","Collapse","Form","inline","Component","connect","withRouter","loginComplete","loginFailed","shouldLogin","checkLogin","cookie","session","last_error","trim","entr_hash","doLoginIfNeeded","encodeURIComponent","doLogin","CustomToggle","React","forwardRef","ref","preventDefault","LoggedUser","onMenuSelect","event","onLogout","bind","userName","float","as","bsRole","Menu","Divider","LoginForm","onLogin","current","createRef","flexWrap","flex","maxLength","autoComplete","Button","margin","rel","ErrorElem","dangerouslySetInnerHTML","__html","Login","elem","receiveSections","fetchSectionsIfNeeded","shouldfetchSections","action2","SectionSelect","currentTarget","selected","sectionsElem","group","label","Control","Header","onSectionSelect","history","Pages","pages","maxPage","TopicNameCell","classes","classNames","user0","is_voting","closed","down","sectionHref","sect2","sect1","substr","overflowWrap","closeTooltip","LinkToPost","onMouseOver","persist","timer","setTimeout","showToolTip","stopPropagation","clearTimeout","onMouseOut","showTooltip","isPreview","pageX","y","pageY","setState","startsWith","pageParam","isNaN","PreviewLink","expanded","time","td","d","getDate","getMonth","getFullYear","today","dateFormat","aria-hidden","color","display","width","textAlign","currentPage","baseUrl","last20","parseInt","Pagination","active","postNewTopicIfNeeded","shouldPostNewTopic","fetchParams","message_text","topic_text","target_section","target_forum","rnd","round","random","voting","votingItems","onSuccess","TextEditor","onButtonCode1c","textArea","start","selectionStart","end","selectionEnd","oldText","len","replacement","substring","newText","formName","onVotingChange","checked","ctrlKey","parent","parentElement","tagName","toUpperCase","dispatchEvent","Event","cancelable","bubbles","showVoting","cols","rows","ButtonGroup","disabled","Check","NewTopic","onSectionChange","currentSection","onSubmit","onSubmitSuccess","refs","onSubjectChange","groupsElem","votingOptions","Text","readOnly","FormGroup","highlight","СтрокаРезультат","УстановленЦвет","ПоследнийЦвет","keywords","Set","split","Спецсиволы","мЦветФона","мЦветЧисла","мЦветСтроки","мЦветКлючевогоСлова1","ВСтроке","Токен","ПустаяСтрока","Строка","Сред","Нач","Длина","Прав","isKeyword","token","has","ДобавитьЧастьСтроки1С","Часть","Цвет","РазукраситьСтроку","СтрокаКода","ВСтрокеСкобка","ВСтрокеТильда","НачалоСтроки","ТокенДоТочки","Поз","ТекущийСимвол","charAt","Code","onShowClick","hidden","textArr","buttonText","buttonShow","linesCount","preStyle","overflow","height","LinkToUser","YoutubeLink","hrefName","v","videoId","apiKey","apiUrl","snippet","getVideoId","getVideoParams","CustomLink","parentText","escapedHref","regExp","RegExp","URL","newHref","set","pathname","query","class","fixBrokenLink","VoteItem","total","colors","img","percent","textDecoration","select","src","maxWwidth","alt","VoteChart","sum","Vote","voteOption","MsgText","res","txt","processCode1C","processLinksToPosts","voteElement","voteChart","html","processedHtml","processText","componentsMap","code","textComponent","activeHtml","PreviewHeader","date","onFirst","onPrev","onNext","onLast","TopicPreview","fetchData","onClickFirst","onClickNext","onClickPrev","onClickLast","maxHeight","overflowY","TopicsList","updateTopicsList","onPostNewTopicSuccess","scrollTo","document","position","top","letterSpacing","receiveTopic","now","closeTopic","shouldFetch","fetchTopicIfNeeded","_item0","first","_items","last","fetchTopic","fetchNewMessagesIfNeeded","fetchNewMessages","TopicInfo","yandexUrl","lineHeight","addMessageText","UserInfo","getElementById","offsetTop","onImageLoad","visibility","dataStr","isAuthor","isYou","isTooltip","timeElem","userClassNames","innerWidth","onLoad","Row","author","addBookmark","Footer","onBookmarkClick","onRefreshClick","updateButton","NewMessage","voting_select","clearVoting","setVotingOption","votingElem","Topic","autoUpdate","updateTopic","onPostNewMessageSuccess","scrolledToHash","setInterval","nodeHash","DOMParser","parseFromString","firstChild","innerText","clearText","clearInterval","RadioOption","values","oneLine","valuesElem","htmlFor","descr","StringOption","postfix","Options","closeForm","resetOptions","applyOptions","onTabClick","activeTab","textContent","optionsParams","max","form","tabName","tabs","tab","row","rowElem","fontWeight","Container","routes","exact","path","component","NavBarFooter","TooltipHeader","closeWindow","onTouchEnd","TooltipBody","onScroll","startX","onTouchStart","nativeEvent","changedTouches","clientX","endX","abs","TooltipWindow","onCloseClick","onWheel","deltaY","axis","left","Children","toArray","header","handle","defaultClassNameDragging","onWheelCapture","Tooltip","delta","TooltipsList","useEffect","setAttribute","middleware","thunk","store","createStore","reducer","applyMiddleware","Root","ReactDOM","render","process","origin","addEventListener","status","get","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"0XAUMA,EAAcC,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,2DAsCN,SAASC,EAAgBC,GACvBC,UAAUC,cACPC,SAASH,GACTI,MAAK,SAAAC,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACtCD,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBG,QACfT,UAAUC,cAAcS,WAK1BC,QAAQC,IAAI,6CAKZD,QAAQC,IAAI,4CAMrBC,OAAM,SAAAC,GACLH,QAAQG,MAAM,4CAA6CA,M,4FCzE1D,IAAMC,EAAU,SAAUC,EAAIC,GACjC,OAAOD,EAAGE,QAAO,SAAUC,EAAIC,GAE3B,OADCD,EAAGC,EAAEH,IAAQE,EAAGC,EAAEH,KAAS,IAAII,KAAKD,GAC9BD,IACR,KAGMG,EAAY,SAACC,GAEtB,IACI,OAAOC,KAAKC,MAAMF,GACpB,MAAMG,IAIR,IAaI,OAZAH,EAAOA,EACFI,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,IAChBA,QAAQ,MAAO,QACfA,QAAQ,MAAO,QACfA,QAAQ,MAAO,OACfA,QAAQ,cAAe,SAGrBH,KAAKC,MAAMF,GAGpB,MAAOG,GAIL,OAHAf,QAAQG,MAAMY,EAAEE,SAChBjB,QAAQC,IAAIW,GAEL,KAIFM,EAAa,SAACC,GAAD,OAAUC,KAAKC,IAAID,KAAKE,KAAKH,EAAO,KAAM,KAAO,GA8B9DI,EAAiB,SAACC,GAE3B,OAAKA,EAEEA,EAASC,KAAI,SAAAC,GAChB,MAAsB,kBAAXA,EACAA,EACe,OAAfA,EAAMC,KACN,OAC2B,wBAA3BD,EAAMC,KAAKC,aAAoE,eAA3BF,EAAMC,KAAKC,YAC/DF,EAAMG,MAAMC,QAEnB9B,QAAQC,IAAIyB,GACLA,MAXOF,GCzEbO,EAAiBC,aAAaC,QAAQ,WAAa,yBAEnDC,EAAwBF,aAAaC,QAAQ,kBAAoB,gBACjEE,EAAuBH,aAAaC,QAAQ,iBAAmB,oBAC/DG,EAA2BJ,aAAaC,QAAQ,qBAAuB,kBACvEI,EAAmBL,aAAaC,QAAQ,aAAe,4BACvDK,EAAoBN,aAAaC,QAAQ,cAAgB,YACzDM,EAAqBP,aAAaC,QAAQ,eAAiB,kBAC3DO,EAAsBR,aAAaC,QAAQ,gBAAkB,2BAC7DQ,EAAwBT,aAAaC,QAAQ,kBAAoB,0BACjES,EAAsBV,aAAaC,QAAQ,gBAAkB,YAC7DU,EAAyBX,aAAaC,QAAQ,mBAAqB,uBAiCnEW,GAhCoBZ,aAAaC,QAAQ,aAgC5B,uCAAG,WAAOY,GAAP,eAAAC,EAAA,sEACRC,EAAgBb,EAAeW,GADvB,cACrBG,EADqB,yBAEpBA,GAFoB,2CAAH,uDAgCbC,EAAc,CACzBC,GAAI,GACJtC,KAAM,GACNuC,cAAe,IAGJC,EAAY,uCAAG,WAAOP,GAAP,eAAAC,EAAA,sEACPC,EAAgBZ,EAAcU,GADvB,cACpBG,EADoB,yBAEnBA,GAFmB,2CAAH,sDAyBZK,EAAgB,uCAAG,WAAOR,GAAP,eAAAC,EAAA,sEACXC,EAAgBX,EAAkBS,GADvB,cACxBG,EADwB,yBAEvBA,GAFuB,2CAAH,sDAKhBM,EAAU,uCAAG,WAAOJ,EAAqBK,GAA5B,iBAAAT,EAAA,sEACLO,EAAiB,CAClCH,KACAM,KAAMD,EACNE,IAAKF,EAAI,IAJa,cAClBP,EADkB,SASZA,EAAKU,OAAS,IACxBC,EAAOX,EAAKY,MAAK,SAAAC,GAAG,OAAIA,EAAIN,IAAMO,OAAOP,OAVnB,kBAYjBI,GAZiB,2CAAH,wDAeVI,EAAqB,uCAAG,WAAOb,GAAP,eAAAJ,EAAA,sEAChBM,EAAa,CAAEF,GAAIY,OAAOZ,KADV,cAC7Bc,EAD6B,0BAE3BA,EAAKb,eAFsB,2CAAH,sDAmBrBc,EAAQ,uCAAG,WAAOpB,GAAP,SAAAC,EAAA,sEACHoB,MAAM,GAAD,OAAInC,EAAJ,YAAcM,GAAY,CAChD8B,OAAQ,OACRC,KAAMC,EAAe,GAAI,CAACC,UAAWzB,EAAO0B,SAAUC,cAAe3B,EAAO4B,WAC5EC,KAAM,UACNC,YAAa,UACbC,QAAS,CACP,OAAU,kDACV,eAAgB,qCAElBC,SAAU,WAVU,yDAAH,sDAgBRC,EAAS,uCAAG,4BAAAhC,EAAA,6DACjBiC,EADiB,UACJhD,EADI,YACMO,EADN,yBAEjB4B,MAAMa,EAAS,CACnBL,KAAM,UACNC,YAAa,YAJQ,2CAAH,qDA4BTK,EAAU,uCAAG,4BAAAlC,EAAA,sEACLmC,EAAqB1C,GADhB,cAClBS,EADkB,yBAEjBA,GAFiB,2CAAH,qDAiBVkC,EAAW,uCAAG,4BAAApC,EAAA,sEACNmC,EAAqBzC,GADf,cACnBQ,EADmB,yBAElBA,GAFkB,2CAAH,qDAgBXmC,EAAc,uCAAG,WAAOtC,GAAP,iBAAAC,EAAA,6DAExBsC,EAAM3C,EAAczB,QAAQ,MAAO6B,EAAOwC,UAFlB,SAITnB,MAAM,GAAD,OAAInC,EAAJ,YAAcqD,GAAO,CAC3CjB,OAAQ,OACRC,KAAMC,EAAe,GAAIxB,GACzB6B,KAAM,UACNC,YAAa,UACbC,QAAS,CACP,OAAU,kDACV,eAAgB,qCAElBC,SAAU,WAbgB,cAIxBS,EAJwB,yBAgBrBA,GAhBqB,2CAAH,sDAyCdC,EAAY,uCAAG,WAAO1C,GAAP,SAAAC,EAAA,sEAEpBoB,MAAM,GAAD,OAAInC,EAAJ,YAAcW,GAAe,CACtCyB,OAAQ,OACRC,KAAMC,EAAe,GAAIxB,GACzB6B,KAAM,UACNC,YAAa,UACbC,QAAS,CACP,eAAgB,uCARM,2CAAH,sDAmBZY,EAAY,uCAAG,WAAO3C,GAAP,SAAAC,EAAA,sEAEpBoB,MAAM,GAAD,OAAInC,EAAJ,YAAcY,GAAkB,CACzCwB,OAAQ,OACRC,KAAMC,EAAe,GAAIxB,GACzB6B,KAAM,UACNC,YAAa,YANW,2CAAH,sDA8BZN,EAAiB,SAACoB,EAAsB5C,GAEnD,IAAKA,EACH,MAAO,GAET,IAAI6C,EAAM,GACV,IAAK,IAAIpF,KAAOuC,OACM8C,IAAhB9C,EAAOvC,IACToF,EAAIhF,KAAKJ,EAAM,IAAMuC,EAAOvC,IAGhC,OAAIoF,EAAIhC,OAAS,EACR+B,EAAeC,EAAIE,KAAK,KAExB,IAGEX,EAAoB,uCAAG,WAAOG,EAAavC,GAApB,qBAAAC,EAAA,6DAE9BiC,EAF8B,UAEjBhD,EAFiB,YAEPqD,GAFO,OAEDf,EAAe,IAAKxB,IAFnB,SAGXgD,IAAWd,GAHA,cAG5Be,EAH4B,gBAITA,EAAS9C,OAJA,OAMlC,GAA8B,kBAF1B+C,EAJ8B,QAQhC,IACE/C,EAAOnC,KAAKC,MAAMiF,GAClB,MAAOhF,GACPiC,EAAOgD,EAAgBD,QAGzB/C,EAAO+C,EAdyB,yBAgB3B/C,GAhB2B,2CAAH,wDAmBpBD,EAAe,uCAAG,WAAOqC,EAAavC,EAAaoD,GAAjC,qBAAAnD,EAAA,6DAEzBiC,EAFyB,UAEZhD,EAFY,YAEFqD,GAFE,OAEIf,EAAe,IAAKxB,IAFxB,SAGNqB,MAAMa,EAASkB,GAHT,cAGvBH,EAHuB,gBAIJA,EAAS9C,OAJL,OAM7B,GAA8B,kBAF1B+C,EAJyB,QAQ3B,IACE/C,EAAOnC,KAAKC,MAAMiF,GAClB,MAAOhF,GACPiC,EAAOgD,EAAgBD,QAGzB/C,EAAO+C,EAdoB,yBAgBtB/C,GAhBsB,2CAAH,0DC5VfkD,EAAsB,sBACtBC,EAAsB,sBACtBC,EAA6B,6BAC7BC,EAAiB,iBA6BjBC,GAAoB,SAAC3C,GAAD,MAAwD,CACvFhC,KAAMwE,EACNI,MAAO5C,EACP6C,WAAY,IAAIC,OAyDLC,GAA0B,SAAC7D,GAAD,OAAsB,SAAC8D,EAAeC,GAC3E,GAZ4B,SAAC9G,GAC7B,IAAM+G,EAAa/G,EAAM+G,WACzB,OAAKA,IAGDA,EAAWC,WAOXC,CAAsBH,KACxB,OAAOD,EAxDa,SAAC9D,GAAD,8CAAiB,WAAO8D,EAAeC,GAAtB,2BAAA9D,EAAA,6DAEvC6D,EAZ+D,CAC/DhF,KAAMuE,IAaAc,EAAOnE,EAAOmE,MAAQ,EACxBC,EAAkC,IAElCC,GAAiBN,IAAWX,QAAQM,MAAMW,eAC1B,KAAIA,EAAgB,IAEpCC,EAAcH,EAAOE,EACzBD,EAAaG,OAASD,EAElBtE,EAAOwE,UACTJ,EAAaK,mBAAqBzE,EAAOwE,SAEvCxE,EAAO0E,QACTN,EAAaM,MAAQ1E,EAAO0E,OAE1B1E,EAAO2E,UACTP,EAAaO,QAAU3E,EAAO2E,SAE5B3E,EAAO4E,WACTR,EAAaQ,SAAW5E,EAAO4E,UAvBM,oBA0BlBC,EAAkBT,GA1BA,QA0B/BjE,EA1B+B,OA4BjCW,EAAOX,EAAK2E,OAAOT,GACvBP,EAASL,GAAkB3C,IA7BU,mDAgCjCiE,EAA2B,CAC7BjG,KAAMyE,EACNjG,MAAO,KAAEc,QACTuF,WAAY,IAAIC,MAElBE,EAASiB,GACT5H,QAAQG,MAAR,MAtCqC,2DAAjB,wDAwDJ0H,CAAgBhF,MClFvBiF,GAA0C,CACrDhB,YAAY,EACZP,MAAO,IA2CMM,GAxCI,WAAiG,IAAhG/G,EAA+F,uDAAtEgI,GAAwBF,EAA8C,uCAEjH,OAAQA,EAAOjG,MACb,KAAKuE,EACH,OAAO,2BACFpG,GADL,IAEEK,MAAO,KACP2G,YAAY,IAEhB,KAAKX,EACH,OAAO,2BACFrG,GADL,IAEEgH,YAAY,EACZP,MAAOqB,EAAOrB,MACdwB,YAAaH,EAAOpB,aAExB,KAAKJ,EACH,OAAO,2BACFtG,GADL,IAEEgH,YAAY,EACZ3G,MAAOyH,EAAOzH,MACd4H,YAAaH,EAAOpB,aAExB,KAAKH,EACH,IAAIE,EAAQzG,EAAMyG,MAAMoB,QAClBK,EAAMzB,EAAM0B,WAAU,SAAAC,GAAI,OAAIA,EAAKhF,KAAO0E,EAAOO,WAEnDD,EAAOE,OAAOC,OAAO,GAAI9B,EAAMyB,IAInC,OAHAE,EAAKI,aAAeJ,EAAKI,YACzB/B,EAAMyB,GAAOE,EAEN,2BACFpI,GADL,IAEEyG,UAEJ,QACE,OAAOzG,IC5CAyI,GAAgC,CACzCzB,YAAY,EACZ9C,KAAMf,EACNsD,MAAO,IAgEIiC,GA7DD,WAA6E,IAA5E1I,EAA2E,uDAAvDyI,GAAmBX,EAAoC,uCACtF,OAAQA,EAAOjG,MACX,IAAK,gBACD,OAAO,2BACA7B,GADP,IAEIgH,YAAY,EACZ3G,MAAO,OAEf,IAAK,gBACD,OAAO,2BACAL,GADP,IAEIgH,YAAY,EACZ9C,KAAM4D,EAAO5D,KACbyE,MAAOb,EAAOa,MACdlC,MAAOqB,EAAOrB,MACdwB,YAAaH,EAAOpB,WACpBrG,MAAO,OAEf,IAAK,uBACD,OAAO,2BACAL,GADP,IAEIgH,YAAY,EACZiB,YAAaH,EAAOpB,WACpBrG,MAAOyH,EAAOzH,QAEtB,IAAK,uBACD,OAAO,2BACAL,GADP,IAEIgH,YAAY,IAGpB,IAAK,uBAED,IAAI9C,EAAOlE,EAAMkE,KAKjB,OAJI4D,EAAOrB,MAAM7C,OAAS,IACtBM,EAAKb,cAAgByE,EAAOrB,MAAMqB,EAAOrB,MAAM7C,OAAS,GAAGH,GAGxD,2BACAzD,GADP,IAEIgH,YAAY,EACZP,MAAOzG,EAAMyG,MAAMmC,OAAOd,EAAOrB,OACjCvC,OACA+D,YAAaH,EAAOpB,aAG5B,IAAK,cAED,OAAO,2BACA1G,GADP,IAEIyG,MAAO,GACPvC,KAAMf,EACNwF,MAAO,KACPV,YAAa,KACb5H,MAAO,OAEf,QACI,OAAOL,ICjEN6I,GAAgC,CACzC7B,YAAY,EACZ8B,YAAQjD,GAqCGkD,GAlCD,WAA6E,IAA5E/I,EAA2E,uDAAvD6I,GAAmBf,EAAoC,uCACtF,OAAQA,EAAOjG,MACX,IAAK,cACD,OAAO,2BACA7B,GADP,IAEIgH,YAAY,IAEpB,IAAK,iBACD,OAAO,uCACAhH,GACA8H,EAAOjE,MAFd,IAGImD,YAAY,EACZ8B,QAAQ,EACRzI,WAAOwF,IAEd,IAAK,eACF,MAAO,CACHmB,YAAY,EACZ8B,QAAQ,EACRzI,MAAOyH,EAAOzH,OAEtB,IAAK,kBACD,OAAO,2BACAL,GADP,IAEIgJ,YAAQnD,EACRpB,cAAUoB,EACVoD,aAASpD,EACTiD,QAAQ,IAEhB,QACI,OAAO9I,IChCNkJ,GAAsC,CAC/ClC,YAAY,EACZP,MAAO,GACP0C,KAAM,GACNxH,IAAK,IA8BMyH,GA3BE,WAAyF,IAAxFpJ,EAAuF,uDAAhEkJ,GAAsBpB,EAA0C,uCACrG,OAAQA,EAAOjG,MACX,IAAK,mBACD,OAAO,2BACA7B,GADP,IAEIgH,YAAY,IAEpB,IAAK,mBAED,IAAIrF,EAAM,GAKV,OAJAmG,EAAOrB,MAAM4C,SAAQ,SAAAtF,GACjBpC,EAAIoC,EAAIuF,QAAUvF,EAAIwF,SAGnB,2BACAvJ,GADP,IAEIgH,YAAY,EACZP,MAAOqB,EAAOrB,MACd0C,KAAM7I,EAAQwH,EAAOrB,MAAO,SAC5B9E,MACAsG,YAAaH,EAAOpB,aAE5B,QACI,OAAO1G,ICtCNwJ,GAAsC,CACjDxC,YAAY,GAqBCyC,GAlBE,WAA4F,IAA3FzJ,EAA0F,uDAAnEwJ,GAAsB1B,EAA6C,uCACxG,OAAQA,EAAOjG,MACX,IAAK,qBACD,OAAO,2BACA7B,GADP,IAEIgH,YAAY,IAEpB,IAAK,wBACL,IAAK,oBACD,OAAO,2BACAhH,GADP,IAEIgH,YAAY,IAEpB,QACI,OAAOhH,ICXN0J,GAAsC,CAC/C1C,YAAY,EACZO,QAAS,KACTzG,KAAM,GACN6I,QAAS,GACTlC,MAAO,KACPmC,UAAU,GAuDCC,GApDE,WAAyF,IAAxF7J,EAAuF,uDAAhE0J,GAAsB5B,EAA0C,uCACrG,OAAQA,EAAOjG,MACX,IAAK,uBACD,OAAO,2BACA7B,GADP,IAEIgH,YAAY,EACZ3G,WAAOwF,IAEf,IAAK,0BACD,OAAO,2BACA7F,GADP,IAEIgH,YAAY,IAErB,IAAK,uBACA,OAAO,2BACAhH,GADP,IAEIgH,YAAY,EACZ3G,MAAOyH,EAAOzH,QAEtB,IAAK,oBACD,OAAO,2BACAL,GADP,IAEIuH,QAASO,EAAOP,QAChBE,MAAyB,MAAlBK,EAAOP,QAAkB,GAAKO,EAAOP,QAAQE,MAAMqC,gBAElE,IAAK,iBACD,OAAO,2BACA9J,GADP,IAEIc,KAAMgH,EAAOhH,OAErB,IAAK,oBACD,OAAO,2BACAd,GADP,IAEI2J,QAAS7B,EAAOhH,OAExB,IAAK,kBACD,OAAO,2BACAd,GADP,IAEIc,KAAM,GACN6I,QAAS,GACTC,UAAU,IAElB,IAAK,cACD,OAAO,2BACA5J,GADP,IAEI4J,SAAU9B,EAAOjE,OAEzB,QACI,OAAO7D,IC/DN+J,GAA0C,CACnD/C,YAAY,EACZlG,KAAM,IA8BKkJ,GA3BI,WAAiG,IAAhGhK,EAA+F,uDAAtE+J,GAAwBjC,EAA8C,uCAC/G,OAAQA,EAAOjG,MACX,IAAK,yBACD,OAAO,2BACA7B,GADP,IAEIgH,YAAY,IAEpB,IAAK,4BACD,OAAO,2BACAhH,GADP,IAEIgH,YAAY,IAEpB,IAAK,mBACD,OAAO,2BACAhH,GADP,IAEIc,KAAMgH,EAAOhH,OAErB,IAAK,mBACD,OAAO,2BACAd,GADP,IAEIc,KAAMd,EAAMc,KAAOgH,EAAOhH,OAElC,QACI,OAAOd,ICxBNiK,GAAsC,CAC/CxD,MAAO,IAqDIyD,GAlDE,WAAyF,IAClGC,EACA1D,EACA2D,EAHUpK,EAAuF,uDAAhEiK,GAAsBnC,EAA0C,uCAIrG,OAAQA,EAAOjG,MACX,IAAK,iBAED4E,EAAQzG,EAAMyG,MAAMoB,QAEpBsC,EAAOpJ,KAAKsJ,UAAUvC,EAAOwC,MAC7B,IAAIpC,EAAMzB,EAAM0B,WAAU,SAAApE,GAAG,OAAIA,EAAIoG,OAASA,KAgB9C,OAfc,IAAVjC,EACAzB,EAAM7F,KAAK,CACP2J,EAAG,EACHD,KAAMxC,EAAOwC,KACbH,OACAK,OAAQ1C,EAAO0C,WAGnBJ,EAAU9B,OAAOC,OAAO,GAAI9B,EAAMyB,KAC1BsC,OAAS1C,EAAO0C,OAExBJ,EAAQG,GAAK,EACb9D,EAAMyB,GAAOkC,GAGV,2BACApK,GADP,IAEIyG,UAER,IAAK,gBAED,OADA0D,EAAOpJ,KAAKsJ,UAAUvC,EAAOwC,MACtB,2BACAtK,GADP,IAEIyG,MAAOzG,EAAMyG,MAAMgE,QAAO,SAAA1G,GAAG,OAAIA,EAAIoG,OAASA,OAEtD,IAAK,iBACD,OAA2B,IAAvBnK,EAAMyG,MAAM7C,OACL5D,EAEP,2BACOA,GADP,IAEIyG,MAAO,KAGnB,QACI,OAAOzG,ICtDN0K,GAA8C,CACvDjE,MAAO,IA8CIkE,GA3CM,WAAyG,IAAxG3K,EAAuG,uDAA5E0K,GAA0B5C,EAAkD,uCAIzH,OAAQA,EAAOjG,MACV,IAAK,eAaF,YAVoBgE,IADN7F,EAAM8H,EAAOO,WAEvBrI,EAAMyG,MAAMqB,EAAOO,SAAW,CAC1B5E,EAAG,IACHL,GAAI0E,EAAOO,QACXvH,KAAM,GACN8J,KAAM,GACNC,OAAQ,GACRC,MAAO,IACPC,KAAM,IAEP,eACA/K,GAEV,IAAK,gBAEF,cADOA,EAAMyG,MAAMqB,EAAOO,SACnB,eACArI,GAGX,IAAK,uBAGD,YAAoB6F,IADN7F,EAAMyG,MAAMqB,EAAOO,SAEtBrI,GAEPA,EAAMyG,MAAMqB,EAAOO,SAAWP,EAAO3G,QAElC,eACAnB,IAEX,QACI,OAAOA,ICzBNgL,GAAoC,CAC/CC,WAAY,CACV,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEFxE,MAAO,CACLyE,MAAO,YACP9D,cAAe,KACf+D,sBAAuB,QACvBC,8BAA+B,KAC/BC,iBAAkB,OAClBC,yBAA0B,KAE1BC,aAAc,OACdC,aAAc,MACdC,wBAAyB,OACzBC,sBAAuB,OAEvBC,sBAAuB,OACvBC,oBAAqB,OACrBC,eAAgB,SAIpB,SAASC,GAAWC,EAAMC,GACxB,OAAO/M,OAAOiD,aAAaC,QAAQ4J,IAASC,EAa9C,IAkCe7F,GAlCC,SAACnG,EAAqB8H,GAKpC,OAHK9H,IACHA,EAbJ,WAEE,IAAIA,EAAsBgL,GAC1B,IAAK,IAAIxK,KAAOR,EAAMyG,MACpBzG,EAAMyG,MAAMjG,GAAOsL,GAAWtL,EAAKR,EAAMyG,MAAMjG,IAGjD,OAAOR,EAMGiM,IAEFnE,EAAOjG,MAEb,IAAK,eAEH,IAAI4E,EAAQ6B,OAAOC,OAAO,GAAIyC,GAAoBvE,OAClD,IAAK,IAAIjG,KAAOiG,EACdA,EAAMjG,GAAOsL,GAAWtL,EAAKwK,GAAoBvE,MAAMjG,IAGzD,OAAO,2BACFR,GADL,IAEEyG,UAGJ,IAAK,eAEH,IAAK,IAAIjG,KAAOsH,EAAO3B,QACrBlH,OAAOiD,aAAagK,QAAQ1L,EAAKwD,OAAO8D,EAAO3B,QAAQ3F,KAGzD,OAAO,2BACFR,GADL,IAEEyG,MAAOqB,EAAO3B,UAElB,QACE,OAAOnG,IC3CGmM,GAbIC,YAAgB,CAClCrF,cACAqC,YACAV,SACAK,SACAU,YACAI,YACAG,cACAE,YACAS,gBACAxE,a,8JCKckG,GApDD,WAEb,MAAwCC,mBAAS,wCAAjD,oBAAOC,EAAP,KAAqBC,EAArB,KACA,EAAwBF,mBAAS,IAAjC,oBAAOxL,EAAP,KAAa2L,EAAb,KAQA,SAASC,IAEP,IAAIpH,EACiB,yCAAjBiH,EACFjH,EAAG,6CAAyCxE,EAAzC,wBAEuB,WAAjByL,IACTjH,EAAG,yCAAqCxE,EAArC,yBAGL7B,OAAO0N,KAAKrH,GAEZmH,EAAQ,IAIV,OACE,gBAACG,GAAA,EAAD,CAAYC,KAAK,KAAjB,UACE,eAACD,GAAA,EAAWE,QAAZ,UACE,gBAACC,GAAA,EAAD,CAAgB3J,GAAG,gBAAgB4J,MAAM,GAAGH,KAAK,KAAKI,MAAO,CAAEC,YAAa,OAASC,UAAU,SAASC,QAAQ,QAAhH,UACE,eAACC,GAAA,EAASC,KAAV,CAAeC,SAAS,uCAASC,SAAU,kBAAMhB,EAAgB,yCAAjE,kDACA,eAACa,GAAA,EAASC,KAAV,CAAeC,SAAS,SAASC,SAAU,kBAAMhB,EAAgB,WAAjE,yBAGJ,eAACiB,GAAA,EAAD,CACE5L,KAAK,OACL6L,YAAW,UAAKnB,EAAL,oCACXU,MAAO,CAAEC,YAAa,MAAOS,aAAc,QAC3CR,UAAU,QACVS,WAnCN,SAAoB3M,GACJ,UAAVA,EAAET,KACJkM,KAkCEmB,SAAU,SAAA5M,GAAC,OAAIwL,EAAQxL,EAAE6M,OAAOlM,QAChCA,MAAOd,IAET,eAAC8L,GAAA,EAAWmB,OAAZ,CAAmBd,MAAO,CAAEe,WAAY,QAASC,UAAW,OAAQC,aAAc,OAAQC,OAAQ,WAAaC,QAAS1B,EAAxH,SACE,oBAAGS,UAAU,qBAAqBF,MAAO,CAAEoB,OAAQ,aCzCrDC,I,sNAEFF,QAAU,SAACnN,GACP,MAA+B,EAAKc,MAA5B8E,EAAR,EAAQA,SAAU3H,EAAlB,EAAkBA,SACdqP,EAAiBC,KAAYxN,MAAM9B,EAASuP,QAChD5H,EAASD,GAAwB2H,K,6CAGrC,WAEI,IASMG,EATO,CACT,CAAE3C,KAAM,UAAM4C,KAAK,GAAD,OAAK1P,OAAOkL,KAAZ,wBAClB,CAAE4B,KAAM,KAAM4C,KAAK,GAAD,OAAK1P,OAAOkL,KAAZ,wBAClB,CAAE4B,KAAM,MAAO4C,KAAK,GAAD,OAAK1P,OAAOkL,KAAZ,yBACnB,CAAE4B,KAAM,OAAQ4C,KAAK,GAAD,OAAK1P,OAAOkL,KAAZ,0BACpB,CAAE4B,KAAM,OAAQ4C,KAAM,yBACtB,CAAE5C,KAAM,sEAAgB4C,KAAM,wBAGXhN,KAAI,SAACyG,EAAMmC,GAC9B,OACI,eAACqE,GAAA,EAAItB,KAAL,UACI,eAACsB,GAAA,EAAIC,KAAL,CAAUC,KAAM1G,EAAKuG,KAArB,SACKvG,EAAK2D,QAFCxB,MAQvB,OACI,gBAACwE,GAAA,EAAD,CAAQC,GAAG,OAAO5B,QAAQ,OAAO6B,OAAO,KAAKC,MAAM,MAAnD,UACI,eAACH,GAAA,EAAOI,MAAR,CACIL,KAAI,UAAK7P,OAAOkL,MAChBiE,QAASgB,KAAKhB,QAFlB,yBAKA,eAACW,GAAA,EAAOM,OAAR,CAAeC,gBAAc,qBAC7B,gBAACP,GAAA,EAAOQ,SAAR,WACI,eAACX,GAAA,EAAD,CAAKzB,UAAU,UAAf,SACKuB,IAEL,eAACc,GAAA,EAAD,CAAMC,QAAM,EAAZ,SACI,eAAC,GAAD,gB,GA1CHC,cAkDNC,iBAAUC,aAAWtB,K,kBCtBvBuB,GAAgB,SAAC3M,GAE5B,MAAO,CACLrB,KAAM,iBACNgC,KAAMX,IAIG4M,GAAc,SAACzP,GAE1B,MAAO,CACLwB,KAAM,eACNxB,UAyBE0P,GAAc,SAAC/P,GACnB,IAAQ+I,EAAU/I,EAAV+I,MACR,OAAKA,IAGDA,EAAM/B,YAMCgJ,GAAa,SAACjN,GAAD,8CAAsB,WAAO8D,GAAP,uBAAA7D,EAAA,6DAE9C6D,EAhCO,CACLhF,KAAM,sBA6BsC,kBAM/B+F,IAN+B,OAM5C1E,EAN4C,8DAQ5C2D,EAASiJ,GAAY,KAAE3O,UARqB,2BAWtC8O,GAXsC,EAWlB/M,GAApB+M,QAAQC,EAX8B,EAW9BA,UAEDA,EAAQxI,SAGP,qHADVrH,GAAS6P,EAAQC,YAAc,IAAIC,UACA/P,EAAQ,IAC/CwG,EAASgJ,GAAc,CACrBxP,QACA2I,OAAQkH,EAAQxI,QAChBjD,SAAUyL,EAAQ1L,UAClByE,QAASgH,EAAOI,cAGlBxJ,EAASiJ,GAAY,KAxBuB,yDAAtB,uDAsEbQ,GAAkB,SAACvN,GAAD,OAA+B,SAAC8D,EAAeC,GAC5E,GAAIiJ,GAAYjJ,KACd,OAAOD,EAtBY,SAAC9D,GAAD,8CAA+B,WAAO8D,GAAP,SAAA7D,EAAA,6DAEpD6D,EAzGO,CACLhF,KAAM,gBAsG4C,kBAM5C+F,EAAa,CACjBnD,SAAU8L,mBAAmBxN,EAAO0B,UACpCE,SAAU4L,mBAAmBxN,EAAO4B,YARY,OAWlDkC,EAASmJ,MAXyC,gDAclD9P,QAAQG,MAAM,gBAAd,MACAwG,EAASiJ,GAAY,KAAI3O,UAfyB,yDAA/B,sDAsBHqP,CAAQzN,MC/ItB0N,GAAeC,IAAMC,YAAW,WAAwBC,GAAxB,IAAGlP,EAAH,EAAGA,SAAU0M,EAAb,EAAaA,QAAb,OACpC,uBACEwC,IAAKA,EACL3D,MAAO,CAAEkB,OAAQ,WACjBhB,UAAU,OACViB,QAAS,SAACnN,GACRA,EAAE4P,iBACFzC,EAAQnN,IANZ,SASGS,OAICoP,G,oDAIF,WAAY/O,GAAe,IAAD,+BACtB,cAAMA,IAYVgP,aAAe,SAACxD,EAAeyD,GAEV,SAAbzD,GACD,EAAK0D,SAASD,IAdjB,EAAKC,SAAW,EAAKA,SAASC,KAAd,iBAFM,E,6CAK1B,SAASF,GAELA,EAAMH,kBAGNhK,EADqBuI,KAAKrN,MAAlB8E,UD6EQ,uCAAsB,WAAOA,GAAP,SAAA7D,EAAA,sDAE5C6D,EA1DO,CACLhF,KAAM,iBA2DR,IAEE+F,IAEA,MAAO3G,GACPf,QAAQG,MAAMY,GAGhB4F,EA7DO,CACLhF,KAAM,oBA6DRgF,EAASmJ,MAbmC,2CAAtB,yD,oBCjEpB,WAEI,MAA6BZ,KAAKrN,MAA1B8I,EAAR,EAAQA,OAAQsG,EAAhB,EAAgBA,SAChB,OACI,sBAAKlE,MAAO,CAACmE,MAAO,QAApB,SACI,gBAAC/D,GAAA,EAAD,CAAUjK,GAAG,uBAAuBoK,SAAU4B,KAAK2B,aAAnD,UACI,2EACA,gBAAC1D,GAAA,EAASgC,OAAV,CAAiBgC,GAAIZ,GAAca,OAAO,SAA1C,UAAoDH,EAApD,aACA,gBAAC9D,GAAA,EAASkE,KAAV,WACI,eAAClE,GAAA,EAASC,KAAV,CAAeC,SAAS,UAAUuB,KAAI,UAAK7M,EAAL,yBAA4B4I,GAAlE,wDACA,eAACwC,GAAA,EAASC,KAAV,CAAeC,SAAS,WAAWuB,KAAI,UAAK7P,OAAOkL,KAAZ,8BAAsCU,GAA7E,yDACA,eAACwC,GAAA,EAASmE,QAAV,IACA,eAACnE,GAAA,EAASC,KAAV,CAAeC,SAAS,UAAUuB,KAAI,UAAK7P,OAAOkL,KAAZ,gBAAtC,oEACA,eAACkD,GAAA,EAASmE,QAAV,IACA,eAACnE,GAAA,EAASC,KAAV,CAAeC,SAAS,OAAxB,wD,GAvCCmC,aA+CRC,iBAAUC,aAAWkB,K,SClEhCW,G,oDAKF,WAAY1P,GAAQ,IAAD,+BACf,cAAMA,IAKV2P,QAAU,SAACV,GAEPA,EAAMH,iBAEN,IAAQhK,EAAa,EAAK9E,MAAlB8E,SAEF9D,EAAS,CACX0B,SAAU,EAAKA,SAASkN,QAAQ/P,MAChC+C,SAAU,EAAKA,SAASgN,QAAQ/P,OAEpCiF,EAASyJ,GAAgBvN,KAdzB,EAAK0B,SAAWiM,IAAMkB,YACtB,EAAKjN,SAAW+L,IAAMkB,YAHP,E,2CAmBnB,WAEI,OACI,iCACI,wBAAM7F,KAAK,YAAYoB,UAAU,WAAWF,MAAO,CAAC4E,SAAU,QAA9D,UACI,eAACpE,GAAA,EAAD,CACI5L,KAAK,OACL6L,YAAY,qBACZkD,IAAKxB,KAAK3K,SACVoI,KAAK,KACLI,MAAO,CAACC,YAAa,MAAO4E,KAAM,eAEtC,eAACrE,GAAA,EAAD,CACI5L,KAAK,WACL6L,YAAY,uCACZqE,UAAU,KACVC,aAAa,MACbpB,IAAKxB,KAAKzK,SACVkI,KAAK,KACLI,MAAO,CAACC,YAAa,MAAO4E,KAAM,eAEtC,eAACG,GAAA,EAAD,CACIpF,KAAK,KACLO,QAAQ,QACRgB,QAASgB,KAAKsC,QAHlB,+CAMJ,qBAAGzE,MAAO,CAACiF,OAAQ,OAAnB,uHAAgD,oBAAGpD,KAAK,0BAAR,+BAChD,oBAAGqD,IAAI,WAAWrD,KAAK,+CAAvB,gFACA,uBAAM7B,MAAO,CAAEiF,OAAQ,OAAvB,eACA,oBAAGC,IAAI,WAAWrD,KAAK,+CAAvB,+F,GAtDQY,aAgEPC,gBAJO,SAAC3P,GACrB,OAAOA,EAAM+I,QAGA4G,CAAyB8B,IC3D3BW,I,OATG,SAACrQ,GACjB,OAAKA,EAAMjB,KAIT,sBAAKqM,UAAU,QAAQkF,wBAAyB,CAAEC,OAAQvQ,EAAMjB,QAHzD,OCILyR,G,2KAEF,YAEI1L,EADqBuI,KAAKrN,MAAlB8E,WJkGwC,SAACA,EAAeC,GACtE,GAAIiJ,GAAYjJ,KACd,OAAOD,EAASmJ,W,oBIhGhB,WAEI,IAEIwC,EAFJ,EAAsDpD,KAAKrN,MAAnD+G,EAAR,EAAQA,OAAQE,EAAhB,EAAgBA,OAAQvE,EAAxB,EAAwBA,SAAUpE,EAAlC,EAAkCA,MAAOwG,EAAzC,EAAyCA,SAUzC,OANI2L,GADW,IAAX1J,EACO,eAAC,GAAD,CAAYjC,SAAUA,EAAUgE,OAAQ7B,EAAQmI,SAAU1M,KACjD,IAAXqE,EACE,eAAC,GAAD,IAEA,KAGP,gBAAC,WAAD,WACK0J,EACAnS,GAAS,eAAC,GAAD,CAAWS,KAAMT,W,GAtBvBqP,aAiCHC,gBALO,SAAC3P,GAErB,OAAOA,EAAM+I,QAGA4G,CAAyB4C,IC3B7BE,GAAkB,SAACvP,GAAD,MAA+C,CAC5ErB,KAAM,mBACN4E,MAAOvD,EACPwD,WAAY,IAAIC,OA+BL+L,GAAwB,kBAAW,SAAC7L,EAAeC,GAC9D,GAjB0B,SAAC9G,GAE3B,IAAMoJ,EAAWpJ,EAAMoJ,SAEvB,OAAKA,IAGDA,EAASpC,cAGToC,EAAS3C,MAAM7C,OAAS,GAOxB+O,CAAoB7L,KACtB,OAAOD,EA9BkB,uCAAW,WAAOA,GAAP,iBAAA7D,EAAA,6DAGtC6D,EAbsD,CACtDhF,KAAM,qBASgC,SAKD+F,IALC,OAKhC1E,EALgC,OAOlC0P,EAAUH,GAAgBvP,GAC9B2D,EAAS+L,GAR6B,2CAAX,yDCEvBC,G,+MAOJrF,SAA2D,SAACvM,GAE1D,MAA4B,EAAKc,MAAzB0E,EAAR,EAAQA,MAAOoH,EAAf,EAAeA,SAEf,GAAIA,EAAU,CACZ,IAAMvE,EAASrI,EAAE6R,cAAclR,MACzBgE,EAAMa,EAAMgE,QAAO,SAAA1G,GAAG,OAAIA,EAAIuF,SAAWA,KAC3C1D,EAAIhC,OAAS,EACfiK,EAAS5M,EAAG2E,EAAI,IAEhBiI,EAAS5M,EAAG,Q,wDAflB,YAEE4F,EADqBuI,KAAKrN,MAAlB8E,UACC6L,Q,oBAiBX,WAEE,MAA0DtD,KAAKrN,MAAvDqB,EAAR,EAAQA,GAAI+F,EAAZ,EAAYA,KAAM6C,EAAlB,EAAkBA,aAAc+G,EAAhC,EAAgCA,SAAU9F,EAA1C,EAA0CA,MAAOJ,EAAjD,EAAiDA,KAE7CmG,EAAe,GACnB,IAAK,IAAIvL,KAAS0B,EAAM,CAEtB,IAAI8J,EACF,2BAAsBC,MAAOzL,EAA7B,SACG0B,EAAK1B,GAAO9F,KAAI,SAACyG,EAAMmC,GAAP,OACf,yBAAsB3I,MAAOwG,EAAKkB,OAAlC,SACGlB,EAAKmB,OADKnB,EAAKhF,QAFPqE,GAQjBuL,EAAapS,KAAKqS,GAGpB,OACE,gBAACzD,GAAA,EAAK2D,QAAN,CAAc9B,GAAG,SACfxD,SAAUuB,KAAK5B,SACf5L,MAAOmR,EACP9F,MAAOA,EACPE,UAAU,QACVN,KAAMA,EACNzJ,GAAIA,EANN,UAQE,yBAAQxB,MAAM,GAAd,SAAkBoK,IACjBgH,S,GAlDmBtD,aAmEZC,gBAXQ,SAAC3P,GAEvB,MAAwBA,EAAMoJ,SAE9B,MAAO,CACL3C,MAHF,EAAQA,MAIN0C,KAJF,EAAeA,QASDwG,CAAyBkD,IC/EnCO,G,+MAOFC,gBAAkB,SAACpS,EAAGW,GACdA,EACA,EAAKG,MAAMuR,QAAQ1S,KAAnB,6BAA8CgB,EAAM0H,SAEpD,EAAKvH,MAAMuR,QAAQ1S,KAAnB,M,wDATR,YAEIiG,EADqBuI,KAAKrN,MAAlB8E,UACC6L,Q,oBAUb,WAEI,IAAQxT,EAAakQ,KAAKrN,MAAlB7C,SACF6D,EAASyL,KAAYxN,MAAM9B,EAASuP,QAE1C,OACI,uBAAKtB,UAAU,WAAf,UACI,sBAAKA,UAAU,UAAf,SACI,eAAC,GAAD,MAEJ,sBAAKA,UAAU,aAAaF,MAAO,CAACe,WAAY,QAAhD,SACI,eAAC,GAAD,CACIhC,aAAa,8DACb+G,SAAUhQ,EAAOwE,QACjBsG,SAAUuB,KAAKiE,gBACfxG,KAAK,gB,GA7BR6C,aAqCJC,iBAAUC,aAAWwD,K,6BClBvBG,GA9BD,SAACxR,GAEX,IAAQV,EAAkBU,EAAlBV,KAAMgH,EAAYtG,EAAZsG,QAEVmL,EAAQ,GACZ,GAAInS,EAAO,IAEP,IADA,IAAIoS,EAAUrS,EAAWC,GAChBkJ,EAAI,EAAGA,GAAKkJ,EAASlJ,IAAK,CAC/B,IAAIuE,EAAI,wBAAoBzG,EAApB,iBAAoCkC,GACxCzJ,OAAI,EAEJA,EADAyJ,EAAI,GAAKA,EAAIkJ,EACN,SAEAlJ,EACXiJ,EAAM5S,KAAK,eAAC,IAAD,CAAeuM,UAAU,MAAMF,MAAO,CAAEiF,OAAQ,OAASvO,GAAImL,EAA7D,SAAoEhO,GAAzDyJ,IAI9B,GAAIlJ,EAAO,GAAI,CACX,IAAIyN,EAAI,wBAAoBzG,EAApB,kBACRmL,EAAM5S,KAAK,eAAC,IAAD,CAAmBuM,UAAU,MAAMF,MAAO,CAAEiF,OAAQ,OAASvO,GAAImL,EAAjE,iBAAU,WAGzB,OACI,uBAAM3B,UAAU,cAAhB,SACKqG,KCJPE,G,2KAEF,c,oBAIA,WAEI,IAQI9J,EARJ,EAAwBwF,KAAKrN,MAArB8B,EAAR,EAAQA,KAAMkF,EAAd,EAAcA,MAEV+F,EAAI,wBAAoBjL,EAAKT,IAC7BuQ,EAAUC,KAAW,MAAO,MAAO,CACnC,KAAQ/P,EAAKxC,MAAQ,IACrB,SAAYwC,EAAKgQ,QAAU9K,EAAMtE,WAId,IAAnBZ,EAAKiQ,YACLlK,EAAW,uBAAMuD,UAAU,gBAAhB,qBAGf,IACI5F,EAWAwM,EACAC,EAbAC,EAAW,6BAAyBpQ,EAAKqQ,OAGzCrQ,EAAKsQ,QACL5M,EACA,wBAAM4F,UAAU,gBAAhB,UACI,uBAAMA,UAAU,MAAMF,MAAO,CAACiF,OAAQ,WAAtC,eACA,eAAC,IAAD,CAAcC,IAAI,WAAWhF,UAAU,MAAMxJ,GAAIsQ,EAAjD,SAAgEpQ,EAAKsQ,OAA3D,SAOlB,IAAIrT,EAAO+C,EAAK/C,KAgBhB,OAfI+C,EAAKkQ,SACLA,EAAS,uBAAM5G,UAAU,MAAhB,mBAEK,IAAdtJ,EAAKmQ,OACLA,EAAO,uBAAM7G,UAAU,MAAhB,qBAEQ,QAAftJ,EAAKqQ,OAAyC,QAAtBpT,EAAKsT,OAAO,EAAG,GACvCtT,EAAO,QAAUA,EAEG,SAAf+C,EAAK4D,OAA0C,QAAtB3G,EAAKsT,OAAO,EAAG,GAC7CtT,EAAO,QAAUA,EAEG,OAAf+C,EAAKqQ,OAAwC,OAAtBpT,EAAKsT,OAAO,EAAG,KAC3CtT,EAAO,OAASA,GAGhB,uBAAKqM,UAAU,aAAf,UACI,eAAC,IAAD,CAAMxJ,GAAImL,EAAM3B,UAAWwG,EAAStB,wBAAyB,CAAEC,OAAQxR,GAAQmM,MAAO,CAACoH,aAAc,cACpGzK,EACD,eAAC,GAAD,CAAOvI,KAAMwC,EAAKxC,KAAMgH,QAASxE,EAAKT,KACrC2Q,EACAC,EACAzM,S,GA1DWmI,aAyEXC,gBARO,SAAC3P,GAErB,MAAO,CACH+I,MAAO/I,EAAM+I,MACb4B,aAAc3K,EAAM2K,gBAIXgF,CAAyB+D,ICpD7BY,GAAe,SAAChK,GAAD,OAA4B,SAACzD,GACvDA,EAAS,CACPhF,KAAM,gBACNyI,WCvBEiK,G,oDAIJ,WAAYxS,GAAQ,IAAD,wBACjB,cAAMA,IA8BRyS,YAAc,SAACxD,GACbA,EAAMyD,UACN,IAAQjJ,EAAiB,EAAKzJ,MAAtByJ,aACR,EAAKkJ,MAAQC,YAAW,kBAAM,EAAKC,YAAY5D,MAASxF,IAlCvC,EAqCnB4C,QAAU,SAAC4C,GACTA,EAAM6D,kBACNC,aAAa,EAAKJ,OAClB,EAAKE,YAAY5D,IAxCA,EA2CnB+D,WAAa,SAAC/D,GACZ8D,aAAa,EAAKJ,QA5CD,EA+CnBE,YAAc,SAAC3T,GACb,MAAiD,EAAKc,MAA9CsG,EAAR,EAAQA,QAASrG,EAAjB,EAAiBA,QAajB6E,EAbA,EAAyBA,UD9CF,SAACyD,EAAmBE,GAApB,8CAA4C,WAAO3D,GAAP,SAAA7D,EAAA,sDAEnD,UAAdsH,EAAKzI,MAAkC,kBAAdyI,EAAKzI,MAOhCgF,EAL+B,CAC7BhF,KAAM,iBACNyI,OACAE,WAPiE,2CAA5C,sDC2DdwK,CANI,CACXnT,KARF,EAAmCoT,UAQf,gBAAkB,QACpC5M,UACArG,UARa,CACbrB,EAAGM,EAAEiU,MACLC,EAAGlU,EAAEmU,MAAQ,OAjDf,MAA6B,EAAKrT,MAA1BL,EAAR,EAAQA,SAAUM,EAAlB,EAAkBA,OAHD,OAKf,EAAKhC,MADH0B,EACW,CAAEZ,KAAMW,EAAeC,GAAUoE,KAAK,KAEtC,CAAEhF,KAAMkD,OAAOhC,IAPb,E,qEAUnB,SAAiCD,GAC1BA,EAAML,UACT0N,KAAKiG,SAAS,CAAEvU,KAAMkD,OAAOjC,EAAMC,Y,+BAIvC,WAAqB,IAAD,OAElB,GAAIoN,KAAKpP,MAAMc,KAAKwU,WAAW,QAAS,CAEtC,IAAQjN,EAAY+G,KAAKrN,MAAjBsG,QACR/E,EAAa,CAAEF,GAAIiF,IAChB3I,MAAK,SAAAsG,GACJ,EAAKqP,SAAS,CACZvU,KAAMkF,EAASlF,a,oBA2CzB,WAEE,MAAyCsO,KAAKrN,MAAtCsG,EAAR,EAAQA,QAASrG,EAAjB,EAAiBA,OAAQiL,EAAzB,EAAyBA,MAAO/I,EAAhC,EAAgCA,KAC1BgD,EAAO9F,EAAWY,GAEpBuT,EAAY,GA6BhB,OA5BIrO,EAAO,IACTqO,EAAS,gBAAYrO,IAGnBmB,IAAYnE,EAAKd,IAAOoS,MAAMpG,KAAKpP,MAAMc,MAYzC,kCACE,oBAAGgO,KAAI,UAAK7P,OAAOkL,KAAZ,yBAAiC9B,GAAjC,OAA2CkN,EAA3C,YAAwDvT,GAC7DiL,MAAK,eAAOA,GADd,SAEEmC,KAAKpP,MAAMc,OAAU,IAHzB,IAIa,uBAAM0T,YAAapF,KAAKoF,YACjCO,WAAY3F,KAAK2F,WACjB3G,QAASgB,KAAKhB,QACdjB,UAAU,OAHD,SAITnL,IARJ,OAVA,uBACEwS,YAAapF,KAAKoF,YAClBO,WAAY3F,KAAK2F,WACjB3G,QAASgB,KAAKhB,QACdjB,UAAU,OACVF,MAAK,eAAOA,GALd,SAMEmC,KAAKpP,MAAMc,W,GAzFI4O,aA0HTC,gBAbQ,SAAC3P,GAEvB,MAEIA,EAAM0I,MAEV,MAAO,CACLjC,MALF,EACEA,MAKAvC,KANF,EACSA,KAMPsH,aAAcxL,EAAMmG,QAAQM,MAAd,gBAIFkJ,CAAyB4E,ICzInCkB,G,+MAEFrH,QAAU,WACN,MAA8B,EAAKrM,MAA3BsG,EAAR,EAAQA,SAERxB,EAFA,EAAiBA,UAER,CACLhF,KAAM,iBACNwG,a,6CAIR,WAEI,IACIvH,EAMJ,OAJIA,EAHiBsO,KAAKrN,MAAlB2T,SAGG,IAEA,IAGP,sBAAKvI,UAAU,oBAAoBiB,QAASgB,KAAKhB,QAAjD,SACI,gCAAOtN,U,GAtBG4O,aA6BTC,iBAAU8F,ICyCX9F,gBARQ,SAAC3P,GAEvB,MAAO,CACL+I,MAAO/I,EAAM+I,MACb0C,wBAAyBzL,EAAMmG,QAAQM,MAAMgF,2BAIjCkE,EAtDJ,SAAC5N,GAEX,IAAQ8B,EAAkC9B,EAAlC8B,KAAM4H,EAA4B1J,EAA5B0J,wBACVkK,EAAO,IAAIhP,KAAmB,KAAb9C,EAAKiH,OAM1B,OAFE6K,E7BnCG,SAAeC,GAClB,IAAIC,EAAI,IAAIlP,KACZ,OAAOiP,EAAGE,YAAcD,EAAEC,WAAaF,EAAGG,aAAeF,EAAEE,YAAcH,EAAGI,gBAAkBH,EAAEG,c6B8B9FC,CAAMN,GACDO,aAAWP,EAAM,SAEjBO,aAAWP,EAAM,YAGxB,uBAAKxI,UAAU,kBAAf,UAEE,sBAAKA,UAAU,aAAf,SACGtJ,EAAK4D,QAER,sBAAK0F,UAAU,eAAf,SACGtJ,EAAKsQ,QAER,uBAAKhH,UAAU,YAAf,UACE,oBAAGA,UAAU,mBAAmBgJ,cAAY,OAAOlJ,MAAO,CAACC,YAAa,SAC3C,SAA5BzB,EACC,eAAC,GAAD,CAAYpD,QAASxE,EAAKT,GAAIpB,OAAQ6B,EAAKxC,KAAM4L,MAAO,CAAEmJ,MAAO,WAAanB,WAAS,IAEvFpR,EAAKxC,QAGT,eAAC,GAAD,CAAagH,QAASxE,EAAKT,GAAIsS,SAAU7R,EAAK2E,cAC9C,eAAC,GAAD,CAAe3E,KAAMA,IACrB,uBAAKsJ,UAAU,cAAf,UACE,oBAAGgJ,cAAY,OAAOhJ,UAAU,oBAAoBF,MAAO,CAACC,YAAa,SACxErJ,EAAKgQ,SAER,sBAAK1G,UAAU,gBAAf,SACE,uBAAKF,MAAO,CAAEoJ,QAAS,QAAvB,UACE,uBAAMlJ,UAAU,qBAAhB,SAAsCwI,IACtC,uBAAMxI,UAAU,qBAAhB,SAAsCtJ,EAAK+G,YAG/C,sBAAKuC,UAAU,cAAf,SACE,eAAC,IAAD,CAAMxJ,GAAE,wBAAmBK,OAAOH,EAAKT,IAA/B,gBAAkD6J,MAAO,CAAEmJ,MAAO,UAAWC,QAAS,QAASC,MAAO,OAAQC,UAAW,UAAjI,SAA8I,c,UCrBvIhD,I,OAjCD,SAACxR,GAEb,IACIyU,EADIjI,EAA6CxM,EAA7CwM,eAAgBkI,EAA6B1U,EAA7B0U,QAAShD,EAAoB1R,EAApB0R,QAASiD,EAAW3U,EAAX2U,OAKxCF,EAHGjI,EAAerH,KAEa,WAAxBqH,EAAerH,KACR,SAEAyP,SAASpI,EAAerH,KAAM,KAAO,EAJrC,EAOhB,IADA,IAAIsM,EAAQ,GACHjJ,EAAI,EAAGA,GAAKkJ,EAASlJ,IAAK,CACjC,IAAIxH,EAAM,2BAAQwL,GAAR,IAAwBrH,KAAMqD,IACpCuE,EAAO,UAAG7P,OAAOkL,KAAV,YAAkBsM,GAAYlS,EAAe,IAAKxB,GAE7DyQ,EAAM5S,KAAK,eAACgW,GAAA,EAAWtJ,KAAZ,CAAiBuJ,OAAQL,IAAgBjM,EAAWuE,KAAMA,EAA1D,SAAiEvE,GAAhBA,IAG9D,IAAe,IAAXmM,EAAiB,CACnB,IAAI3T,EAAM,2BAAQwL,GAAR,IAAwBrH,KAAM,WACpC4H,EAAO,UAAG7P,OAAOkL,KAAV,YAAkBsM,GAAYlS,EAAe,IAAKxB,GAC7DyQ,EAAM5S,KAAK,eAACgW,GAAA,EAAWtJ,KAAZ,CAAiBuJ,OAAwB,WAAhBL,EAAuC1H,KAAMA,EAAtE,iBAAuD,WAGpE,OACE,eAAC8H,GAAA,EAAD,CAAY3J,MAAO,CAAEiF,OAAQ,OAA7B,SACGsB,M,SC0BMsD,GAAuB,SAAC/T,GAAD,OAAqC,SAAC8D,EAAeC,GACvF,GAZgC,SAAC9G,GACjC,IAAM6J,EAAW7J,EAAM6J,SACvB,QAAKA,IAGDA,EAAS7C,WAOT+P,CAAmBjQ,KACrB,OAAOD,EAASpB,GAAa1C,MAI3B0C,GAAe,SAAC1C,GAAD,8CAAgC,WAAO8D,GAAP,iBAAA7D,EAAA,sDAgBnD,GAdA6D,EAAS,CACPhF,KAAM,yBAGJmV,EAA+B,CACjCC,aAAc1G,mBAAmBxN,EAAOjC,MACxCoW,WAAY3G,mBAAmBxN,EAAO4G,SACtCwN,eAAgBnT,OAAOjB,EAAOwE,SAC9B6P,aAAcrU,EAAO0E,MAAMqC,cAC3BhC,OAAQ,MACRuP,IAAK/V,KAAKgW,MAAsB,KAAhBhW,KAAKiW,UACrBC,OAAQzU,EAAO6G,SAAW,EAAI,GAG5B7G,EAAO0U,YACT,IAASlN,EAAI,EAAGA,EAAIxH,EAAO0U,YAAY7T,OAAQ2G,IAC7CyM,EAAY,UAAD,OAAWzM,EAAI,IAAOxH,EAAO0U,YAAYlN,GAlBL,gBAqB7C3C,EAAiBoP,GArB4B,OAuBnDnQ,EAAS,CACPhF,KAAM,4BAGJkB,EAAO2U,WACT3U,EAAO2U,YA5B0C,2CAAhC,uD,UCpDfC,I,2DAIJ,WAAY5V,GAAQ,IAAD,+BACjB,cAAMA,IAIR6V,eAAiB,SAAC3W,GAEhBA,EAAE4P,iBAEF,IAGIgH,EAAgB,EAAKA,SAASlG,QAE9BmG,EAAQD,EAASE,eACjBC,EAAMH,EAASI,aAEfC,EAAUL,EAASjW,MACnBuW,EAAMD,EAAQtU,OAEdwU,EAXU,SAUKF,EAAQG,UAAUP,EAAOE,GAT7B,UAWXM,EAAUJ,EAAQG,UAAU,EAAGP,GAASM,EAAcF,EAAQG,UAAUL,EAAKG,GAEjF,EAA+B,EAAKpW,OACpC8E,EADA,EAAQA,UACC,CACPhF,KAFF,EAAkB0W,SAEC,QACjBzX,KAAMwX,KA1BS,EA+BnBE,eAAiB,SAACvX,IAEhB4F,EADqB,EAAK9E,MAAlB8E,UACC,CACPhF,KAAM,cACNgC,KAAM5C,EAAE6R,cAAc2F,WAnCP,EAuCnB5K,SAAW,SAAC5M,GACV,MAA+B,EAAKc,OACpC8E,EADA,EAAQA,UACC,CACPhF,KAFF,EAAkB0W,SAEC,QACjBzX,KAAMG,EAAE6R,cAAclR,SA3CP,EA+CnBgM,WAAa,SAAC3M,GAEZ,GAAc,UAAVA,EAAET,KAAmBS,EAAEyX,QAAS,CAElC,IADA,IAAIC,EAAS1X,EAAE6R,cAAc8F,cACtBD,GAA2C,SAAjCA,EAAOE,QAAQC,eAC9BH,EAASA,EAAOC,cAEdD,GACFA,EAAOI,cAAc,IAAIC,MAAM,SAAU,CAAEC,YAAY,EAAMC,SAAS,OArD1E,EAAKrB,SAAWnH,IAAMkB,YAFL,E,2CA4DnB,WAEE,MAAgExC,KAAKrN,MAA7D2L,EAAR,EAAQA,YAAayL,EAArB,EAAqBA,WAAYvP,EAAjC,EAAiCA,SAAU5C,EAA3C,EAA2CA,WAAYlG,EAAvD,EAAuDA,KAEvD,OACE,iCACE,eAAC2M,GAAA,EAAD,CACE4D,GAAG,WACH3D,YAAaA,EACb0L,KAAK,KAAKC,KAAK,IACfzX,MAAOd,EACP+M,SAAUuB,KAAKvB,SACfD,WAAYwB,KAAKxB,WACjBgD,IAAKxB,KAAKyI,SACV1K,UAAU,sBAEZ,uBAAKA,UAAU,WAAf,UACE,gBAACmM,GAAA,EAAD,WACE,eAACrH,GAAA,EAAD,CACEpF,KAAK,KACLO,QAAQ,QACRgB,QAASgB,KAAKwI,eACd3K,MAAO,CAAEC,YAAa,OACtBC,UAAU,SALZ,wCAOA,eAAC8E,GAAA,EAAD,CACEpF,KAAK,KACLO,QAAQ,QACRmM,SAAUvS,EACVnF,KAAK,SACLsL,UAAU,SALZ,SAOGnG,EAAa,2EAAiB,8DAGlCmS,GACC,eAAC3J,GAAA,EAAKgK,MAAN,CACE3X,KAAK,WACL4W,QAAS7O,EACTiE,SAAUuB,KAAKoJ,eACftF,MAAM,qEACNjG,MAAO,CAAEiF,OAAQ,kC,GAzGNxC,cAkHTC,iBAAUgI,ICrGpB8B,I,sNAIJC,gBAAkB,SAACzY,EAAQsG,GACzB,IAAQV,EAAa,EAAK9E,MAAlB8E,SACR,EAAK8S,eAAiBpS,EAOtBV,EAL+B,CAC7BhF,KAAM,oBACN0F,a,EAMJqS,SAAW,SAAC3Y,GAEVA,EAAE4P,iBACF,MAA+B,EAAK9O,MAA5B8E,EAAR,EAAQA,SAAUgD,EAAlB,EAAkBA,SAGlB,GAAK,EAAK8P,eAAV,CASA,IAAIhQ,EAAUE,EAASF,QACvB,GAAKA,EASL,GAAKE,EAAS/I,KAAd,CAUA,IAAIiC,EAA6B,CAC/B4G,UACA7I,KAAM+I,EAAS/I,KACfyG,QAAS,EAAKoS,eAAevW,GAC7BqE,MAAO,EAAKkS,eAAelS,MAC3BmC,SAAUC,EAASD,SACnB6N,YAAa,GACbC,UAAW,EAAKmC,iBAGlB,GAAIhQ,EAASD,SAAU,CACrB7G,EAAO0U,YAAc,GACrB,IAAK,IAAIlN,EAAI,EAAGA,GAAK,GAAIA,IAAK,CAC5B,IAAIxG,EAAM,EAAK+V,KAAL,cAAiBvP,IAAK3I,MAC5BmC,GACFhB,EAAO0U,YAAY7W,KAAKmD,IAK9B8C,EAASiQ,GAAqB/T,SAzB5B8D,EAJS,CACPhF,KAAM,uBACNxB,MAAO,wHAPTwG,EAJS,CACPhF,KAAM,uBACNxB,MAAO,0FARTwG,EAJS,CACPhF,KAAM,uBACNxB,MAAO,kG,EAiDb0Z,gBAAkB,SAAC9Y,IAGjB4F,EADqB,EAAK9E,MAAlB8E,UACC,CACPhF,KAAM,oBACNf,KAAMG,EAAE6M,OAAOlM,S,EAMnBiY,gBAAkB,YAGhBhT,EADqB,EAAK9E,MAAlB8E,UACC,CACPhF,KAAM,kBACNf,KAAM,KAGJ,EAAKiB,MAAM8X,iBACb,EAAK9X,MAAM8X,mB,6CAIf,WAEE,MAA+BzK,KAAKrN,MAA5BqH,EAAR,EAAQA,SAAUS,EAAlB,EAAkBA,SAEdmQ,EAAa,GACjB,IAAK,IAAIvS,KAAS2B,EAASD,KACzB6Q,EAAWpZ,KAAK,yBAAoBgB,MAAO6F,EAAMqC,cAAjC,SAAiDrC,GAApCA,IAG/B,IAAIwS,EAAgB,GAEpB,GAAIpQ,EAASD,SAAU,CACrBqQ,EAAcrZ,KAAK,oFAAS,MAC5B,IAAK,IAAI2J,EAAI,EAAGA,GAAK,GAAIA,IACvB0P,EAAcrZ,KACZ,gBAACgM,GAAA,EAAD,CAAoBC,KAAK,KAAKI,MAAO,CAAEiB,aAAc,MAAOoI,MAAO,QAAnE,UACE,eAAC1J,GAAA,EAAWE,QAAZ,UACE,eAACF,GAAA,EAAWsN,KAAZ,CACEjN,MAAO,CAAEqJ,MAAO,QAAUnJ,UAAU,QADtC,mBAEM5C,EAFN,SAKF,eAACiF,GAAA,EAAK2D,QAAN,CACEtR,KAAK,OACLkQ,UAAU,KACVnB,IAAG,cAASrG,GACZ4C,UAAU,YAXG5C,IAkBvB,OACE,wBAAM4C,UAAU,sBAAsByM,SAAUxK,KAAKwK,SAArD,UACE,uBAAKxW,GAAG,gBAAgB+J,UAAU,iBAAlC,UACE,+BAAK,4FACJtD,EAASxJ,OAAS,eAAC,GAAD,CAAWS,KAAM+I,EAASxJ,QAC7C,uBAAK8M,UAAU,WAAWF,MAAO,CAAEiB,aAAc,OAAjD,UACE,eAACsB,GAAA,EAAK2D,QAAN,CAAc9B,GAAG,SACfxE,KAAK,KACLsN,UAAU,EACVvY,MAAOiI,EAASpC,MAChBwF,MAAO,CAAE6E,KAAM,YACf3E,UAAU,QALZ,SAOG6M,IAEH,eAAC,GAAD,CACEhO,aAAa,uCACb5I,GAAG,iBACHyJ,KAAK,KACLI,MAAO,CAAE6E,KAAM,YACfjE,SAAUuB,KAAKsK,qBAGnB,eAAClK,GAAA,EAAK2D,QAAN,CACEtR,KAAK,OACLgL,KAAK,KACLjL,MAAOiI,EAASF,QAChBkE,SAAUuB,KAAK2K,gBACf9M,MAAO,CAAEiB,aAAc,OACvBf,UAAU,QACVO,YAAY,2BACZqE,UAAU,OAEZ,eAAC,GAAD,CACErE,YAAY,yDACZyL,YAAY,EACZvP,SAAUC,EAASD,SACnB9I,KAAM+I,EAAS/I,KACfkG,WAAY6C,EAAS7C,WACrBuR,SAAS,iBAGb,eAAC6B,GAAA,EAAD,CAAWjN,UAAU,mBAArB,SACG8M,W,GA9KYvK,cA6LPC,gBARQ,SAAC3P,GAEvB,MAAO,CACLoJ,SAAUpJ,EAAMoJ,SAChBS,SAAU7J,EAAM6J,YAIJ8F,CAAyB8J,I,oBCmD1BY,OAjRf,SAAmBvZ,GAEjB,IAmBIwZ,EACAC,EACAC,EArBEC,EAAW,IAAIC,IACnB,yqDACGC,MAAM,MAGLC,EAAa,IAAIF,IAAI,oBAAoBC,MAAM,KAI/CE,EAAY,MACZC,EAAa,OACbC,EAAc,OAKdC,EAAuB,OAOzBC,GAAU,EACVC,EAAQ,GAEZ,SAASC,EAAaC,GACpB,MAAyB,KAAlBA,EAAOhL,OAGhB,SAASiL,EAAKD,EAAQE,EAAKC,GACzB,OAAOH,EAAOhH,OAAOkH,EAAM,EAAGC,GAGhC,SAASC,EAAKJ,EAAQG,GACpB,OAAOH,EAAOhH,QAAQmH,GAGxB,SAASE,EAAUC,GACjB,OAAOjB,EAASkB,IAAID,EAAM5R,cAAcsG,QAG1C,SAASwL,EAAsBC,EAAOC,GAEtB,MAAVD,GAAiBrB,IAAkBsB,EACrCxB,GAAoCuB,GAEhCtB,IACFD,GAzCY,UA0CZC,GAAiB,GAGnBD,EAAkBA,EA9CH,eA8CkCwB,EAAOD,EACxDtB,GAAiB,EACjBC,EAAgBsB,GAIpB,SAASC,EAAkBC,GAGzB,IAAIC,GAAgB,EAChBC,GAAgB,EAChBC,EAAe,EACfC,GAAe,EAIfC,EAAM,EACV,IAAKA,EAAM,EAAGA,GAAOL,EAAWpY,OAAQyY,IAAO,CAE7C,IAAIC,EAAgBN,EAAWO,OAAOF,EAAM,GAC5C,GAAIpB,EAGoB,MAAlBqB,GAEFV,EAAsBP,EAAKW,EAAYG,EAAcE,EAAMF,EAAe,GAAIpB,GAC9EE,GAAU,EACVC,EAAQ,GACRkB,GAAe,GAEflB,GAAgBoB,OAGb,GAAIL,EAGa,MAAlBK,GAEFV,EAAsBP,EAAKW,EAAYG,EAAcE,EAAMF,EAAe,GAAIpB,GAC9EkB,GAAgB,EAChBf,EAAQ,GACRkB,GAAe,GAEflB,GAAgBoB,OAGb,GAAsB,MAAlBA,EAEJnB,EAAaD,GAkBhBZ,GAAoC,KAfhC4B,GACFN,EAAsBV,EAAQ,IAAKH,GACnCmB,GAAgB,GAEPT,EAAUP,EAAM9K,QACzBwL,EAAsBV,EAAQ,IAAKF,GAEzBxF,MAAMmB,SAASuE,EAAO,KAIhCU,EAAsBV,EAAQ,IAAKL,GAHnCe,EAAsBV,EAAQ,IAAKJ,GAKrCI,EAAQ,IAIVkB,GAAe,OAEV,GAAIxB,EAAWe,IAAIW,GAAgB,CA6BxC,GA1BKnB,EAAaD,KAGZgB,GAEFN,EAAsBV,EAAOH,GAC7BmB,GAAgB,EAChBE,EAAkC,MAAlBE,GAEPF,GAAgBX,EAAUP,IACnCU,EAAsBV,EAAOF,GAC7BoB,EAAkC,MAAlBE,IAIX9G,MAAMmB,SAASuE,EAAO,KAIzBU,EAAsBV,EAAOL,GAH7Be,EAAsBV,EAAOJ,GAK/BsB,EAAkC,MAAlBE,GAElBpB,EAAQ,IAGY,MAAlBoB,GAAyB9B,IAAkBM,EAAY,CAEzDc,EAAsBU,EAAexB,GACrC,SAEK,GAAsB,MAAlBwB,GAA0D,MAAjCjB,EAAKW,EAAYK,EAAM,EAAG,GAE5D7B,OAAgB3U,OAEX,GAAsB,MAAlByW,GAA0D,MAAjCjB,EAAKW,EAAYK,EAAM,EAAG,GAG5D,YADAT,EAAsBJ,EAAKQ,EAAYA,EAAWpY,OAASyY,EAAM,GArJhD,QAwJnBT,EAAsBU,EAvJH,YAyJd,GAAsB,MAAlBA,GAA2C,MAAlBA,EAI9BnB,EAAaD,IACfiB,EAAeE,EACfpB,GAAU,IAGVW,EAAsBV,EAAQoB,EAAevB,GAC7CG,EAAQ,IAEVkB,GAAe,OAEV,GAAsB,MAAlBE,EAILnB,EAAaD,IACfiB,EAAeE,EACfJ,GAAgB,IAGhBL,EAAsBV,EAAQoB,EAAevB,GAC7CG,EAAQ,IAEVkB,GAAe,MAEV,IAAsB,MAAlBE,GAA4C,MAAlBA,GAAyBnB,EAAab,GAAmB,CAG5FsB,EAAsBJ,EAAKQ,EAAYA,EAAWpY,OAASyY,EAAM,GAvL5C,OAwLrBA,EAAML,EAAWpY,OACjB,MAE2B,MAAlB0Y,GACTpB,GAAgBoB,EAChBJ,GAAgB,GAGhBhB,GAAgBoB,GAIhBrB,GAKOgB,EAFTL,EAAsBP,EAAKW,EAAYG,EAAcE,EAAMF,EAAe,GAAIpB,GAOpEI,EAAaD,KAGnBO,EAAUP,GACZU,EAAsBV,EAAOF,GAEnBxF,MAAMmB,SAASuE,EAAO,KAIhCU,EAAsBV,EAAOL,GAH7Be,EAAsBV,EAAOJ,IAUnCG,GAAU,EACVC,EAAQ,GACRX,GAAiB,EACjBC,OAAgB3U,EAChByU,EAAkB,GAElB,IAtPuB,EAsPnB9U,EAAS,GAtPU,eAwPA1E,EAAK6Z,MAAM,OAxPX,IAwPvB,2BAAyC,CAAC,IAAjCqB,EAAgC,QAEnCb,EAAaa,GACfxW,EAAO5E,KAAK,KAId0Z,EAAkB,GAClByB,EAAkBC,GACdzB,IAAmBU,GACrBX,GAAmB,UACnBC,GAAiB,EACjBC,EAAgB,GAChBU,EAAQ,IACED,IACVT,EAAgB,GAChBU,EAAQ,IAGV1V,EAAO5E,KAAK0Z,KA3QS,8BA8QvB,OAAO9U,EAAOM,KAAK,OCvLN0W,I,2DAjFb,WAAYza,GAAQ,IAAD,wBACjB,cAAMA,IAED0a,YAAc,EAAKA,YAAYvL,KAAjB,iBACnB,EAAKlR,MAAQ,CAAE0c,QAAQ,GAEvB,IAAQhb,EAAaK,EAAbL,SACR,GAAIA,EAAU,CAEZ,IAAMib,EAAUlb,EAAeC,GAY/B,IAXA,EAAKZ,KAAO6b,EAAQ7W,KAAK,IAGzB,EAAKhF,KAAO,EAAKA,KACdI,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MACnBA,QAAQ,QAAS,MAGI,OAAjB,EAAKJ,KAAK,IACf,EAAKA,KAAO,EAAKA,KAAKsT,OAAO,GAG/B,KAAgC,OAAzB,EAAKtT,KAAKsT,QAAQ,IACvB,EAAKtT,KAAO,EAAKA,KAAKsT,OAAO,EAAG,EAAKtT,KAAK8C,OAAS,GAGrD,EAAK9C,KAAOuZ,GAAU,EAAKvZ,MA7BZ,S,gDAiCnB,WACEsO,KAAKiG,SAAS,CACZqH,QAAStN,KAAKpP,MAAM0c,W,oBAIxB,WAEE,IAAIE,EAUAC,EATAC,EAAa,EACb1N,KAAKtO,OACPgc,EAAa1N,KAAKtO,KAAK6Z,MAAM,MAAM/W,QAGnCgZ,EADExN,KAAKpP,MAAM0c,OACH,4DAAgBI,EAAhB,mCAEG,uCAGXA,EAAa,IACfD,EACE,sBAAK1P,UAAU,oBAAf,SACE,uBAAMA,UAAU,qBAAqBiB,QAASgB,KAAKqN,YAAnD,SAAiEG,OAIvE,IAAIG,EAAW,GAWf,OARI3N,KAAKpP,MAAM0c,QAAUI,EAAa,GACpCC,EAASC,SAAW,SACpBD,EAASE,OAAS,UAElBF,EAASC,SAAW,OACpBD,EAASE,OAAS,QAIlB,uBAAKhQ,MAAO,CAAEgB,UAAW,OAAzB,UACE,sBAAKd,UAAU,WAAWF,MAAO8P,EAAU1K,wBAAyB,CAAEC,OAAQlD,KAAKtO,QAElF+b,S,GA5EUnN,c,oBCWHwN,G,gKANd,WACE,MAA2B9N,KAAKrN,MAAxB+M,EAAR,EAAQA,KAAMpN,EAAd,EAAcA,SACd,OAAO,oBAAGoN,KAAMA,EAAM3B,UAAU,kBAAzB,SAA4CzL,Q,GAJ9BgO,aCoETyN,G,oDAhEd,WAAYpb,GAA0B,IAAD,+BACnC,cAAMA,IACD/B,MAAQ,CAAEod,SAAUrb,EAAM+M,KAAM9B,MAAO,IAFT,E,+CAKrC,SAAW8B,GAET,IAAgC,IAA5BA,EAAKL,OAAO,WAAmB,CACjC,IAAI7I,EAAMkJ,EAAK6L,MAAM,KACrB,OAAOnM,KAAYxN,MAAM4E,EAAI,IAAIyX,EAGnC,IAAkC,IAA9BvO,EAAKL,OAAO,aAAqB,CACnC,IAAI7I,EAAMkJ,EAAK1P,MAAM,oBAErB,GAAIwG,GAAOA,EAAIhC,OAAS,EACtB,OAAOgC,EAAI,GAEf,OAAO,O,mEAGT,WAAqB0X,GAArB,yBAAAta,EAAA,6DAEQua,EAASrb,aAAaC,QAAQ,kBAAoB,0CACpDqb,EAHN,2DAGmED,EAHnE,yDAG0HD,GAH1H,SAIyBlZ,MAAMoZ,GAJ/B,cAIQxX,EAJR,gBAKqBA,EAAS9C,OAL9B,cAKQA,EALR,OAOM8J,EAAQ9J,EAAKuD,MAAM,GAAGgX,QAAQzQ,MAC9BoQ,EAAWpQ,EACC,GACZA,EAAMpJ,OAASmO,KACjBqL,EAAWA,EAAS/E,UAAU,EAFhB,IAEgC,OAXlD,kBAaS,CACL+E,WACApQ,UAfJ,4C,6HAmBA,gCAAAhK,EAAA,yDAEU8L,EAASM,KAAKrN,MAAd+M,KACFwO,EAAUlO,KAAKsO,WAAW5O,GAHlC,0EAQyBM,KAAKuO,eAAeL,GAR7C,OAQUva,EARV,OASIqM,KAAKiG,SAAL,eACKtS,IAVT,kDAcI7C,QAAQG,MAAM,UAAW,KAAEc,SAd/B,0D,0EAkBA,WAEE,OAAO,oBAAG2N,KAAMM,KAAKrN,MAAM+M,KAAM9B,MAAOoC,KAAKpP,MAAMgN,MAA5C,mBADM,UACN,aAAkEoC,KAAKpP,MAAMod,gB,GAhE9D1N,aCmBpBkO,G,uKAEJ,SAAc9O,EAAc+O,GAC1B,IAAIC,EAAchP,EACf5N,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,KACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OAElB,IACE,IAAI6c,EAAS,IAAIC,OAAOF,EAAc,6EAClClY,EAAMiY,EAAWze,MAAM2e,GAC3B,GAAInY,GAAOA,EAAIhC,OAAS,EACtB,MAAe,MAAXgC,EAAI,KAAsC,IAAxBkJ,EAAKL,OAAO,OACzBK,EAETA,GAAclJ,EAAI,GAGpB,MAAO3E,GACPf,QAAQG,MAAMY,GAEhB,OAAO6N,I,oBAGT,WAEE,MACwFM,KAAKrN,MADrF+M,EAAR,EAAQA,KAAMpN,EAAd,EAAcA,SAAUmc,EAAxB,EAAwBA,WACtBnS,EADF,EACEA,sBAAuBC,EADzB,EACyBA,sBAAuBC,EADhD,EACgDA,oBAAqBC,EADrE,EACqEA,eAErE,IACE,IAAIvG,EAAM,IAAI2Y,KAAInP,GAAM,GACxB,MAAOzO,GAEP,OADAH,QAAQG,MAAMA,EAAMc,QAAS2N,GACtB,oBAAGA,KAAMA,EAAT,SAAgBA,IAIzB,IAAIoP,EAAUpP,EAOd,GANIoP,EAAQ5I,WAAW,OACrBhQ,EAAI6Y,IAAI,WAAY,SACpB7Y,EAAI6Y,IAAI,WAAY,kBACpBD,EAAU5Y,EAAIwJ,MAGc,SAA1BpD,EAAkC,CACpC,IAAgD,IAA5CpG,EAAInG,SAASsP,OAAO,mBAA2B,CAEjD,GAAqB,eAAjBnJ,EAAI8Y,SACN,OACE,eAAC,GAAD,CAAY/V,QAAS/C,EAAI+Y,MAAMjb,GAAIpB,OAAQsD,EAAI6E,KAAKjJ,QAAQ,IAAK,KAAO,IAAxE,SACGO,EAAeC,KAGf,GAAqB,eAAjB4D,EAAI8Y,SACb,OACE,eAAC,GAAD,CAAYtP,KAAMxJ,EAAIwJ,KAAtB,SACGpN,IAMT,GAAqB,yBAAjB4D,EAAInG,UACW,kBAAjBmG,EAAI8Y,UAEkC,IAAlC9V,OAAOgC,KAAKhF,EAAI+Y,OAAOza,QAGJ,4BADrB0B,EAAM,IAAI2Y,KAAInP,EAAK5N,QAAQ,MAAO,KAAK,IAC/Bkd,SACN,OACE,eAAC,GAAD,CAAY/V,QAAS/C,EAAI+Y,MAAMjb,GAAIpB,OAAQsD,EAAI6E,KAAKjJ,QAAQ,IAAK,KAAO,IAAxE,SACGO,EAAeC,KAO5B,MAA8B,SAA1BiK,IACsC,IAApCrG,EAAInG,SAASsP,OAAO,aACmB,IAAtCnJ,EAAInG,SAASsP,OAAO,aAIC,SAAxB7C,IAC6C,IAA3CtG,EAAInG,SAASsP,OAAO,mBACtBnJ,EAAI6Y,IAAI,WAAY,gBAGlB,qBAAGrQ,OAAQsB,KAAKrN,MAAM+L,OACpBX,UAAWiC,KAAKrN,MAAMuc,MACtBnM,IAAK/C,KAAKrN,MAAMoQ,IAChBrD,KAAMxJ,EAAIwJ,KAHZ,UAGoBxJ,EAAIwJ,KAHxB,SAOiB,SAAnBjD,GAA6BgS,IAC/BK,EAAU9O,KAAKmP,cAAcL,EAASL,IAItC,oBAAG/P,OAAQsB,KAAKrN,MAAM+L,OACpBX,UAAWiC,KAAKrN,MAAMuc,MACtBnM,IAAK/C,KAAKrN,MAAMoQ,IAChBrD,KAAMoP,EAHR,SAGmBxc,KAvBV,eAAC,GAAD,CAAaoN,KAAMA,Q,GAxFTY,aAqITC,gBAjBQ,SAAC3P,GAEvB,MAKIA,EAAMmG,QAAQM,MAElB,MAAO,CACLiF,sBARF,EACEA,sBAQAC,sBATF,EAEEA,sBAQAC,oBAVF,EAGEA,oBAQAC,eAXF,EAIEA,kBAWY8D,CAAyBiO,IC7GzBY,GArCC,SAACzc,GAEhB,IAAQsG,EAAoCtG,EAApCsG,QAASxE,EAA2B9B,EAA3B8B,KAAM4a,EAAqB1c,EAArB0c,MAAOhb,EAAc1B,EAAd0B,EAAGib,EAAW3c,EAAX2c,OAE3BC,EAAG,UAAM1c,EAAN,sBAA0BwB,EAA1B,QAELmb,EAAU,EAEVH,IACFG,EAAUtd,KAAKgW,MAAM,IAAMzT,EAAK2B,OAASiZ,IAK3C,OACE,uBAAKtR,UAAU,cAAf,UACE,sBAAKA,UAAU,eAAf,SACE,oBAAGgF,IAAI,WAAWlF,MAAO,CAAE4R,eAAgB,QAAU/P,KAAI,UAAK7P,OAAOkL,KAAZ,yBAAiC9B,EAAjC,gBAAgD5E,GAAzG,SACE,6BAAG,uBAAMwJ,MAAO,CAAEmJ,MAAOsI,EAAOjb,EAAI,IAAjC,mBAA2CA,EAA3C,aAAiDI,EAAKib,gBAG7D,sBAAK3R,UAAU,oBAAf,SAEE,6BAAG,uBAAMF,MAAO,CAAEmJ,MAAOsI,EAAOjb,EAAI,IAAjC,mBAA2Cmb,EAA3C,cAAwD/a,EAAK2B,OAA7D,WAGL,sBAAK2H,UAAU,aAAf,SACE,sBAAKF,MAAO,CAAEqJ,MAAM,GAAD,OAAKsI,EAAL,MAAnB,SACE,oBAAG9P,KAAM6P,EAAT,SACE,sBAAKI,IAAKJ,EAAK1R,MAjBR,CAAE+R,UAAW,QAAS1I,MAAO,OAAQ2G,OAAQ,QAiBpBgC,IAAG,gBAAMxb,eCnBrCyb,GAbE,SAACnd,GAEjB,IAAQ0E,EAA2B1E,EAA3B0E,MAAO4B,EAAoBtG,EAApBsG,QAASqW,EAAW3c,EAAX2c,OAEpBD,EAAQhY,EAAMhG,QAAO,SAAC0e,EAAKle,GAAN,OAAYke,EAAMle,EAAEuE,SAAQ,GAErD,OACE,sBAAKyH,MAAO,CAAEiB,aAAc,QAA5B,SACGzH,EAAMgE,QAAO,SAAA1G,GAAG,OAAIA,EAAI+a,UAAQnd,KAAI,SAACkC,EAAM0G,GAAP,OAAa,eAAC,GAAD,CAAkB1G,KAAMA,EAAM4a,MAAOA,EAAOhb,EAAG8G,EAAI,EAAGlC,QAASA,EAASqW,OAAQA,GAAjEnU,SCHxD6U,G,gKAZb,WACE,MAA+BhQ,KAAKrN,MAA5B2c,EAAR,EAAQA,OAAQxa,EAAhB,EAAgBA,KAAM6G,EAAtB,EAAsBA,KAEhBsU,EAAanb,EAAK6G,EAAO,GAC/B,OACE,sBAAKkC,MAAO,CAAEgB,UAAW,OAAzB,SACE,6BAAG,uBAAMhB,MAAO,CAAEmJ,MAAOsI,EAAO3T,EAAO,IAApC,mBAA8CA,EAA9C,aAAuDsU,EAAWP,kB,GAR1DpP,aC+Bb4P,G,6KAEJ,SAAoBxe,GAElB,IAAQuH,EAAY+G,KAAKrN,MAAjBsG,QAGR,OAAOvH,EAAKI,QADG,mBACa,SAACqe,GAC3B,IAAMvd,EAAM,wCACZ,MAAM,wBAAN,OAA+BqG,EAA/B,0BAAwDrG,EAAxD,oB,2BAIJ,SAAclB,GAGZ,OAAOA,EAAKI,QADG,qDACa,SAACqe,GAC3B,IAAIC,EAAG,wCAKP,MAFyB,SAArBA,EAAIpL,OAAO,EAAG,KAChBoL,EAAMA,EAAIpL,OAAO,IACb,SAAN,OAAgBoL,EAAhB,gB,yBAIJ,SAAY1e,GAEV,IAAKA,EACH,OAAOA,EAET,IAAQyK,EAAiB6D,KAAKrN,MAAtBwJ,aAOR,OALAzK,EAAOsO,KAAKqQ,cAAc3e,GAEL,SAAjByK,IACFzK,EAAOsO,KAAKsQ,oBAAoB5e,IAE3BA,I,oBAGT,WACE,IAEI6e,EAOAC,EATJ,EAA4DxQ,KAAKrN,MAAzDsG,EAAR,EAAQA,QAAS5E,EAAjB,EAAiBA,EAAGoc,EAApB,EAAoBA,KAAM9U,EAA1B,EAA0BA,KAAM7G,EAAhC,EAAgCA,KAAM+I,EAAtC,EAAsCA,MAAOhC,EAA7C,EAA6CA,WAGzCF,GAAQ7G,EAAKsT,QAAUnP,IAAYnE,EAAKd,KACzBc,EAAKsT,OAAOzM,EAAO,KAElC4U,EAAc,eAAC,GAAD,CAAMzb,KAAMA,EAAKsT,OAAQzM,KAAMA,EAAM2T,OAAQzT,MAIrD,MAANxH,GAAgC,IAAnBS,EAAK4P,WAAmB5P,EAAKsT,SAC5CoI,EAAY,eAAC,GAAD,CAAWnZ,MAAOvC,EAAKsT,OAAQnP,QAASA,EAASqW,OAAQzT,KAGvE,IAAI6U,EAAgB1Q,KAAK2Q,YAAYF,GAC/BG,EAAgB,CACpBrR,KAAM,SAAA5M,GAAK,OAAI,eAAC,GAAD,CAAYsG,QAAStG,EAAM,gBAAiBC,OAAQD,EAAM,gBAAqBA,EAAMvB,MACpGyf,KAAM,SAAAle,GAAK,OAAI,eAAC,GAAD,eAAUA,KACzBiB,EAAG,SAAAjB,GAAK,OAAI,eAAC,GAAD,2BAAgBA,GAAhB,IAAuB8b,WAAYiC,OAE7CI,EAAgBC,KAAWL,EAAeE,GAE9C,OACE,uBAAK7S,UAAU,UAAUF,MAAK,eAAOA,GAArC,UACG2S,EACD,+BACGM,IAEFP,S,GAtEajQ,aAuFNC,gBAXQ,SAAC3P,GAIvB,MAAO,CACLkE,KAHelE,EAAM0I,MAAfxE,KAIN+G,WAAYjL,EAAMmG,QAAQ8E,WAC1BM,aAAcvL,EAAMmG,QAAQM,MAAd,gBAIFkJ,CAAyB2P,IC/ExBc,I,sKArBb,WACI,MAAoChR,KAAKrN,MAAjC6I,EAAR,EAAQA,KAAME,EAAd,EAAcA,MAAOzC,EAArB,EAAqBA,QAAS5E,EAA9B,EAA8BA,EAE9B,GAAIqH,EACA,IAAIuV,EAAO,IAAI1Z,KAAW,IAANmE,GAExB,OACI,iCACI,uBAAMqC,UAAU,WAAWiB,QAASgB,KAAKrN,MAAMue,QAA/C,sBACA,uBAAMnT,UAAU,WAAWiB,QAASgB,KAAKrN,MAAMwe,OAA/C,oBACA,eAAC,IAAD,CAAMpT,UAAU,WAAWH,MAAK,mHAAyBvJ,GAAKE,GAAE,wBAAmB0E,EAAnB,YAA8B5E,GAA9F,SAAoGA,IACpG,uBAAM0J,UAAU,WAAWiB,QAASgB,KAAKrN,MAAMye,OAA/C,oBACA,uBAAMrT,UAAU,WAAWiB,QAASgB,KAAKrN,MAAM0e,OAA/C,sBACA,oBAAGxT,MAAO,CAACiF,OAAQ,YAAnB,SAAiCtH,IACjC,uBAAMuC,UAAU,MAAhB,SAAuB+I,aAAWmK,EAAM,6B,GAhB5B3Q,cCwFXgR,G,oDAlFb,WAAY3e,GAAe,IAAD,+BACtB,cAAMA,IAYV4e,UAb0B,uCAad,WAAOld,GAAP,iBAAAT,EAAA,+EAGS4E,EAAe,EAAK7F,MAAMsG,QAAS5E,GAH5C,QAGJI,EAHI,UAKAxD,EAAK,yHAA2BoD,IALhC,gDAQJpD,EAAQ,KAAEc,QARN,QAUR,EAAKkU,SAAS,CACV5R,IACAI,OACAxD,UAbI,yDAbc,wDA8B1BugB,aAAe,WACX,EAAKD,UAAU,IA/BO,EAkC1BE,YAAc,WACV,EAAKF,UAAU,EAAK3gB,MAAMyD,EAAI,IAnCR,EAsC1Bqd,YAAc,WACN,EAAK9gB,MAAMyD,EAAI,GACf,EAAKkd,UAAU,EAAK3gB,MAAMyD,EAAI,IAxCZ,EA2C1Bsd,YA3C0B,sBA2CZ,4BAAA/d,EAAA,sEACM4E,EAA0B,EAAK7F,MAAMsG,SAD3C,OACJ5E,EADI,OAEV,EAAKkd,UAAUld,GAFL,2CAzCV,EAAKzD,MAAQ,CACTyD,EAAG1B,EAAM0B,EACTI,KAAM,KACNxD,MAAO,MALW,E,6FAS1B,sBAAA2C,EAAA,sEACUoM,KAAKuR,UAAUvR,KAAKpP,MAAMyD,GADpC,gD,0EAuCA,WACI,IAAQ4E,EAAY+G,KAAKrN,MAAjBsG,QACR,EAA2B+G,KAAKpP,MAAxB6D,EAAR,EAAQA,KAAMxD,EAAd,EAAcA,MAAOoD,EAArB,EAAqBA,EACrB,IAAKI,IAASxD,EACV,OAAO,KAEX,GAAIwD,EACA,IAAM+G,EAAgB/G,EAAhB+G,KAAME,EAAUjH,EAAViH,MAEhB,OACI,uBAAKqC,UAAU,gBAAf,UACI,eAAC,GAAD,CACIvC,KAAMA,EACNE,OAAQA,EACRzC,QAASA,EACT5E,EAAGA,EACH6c,QAASlR,KAAKwR,aACdH,OAAQrR,KAAK2R,YACbP,OAAQpR,KAAKyR,YACbN,OAAQnR,KAAK0R,cAEhBjd,GAAQ,eAAC,GAAD,CACLA,KAAMA,EACNgc,KAAMhc,EAAK/C,KACXuH,QAASA,EACT4E,MAAO,CAAC+T,UAAW,QAASC,UAAW,OAAQ5M,aAAc,gBAEhEhU,GAAS,6BAAIA,W,GA7EHqP,aCcrBwR,I,2DAOJ,WAAYnf,GAAe,IAAD,+BACxB,cAAMA,IAgCRof,iBAAmB,WAEjB,IAAQva,EAA4B,EAAK7E,MAAjC6E,wBACR,EAA+D,EAAK7E,MAA9DoJ,EAAN,EAAMA,sBAAuBC,EAA7B,EAA6BA,8BAE7B,EAAKmD,eAAiBC,KAAYxN,MAAM,EAAK9B,SAASuP,QACtD7H,EAAwB,EAAK2H,gBAEC,SAA1BpD,KAEFC,GAAiCA,GACG,KAAIA,EAAgC,IAExE0J,aAAa,EAAKJ,OAClB,EAAKA,MAAQC,WAAW,EAAKwM,iBAAkD,IAAhC/V,KA/CzB,EAmD1BgW,sBAAwB,WACtB,EAAKD,oBAlDL,EAAK5S,eAAiB,CAAErH,KAAM,KAFN,E,sDAK1B,WAEE,IAAMhI,EAAakQ,KAAKrN,MAAlB7C,SAENkQ,KAAKlQ,SAAWA,EAChBkQ,KAAK+R,qB,kCAIP,WACErM,aAAa1F,KAAKsF,S,gCAGpB,WAEE,MAAoCtF,KAAKrN,MAAjC7C,EAAR,EAAQA,SAAUkI,EAAlB,EAAkBA,cAEdgI,KAAKlQ,SAASuP,SAAWvP,EAASuP,QACjCW,KAAKrN,MAAMqF,gBAAkBA,IAEhCgI,KAAKlQ,SAAWA,EAChBkQ,KAAK+R,mBACLliB,OAAOoiB,SAAS,EAAG,IAGrBC,SAAStU,MAAQ,gB,oBAyBnB,WAEE,IAFO,EAEP,EAAiCoC,KAAKrN,MAA9BgF,EAAR,EAAQA,WAAYqC,EAApB,EAAoBA,SAEhBiQ,EAAO,GAJJ,eAKUtS,EAAWN,OALrB,IAKP,2BAAmC,CAAC,IAA3B2B,EAA0B,QAEjCiR,EAAKzY,KAAK,eAAC,GAAD,CAAmBiD,KAAMuE,GAAfA,EAAKhF,KACrBgF,EAAKI,aACP6Q,EAAKzY,KACH,sBAAuCuM,UAAU,oBAAjD,SACE,eAAC,GAAD,CAAc9E,QAASrE,OAAOoE,EAAKhF,IAAKK,EAAG,KAD7C,iBAAoBO,OAAOoE,EAAKhF,QAV/B,8BAgBP,OACE,iCACE,eAAC,GAAD,CAAQkQ,QAASlE,KAAKrN,MAAMuR,UAC3BvM,EAAW1G,OAAU,eAAC,GAAD,CAAOS,KAAMiG,EAAW1G,QAC9C,uBAAK8M,UAAU,QAAf,UACE,uBAAKA,UAAU,KAAKF,MAAO,CAAEsU,SAAU,SAAUC,IAAK,QAAtD,UACE,sBAAKvU,MAAO,CAACwU,cAAe,QAA5B,kDACA,sCACA,yBACA,4DACA,kEACA,+BAAK,uBAAMxU,MAAO,CAAEkB,OAAQ,WAAanB,MAAM,wFAAkBoB,QAASgB,KAAK+R,iBAA1E,SAA6Fpa,EAAWC,WAAa,qEAAgB,gEAE3IqS,EACD,sBAAKlM,UAAU,KAAf,SACE,eAAC,GAAD,CAAOsJ,QAAQ,YAAYlI,eAAgBa,KAAKb,eAAgBkF,QAAS,UAG7E,sBAAKrQ,GAAG,IAAI+J,UAAU,WAAWF,MAAO,CAAEiB,aAAc,OAAQD,UAAW,MAAOsT,SAAU,YAA5F,SACE,eAAC,GAAD,CAAUnY,SAAUA,EAAS3C,MAAOoT,gBAAiBzK,KAAKgS,sBAAuB7S,eAAgBa,KAAKb,0B,GAjGvFmB,cAyHVC,gBAhBS,SAAC3P,GAEvB,MAAO,CACL+G,WAAY/G,EAAM+G,WAClBqC,SAAUpJ,EAAMoJ,SAChBL,MAAO/I,EAAM+I,MACb3B,cAAepH,EAAMmG,QAAQM,MAAMW,cACnC+D,sBAAuBnL,EAAMmG,QAAQM,MAAM0E,sBAC3CC,8BAA+BpL,EAAMmG,QAAQM,MAAM2E,kCAI5B,SAACvE,GAAD,MAAe,CACxCD,wBAAyB,kBAAeC,EAASD,GAAuB,WAAvB,kBAGpC+I,CAA6CuR,ICjH/CQ,GAAe,SAACxd,EAAoByE,EAAyBlC,GAExE,MAAO,CACL5E,KAAM,gBACNqC,OACAyE,QACAlC,QACAC,WAAYC,KAAKgb,QAIRC,GAAa,WAExB,MAAO,CACL/f,KAAM,gBA2HJggB,GAAc,SAAC7hB,GACnB,IAAM0I,EAAQ1I,EAAM0I,MACpB,OAAKA,IAGDA,EAAM1B,YAMC8a,GAAqB,SAAC/e,EAAa4F,GAAd,OAA+C,SAAC9B,EAAeC,GAC/F,GAAI+a,GAAY/a,KACd,OAAOD,EApIe,SAAC9D,EAAa4F,GAAd,8CAA+C,WAAO9B,GAAP,mCAAA7D,EAAA,6DAEvE6D,EAxBsC,CACtChF,KAAM,kBAqBiE,kBAMxD+F,EAAiB,CAAExE,GAAIL,EAAOK,KAN0B,OAMrEc,EANqE,uDAQrEhE,QAAQG,MAAR,MACA6D,EAAO,CACLd,GAAIL,EAAOK,GACXtC,KAAM,GACNuC,cAAe,KAZoD,qBAiBjE6D,EAAOnE,EAAOmE,MAAQ,EAEtB6a,EAASpZ,EAEA,WAATzB,EArBiE,uBAuB9DhD,EAAKb,cAAgB,IAvByC,oBAyB5D0e,EAzB4D,kCA0B7Cna,EAAqB,CACrCxE,GAAIL,EAAOK,GACXM,KAAM,EACNC,GAAI,IA7ByD,QA0B3D8C,EA1B2D,OA+B/Dsb,EAAStb,EAAM,GA/BgD,eAkC7Dub,GAAS9d,EAAKb,cAAgB,GAlC+B,UAmClDuE,EAAqB,CAClCxE,GAAIL,EAAOK,GACXM,KAAMse,EACNre,GAAI,OAtC2D,QAmCjEse,EAnCiE,gDA0C/Cra,EAAqB,CACrCxE,GAAIL,EAAOK,GACXM,KAAM,EACNC,GAAI,OA7C2D,QA0C7D8C,EA1C6D,OA+CjEsb,EAAStb,EAAM,GACfwb,EAASxb,EAAMoB,MAAM,GAhD4C,mCAsD/Dma,EAAQ,EACRE,EAAc,KAFlBhb,GAAQA,GAEgB,IAEpBA,EAAO,GAzDwD,oBA2DjE8a,EAAqB,KAAZ9a,EAAO,GACX6a,EA5D4D,kCA6D7Cna,EAAqB,CACrCxE,GAAIL,EAAOK,GACXM,KAAM,EACNC,GAAI,IAhEyD,QA6D3D8C,EA7D2D,OAkE/Dsb,EAAStb,EAAM,GAlEgD,yBAqElDmB,EAAqB,CAClCxE,GAAIL,EAAOK,GACXM,KAAMse,EACNre,GAAIue,IAxE2D,QAqEjED,EArEiE,sCA6E/DD,EADED,EACM,EAEA,EA/EuD,UAiF/Cna,EAAqB,CACrCxE,GAAIL,EAAOK,GACXM,KAAMse,EACNre,GAAIue,IApF2D,QAiF7Dzb,EAjF6D,OAuF7Dsb,EACFE,EAASxb,GAETsb,EAAStb,EAAM,GACfwb,EAASxb,EAAMoB,MAAM,IA3F0C,QAiG1C,MAAvB3D,EAAKb,eAAyB4e,EAAOre,OAAS,IAChDM,EAAKb,cAAgB4e,EAAOA,EAAOre,OAAS,GAAGH,GAEpC,WAATyD,GAAqB+a,EAAOre,OAAS,KACvCqe,EAASA,EAAOpa,OAAO,KAGzBhB,EAAS6a,GAAaxd,EAAM6d,EAAQE,IAxGiC,mDA4GrE/hB,QAAQG,MAAM,yBAAd,MAEAwG,EAAS,CACPhF,KAAM,uBACNxB,MAAK,KACLqG,WAAYC,KAAKgb,QAjHkD,iEAA/C,sDAoINQ,CAAWpf,EAAQ4F,MAwC1ByZ,GAA2B,SAACrf,GAAD,OAA0C,SAAC8D,EAAeC,GAChG,GAAI+a,GAAY/a,KACd,OAAOD,EAjCqB,SAAC9D,GAAD,8CAA0C,WAAO8D,GAAP,eAAA7D,EAAA,6DAExE6D,EAAS,CACPhF,KAAM,yBAHgE,kBAOnD+F,EAAqB,CACtCxE,GAAIL,EAAOK,GACXM,KAAMX,EAAOmf,KAAO,EACpBve,GAAI,OAVgE,OAOhET,EAPgE,OAatE2D,EAAS,CACPhF,KAAM,uBACN4E,MAAOvD,EACPwD,WAAYC,KAAKgb,QAhBmD,gDAoBtEzhB,QAAQG,MAAM,gCAAd,MAEAwG,EAAS,CACPhF,KAAM,8BACNxB,MAAK,KACLqG,WAAYC,KAAKgb,QAzBmD,yDAA1C,sDAiCZU,CAAiBtf,MClO/BqQ,G,gKAEJ,WAEE,IAAQlP,EAASkL,KAAKrN,MAAdmC,KASR,OAEE,uBAAKiJ,UAAU,WAAf,UACE,sBAAKA,UAAU,UAAf,SACE,eAAC,GAAD,MAEF,sBAAKA,UAAU,aAAf,SACE,uBAAM/J,GAAG,eAAe+J,UAAU,UAAlC,SACE,oBAAGgF,IAAI,WAAWrD,KAAI,UAAK7P,OAAOkL,KAAZ,4BAAoCjG,EAAKuD,OAASwF,MAAO,CAAE4R,eAAgB,QAAjG,SAfO,CACb,KAAM,6EACN,KAAQ,wCACR,GAAM,oJACN,IAAO,wCAWkH3a,EAAKuD,oB,GArB/GiJ,aA4CLf,gBAfQ,SAAA3P,GAUtB,MAAO,CACLkE,MAPElE,EAAM0I,OAAS,CACjBxE,KAAM,CACJuD,MAAO,MAHTvD,QAYYyL,CAAyByD,ICxCnCkP,G,gKAEJ,WAEE,IAAQpe,EAASkL,KAAKrN,MAAdmC,KAEJqe,EAAY,iDAAmDhS,mBAAmBrM,EAAKpD,MAE3F,OACE,uBAAKqM,UAAU,YAAf,UACE,sBAAKA,UAAU,gBAAf,SACE,uBAAKA,UAAU,cAAf,UACE,oBAAGH,MAAM,WAAW8B,KAAI,UAAK7M,EAAL,YAAeI,EAAf,eAAkC6B,EAAKd,IAAM+J,UAAU,MAAMF,MAAO,CAAEoJ,QAAS,QAASmM,WAAY,OAA5H,eACA,oBAAGxV,MAAM,eAAe8B,KAAI,UAAK7M,EAAL,YAAeK,EAAf,eAAsC4B,EAAKd,GAA3C,iBAA8D+J,UAAU,MAAMF,MAAO,CAAEoJ,QAAS,QAASmM,WAAY,OAAjJ,oBAIJ,sBAAKrV,UAAU,eAAf,SACE,uBAAKA,UAAU,WAAf,UACE,uBAAKF,MAAO,CAAE6E,KAAM,EAAGyE,UAAW,UAAlC,UACE,oBAAGzH,KAAI,UAAK7M,EAAL,yBAA4BiC,EAAKd,IAAxC,SACE,qBAAI+J,UAAU,cAAckF,wBAAyB,CAAEC,OAAQpO,EAAKpD,UAEtE,sBAAKqM,UAAU,oBAEjB,sBAAKF,MAAO,CAAE6E,KAAM,WAAYyP,SAAU,YAA1C,SACE,sBAAKpU,UAAU,gBAAf,SACE,oBAAGgF,IAAI,sBAAsBrD,KAAMyT,EAAWvV,MAAM,yFAAmBc,OAAO,SAASX,UAAU,SAAjG,oC,GA3BQuC,aAgDRC,gBAXQ,SAAC3P,GAMvB,MAAO,CACLkE,MAHElE,EAAM0I,OAASD,IADjBvE,QAQYyL,CAAyB2S,ICD5BG,GAAiB,SAAC3hB,GAAD,OAAuB,SAAC+F,GACpDA,EAAS,CACPhF,KAAM,mBACNf,WC3CE4hB,G,+MAEJtU,QAAU,WACR,MAA2B,EAAKrM,MAAxB8E,EAAR,EAAQA,SAAUhD,EAAlB,EAAkBA,KAClBgD,EAAS4b,GAAe,IAAD,OAAK5e,EAAKJ,EAAV,OAEvB,IAAI+O,EAAO8O,SAASqB,eAAe,gBAC/BnQ,GACFvT,OAAOoiB,SAAS,EAAG7O,EAAKoQ,Y,EAG5BC,YAAc,SAAC7R,GACbA,EAAMlD,OAAOb,MAAM6V,WAAa,W,6CAGlC,WACE,IAEIC,EAFJ,EAA6C3T,KAAKrN,MAA1C8B,EAAR,EAAQA,KAAMmf,EAAd,EAAcA,SAAUC,EAAxB,EAAwBA,MAAOC,EAA/B,EAA+BA,UACzBpU,EAAI,UAAM7M,EAAN,yBAA6B4B,EAAKgH,QAK1CkY,EAHGlf,EAEiB,MAAXA,EAAKJ,EACJyS,aAAW,IAAIvP,KAAmB,KAAb9C,EAAKiH,OAAe,oBAGjD,gBAAC,WAAD,WACE,uBAAMqC,UAAU,iBAAhB,SAAkCtJ,EAAKJ,IAAU,MAAQyS,aAAW,IAAIvP,KAAmB,KAAb9C,EAAKiH,OAAe,uBAN5F,GAWZ,IAKI6T,EAMAwE,EAXEC,EAAiBxP,KAAW,kBAAmB,CACnD,YAAaoP,EACb,SAAUC,IAqBZ,OAjBkB,IAAdC,GAAsBjkB,OAAOokB,WAAa,MAC5C1E,EAAM,sBAAKI,IAAG,UAAK9c,EAAL,2BAA8B4B,EAAKgH,OAAnC,cACNyY,OAAQlU,KAAKyT,YACb5V,MAAO,CAAC6V,WAAW,SAAU5U,aAAa,MAAOhB,YAAY,UAIrEiW,EADED,EAED,uBAAM/V,UAAU,eAAhB,SAAgC4V,IAG/B,uBAAK5V,UAAU,eAAf,UACE,uBAAMA,UAAU,KAAhB,SAAuB4V,IACvB,yBAAQ5V,UAAU,YAAYiB,QAASgB,KAAKhB,QAA5C,SAAsD2U,OAK1D,uBAAK5V,UAAU,YAAf,UACGwR,EACD,oBAAGxR,UAAWiW,EAAgBtU,KAAMA,EAApC,SAA2CjL,EAAK+G,OAC/CuY,S,GA1DczT,aAiEPC,iBAAU+S,IC9DpBa,G,gKAEF,WACI,MAAyCnU,KAAKrN,MAAtC8B,EAAR,EAAQA,KAAM2f,EAAd,EAAcA,OAAQnb,EAAtB,EAAsBA,QAASU,EAA/B,EAA+BA,MAE/B,OAAKlF,EAID,uBAAKsJ,UAAU,YAAY/J,GAAIS,EAAKJ,EAApC,UACI,sBAAK0J,UAAU,gBAAf,SACI,eAAC,GAAD,CAAUtJ,KAAMA,EAAMmf,SAAUnf,EAAK+G,OAAS4Y,EAAQP,MAAOpf,EAAK+G,OAAS7B,EAAMtE,aAErF,sBAAK0I,UAAU,eAAf,SACI,eAAC,GAAD,CAAStJ,KAAMA,EAAMgc,KAAMhc,EAAK/C,KAAMuH,QAASA,EAAS5E,EAAGI,EAAKJ,EAAGsH,MAAOlH,EAAKkH,YARhF,S,GAND2E,aAsCDC,gBAjBO,SAAC3P,GAErB,MAGIA,EAAM0I,OAAS,CACfxE,KAAM,GACNyE,MAAO,IAJPzE,EADJ,EACIA,KACAyE,EAFJ,EAEIA,MAMJ,MAAO,CACHN,QAASnE,EAAKd,GACdogB,OAAQ7a,EAAQA,EAAMiC,KAAO,GAC7B7B,MAAO/I,EAAM+I,SAIJ4G,CAAyB4T,IC3C7BE,GAAc,SAAC1gB,GAAD,8CAAkC,WAAO8D,GAAP,SAAA7D,EAAA,6DAE3D6D,EAAS,CACPhF,KAAM,uBAHmD,kBAOnD+F,EAAiB7E,GAPkC,OASzD8D,EAAS,CACPhF,KAAM,0BAViD,gDAczD3B,QAAQG,MAAM,yBAAd,MACAwG,EAAS,CACPhF,KAAM,sBAhBiD,yDAAlC,uDCFrB6hB,G,+MAEJC,gBAAkB,WAChB,MAA2B,EAAK5hB,MAAxBmC,EAAR,EAAQA,MACR2C,EADA,EAAcA,UACL4c,GAAYvf,K,EAGvB0f,eAAiB,WAEf,MAA2B,EAAK7hB,MAAxBmC,EAAR,EAAQA,MAER2C,EAFA,EAAcA,UAELub,GAAyB,CAChChf,GAAIc,EAAKd,GACT8e,KAAMvL,SAASzS,EAAKb,cAAe,Q,6CAKvC,WAEE,IAGIwgB,EAHJ,EAA+CzU,KAAKrN,MAA5CmC,EAAR,EAAQA,KAAMuF,EAAd,EAAcA,SAAUzC,EAAxB,EAAwBA,WAAYjE,EAApC,EAAoCA,OAC9B0Q,EAAUrS,EAAW8C,EAAKb,eAG5B6D,EAAOnE,EAAOmE,MAAQ,EAY1B,MAXa,WAATA,GAAqBA,IAASuM,IAChCoQ,EACE,eAAC5R,GAAA,EAAD,CACE7D,QAASgB,KAAKwU,eACdrK,SAAU9P,EAASzC,WACnB6F,KAAK,KACLM,UAAU,SACVC,QAAQ,QALV,SAMGpG,EAAa,qEAAgB,qFAIlC,uBAAKmG,UAAU,WAAW/J,GAAG,IAA7B,UACE,sBAAK+J,UAAU,iBAAiBF,MAAO,CAAEqJ,MAAO,OAAhD,SACE,eAACrE,GAAA,EAAD,CACE7D,QAASgB,KAAKuU,gBACdpK,SAAU9P,EAASzC,WACnB6F,KAAK,KACLM,UAAU,SACVC,QAAQ,QALV,SAMG3D,EAASzC,WAAa,4DAAiB,uDAG5C,sBAAKmG,UAAU,qBAAqBF,MAAO,CAAEe,WAAY,QAAzD,SACG6V,W,GAjDUnT,aA4ELf,gBAnBQ,SAAA3P,GAEtB,MAIIA,EAAM0I,OAAS,CACjB1B,YAAY,EACZ9C,KAAM,IALN8C,EADF,EACEA,WACAiB,EAFF,EAEEA,YAOF,MAAO,CACL/D,KAVF,EAGEA,KAQA8C,aACAiB,cACAwB,SAAUzJ,EAAMyJ,UAAY,MAIhBkG,CAAyB+T,ICjEnCI,G,oDAEJ,WAAY/hB,GAAQ,IAAD,+BACjB,cAAMA,IAIR6X,SAAW,SAAC3Y,GAEVA,EAAE4P,iBACF5P,EAAE4T,kBAEF,MAAuC,EAAK9S,MAApC8E,EAAR,EAAQA,SAAU3C,EAAlB,EAAkBA,KAEdnB,EAAS,CACXjC,KAHF,EAAwBkJ,WAGLlJ,KACjBuH,QAASnE,EAAKd,GACdsU,UAAW,EAAKmC,gBAChBkK,mBAAele,GAGb,EAAK7F,MAAMwX,SACbzU,EAAOghB,cAAgB,EAAK/jB,MAAMwX,QAGpC3Q,ELrB0B,SAAC9D,GAAD,8CAAuC,WAAO8D,GAAP,eAAA7D,EAAA,6DAEnE6D,EAAS,CACPhF,KAAM,2BAGJmV,EAAiC,CACnCC,aAAc1G,mBAAmBxN,EAAOjC,MACxCgH,OAAQ,MACRvC,SAAUxC,EAAOsF,QACjBgP,IAAK/V,KAAKgW,MAAsB,KAAhBhW,KAAKiW,WAGnBxU,EAAOghB,gBACT/M,EAAY+M,cAAgBhhB,EAAOghB,eAd8B,kBAiB3Dnc,EAAmBoP,GAjBwC,uBAkB3DnQ,EAAS,CACbhF,KAAM,8BAnByD,OAqB7DkB,EAAO2U,WACT3U,EAAO2U,YAtBwD,kDAyBjExX,QAAQG,MAAM,qCAzBmD,0DAAvC,sDKqBjBgF,CAAetC,KAvBP,EA0BnB8W,gBAAkB,YAIhBhT,EAFqB,EAAK9E,MAAlB8E,UAEC,CACPhF,KAAM,mBACNf,KAAM,KAGR,EAAKuU,SAAL,2BACK,EAAKrV,OADV,IAEEwX,YAAQ3R,KAGN,EAAK9D,MAAM8X,iBACb,EAAK9X,MAAM8X,mBAzCI,EA6CnBmK,YAAc,SAAC/iB,GAEbA,EAAE4P,iBAEF,EAAKwE,SAAL,2BACK,EAAKrV,OADV,IAEEwX,YAAQ3R,MAnDO,EAwDnBoe,gBAAkB,SAAC1Z,GACjB,EAAK8K,SAAL,2BACK,EAAKrV,OADV,IAEEwX,OAAQjN,MAzDV,EAAKvK,MAAQ,CAAEwX,YAAQ3R,GAFN,E,2CA+DnB,WAAU,IAIJqe,EAJG,OAEP,EAA6B9U,KAAKrN,MAA1BmC,EAAR,EAAQA,KAAM8F,EAAd,EAAcA,WAGd,GAAI9F,EAAK4P,WAAa5P,EAAKsT,OAAQ,CAGjC,IADA,IAAIyC,EAAgB,GAFa,WAGxB1P,GAEP,IAAMnC,EAAOlE,EAAKsT,OAAOjN,EAAI,GAC7B,IAAKnC,EAAK0W,OACR,iBAEF7E,EAAcrZ,KACZ,eAAC4O,GAAA,EAAKgK,MAAN,CACE3X,KAAK,QAELkK,KAAK,SACL0M,QAAS,EAAKzY,MAAMwX,SAAWjN,EAC/BsD,SAAU,kBAAM,EAAKoW,gBAAgB1Z,IACrC2I,MAAK,UAAK3I,EAAL,aAAWnC,EAAK0W,SAJhBvU,KATFA,EAAI,EAAGA,GAAKrG,EAAKsT,OAAO5T,OAAQ2G,IAAK,EAArCA,GAmBT2Z,EACE,gBAAC9J,GAAA,EAAD,WACE,kCACE,wFACE,uBAAMtL,KAAK,GAAG1L,GAAG,eAAe6J,MAAO,CAAEe,WAAY,MAAOG,OAAQ,WAAaC,QAASgB,KAAK4U,YAA/F,mEAGH/J,EANH,qHAaJ,OACE,wBAAMhN,MAAO,CAAEgB,UAAW,OAAS2L,SAAUxK,KAAKwK,SAAlD,UACE,sBAAKzM,UAAU,OAAf,sJACA,uBAAKA,UAAU,wBAAf,UACE,sBAAKA,UAAU,mBAAf,SACE,eAAC,GAAD,CACEnG,WAAYgD,EAAWhD,WACvBlG,KAAMkJ,EAAWlJ,KACjB4M,YAAY,yDACZ6K,SAAS,kBAGb,sBAAKpL,UAAU,qBAAf,SACG+W,c,GAvHYxU,aAwITC,gBATQ,SAAC3P,GAEvB,MAAO,CACLkE,KAAMlE,EAAM0I,MAAMxE,KAClB8F,WAAYhK,EAAMgK,cAKN2F,CAAyBmU,ICvHnCK,I,2DAQJ,WAAYpiB,GAAQ,IAAD,+BACjB,cAAMA,IA0DRqiB,WAAa,WACX,MAA2C,EAAKriB,MAAxCmC,EAAR,EAAQA,KAAMke,EAAd,EAAcA,0BACmC,WAA7B,EAAK7T,eAAerH,MAAqB,EAAKqH,eAAerH,OAAS9F,GAAY8C,EAAKb,iBAGzG+e,EAAyB,CACvBhf,GAAIc,EAAKd,GACT8e,KAAMvL,SAASzS,EAAKb,cAAe,OAlEtB,EAsEnBghB,YAAc,WAEZ,MAAoC,EAAKtiB,MAAnC+f,EAAN,EAAMA,mBAAoBnZ,EAA1B,EAA0BA,MACtB4F,EAAiBC,KAAYxN,MAAM,EAAK9B,SAASuP,QAEhDF,EAAerH,KAGa,WAAxBqH,EAAerH,OACtBqH,EAAerH,MAAQqH,EAAerH,KAClCsO,MAAMjH,EAAerH,QACvBqH,EAAerH,KAAO,IALxBqH,EAAerH,KAAO,EAQpBqH,EAAenL,KAAO,EAAKmL,eAAenL,KAC5CuF,EAAQ,MAEV,EAAK4F,eAAiBA,EACtBuT,EAAmB,EAAKvT,eAAgB5F,IAxFvB,EA2FnB2b,wBAA0B,WAExB,MAA2C,EAAKviB,MAAxCqgB,EAAR,EAAQA,yBAA0Ble,EAAlC,EAAkCA,MAEe,WAA7B,EAAKqK,eAAerH,MAAqB,EAAKqH,eAAerH,OAAS9F,GAAY8C,EAAKb,iBAGzG+e,EAAyB,CACvBhf,GAAIc,EAAKd,GACT8e,KAAMvL,SAASzS,EAAKb,cAAe,OAlGvC,EAAKkL,eAAiB,CAAEnL,GAAI,IAC5B,EAAKmhB,gBAAiB,EAHL,E,sDAMnB,WAKE,GAHAnV,KAAKlQ,SAAWkQ,KAAKrN,MAAM7C,SAC3BkQ,KAAKiV,cAEuC,SAAxCjV,KAAKrN,MAAMoE,QAAQkF,iBAA6B,CAElD,IAAIC,GAA4B8D,KAAKrN,MAAMoE,QAAQmF,yBAC/CA,EAA2B,KAAIA,EAA2B,IAE9D8D,KAAKsF,MAAQ8P,YAAYpV,KAAKgV,WAAuC,IAA3B9Y,M,gCAK9C,WAEE,MAAkC8D,KAAKrN,MAA/B7C,EAAR,EAAQA,SAAUuH,EAAlB,EAAkBA,MAAOvC,EAAzB,EAAyBA,KACzB,IAAKkL,KAAKmV,gBACRrlB,EAASiL,MACT1D,EAAM7C,OAAS,EAAG,CAElBwL,KAAKmV,gBAAiB,EACtB,IAAIE,EAAWnD,SAASqB,eAAezjB,EAASiL,KAAKtC,MAAM,IACvD4c,GACF9P,YAAW,kBAAM1V,OAAOoiB,SAAS,EAAGoD,EAAS7B,aAAY,GAG7D,IAAI5V,EAAQ9I,EAAKpD,KACbkM,GAASsU,SAAStU,QAAUA,IAI9BA,GAFe,IAAI0X,WACYC,gBAAgB3X,EAAO,aAC9B4X,WAAWC,UAEnCvD,SAAStU,MAAQA,GAGfoC,KAAKlQ,SAASuP,SAAWvP,EAASuP,SACpCW,KAAKlQ,SAAWA,EAChBkQ,KAAKiV,iB,kCAIT,WAEE,MAAkCjV,KAAKrN,MAA/B6f,EAAR,EAAQA,WAAYkD,EAApB,EAAoBA,UAEpBC,cAAc3V,KAAKsF,OACnBkN,IACAkD,M,oBAiDF,WAEE,MAA6C1V,KAAKrN,MAA1CgH,EAAR,EAAQA,MAAOtC,EAAf,EAAeA,MAAOkC,EAAtB,EAAsBA,MAAOzE,EAA7B,EAA6BA,KAAM7D,EAAnC,EAAmCA,MAC7BoT,EAAUrS,GAAY8C,EAAKb,eAEjC,OACE,uBAAK4J,MAAO,CAAEiB,aAAc,OAA5B,UACG7N,GAAS,eAAC,GAAD,CAAOS,KAAMT,EAAMc,UAC7B,eAAC,GAAD,CAAQqV,YAAapH,KAAKb,eAAerH,OACzC,uBAAKiG,UAAU,cAAf,UACE,eAAC,GAAD,IACA,eAAC,GAAD,CAAatJ,KAAM8E,GAAV,KACRlC,EAAM9E,KAAI,SAACyG,EAAMmC,GAAP,OACT,eAAC,GAAD,CAAkB1G,KAAMuE,GAAdA,EAAK3E,OAEfgQ,EAAU,GAAkC,WAA7BrE,KAAKb,eAAerH,OACnC,sBAAKiG,UAAU,KAAf,SACE,eAAC,GAAD,CAAOsJ,QAAQ,YAAYlI,eAAgBa,KAAKb,eAAgBkF,QAASA,EAASiD,QAAM,SAI9F,eAAC,GAAD,CAAQ3T,OAAQqM,KAAKb,iBACpBxF,EAAMD,QACL,eAAC,GAAD,CAAY+Q,gBAAiBzK,KAAKkV,iC,GAxIxB5U,cA6KJC,gBA9BQ,SAAC3P,GAEvB,MAOIA,EAAM0I,MANR1B,EADF,EACEA,WACAiB,EAFF,EAEEA,YACA/D,EAHF,EAGEA,KACAyE,EAJF,EAIEA,MACAlC,EALF,EAKEA,MACApG,EANF,EAMEA,MAGF,MAAO,CACL0I,MAAO/I,EAAM+I,MACb7E,OACAyE,QACAlC,QACAO,aACAiB,cACA5H,QACA8F,QAASnG,EAAMmG,QAAQM,UAIA,SAACI,GAAD,MAAe,CACxCib,mBAAoB,kBAAejb,EAASib,GAAkB,WAAlB,eAC5CM,yBAA0B,kBAAevb,EAASub,GAAwB,WAAxB,eAClDR,WAAY,kBAAe/a,EAAS+a,GAAU,WAAV,eACpCkD,UAAW,kBAAMje,EAAS,CAAEhF,KAAM,mBAAoBf,KAAM,SAG9C6O,CAA6CwU,IC9K7Ca,G,+MA9BdnX,SAAW,SAAC5M,GACV,IAAQ8K,EAAS,EAAKhK,MAAdgK,KACR,EAAKhK,MAAM8L,SAAS5M,EAAG8K,EAAM9K,EAAE6M,OAAOlM,Q,6CAGxC,WAKE,IAHA,MAAyCwN,KAAKrN,MAAtCgK,EAAR,EAAQA,KAAMmH,EAAd,EAAcA,MAAO+R,EAArB,EAAqBA,OAAQC,EAA7B,EAA6BA,QAEzBC,EAAa,GACR5a,EAAI,EAAGA,EAAI0a,EAAOrhB,OAAQ2G,IAAK,CACtC,IAAInC,EAAO6c,EAAO1a,GAClB4a,EAAWvkB,KACT,yBAAewkB,QAAShd,EAAK2D,KAAMkB,MAAO,CAAEC,YAAa,OAAzD,UACE,wBAAOrL,KAAK,QAAQkK,KAAMA,EAAMnK,MAAOwG,EAAK2D,KAAM0M,QAASrQ,EAAK2D,OAASqD,KAAKrN,MAAMH,MAAOiM,SAAUuB,KAAKvB,WACzGzF,EAAKid,QAFI9a,IAOhB,OACE,kCACE,uBAAM0C,MAAO,CAAEC,YAAa,OAA5B,SAAsCgG,IACrCgS,EAAU,KAAO,wBACjBC,S,GA1BiBzV,aCsBV4V,G,+MArBdzX,SAAW,SAAC5M,GACV,IAAQ8K,EAAS,EAAKhK,MAAdgK,KACR,EAAKhK,MAAM8L,SAAS5M,EAAG8K,EAAM9K,EAAE6M,OAAOlM,Q,6CAGxC,WAEE,MAAwCwN,KAAKrN,MAArCgK,EAAR,EAAQA,KAAMnK,EAAd,EAAcA,MAAOsR,EAArB,EAAqBA,MAAOqS,EAA5B,EAA4BA,QAE5B,OACE,yBAAOH,QAASrZ,EAAMkB,MAAO,CAAEC,YAAa,OAA5C,UACE,uBAAMD,MAAO,CAAEC,YAAa,OAA5B,SAAsCgG,IACtC,wBAAOrR,KAAK,SAASkK,KAAMA,EAAMnK,MAAOA,EAAOiM,SAAUuB,KAAKvB,SAAUV,UAAU,eACrEtH,IAAZ0f,EACC,uBAAMtY,MAAO,CAAEe,WAAY,OAA3B,SAAqCuX,IACnC,Y,GAjBe7V,aCSrB8V,I,2DAMJ,WAAYzjB,GAAQ,IAAD,+BACjB,cAAMA,IA6GR0jB,UAAY,WACU,EAAK1jB,MAAjBuR,QACA1S,KAAK,IAAM3B,OAAOkL,OAhHT,EAmHnBub,aAAe,WACb,EAAKrQ,SAAL,2BACK,EAAKrV,OADV,IAEEyG,MAAO6B,OAAOC,OAAO,GAAIyC,GAAoBvE,WAtH9B,EA0HnBkf,aAAe,WAEb,ICjIwBxf,GDkIxBU,EADqB,EAAK9E,MAAlB8E,WCjIgBV,EDkIH,EAAKnG,MAAMyG,MClIkB,SAACI,GAMrDA,EAJ4B,CAC1BhF,KAAM,eACNsE,eD+HA,EAAKsf,aA9HY,EAiInBG,WAAa,SAAC3kB,GACZ,EAAKoU,SAAL,2BACK,EAAKrV,OADV,IAEE6lB,UAAW5kB,EAAE6M,OAAOgY,gBApIL,EAwInBjY,SAAW,SAAC5M,EAAG8K,EAAMnK,GAEnB,IAAI6E,EAAQ6B,OAAOC,OAAO,GAAI,EAAKvI,MAAMyG,OACzCA,EAAMsF,GAAQnK,EACd,EAAKyT,SAAL,2BACK,EAAKrV,OADV,IAEEyG,YA3IF,EAAKzG,MAAQ,CACXyG,MAAO1E,EAAMoE,QAAQM,OAGvB,EAAKsf,cAAgB,CACnB,MAAS,CACPlkB,KAAM,QACNqR,MAAO,+FACPgS,SAAS,EACTD,OAAQ,CACN,CAAElZ,KAAM,SAAUsZ,MAAO,8CACzB,CAAEtZ,KAAM,YAAasZ,MAAO,kCAC5B,CAAEtZ,KAAM,OAAQsZ,MAAO,0CAG3B,cAAiB,CACfxjB,KAAM,SACNqR,MAAO,6FACP3R,IAAK,EACLykB,IAAK,IAEP,sBAAyB,CACvBnkB,KAAM,WACNqR,MAAO,gJAET,8BAAiC,CAC/BrR,KAAM,SACNqR,MAAO,GACP3R,IAAK,GACLykB,IAAK,IACLT,QAAS,sBAEX,iBAAoB,CAClB1jB,KAAM,WACNqR,MAAO,iHAET,yBAA4B,CAC1BrR,KAAM,SACNqR,MAAO,GACP3R,IAAK,GACLykB,IAAK,IACLT,QAAS,sBAGX,aAAgB,CACd1jB,KAAM,WACNqR,MAAO,6JAET,aAAgB,CACdrR,KAAM,SACNmkB,IAAK,IACL9S,MAAO,GACPqS,QAAS,gBAEX,wBAA2B,CACzB1jB,KAAM,WACNqR,MAAO,uXAET,sBAAyB,CACvBrR,KAAM,WACNqR,MAAO,qNAGT,sBAAyB,CACvBrR,KAAM,WACNqR,MAAO,4LAET,oBAAuB,CACrBrR,KAAM,WACNqR,MAAO,0IAET,eAAkB,CAChBrR,KAAM,WACNqR,MAAO,4PAIX,EAAK+S,KAAO,CACV,CACEC,QAAS,iCACT7M,KAAM,CACJ,CAAC,SACD,CAAC,iBACD,CAAC,wBAAyB,iCAC1B,CAAC,mBAAoB,8BAGzB,CACE6M,QAAS,6CACT7M,KAAM,CACJ,CAAC,eAAgB,gBACjB,CAAC,2BACD,CAAC,2BAGL,CACE6M,QAAS,uCACT7M,KAAM,CACJ,CAAC,yBACD,CAAC,uBACD,CAAC,qBAvGU,E,2CAkJnB,WAAU,IAAD,SAEH8M,EAAO,GAFJ,eAGS/W,KAAK6W,MAHd,IAGP,2BAA2B,CAAC,IAAnBG,EAAkB,QAErB/M,EAAO,GACX,IAAK,IAAI9O,KAAK6b,EAAI/M,KAAM,CAEtB,IAFsB,EAEhBgN,EAAMD,EAAI/M,KAAK9O,GACjB+b,EAAU,GAHQ,eAILD,GAJK,yBAIbta,EAJa,QAMd3D,EAAO,EAAK2d,cAAcha,GAChC,IAAK3D,EAAM,iBAEX,IAAMxG,EAAQ,EAAK5B,MAAMyG,MAAMsF,GAEb,UAAd3D,EAAKvG,KACPykB,EAAQ1lB,KACN,eAAC,GAAD,CAEEmL,KAAMA,EACNmH,MAAO9K,EAAK8K,MACZ+R,OAAQ7c,EAAK6c,OACbrjB,MAAOA,EACPsjB,QAAS9c,EAAK8c,QACdrX,SAAU,EAAKA,UANV9B,IASc,WAAd3D,EAAKvG,MAEVuG,EAAK8K,OACPoT,EAAQ1lB,KACN,wBACEwkB,QAASrZ,EAETkB,MAAO,CAAEsZ,WAAY,WAHvB,SAIGne,EAAK8K,OAFDnH,EAAO,WAMlBua,EAAQ1lB,KACN,eAAC6M,GAAA,EAAD,CAEE5L,KAAK,SACLN,IAAK6G,EAAK7G,IACVykB,IAAK5d,EAAK4d,IACVpkB,MAAOA,EACPiM,SAAU,SAAC5M,GAAD,OAAO,EAAK4M,SAAS5M,EAAG8K,EAAM9K,EAAE6M,OAAOlM,QACjDqL,MAAO,CAAE6E,KAAM,YAAa9D,WAAY,OACxCb,UAAU,QACVN,KAAK,MARAd,IAaL3D,EAAKmd,SACPe,EAAQ1lB,KACN,uBAA8BqM,MAAO,CAAEe,WAAY,MAAO8D,KAAM,YAAhE,SAAgF1J,EAAKmd,SAA1ExZ,EAAO,cAIC,WAAd3D,EAAKvG,KACdykB,EAAQ1lB,KACN,eAAC,GAAD,CAEEmL,KAAMA,EACNmH,MAAO9K,EAAK8K,MACZqS,QAASnd,EAAKmd,QACd3jB,MAAOA,EACPiM,SAAU,EAAKA,UALV9B,IAQc,aAAd3D,EAAKvG,MACdykB,EAAQ1lB,KACN,eAAC4O,GAAA,EAAKgK,MAAN,CACE3X,KAAK,WACLqR,MAAO9K,EAAK8K,MAEZnH,KAAMA,EACN0M,QAA2B,SAAlBzU,OAAOpC,GAChBiM,SAAU,SAAC5M,GAAD,OAAO,EAAK4M,SAAS5M,EAAG8K,EAAM9K,EAAE6M,OAAO2K,UACjDxL,MAAO,CAAE6E,KAAM,WAAYI,OAAQ,MAAOoE,MAAO,SAJ5CvK,KApEb,2BAAsB,IAJA,8BAkFtBsN,EAAKzY,KACH,sBAAauM,UAAU,cAAvB,SACGmZ,GADO/b,IAOd4b,EAAKvlB,KACH,iCACE,sBAAKuM,UAAU,aAAf,SACGiZ,EAAIF,UAEP,sBAAK/Y,UAAU,cAAf,SACGkM,MALK+M,EAAIF,WAjGX,8BA6GP,OACE,uBAAK/Y,UAAU,eAAf,UACE,sBAAKA,UAAU,iBAAiBF,MAAO,CAAEkB,OAAQ,WAAjD,SACE,0FAEDgY,EACD,uBAAKhZ,UAAU,aAAf,UACE,eAAC8E,GAAA,EAAD,CACE7O,GAAG,eACHyJ,KAAK,KACLO,QAAQ,QACRH,MAAO,CAAEiF,OAAQ,OACjB/E,UAAU,SACViB,QAASgB,KAAKuW,aANhB,gBASA,eAAC1T,GAAA,EAAD,CACE7O,GAAG,gBACHyJ,KAAK,KACLO,QAAQ,QACRH,MAAO,CAAEiF,OAAQ,MAAOd,MAAO,QAC/BjE,UAAU,SACViB,QAASgB,KAAKqW,UANhB,kDASA,eAACxT,GAAA,EAAD,CACE7O,GAAG,iBACHyJ,KAAK,KACLO,QAAQ,QACRH,MAAO,CAAEiF,OAAQ,MAAOd,MAAO,SAC/BjE,UAAU,SACViB,QAASgB,KAAKsW,aANhB,+H,GA9RYhW,cAsTNC,gBARQ,SAAC3P,GAEvB,MAAO,CACLmG,QAASnG,EAAMmG,WAKHwJ,CAAyBC,aAAW4V,KE9T9CgB,G,+MAEJpY,QAAU,SAACnN,IAET4F,EADqB,EAAK9E,MAAlB8E,WlCwCoC,SAACA,EAAeC,GACzCA,IACXoD,SAASzD,MAAM7C,OAAS,GAMhCiD,EAJ+B,CAC7BhF,KAAM,uB,6CkCzCV,WAEE,IAAM4kB,EACJ,gBAAC,KAAD,WACE,eAAC,KAAD,CAAOC,OAAK,EAACC,KAAK,IAAIC,UAAW1F,KACjC,eAAC,KAAD,CAAOyF,KAAK,aAAaC,UAAW1F,KACpC,eAAC,KAAD,CAAOyF,KAAK,aAAaC,UAAWzC,KACpC,eAAC,KAAD,CAAOwC,KAAK,eAAeC,UAAWpB,QAG1C,OAAIvmB,OAAOkL,KAGP,sBAAKiE,QAASgB,KAAKhB,QAASnB,MAAO,CAAE6E,KAAM,QAA3C,SACE,sBAAK3E,UAAU,YAAf,SACE,eAAC,IAAD,UACGsZ,QAQP,sBAAKrY,QAASgB,KAAKhB,QAASnB,MAAO,CAAE6E,KAAM,QAA3C,SACE,sBAAK3E,UAAU,YAAf,SACGsZ,U,GAjCW/W,aAyCPC,iBAAU6W,ICjBZK,GAjCM,SAAC9kB,GAElB,OACI,0BAAQoL,UAAU,yBAAlB,UACI,oBAAG2B,KAAI,UAAK7M,EAAL,cAAP,wDACA,uBAAMkL,UAAU,YAAhB,eACA,oBAAG2B,KAAI,UAAK7M,EAAL,cAAP,8DACA,uBAAMkL,UAAU,YAAhB,eACA,+BAAG,oBAAG2B,KAAI,UAAK7M,EAAL,WAAP,oGAAH,QACA,uBAAMkL,UAAU,YAAhB,eACA,oBAAG2B,KAAI,UAAK7M,EAAL,aAAP,4CACA,uBAAMkL,UAAU,YAAhB,eACA,oBAAGgF,IAAI,WAAWrD,KAAI,UAAK7M,EAAL,sBAAtB,kDACA,uBAAMkL,UAAU,YAAhB,eACA,oBAAGgF,IAAI,WAAWrD,KAAI,UAAK7M,EAAL,eAAtB,wDACA,uBAAMkL,UAAU,YAAhB,eACA,oBAAG2B,KAAK,qBAAR,iFACA,uBAAM3B,UAAU,YAAhB,eACA,oBAAG2B,KAAK,uBAAR,qFACA,uBAAM3B,UAAU,YAAhB,eACA,oBAAGgF,IAAI,WAAWrD,KAAK,qBAAvB,oEACA,uBAAM3B,UAAU,YAAhB,eACA,oBAAG2B,KAAI,UAAK7M,EAAL,gBAAP,4CACA,uBAAMkL,UAAU,YAAhB,eACA,oBAAG2B,KAAI,UAAK7M,EAAL,eAAP,0EACA,uBAAMkL,UAAU,YAAhB,eACA,oBAAG2B,KAAI,UAAK7M,EAAL,sBAAP,wDACA,uBAAMkL,UAAU,YAAhB,eACA,4C,oBClBG2Z,GAXO,SAAC,GAA6B,IAA5BplB,EAA2B,EAA3BA,SAAUqlB,EAAiB,EAAjBA,YAC9B,OACI,uBAAK5Z,UAAU,iBAAf,UACKzL,EACD,sBAAKyL,UAAU,gBAAgBiB,QAAS2Y,EAAaC,WAAYD,EAAjE,SACI,uBAAM5Z,UAAU,kBAAhB,qBCgBD8Z,GArBK,SAAC,GAA0B,IAAzBvlB,EAAwB,EAAxBA,SAAUwlB,EAAc,EAAdA,SAExBC,EAAS,EAYb,OACI,sBAAKha,UAAU,eAAeia,aAXlC,SAAsBnmB,GAClBkmB,EAASlmB,EAAEomB,YAAYC,eAAe,GAAGC,SAUiBP,WAP9D,SAAoB/lB,GAChB,IAAIumB,EAAOvmB,EAAEomB,YAAYC,eAAe,GAAGC,QACvCjmB,KAAKmmB,IAAID,EAAOL,GAAU,KAC1BD,GAAUM,EAAOL,IAIrB,SACKzlB,KCKPgmB,I,qNAEJC,aAAe,WACb,MAA8B,EAAK5lB,MAA3B8E,EAAR,EAAQA,SAAUuD,EAAlB,EAAkBA,QAClBvD,EAASyN,GAAalK,EAAQE,Q,EAGhCsd,QAAU,SAAC3mB,GACTA,EAAE4P,iBACF,EAAK9O,MAAMmlB,UAAUjmB,EAAEomB,YAAYQ,S,6CAGrC,WACE,IAEIC,EACAvG,EAHJ,EAAsBnS,KAAKrN,MAAMqI,QAAzBI,EAAR,EAAQA,OAAQD,EAAhB,EAAgBA,EAIZtL,OAAOokB,YAAc,KACvByE,EAAO,IACPvG,EAAW,CAAEC,IAAKhX,EAAO2K,EAAG4S,KAAM,KAElCD,EAAO,OACPvG,EAAW,CAAEC,IAAKhX,EAAO2K,EAAG4S,KAAMzmB,KAAKC,IAAIiJ,EAAO7J,EAAG1B,OAAOokB,WAAa,OAG3E,MAAqB3S,IAAMsX,SAASC,QAAQ7Y,KAAKrN,MAAML,UAAvD,oBAAKwmB,EAAL,KAAa5jB,EAAb,KAEA,OACE,eAAC,KAAD,CACEwjB,KAAMA,EACNK,OAAO,kBACPC,yBAAyB,WAH3B,SAME,uBAAKjb,UAAU,iBAAiBF,MAAK,eAAOsU,GAAY8G,eAAgBjZ,KAAKwY,QAA7E,UACE,eAAC,GAAD,CAAeb,YAAa3X,KAAKuY,aAAjC,SACGO,EAAOnmB,MAAML,WAEhB,eAAC,GAAD,CAAawlB,SAAU9X,KAAKrN,MAAMmlB,SAAlC,SACG5iB,EAAKvC,MAAML,eAPX6I,O,GAhCemF,cA+CZC,iBAAU+X,ICtCpBY,G,oDAMJ,WAAYvmB,GAAQ,IAAD,wBACjB,cAAMA,IAwBR4e,UAzBmB,uCAyBP,WAAO3e,GAAP,mBAAAgB,EAAA,2DAENhB,EAAS,GAFH,wDAKNlB,EAAO,GACLuH,EAAU,EAAKtG,MAAMqI,QAAQE,KAAKjC,QAN9B,kBASKT,EAAeS,EAASrG,GAT7B,OASR6B,EATQ,OAWN/C,EADE+C,EACKA,EAAK/C,KAER,yHAA2BkB,GAbzB,kDAgBRlB,EAAO,KAAEK,QAhBD,QAmBV,EAAKkU,SAAS,CAAExR,OAAM/C,OAAMkB,WAnBlB,0DAzBO,wDA+CnBklB,SAAW,SAACqB,GAGQ,kBADD,EAAKxmB,MAAMqI,QAApBE,KACCzI,OACL0mB,EAAQ,EACV,EAAK5H,UAAU,EAAK3gB,MAAMgC,OAAS,GAEnC,EAAK2e,UAAU,EAAK3gB,MAAMgC,OAAS,KAnDrC,IAII6B,EAJIuG,EAAgCrI,EAAhCqI,QAASlG,EAAuBnC,EAAvBmC,KAAMuC,EAAiB1E,EAAjB0E,MAAOkC,EAAU5G,EAAV4G,MACtB2B,EAASF,EAATE,KAEJxJ,EAAO,GANM,OAQbwJ,EAAKjC,UAAYnE,EAAKd,KAEtBS,EADkB,IAAhByG,EAAKtI,OACA2G,EAEAlC,EAAM3C,MAAK,SAAAsE,GAAI,OAAIA,EAAK3E,IAAMO,OAAOsG,EAAKtI,cAGjDlB,EAAO+C,EAAK/C,MAGhB,EAAKd,MAAQ,CACX6D,OACA/C,OACAkB,OAAQsI,EAAKtI,QArBE,E,sDA0DnB,WAEOoN,KAAKpP,MAAM6D,MACduL,KAAKuR,UAAUvR,KAAKpP,MAAMgC,U,oBAI9B,WACE,IAKIkmB,EALI5d,EAAS8E,KAAKrN,MAAMqI,QAApBE,KAER,OAAK8E,KAAKpP,MAAMc,MAOdonB,EAHG9Y,KAAKpP,MAAM6D,KAGL,eAAC,GAAD,CAAUA,KAAMuL,KAAKpP,MAAM6D,KAAMmf,UAAU,EAAOE,WAAW,IAF7D,wFAKO,UAAd5Y,EAAKzI,MAAkC,kBAAdyI,EAAKzI,KAE9B,gBAAC,GAAD,CAAeuI,QAASgF,KAAKrN,MAAMqI,QAAS8c,SAAU9X,KAAK8X,SAA3D,UACE,eAAC,GAAD,UACGgB,IAEH,eAAC,GAAD,UACE,eAAC,GAAD,CACErkB,KAAMuL,KAAKpP,MAAM6D,KACjBgc,KAAMzQ,KAAKpP,MAAMc,KACjBuH,QAASiC,EAAKjC,QACd4E,MAAO,CAAE+T,UAAW,mBAAoBC,UAAW,eAMpD,MA1BA,S,GA3ESvR,aAuHNC,gBAfQ,SAAC3P,GAEvB,MAIIA,EAAM0I,MAEV,MAAO,CACLxE,KAPF,EACEA,KAOAuC,MARF,EAEEA,MAOAkC,MATF,EAGEA,SAUYgH,CAAyB2Y,ICvInCE,G,gKAEF,WAEI,IAAQ/hB,EAAU2I,KAAKrN,MAAf0E,MAER,OACI,+BACKA,EAAM9E,KAAI,SAACyG,EAAMmC,GACd,OACI,eAAC,GAAD,CAAyBH,QAAShC,EAAMkC,KAAMlC,EAAKkC,MAArClC,EAAK+B,e,GAVhBuF,aA8BVC,gBAXO,SAAC3P,GAMrB,MAAO,CACHyG,MAHAzG,EAAMkK,SADNzD,SAQSkJ,CAAyB6Y,ICX1C,IAOe7Y,gBAPS,SAAC3P,GAEvB,MAAO,CACLkL,MAAOlL,EAAMmG,QAAQM,MAAMyE,SAIhByE,EAvBf,SAAa5N,GAMX,OAJA0mB,qBAAU,WACRnH,SAAShd,KAAKokB,aAAa,QAAS3mB,EAAMmJ,UAI1C,gBAAC,WAAD,WACE,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,UCbAyd,GAAa,CAACC,KAMpB,IAAMC,GAAQC,YACVC,GACAC,IAAe,WAAf,EAAmBL,KAGjBM,GAAO,SAAC,GAAD,IAAGJ,EAAH,EAAGA,MAAH,OACT,eAAC,IAAD,CAAUA,MAAOA,EAAjB,SACI,eAAC,IAAD,UACI,eAAC,GAAD,SAMZ5pB,OAAOkL,KAAO,IAEd+e,IAASC,OAAO,eAAC,GAAD,CAAMN,MAAOA,KACzBvH,SAASqB,eAAe,SrEpBb,WACb,GAA6C,kBAAmBpjB,UAAW,CAGzE,GADkB,IAAI0e,IAAImL,eAAwBnqB,OAAOC,UAC3CmqB,SAAWpqB,OAAOC,SAASmqB,OAIvC,OAGFpqB,OAAOqqB,iBAAiB,QAAQ,WAC9B,IAAMhqB,EAAK,UAAM8pB,eAAN,sBAEPrqB,IAiDV,SAAiCO,GAE/B8E,MAAM9E,GACHI,MAAK,SAAAsG,GAGkB,MAApBA,EAASujB,SACuD,IAAhEvjB,EAASlB,QAAQ0kB,IAAI,gBAAgBC,QAAQ,cAG7ClqB,UAAUC,cAAckqB,MAAMhqB,MAAK,SAAAC,GACjCA,EAAagqB,aAAajqB,MAAK,WAC7BT,OAAOC,SAAS0qB,eAKpBvqB,EAAgBC,MAGnBc,OAAM,WACLF,QAAQC,IACN,oEArEA0pB,CAAwBvqB,GAIxBC,UAAUC,cAAckqB,MAAMhqB,MAAK,WACjCQ,QAAQC,IACN,gHAMJd,EAAgBC,OqENxBwqB,I","file":"static/js/main.52227b83.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport default function register() {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Lets check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the old content will have been purged and\r\n              // the fresh content will have been added to the cache.\r\n              // It's the perfect time to display a \"New content is\r\n              // available; please refresh.\" message in your web app.\r\n              console.log('New content is available; please refresh.');\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","\r\nexport function today(td) {\r\n    var d = new Date();\r\n    return td.getDate() === d.getDate() && td.getMonth() === d.getMonth() && td.getFullYear() === d.getFullYear();\r\n}\r\n\r\nexport const groupBy = function (xs, key) {\r\n    return xs.reduce(function (rv, x) {\r\n        (rv[x[key]] = rv[x[key]] || []).push(x);\r\n        return rv;\r\n    }, {});\r\n};\r\n\r\nexport const parseJSON = (text) => {\r\n\r\n    try {\r\n        return JSON.parse(text);    \r\n    } catch(e) {\r\n\r\n    }\r\n\r\n    try {\r\n        text = text\r\n            .replace(/\\\\</g, '<')\r\n            .replace(/\\\\>/g, '>')\r\n            .replace(/\\\\&/g, '&')\r\n            .replace(/\\\\'/g, \"'\")\r\n            .replace(/\\\\\"/g, \"\")\r\n            .replace(/ \"/g, ' \\\\\"')\r\n            .replace(/\"\"/g, '\\\\\"\"')\r\n            .replace(/\\t/g, '\\\\t')\r\n            .replace(/\"(\\.| |\\?)/g, '\\\\\"$1')\r\n\r\n        //           console.log(text);\r\n        return JSON.parse(text);\r\n\r\n        //return eval(text);\r\n    } catch (e) {\r\n        console.error(e.message);\r\n        console.log(text);\r\n\r\n        return {};\r\n    }\r\n}\r\n\r\nexport const getMaxPage = (answ) => Math.min(Math.ceil(answ / 100), 10) || 1;\r\n\r\nexport const encodeText = (text) => {\r\n    text = text\r\n        .replace(/&/g, '%26')\r\n        .replace(/\\+/g, '%2B')\r\n\r\n    return text;\r\n}\r\n\r\nexport const compare = (obj1, obj2) => {\r\n\r\n    for (let key in obj2) {\r\n        if (obj1[key] !== obj2[key])\r\n            return false\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport const join = (obj, str) => {\r\n\r\n    let res = [];\r\n    for (let key in obj) {\r\n        res.push('' + key + ':' + obj[key]);\r\n    }\r\n\r\n    return res.join(str);\r\n}\r\n\r\nexport const childrenToText = (children) => {\r\n\r\n    if (!children) return children;\r\n\r\n    return children.map(value => {\r\n        if (typeof(value) === 'string') {\r\n            return value;\r\n        } else if (value.type === 'br') {\r\n            return '<br>'\r\n        } else if (value.type.displayName === 'Connect(LinkToPost)' || value.type.displayName === 'Connect(t)') {\r\n            return value.props.number;\r\n        } else {  \r\n            console.log(value);\r\n            return value;\r\n        }    \r\n    })    \r\n}","//@flow\r\nimport fetchJsonp from 'fetch-jsonp'\r\nimport * as utils from './utils'\r\n\r\nexport const domain: string = localStorage.getItem('domain') || 'https://forum.mista.ru';\r\n//export const domain = 'https://dev.mista.ru';\r\nexport const urlTopicsList: string = localStorage.getItem('urlTopicsList') || 'api/topic.php';\r\nexport const urlTopicInfo: string = localStorage.getItem('urlTopicInfo') || 'ajax_gettopic.php';\r\nexport const urlTopicMessages: string = localStorage.getItem('urlTopicMessages') || 'api/message.php';\r\nexport const urlLogin: string = localStorage.getItem('urlLogin') || 'users.php?action=do_enter';\r\nexport const urlLogout: string = localStorage.getItem('urlLogout') || 'users.php';\r\nexport const urlCookies: string = localStorage.getItem('urlCookies') || 'ajax_cookie.php';\r\nexport const urlSections: string = localStorage.getItem('urlSections') || 'ajax_getsectionslist.php';\r\nexport const urlNewMessage: string = localStorage.getItem('urlNewMessage') || 'topic.php?id=:id&page=1';\r\nexport const urlNewTopic: string = localStorage.getItem('urlNewTopic') || 'index.php';\r\nexport const urlAddBookmark: string = localStorage.getItem('urlAddBookmark') || 'ajax_addbookmark.php';\r\nexport const urlSearch: string = localStorage.getItem('urlSearch') || 'ajax_find.php';\r\n\r\n// Topics list\r\nexport type RequestTopicsList = {\r\n  topics?: number, // число тем, которые нужно вернуть (по умолчанию - 20);\r\n  utime?: number, // время (в формате unixtime) после которого надо вернуть ветки;\r\n  callback?: string, // если указано, то ответ заворачивается в вызов функции, имя которой передано в параметре (реализация JSONP)\r\n  forum?: string, // раздел форума (1c|it|life);\r\n  section_short_name?: string,\r\n  user_id?: string,\r\n  mytopics?: string\r\n}\r\n\r\nexport type ResponseTopicsListItem = {\r\n  id: number,\r\n  forum: string,\r\n  sect1: string,\r\n  sect2: string,\r\n  v8: string,\r\n  closed: number,\r\n  down: number,\r\n  text: string,\r\n  utime: number,\r\n  created: number,\r\n  user: string,\r\n  user0: string,\r\n  is_voting: number,\r\n  answ: number\r\n}\r\n\r\nexport type ResponseTopicsList = Array<ResponseTopicsListItem>;\r\n\r\nexport const getTopicsList = async (params: RequestTopicsList): Promise<ResponseTopicsList> => {\r\n  const json = await fetchAndGetJson(urlTopicsList, params);\r\n  return json;\r\n}\r\n\r\n\r\n// Topics info\r\nexport type RequestInfo = {\r\n  id: string // идентификатор (topic_id) темы\r\n}\r\n\r\nexport type ResponseVoteItem = {\r\n  select: string,\r\n  result: number\r\n}\r\n\r\nexport type ResponseInfo = {\r\n  id: string,\r\n  text: string,\r\n  forum?: string,\r\n  section?: string,\r\n  created?: string,\r\n  user_id?: string,\r\n  user_name?: string,\r\n  answers_count: string,\r\n  down?: number,\r\n  closed?: number,\r\n  deleted?: number,\r\n  is_voting?: number,\r\n  voting?: Array<ResponseVoteItem>\r\n}\r\n\r\nexport const defaultInfo = {\r\n  id: \"\",\r\n  text: \"\",\r\n  answers_count: \"\"\r\n}\r\n\r\nexport const getTopicInfo = async (params: RequestInfo): Promise<ResponseInfo> => {\r\n  const json = await fetchAndGetJson(urlTopicInfo, params);\r\n  return json;\r\n}\r\n\r\n\r\n// Topic messages\r\nexport type RequestMessages = {\r\n  id: number | string, // идентификатор (topic_id) темы\r\n  from?: number, // с какого сообщения. если не указан, то с первого\r\n  to?: number  // до какого сообщения. если не указан, то from+10\r\n}\r\n\r\nexport type ResponseMessage = {\r\n  id: string,\r\n  n: string,\r\n  user: string,\r\n  userId: string,\r\n  text: string,\r\n  utime: string,\r\n  vote: number\r\n}\r\n\r\nexport type ResponseMessages = Array<ResponseMessage>;\r\n\r\nexport const getTopicMessages = async (params: RequestMessages): Promise<ResponseMessages> => {\r\n  const json = await fetchAndGetJson(urlTopicMessages, params);\r\n  return json;\r\n}\r\n\r\nexport const getMessage = async (id: number | string, n: number): Promise<?ResponseMessage> => {\r\n  const json = await getTopicMessages({\r\n    id,\r\n    from: n,\r\n    to: +n + 1\r\n  }\r\n  );\r\n\r\n  let data;\r\n  if (json && json.length > 0)\r\n    data = json.find(val => val.n === String(n));\r\n\r\n  return data;\r\n}\r\n\r\nexport const getTopicMessagesCount = async (id: number | string): Promise<number> => {\r\n  const info = await getTopicInfo({ id: String(id) });\r\n  return +info.answers_count;\r\n}\r\n\r\n// Login\r\nexport type RequestLogin = {\r\n  username: string, // логин (ник) пользователя\r\n  password: string, // пароль пользователя\r\n  callback?: string, // если указано, то ответ заворачивается в вызов функции, имя которой передано в параметре (реализация JSONP)\r\n}\r\n\r\nexport type ResponseLogin = {\r\n  userid: string,\r\n  username: string,\r\n  hashkey: string,\r\n  error?: string\r\n}\r\n\r\nexport const getLogin = async (params: RequestLogin): Promise<any> => {\r\n  let result = await fetch(`${domain}/${urlLogin}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', {user_name: params.username, user_password: params.password}),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Accept': 'text/html,application/xhtml+xml,application/xml',\r\n      'Content-Type': 'application/x-www-form-urlencoded',\r\n    },\r\n    redirect: 'follow'\r\n  });\r\n  //const json = await fetchJsonpAndGetJson(urlLogin, params);\r\n  //return json;\r\n}\r\n\r\nexport const getLogout = async (): Promise<any> => {\r\n  const fullUrl = `${domain}/${urlLogout}?action=exit`;\r\n  await fetch(fullUrl, {\r\n    mode: 'no-cors',\r\n    credentials: 'include'\r\n  });\r\n}\r\n\r\n\r\n// Cookies\r\nexport type ResponseCookies = {\r\n  cookie: {\r\n    entr_id: string,\r\n    entr_key: string,\r\n    entr_hash: string\r\n  },\r\n  session: {\r\n    user_id: string,\r\n    user_name: string,\r\n    user_hash: string,\r\n    is_moderator: number,\r\n    light_moderator: number,\r\n    section: string,\r\n    show_moderator_tools: number,\r\n    last_error?: string\r\n  }\r\n}\r\n\r\nexport const getCookies = async (): Promise<ResponseCookies> => {\r\n  const json = await fetchJsonpAndGetJson(urlCookies);\r\n  return json;\r\n}\r\n\r\n\r\n// Sections\r\nexport type ResponseSection = {\r\n  id: number,\r\n  forum: string,\r\n  shortn: string,\r\n  fulln: string,\r\n  id: number\r\n}\r\n\r\nexport type ResponseSections = Array<ResponseSection>;\r\n\r\nexport const getSections = async (): Promise<ResponseSections> => {\r\n  const json = await fetchJsonpAndGetJson(urlSections);\r\n  return json;\r\n}\r\n\r\n\r\n// New message\r\nexport type RequestNewMessage = {\r\n  message_text: string,\r\n  action: \"new\",\r\n  topic_id: string,\r\n  rnd: number,\r\n  voting_select?: number,\r\n  as_admin?: boolean\r\n}\r\n\r\nexport const postNewMessage = async (params: RequestNewMessage): Promise<any> => {\r\n\r\n  let url = urlNewMessage.replace(':id', params.topic_id);\r\n\r\n  let result = await fetch(`${domain}/${url}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', params),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Accept': 'text/html,application/xhtml+xml,application/xml',\r\n      'Content-Type': 'application/x-www-form-urlencoded',\r\n    },\r\n    redirect: 'follow'\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n\r\n// New topic\r\nexport type RequestNewTopic = {\r\n  action: \"new\",\r\n  rnd: number,\r\n  topic_text: string,\r\n  message_text: string,\r\n  target_section: string,\r\n  target_forum: string,\r\n  voting: number,\r\n  select1?: string,\r\n  select2?: string,\r\n  select3?: string,\r\n  select4?: string,\r\n  select5?: string,\r\n  select6?: string,\r\n  select7?: string,\r\n  select8?: string,\r\n  select9?: string,\r\n  select10?: string\r\n}\r\n\r\nexport const postNewTopic = async (params: RequestNewTopic): Promise<any> => {\r\n\r\n  await fetch(`${domain}/${urlNewTopic}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', params),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded'\r\n    }\r\n  });\r\n}\r\n\r\n\r\n//Bookmark\r\nexport type RequestBookmark = {\r\n  id: string\r\n}\r\n\r\nexport const postBookmark = async (params: RequestBookmark) => {\r\n\r\n  await fetch(`${domain}/${urlAddBookmark}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', params),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n  });\r\n}\r\n\r\n\r\n//Search\r\nexport type RequestSearch = {\r\n  keywords: string\r\n}\r\n\r\nexport type ResponseSearch = {\r\n\r\n}\r\n\r\nexport const postSearch = async (params: RequestSearch) => {\r\n\r\n  await fetch(`${domain}/${urlSearch}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', params),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n  });\r\n}\r\n\r\nexport const paramsToString = (paramsPrefix: string, params: ?{}): string => {\r\n\r\n  if (!params)\r\n    return '';\r\n\r\n  let arr = [];\r\n  for (let key in params) {\r\n    if (params[key] !== undefined)\r\n      arr.push(key + '=' + params[key]);\r\n  }\r\n\r\n  if (arr.length > 0)\r\n    return paramsPrefix + arr.join('&');\r\n  else\r\n    return '';\r\n}\r\n\r\nexport const fetchJsonpAndGetJson = async (url: string, params: any): Promise<any> => {\r\n\r\n  let fullUrl = `${domain}/${url}${paramsToString('?', params)}`;\r\n  const response = await fetchJsonp(fullUrl);\r\n  let responseJson = await response.json();\r\n  let json;\r\n  if (typeof (responseJson) === 'string') {\r\n\r\n    try {\r\n      json = JSON.parse(responseJson)\r\n    } catch (e) {\r\n      json = utils.parseJSON(responseJson);\r\n    }\r\n  } else {\r\n    json = responseJson;\r\n  }\r\n  return json;\r\n}\r\n\r\nexport const fetchAndGetJson = async (url: string, params: any, options: any): Promise<any> => {\r\n\r\n  let fullUrl = `${domain}/${url}${paramsToString('?', params)}`;\r\n  const response = await fetch(fullUrl, options);\r\n  let responseJson = await response.json();\r\n  let json;\r\n  if (typeof (responseJson) === 'string') {\r\n\r\n    try {\r\n      json = JSON.parse(responseJson)\r\n    } catch (e) {\r\n      json = utils.parseJSON(responseJson);\r\n    }\r\n  } else {\r\n    json = responseJson;\r\n  }\r\n  return json;\r\n}","//@flow\r\nimport * as API from '../api'\r\nimport type { RequestTopicsList, ResponseTopicsList } from 'src/api'\r\nimport type { State } from 'src/reducers'\r\n\r\nexport const REQUEST_TOPICS_LIST = 'REQUEST_TOPICS_LIST';\r\nexport const RECEIVE_TOPICS_LIST = 'RECEIVE_TOPICS_LIST';\r\nexport const RECEIVE_TOPICS_LIST_FAILED = 'RECEIVE_TOPICS_LIST_FAILED';\r\nexport const TOGGLE_PREVIEW = 'TOGGLE_PREVIEW';\r\n\r\nexport type typeREQUEST_TOPICS_LIST = {\r\n  type: typeof REQUEST_TOPICS_LIST\r\n}\r\n\r\nexport type typeRECEIVE_TOPICS_LIST = {\r\n  type: typeof RECEIVE_TOPICS_LIST,\r\n  items: ResponseTopicsList,\r\n  receivedAt: Date\r\n}\r\n\r\nexport type typeRECEIVE_TOPICS_LIST_FAILED = {\r\n  type: typeof RECEIVE_TOPICS_LIST_FAILED,\r\n  error: string,\r\n  receivedAt: Date\r\n}\r\n\r\nexport type typeTOGGLE_PREVIEW = {\r\n  type: typeof TOGGLE_PREVIEW,\r\n  topicId: string\r\n}\r\n\r\nexport type TopicsListAction = typeREQUEST_TOPICS_LIST | typeRECEIVE_TOPICS_LIST | typeRECEIVE_TOPICS_LIST_FAILED | typeTOGGLE_PREVIEW;\r\n\r\nexport const requestTopicsList = (): typeREQUEST_TOPICS_LIST => ({\r\n  type: REQUEST_TOPICS_LIST\r\n})\r\n\r\nexport const receiveTopicsList = (data: ResponseTopicsList): typeRECEIVE_TOPICS_LIST => ({\r\n  type: RECEIVE_TOPICS_LIST,\r\n  items: data,\r\n  receivedAt: new Date()\r\n})\r\n\r\nconst fetchTopicsList = (params: any) => async (dispatch: any, getState: any) => {\r\n\r\n  dispatch(requestTopicsList())\r\n\r\n  const page = params.page || 1;\r\n  let reqestParams: RequestTopicsList = {};\r\n\r\n  let topicsPerPage = +getState().options.items.topicsPerPage;\r\n  if (topicsPerPage > 99) topicsPerPage = 99;\r\n\r\n  let topicsCount = page * topicsPerPage;\r\n  reqestParams.topics = topicsCount;\r\n\r\n  if (params.section)\r\n    reqestParams.section_short_name = params.section;\r\n\r\n  if (params.forum)\r\n    reqestParams.forum = params.forum;\r\n\r\n  if (params.user_id)\r\n    reqestParams.user_id = params.user_id;\r\n\r\n  if (params.mytopics)\r\n    reqestParams.mytopics = params.mytopics;\r\n\r\n  try {\r\n    const json = await API.getTopicsList(reqestParams);\r\n\r\n    let data = json.slice(-topicsPerPage);\r\n    dispatch(receiveTopicsList(data));\r\n  } catch (e) {\r\n\r\n    let action: TopicsListAction = {\r\n      type: RECEIVE_TOPICS_LIST_FAILED,\r\n      error: e.message,\r\n      receivedAt: new Date()\r\n    }\r\n    dispatch(action);\r\n    console.error(e);\r\n  }\r\n\r\n}\r\n\r\nconst shouldFetchTopicsList = (state: State) => {\r\n  const topicsList = state.topicsList;\r\n  if (!topicsList) {\r\n    return true\r\n  }\r\n  if (topicsList.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const fetchTopicsListIfNeeded = (params: any): any => (dispatch: any, getState: any) => {\r\n  if (shouldFetchTopicsList(getState())) {\r\n    return dispatch(fetchTopicsList(params));\r\n  }\r\n}\r\n","//@flow\r\nimport type { TopicsListAction } from 'src/actions/topics_list'\r\nimport type { ResponseTopicsListItem } from 'src/api'\r\n\r\nimport { REQUEST_TOPICS_LIST, RECEIVE_TOPICS_LIST, RECEIVE_TOPICS_LIST_FAILED, TOGGLE_PREVIEW } from 'src/actions/topics_list'\r\n\r\nexport type TopicsListItem = ResponseTopicsListItem & {\r\n  showPreview?: ?boolean\r\n}\r\n\r\nexport type TopicsListState = {\r\n  isFetching: boolean;\r\n  items: Array<TopicsListItem>,\r\n  error?: ?string,\r\n  lastUpdated?: Date\r\n};\r\n\r\nexport const defaultTopicsListState: TopicsListState = {\r\n  isFetching: false,\r\n  items: []\r\n}\r\n\r\nconst topicsList = (state: TopicsListState = defaultTopicsListState, action: TopicsListAction): TopicsListState => {\r\n\r\n  switch (action.type) {\r\n    case REQUEST_TOPICS_LIST:\r\n      return {\r\n        ...state,\r\n        error: null,\r\n        isFetching: true\r\n      }\r\n    case RECEIVE_TOPICS_LIST:\r\n      return {\r\n        ...state,\r\n        isFetching: false,\r\n        items: action.items,\r\n        lastUpdated: action.receivedAt\r\n      }\r\n    case RECEIVE_TOPICS_LIST_FAILED:\r\n      return {\r\n        ...state,\r\n        isFetching: false,\r\n        error: action.error,\r\n        lastUpdated: action.receivedAt\r\n      }\r\n    case TOGGLE_PREVIEW:\r\n      let items = state.items.slice();\r\n      const ind = items.findIndex(item => item.id === action.topicId);\r\n\r\n      let item = Object.assign({}, items[ind]);\r\n      item.showPreview = !item.showPreview;\r\n      items[ind] = item;\r\n\r\n      return {\r\n        ...state,\r\n        items\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default topicsList;","//@flow \r\nimport { defaultInfo } from 'src/api'\r\nimport type { ResponseInfo, ResponseMessages, ResponseMessage } from 'src/api'\r\nimport type { TopicAction } from 'src/actions/topic'\r\n\r\nexport type TopicState = {\r\n  isFetching: boolean;\r\n  info: ResponseInfo,\r\n  item0?: ?ResponseMessage,\r\n  items: ResponseMessages,\r\n  lastUpdated?: ?Date,\r\n  error?: ?string\r\n};\r\n\r\nexport const defaultTopicState: TopicState = {\r\n    isFetching: false,\r\n    info: defaultInfo,\r\n    items: []\r\n}\r\n\r\nconst topic = (state: TopicState = defaultTopicState, action: TopicAction): TopicState => {\r\n    switch (action.type) {\r\n        case 'REQUEST_TOPIC':\r\n            return {\r\n                ...state,\r\n                isFetching: true,\r\n                error: null\r\n            }\r\n        case 'RECEIVE_TOPIC':\r\n            return {\r\n                ...state,\r\n                isFetching: false,\r\n                info: action.info,\r\n                item0: action.item0,\r\n                items: action.items,\r\n                lastUpdated: action.receivedAt,\r\n                error: null\r\n            }\r\n        case 'RECEIVE_TOPIC_FAILED':\r\n            return {\r\n                ...state,\r\n                isFetching: false,\r\n                lastUpdated: action.receivedAt,\r\n                error: action.error\r\n            }\r\n        case 'REQUEST_NEW_MESSAGES':\r\n            return {\r\n                ...state,\r\n                isFetching: true\r\n            }\r\n            \r\n        case 'RECEIVE_NEW_MESSAGES':\r\n\r\n            let info = state.info;\r\n            if (action.items.length > 0) {\r\n                info.answers_count = action.items[action.items.length - 1].n;\r\n            }\r\n\r\n            return {\r\n                ...state,\r\n                isFetching: false,\r\n                items: state.items.concat(action.items),\r\n                info,\r\n                lastUpdated: action.receivedAt\r\n            }\r\n\r\n        case 'CLOSE_TOPIC': \r\n        \r\n            return {\r\n                ...state,\r\n                items: [],\r\n                info: defaultInfo,\r\n                item0: null,\r\n                lastUpdated: null,\r\n                error: null            \r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default topic;","//@flow \r\nimport type { LoginAction } from 'src/actions/login'\r\n\r\nexport type LoginState = {\r\n  isFetching: boolean;\r\n  logged: any,\r\n  userid?: string,\r\n  username?: string,\r\n  hashkey?: string,\r\n  error?: string\r\n};\r\n\r\nexport const defaultLoginState: LoginState = {\r\n    isFetching: false,\r\n    logged: undefined\r\n}\r\n\r\nconst login = (state: LoginState = defaultLoginState, action: LoginAction): LoginState => {\r\n    switch (action.type) {\r\n        case 'LOGIN_START':\r\n            return {\r\n                ...state,\r\n                isFetching: true\r\n            }\r\n        case 'LOGIN_COMPLETE':\r\n            return {\r\n                ...state,\r\n                ...action.data,\r\n                isFetching: false,\r\n                logged: true,\r\n                error: undefined\r\n            }\r\n         case 'LOGIN_FAILED':\r\n            return {\r\n                isFetching: false,\r\n                logged: false,\r\n                error: action.error\r\n            }\r\n        case 'LOGOUT_COMPLETE':\r\n            return {\r\n                ...state,\r\n                userid: undefined,\r\n                username: undefined,\r\n                hashkey: undefined,\r\n                logged: false\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default login;","//@flow \r\nimport type { ResponseSections } from 'src/api'\r\nimport type { SectionsAction } from 'src/actions/sections'\r\n\r\nimport { groupBy } from 'src/utils'\r\n\r\nexport type SectionsState = {\r\n  isFetching: boolean;\r\n  items: ResponseSections,\r\n  tree: {[string]: any},\r\n  map: {[string]: any},\r\n  lastUpdated?: Date,\r\n  error?: ?string\r\n};\r\n\r\nexport const defaultSectionsState: SectionsState = {\r\n    isFetching: false,\r\n    items: [],\r\n    tree: {},\r\n    map: {}\r\n}\r\n\r\nconst sections = (state: SectionsState = defaultSectionsState, action: SectionsAction): SectionsState => {\r\n    switch (action.type) {\r\n        case 'REQUEST_SECTIONS':\r\n            return {\r\n                ...state,\r\n                isFetching: true\r\n            }\r\n        case 'RECEIVE_SECTIONS':\r\n\r\n            let map = {};\r\n            action.items.forEach(val => {\r\n                map[val.shortn] = val.fulln\r\n            });\r\n\r\n            return {\r\n                ...state,\r\n                isFetching: false,\r\n                items: action.items,\r\n                tree: groupBy(action.items, 'forum'),\r\n                map,\r\n                lastUpdated: action.receivedAt\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default sections;","//@flow\r\nimport type { AddBookmarkAction } from 'src/actions/bookmark'\r\n\r\nexport type BookmarkState = {\r\n  isFetching: boolean\r\n};\r\n\r\nexport const defaultBookmarkState: BookmarkState = {\r\n  isFetching: false\r\n};\r\n\r\nconst bookmark = (state: BookmarkState = defaultBookmarkState, action: AddBookmarkAction): BookmarkState => {\r\n    switch (action.type) {\r\n        case 'ADD_BOOKMARK_START':\r\n            return {\r\n                ...state,\r\n                isFetching: true\r\n            }\r\n        case 'ADD_BOOKMARK_COMPLETE':\r\n        case 'ADD_BOOKMARK_FAIL':\r\n            return {\r\n                ...state,\r\n                isFetching: false\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default bookmark;","//@flow\r\nimport type { NewTopicAction } from '../actions/new_topic'\r\nimport type { ResponseSection } from 'src/api'\r\n\r\nexport type NewTopicState = {\r\n    isFetching: boolean,\r\n    section: ?ResponseSection,\r\n    text: string,\r\n    subject: string,\r\n    forum: string,\r\n    isVoting: boolean,\r\n    error?: ?string\r\n};\r\n\r\nexport const defaultNewTopicState: NewTopicState = {\r\n    isFetching: false,\r\n    section: null,\r\n    text: '',\r\n    subject: '',\r\n    forum: '1C',\r\n    isVoting: false\r\n}\r\n\r\nconst newTopic = (state: NewTopicState = defaultNewTopicState, action: NewTopicAction): NewTopicState => {\r\n    switch (action.type) {\r\n        case 'POST_NEW_TOPIC_START':\r\n            return {\r\n                ...state,\r\n                isFetching: true,\r\n                error: undefined\r\n            }\r\n        case 'POST_NEW_TOPIC_COMPLETE':\r\n            return {\r\n                ...state,\r\n                isFetching: false\r\n            }\r\n       case 'POST_NEW_TOPIC_ERROR':\r\n            return {\r\n                ...state,\r\n                isFetching: false,\r\n                error: action.error\r\n            }\r\n        case 'NEW_TOPIC_SECTION':\r\n            return {\r\n                ...state,\r\n                section: action.section,\r\n                forum: action.section == null ? '' : action.section.forum.toLowerCase()\r\n            }\r\n        case 'NEW_TOPIC_TEXT':\r\n            return {\r\n                ...state,\r\n                text: action.text\r\n            }\r\n        case 'NEW_TOPIC_SUBJECT':\r\n            return {\r\n                ...state,\r\n                subject: action.text\r\n            }\r\n        case 'NEW_TOPIC_CLEAR':\r\n            return {\r\n                ...state,\r\n                text: '',\r\n                subject: '',\r\n                isVoting: false\r\n            }\r\n        case 'SHOW_VOTING':\r\n            return {\r\n                ...state,\r\n                isVoting: action.data\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default newTopic;","//@flow\r\nimport type { NewMessageAction } from 'src/actions/new_message'\r\n\r\nexport type NewMessageState = {\r\n    isFetching: boolean;\r\n    text: string\r\n};\r\n\r\nexport const defaultNewMessageState: NewMessageState = {\r\n    isFetching: false,\r\n    text: ''\r\n}\r\n\r\nconst newMessage = (state: NewMessageState = defaultNewMessageState, action: NewMessageAction): NewMessageState => {\r\n    switch (action.type) {\r\n        case 'POST_NEW_MESSAGE_START':\r\n            return {\r\n                ...state,\r\n                isFetching: true\r\n            }\r\n        case 'POST_NEW_MESSAGE_COMPLETE':\r\n            return {\r\n                ...state,\r\n                isFetching: false\r\n            }\r\n        case 'NEW_MESSAGE_TEXT':\r\n            return {\r\n                ...state,\r\n                text: action.text\r\n            }\r\n        case 'ADD_MESSAGE_TEXT':\r\n            return {\r\n                ...state,\r\n                text: state.text + action.text\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default newMessage;","//@flow\r\nimport type { TooltipItem, TooltipsAction } from 'src/actions/tooltips'\r\n\r\nexport type TooltipItemState = {\r\n    i: number,\r\n    hash: string\r\n} & TooltipItem\r\n\r\nexport type TooltipsState = {\r\n    items: Array<TooltipItemState>\r\n};\r\n\r\nexport const defaultTooltipsState: TooltipsState = {\r\n    items: []\r\n}\r\n\r\nconst tooltips = (state: TooltipsState = defaultTooltipsState, action: TooltipsAction): TooltipsState => {\r\n    let hash: string;\r\n    let items: Array<TooltipItemState>;\r\n    let tooltip;\r\n    switch (action.type) {\r\n        case 'CREATE_TOOLTIP':\r\n\r\n            items = state.items.slice();\r\n\r\n            hash = JSON.stringify(action.keys);\r\n            var ind = items.findIndex(val => val.hash === hash);\r\n            if (ind === - 1)\r\n                items.push({\r\n                    i: 0,\r\n                    keys: action.keys,\r\n                    hash,\r\n                    coords: action.coords\r\n                });\r\n            else {   \r\n                tooltip = Object.assign({}, items[ind]);\r\n                tooltip.coords = action.coords;\r\n                //to reset draggable position\r\n                tooltip.i += 1;\r\n                items[ind] = tooltip;\r\n            }\r\n\r\n            return {\r\n                ...state,\r\n                items\r\n            }\r\n        case 'CLOSE_TOOLTIP':\r\n            hash = JSON.stringify(action.keys);\r\n            return {\r\n                ...state,\r\n                items: state.items.filter(val => val.hash !== hash)\r\n            }\r\n        case 'CLEAR_TOOLTIPS':\r\n            if (state.items.length === 0)\r\n                return state\r\n            else     \r\n                return {\r\n                    ...state,\r\n                    items: []\r\n                }\r\n\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default tooltips;","//@flow\r\nimport type { TopicPreviewAction } from 'src/actions/topic_preview'\r\nimport type { ResponseMessage } from 'src/api'\r\n\r\nexport type TopicPreviewState = {\r\n    items: {[string]: ResponseMessage | null}\r\n};\r\n\r\nexport const defaultTopicPreviewState: TopicPreviewState = {\r\n    items: {}\r\n};\r\n\r\nconst topicPreview = (state: TopicPreviewState = defaultTopicPreviewState, action: TopicPreviewAction): TopicPreviewState => {\r\n\r\n    let previewItem;\r\n\r\n    switch (action.type) {\r\n         case 'SHOW_PREVIEW':\r\n\r\n            previewItem = state[action.topicId];\r\n            if (previewItem === undefined)\r\n                state.items[action.topicId] = {\r\n                    n: '0',\r\n                    id: action.topicId,\r\n                    text: '',\r\n                    user: '',\r\n                    userId: '',\r\n                    utime: '0',\r\n                    vote: 0\r\n                };    \r\n            return {\r\n                ...state,\r\n            }\r\n         case 'CLOSE_PREVIEW': {\r\n            delete state.items[action.topicId];\r\n            return {\r\n                ...state\r\n            }\r\n         }\r\n        case 'RECEIVE_PREVIEW_TEXT':\r\n\r\n            previewItem = state.items[action.topicId];\r\n            if (previewItem === undefined)\r\n                return state;\r\n            else\r\n                state.items[action.topicId] = action.message;        \r\n            \r\n            return {\r\n                ...state,\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default topicPreview;","//@flow\r\nexport type Column = {\r\n  name: string,\r\n  className?: string,\r\n  width?: string\r\n}\r\n\r\nexport type OptionsItems = {\r\n  theme: 'yellow' | 'lightgray' | 'dark',\r\n  topicsPerPage: string,\r\n  autoRefreshTopicsList: string,\r\n  autoRefreshTopicsListInterval: string,\r\n  autoRefreshTopic: string,\r\n  autoRefreshTopicInterval: string,\r\n  contetnMaxWidth?: string,\r\n  tooltipDelay: string,\r\n  showTooltips: string,\r\n  showTooltipOnTopicsList: string\r\n}\r\n\r\nexport type OptionsState = {\r\n  voteColors: Array<string>,\r\n  items: OptionsItems,\r\n  show?: boolean\r\n};\r\n\r\nexport const defaultOptionsState: OptionsState = {\r\n  voteColors: [\r\n    \"#FF1616\", //1\r\n    \"#1A861A\", //2\r\n    \"#0023FF\", //3\r\n    \"#FF6B18\", //4\r\n    \"#9B3A6E\", //5\r\n    \"#567655\", //6\r\n    \"#233345\", //7\r\n    \"#CC0000\", //8\r\n    \"#00CCCC\", //9\r\n    \"#0000CC\", //10\r\n  ],\r\n  items: {\r\n    theme: 'lightgray',\r\n    topicsPerPage: '20',\r\n    autoRefreshTopicsList: 'false',\r\n    autoRefreshTopicsListInterval: '60',\r\n    autoRefreshTopic: 'true',\r\n    autoRefreshTopicInterval: '60',\r\n    //tooltips\r\n    showTooltips: 'true',\r\n    tooltipDelay: '500',\r\n    showTooltipOnTopicsList: 'true',\r\n    showTooltipOnPostLink: 'true',\r\n    //links\r\n    showYoutubeVideoTitle: 'true',\r\n    replaceCatalogMista: 'true',\r\n    fixBrokenLinks: 'true',\r\n  }\r\n}\r\n\r\nfunction readOption(name, defaultValue) {\r\n  return window.localStorage.getItem(name) || defaultValue;\r\n}\r\n\r\nfunction readOptions() {\r\n  \r\n  let state: OptionsState = defaultOptionsState;\r\n  for (let key in state.items) {\r\n    state.items[key] = readOption(key, state.items[key]);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nconst options = (state: OptionsState, action: any): OptionsState => {\r\n\r\n  if (!state)\r\n    state = readOptions();\r\n\r\n  switch (action.type) {\r\n\r\n    case 'READ_OPTIONS':\r\n\r\n      let items = Object.assign({}, defaultOptionsState.items);\r\n      for (let key in items) {\r\n        items[key] = readOption(key, defaultOptionsState.items[key]);\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        items\r\n      }\r\n\r\n    case 'SAVE_OPTIONS':\r\n\r\n      for (let key in action.options) {\r\n        window.localStorage.setItem(key, String(action.options[key]));\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        items: action.options\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default options;","//@flow\r\nimport { combineReducers } from 'redux'\r\n\r\nimport topicsList from './topics_list'\r\nimport type { TopicsListState } from './topics_list'\r\n\r\nimport topic from './topic'\r\nimport type { TopicState } from './topic'\r\n\r\nimport login from './login'\r\nimport type { LoginState } from './login'\r\n\r\nimport sections from './sections'\r\nimport type { SectionsState } from './sections'\r\n\r\nimport bookmark from './bookmark'\r\nimport type { BookmarkState } from './bookmark'\r\n\r\nimport newTopic from './new_topic'\r\nimport type { NewTopicState } from './new_topic'\r\n\r\nimport newMessage from './new_message'\r\nimport type { NewMessageState } from './new_message'\r\n\r\nimport tooltips from './tooltips'\r\nimport type { TooltipsState } from './tooltips'\r\n\r\nimport topicPreview from './topic_preview'\r\nimport type { TopicPreviewState } from './topic_preview'\r\n\r\nimport options from './options'\r\nimport type { OptionsState } from './options'\r\n\r\nexport type State = {\r\n  topicsList: TopicsListState,\r\n  sections: SectionsState,\r\n  topic: TopicState,\r\n  login: LoginState,\r\n  bookmark: BookmarkState,\r\n  newTopic: NewTopicState,\r\n  newMessage: NewMessageState,\r\n  tooltips: TooltipsState,\r\n  topicPreview: TopicPreviewState,\r\n  options: OptionsState\r\n}\r\n\r\nconst rootReducer = combineReducers({\r\n  topicsList,\r\n  sections,\r\n  topic,\r\n  login,\r\n  bookmark,\r\n  newTopic,\r\n  newMessage,\r\n  tooltips,\r\n  topicPreview,\r\n  options\r\n})\r\n\r\nexport default (rootReducer: any);","//@flow\r\nimport React, { Component, useState } from 'react'\r\nimport InputGroup from 'react-bootstrap/InputGroup'\r\nimport FormControl from 'react-bootstrap/FormControl'\r\nimport Dropdown from 'react-bootstrap/Dropdown'\r\nimport DropdownButton from 'react-bootstrap/DropdownButton'\r\n\r\nimport './search.css'\r\n\r\nconst Search = () => {\r\n\r\n  const [searchEngine, setSearchEngine] = useState('Яндекс');\r\n  const [text, setText] = useState('');\r\n\r\n  function onKeyPress(e: any) {\r\n    if (e.key === 'Enter') {\r\n      doSearch();\r\n    }\r\n  }\r\n\r\n  function doSearch() {\r\n\r\n    let url;\r\n    if (searchEngine === 'Яндекс') {\r\n      url = `https://www.yandex.ru/search/?text=${text}&site=forum.mista.ru`;\r\n\r\n    } else if (searchEngine === 'Google') {\r\n      url = `https://www.google.ru/search?q=${text}+site:forum.mista.ru`\r\n    }\r\n\r\n    window.open(url);\r\n\r\n    setText('');\r\n\r\n  }\r\n\r\n  return (\r\n    <InputGroup size=\"sm\">\r\n      <InputGroup.Prepend>\r\n        <DropdownButton id=\"search-engine\" title=\"\" size=\"sm\" style={{ marginRight: \"2px\" }} className='button' variant=\"light\">\r\n          <Dropdown.Item eventKey=\"Яндекс\" onSelect={() => setSearchEngine(\"Яндекс\")}>Яндекс</Dropdown.Item>\r\n          <Dropdown.Item eventKey=\"Google\" onSelect={() => setSearchEngine(\"Google\")}>Google</Dropdown.Item>\r\n        </DropdownButton>\r\n      </InputGroup.Prepend>\r\n      <FormControl\r\n        type=\"text\"\r\n        placeholder={`${searchEngine}: поиск`}\r\n        style={{ marginRight: \"4px\", paddingRight: \"27px\" }}\r\n        className='input'\r\n        onKeyPress={onKeyPress}\r\n        onChange={e => setText(e.target.value)}\r\n        value={text}\r\n      />\r\n      <InputGroup.Append style={{ marginLeft: \"-25px\", marginTop: \"auto\", marginBottom: \"auto\", cursor: \"pointer\" }} onClick={doSearch}>\r\n        <i className=\"fa fa-search input\" style={{ zIndex: 1000 }} />\r\n      </InputGroup.Append>\r\n    </InputGroup>\r\n  )\r\n\r\n}\r\n\r\nexport default (Search: any);","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\nimport Navbar from 'react-bootstrap/Navbar'\r\nimport Nav from 'react-bootstrap/Nav'\r\nimport Form from 'react-bootstrap/Form'\r\nimport queryString from 'query-string'\r\nimport { withRouter } from 'react-router-dom'\r\n\r\nimport Search from 'src/components/common/search'\r\nimport { fetchTopicsListIfNeeded } from 'src/actions/topics_list'\r\n\r\nimport './nav_bar.css'\r\n\r\nclass NavBar extends Component {\r\n\r\n    onClick = (e) => {\r\n        const { dispatch, location } = this.props;\r\n        let locationParams = queryString.parse(location.search);\r\n        dispatch(fetchTopicsListIfNeeded(locationParams));\r\n    }\r\n\r\n    render() {\r\n\r\n        const menu = [\r\n            { name: '1С', link: `${window.hash}/index.php?forum=1C` },\r\n            { name: 'IT', link: `${window.hash}/index.php?forum=IT` },\r\n            { name: 'JOB', link: `${window.hash}/index.php?forum=JOB` },\r\n            { name: 'LIFE', link: `${window.hash}/index.php?forum=LIFE` },\r\n            { name: 'Wiki', link: 'https://wiki.mista.ru' },\r\n            { name: 'Книга знаний', link: 'https://kb.mista.ru' },\r\n        ];\r\n\r\n        const menuItems = menu.map((item, i) => {\r\n            return (\r\n                <Nav.Item key={i}>\r\n                    <Nav.Link href={item.link}>\r\n                        {item.name}\r\n                    </Nav.Link>\r\n                </Nav.Item>\r\n            )\r\n        });\r\n        \r\n        return (\r\n            <Navbar bg=\"dark\" variant=\"dark\" expand=\"md\" fixed=\"top\">\r\n                <Navbar.Brand\r\n                    href={`${window.hash}`} \r\n                    onClick={this.onClick}>\r\n                    React.Mista\r\n                </Navbar.Brand>\r\n                <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\r\n                <Navbar.Collapse>\r\n                    <Nav className=\"mr-auto\">\r\n                        {menuItems}\r\n                    </Nav>\r\n                    <Form inline>\r\n                        <Search />\r\n                    </Form>\r\n               </Navbar.Collapse>\r\n            </Navbar>\r\n        )\r\n    }\r\n}\r\n\r\nexport default connect()(withRouter(NavBar));","//@flow\r\nimport * as API from 'src/api'\r\nimport type { RequestLogin, ResponseLogin } from 'src/api'\r\nimport type { State } from 'src/reducers'\r\n\r\nexport type LOGIN_START = {\r\n  type: 'LOGIN_START',\r\n}\r\n\r\nexport type LOGIN_COMPLETE = {\r\n  type: 'LOGIN_COMPLETE',\r\n  data: ResponseLogin\r\n}\r\n\r\nexport type CHECK_LOGIN_START = {\r\n  type: 'CHECK_LOGIN_START'\r\n}\r\n\r\nexport type LOGOUT_START = {\r\n  type: 'LOGOUT_START'\r\n}\r\n\r\nexport type LOGOUT_COMPLETE = {\r\n  type: 'LOGOUT_COMPLETE'\r\n}\r\n\r\nexport type LOGIN_FAILED = {\r\n  type: 'LOGIN_FAILED',\r\n  error: string\r\n}\r\n\r\n\r\nexport type LoginAction = LOGIN_START | LOGIN_COMPLETE | LOGIN_FAILED | CHECK_LOGIN_START | LOGOUT_START | LOGOUT_COMPLETE;\r\n\r\nexport const loginStart = (): LOGIN_START => {\r\n\r\n  return {\r\n    type: 'LOGIN_START'\r\n  }\r\n}\r\n\r\nexport const loginComplete = (json: ResponseLogin): LOGIN_COMPLETE => {\r\n\r\n  return {\r\n    type: 'LOGIN_COMPLETE',\r\n    data: json\r\n  }\r\n}\r\n\r\nexport const loginFailed = (error: string): LOGIN_FAILED => {\r\n\r\n  return {\r\n    type: 'LOGIN_FAILED',\r\n    error\r\n  }\r\n}\r\n\r\nexport const checkLoginStart = (): CHECK_LOGIN_START => {\r\n\r\n  return {\r\n    type: 'CHECK_LOGIN_START'\r\n  }\r\n}\r\n\r\nexport const logoutStart = (): LOGOUT_START => {\r\n\r\n  return {\r\n    type: 'LOGOUT_START'\r\n  }\r\n}\r\n\r\nexport const logoutComplete = (): LOGOUT_COMPLETE => {\r\n\r\n  return {\r\n    type: 'LOGOUT_COMPLETE'\r\n  }\r\n}\r\n\r\nconst shouldLogin = (state: State): boolean => {\r\n  const { login } = state;\r\n  if (!login) {\r\n    return true\r\n  }\r\n  if (login.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const checkLogin = (params: any): any => async (dispatch: any) => {\r\n\r\n  dispatch(checkLoginStart());\r\n\r\n  let json;\r\n  try {\r\n    json = await API.getCookies();\r\n  } catch (e) {\r\n    dispatch(loginFailed(e.message));\r\n    return;\r\n  }\r\n  const { cookie, session } = json;\r\n\r\n  if (session && session.user_id){\r\n\r\n    let error = (session.last_error || '').trim();\r\n    if (error === 'Не указано сообщение.') error = '';\r\n    dispatch(loginComplete({\r\n      error,\r\n      userid: session.user_id,\r\n      username: session.user_name,\r\n      hashkey: cookie.entr_hash\r\n    }));\r\n  } else\r\n    dispatch(loginFailed(''));\r\n}\r\n\r\nexport const checkLoginIfNeeded = (params: any): any => (dispatch: any, getState: any) => {\r\n  if (shouldLogin(getState())) {\r\n    return dispatch(checkLogin(params))\r\n  }\r\n}\r\n\r\nexport const doLogout = (params: any): any => async (dispatch: any) => {\r\n\r\n  dispatch(logoutStart());\r\n\r\n  try {\r\n    \r\n    API.getLogout();\r\n\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n  \r\n  dispatch(logoutComplete());\r\n  dispatch(checkLogin());\r\n\r\n}\r\n\r\nexport const doLogin = (params: RequestLogin): any => async (dispatch: any) => {\r\n\r\n  dispatch(loginStart());\r\n\r\n  try {\r\n\r\n    await API.getLogin({\r\n      username: encodeURIComponent(params.username),\r\n      password: encodeURIComponent(params.password)\r\n    })\r\n\r\n    dispatch(checkLogin());\r\n\r\n  } catch (err) {\r\n    console.error('Login error :', err);\r\n    dispatch(loginFailed(err.message));\r\n  }\r\n\r\n}\r\n\r\nexport const doLoginIfNeeded = (params: RequestLogin): any => (dispatch: any, getState: any) => {\r\n  if (shouldLogin(getState())) {\r\n    return dispatch(doLogin(params))\r\n  }\r\n}","//@flow\r\nimport React, { Component } from 'react'\r\nimport { withRouter } from 'react-router-dom'\r\nimport { connect } from 'react-redux'\r\nimport { Dropdown } from 'react-bootstrap'\r\n\r\nimport { doLogout } from 'src/actions/login'\r\nimport { domain } from 'src/api'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype LoggedUserProps = {\r\n    userId: string,\r\n    userName: string    \r\n}\r\n\r\ntype Props = LoggedUserProps & DefaultProps;\r\n\r\nconst CustomToggle = React.forwardRef(({ children, onClick }, ref) => (\r\n  <span\r\n    ref={ref} \r\n    style={{ cursor: \"pointer\" }} \r\n    className='link'\r\n    onClick={(e) => {\r\n      e.preventDefault();\r\n      onClick(e);\r\n    }}\r\n  >\r\n    {children}\r\n  </span>\r\n));\r\n\r\nclass LoggedUser extends Component<Props> {\r\n\r\n    onLogout;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.onLogout = this.onLogout.bind(this);\r\n    }\r\n    \r\n    onLogout(event: any) {\r\n\r\n        event.preventDefault();\r\n\r\n        const { dispatch } = this.props;\r\n        dispatch(doLogout());  \r\n    }\r\n\r\n    onMenuSelect = (eventKey: any, event: Object): any => {\r\n\r\n        if (eventKey === 'exit') {\r\n           this.onLogout(event);\r\n        }\r\n\r\n    }\r\n\r\n    render() {\r\n\r\n        const { userId, userName } = this.props;\r\n        return (\r\n            <div style={{float: \"left\"}}>\r\n                <Dropdown id=\"dropdown-custom-menu\" onSelect={this.onMenuSelect}>\r\n                    <span>Привет, </span>\r\n                    <Dropdown.Toggle as={CustomToggle} bsRole=\"toggle\">{userName} ▼</Dropdown.Toggle>\r\n                    <Dropdown.Menu>\r\n                        <Dropdown.Item eventKey=\"profile\" href={`${domain}/users.php?id=${userId}`}>Профиль</Dropdown.Item>\r\n                        <Dropdown.Item eventKey=\"myTopics\" href={`${window.hash}/index.php?user_id=${userId}`}>Мои темы</Dropdown.Item>\r\n                        <Dropdown.Divider />\r\n                        <Dropdown.Item eventKey=\"options\" href={`${window.hash}/options.php`}>Настройки</Dropdown.Item>\r\n                        <Dropdown.Divider />\r\n                        <Dropdown.Item eventKey=\"exit\">Выход</Dropdown.Item>\r\n                    </Dropdown.Menu>\r\n                </Dropdown>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ( connect()(withRouter(LoggedUser)): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { FormControl, Button } from 'react-bootstrap'\r\n\r\nimport { doLoginIfNeeded } from 'src/actions/login'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { LoginState } from 'src/reducers/login'\r\nimport type { State } from 'src/reducers'\r\n\r\ntype Props = LoginState & DefaultProps;\r\n\r\nclass LoginForm extends Component<Props> {\r\n\r\n    username: any;\r\n    password: any;\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.username = React.createRef();  \r\n        this.password = React.createRef();  \r\n    }\r\n        \r\n    onLogin = (event) => {\r\n\r\n        event.preventDefault();\r\n\r\n        const { dispatch } = this.props;\r\n\r\n        const params = {\r\n            username: this.username.current.value,\r\n            password: this.password.current.value\r\n        }\r\n        dispatch(doLoginIfNeeded(params));  \r\n    }\r\n\r\n    render() {\r\n\r\n        return (\r\n            <div>\r\n                <form name=\"enterform\" className=\"flex-row\" style={{flexWrap: \"wrap\"}}>\r\n                    <FormControl \r\n                        type=\"text\" \r\n                        placeholder=\"Имя\" \r\n                        ref={this.username} \r\n                        size=\"sm\" \r\n                        style={{marginRight: \"5px\", flex: \"0 1 300px\"}}\r\n                    />\r\n                    <FormControl \r\n                        type=\"password\" \r\n                        placeholder=\"Пароль\" \r\n                        maxLength=\"20\" \r\n                        autoComplete=\"off\" \r\n                        ref={this.password}\r\n                        size=\"sm\" \r\n                        style={{marginRight: \"5px\", flex: \"0 1 300px\"}}\r\n                    />\r\n                    <Button \r\n                        size=\"sm\"\r\n                        variant=\"light\" \r\n                        onClick={this.onLogin}\r\n                    >Войти</Button>\r\n                </form>\r\n                <p style={{margin: \"0px\"}}>Войти можно на сайте <a href=\"https://forum.mista.ru/\">forum.mista.ru</a></p>\r\n                <a rel=\"nofollow\" href=\"https://forum.mista.ru/user_registration.php\">Регистрация</a>\r\n                <span style={{ margin: \"5px\" }}>|</span>\r\n                <a rel=\"nofollow\" href=\"https://forum.mista.ru/remember_password.php\">Забыли пароль?</a>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state: State): LoginState => {\r\n    return state.login;\r\n}\r\n\r\nexport default ( connect(mapStateToProps)(LoginForm): any );","//@flow\r\nimport React from 'react'\r\n\r\nimport './error.css'\r\n\r\ntype Props = {\r\n  text: ?string\r\n}\r\n\r\nconst ErrorElem = (props: Props): any => {\r\n  if (!props.text)\r\n    return null;\r\n\r\n  return (\r\n    <div className=\"error\" dangerouslySetInnerHTML={{ __html: props.text }}></div>\r\n  )\r\n}\r\n\r\nexport default ErrorElem;","//@flow\r\nimport React, { Fragment, Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport LoggedUser from './logged_user'\r\nimport LoginForm from './login_form'\r\nimport ErrorElem from '../common/error'\r\n\r\nimport { checkLoginIfNeeded } from 'src/actions/login'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { LoginState } from 'src/reducers/login'\r\n\r\ntype Props = LoginState & DefaultProps;\r\n\r\nclass Login extends Component<Props> {\r\n\r\n    componentDidMount() {\r\n        const { dispatch } = this.props;\r\n        dispatch(checkLoginIfNeeded());        \r\n    }\r\n\r\n    render() {\r\n\r\n        const { logged, userid, username, error, dispatch } = this.props;\r\n\r\n        let elem;\r\n        if (logged === true) \r\n            elem = <LoggedUser dispatch={dispatch} userId={userid} userName={username} />\r\n        else if (logged === false)\r\n            elem = <LoginForm /> \r\n        else \r\n            elem = null;   \r\n\r\n        return (\r\n            <Fragment>\r\n                {elem}\r\n                {error && <ErrorElem text={error} />}\r\n            </Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state: State): LoginState => {\r\n    \r\n    return state.login;\r\n}\r\n\r\nexport default ( connect(mapStateToProps)(Login): any );","//@flow\r\nimport * as API from 'src/api'\r\nimport type { ResponseSections } from 'src/api'\r\nimport type { State } from 'src/reducers'\r\n\r\nexport type REQUEST_SECTIONS = {\r\n  type: 'REQUEST_SECTIONS',\r\n}\r\n\r\nexport type RECEIVE_SECTIONS = {\r\n  type: 'RECEIVE_SECTIONS',\r\n  items: ResponseSections,\r\n  receivedAt: Date\r\n}\r\n\r\nexport type SectionsAction = REQUEST_SECTIONS | RECEIVE_SECTIONS;\r\n\r\nexport const requestSections = (): REQUEST_SECTIONS => ({\r\n  type: 'REQUEST_SECTIONS'\r\n})\r\n\r\nexport const receiveSections = (json: ResponseSections): RECEIVE_SECTIONS => ({\r\n  type: 'RECEIVE_SECTIONS',\r\n  items: json,\r\n  receivedAt: new Date()\r\n})\r\n\r\nexport const fetchSections = (): any => async (dispatch: any) => {\r\n\r\n  let action1 = requestSections();\r\n  dispatch(action1);\r\n\r\n  const json: ResponseSections = await API.getSections();\r\n\r\n  let action2 = receiveSections(json);\r\n  dispatch(action2);\r\n\r\n}\r\n\r\nconst shouldfetchSections = (state: State): boolean => {\r\n\r\n  const sections = state.sections;\r\n\r\n  if (!sections)\r\n    return true\r\n\r\n  if (sections.isFetching)\r\n    return false\r\n\r\n  if (sections.items.length > 0)\r\n    return false;\r\n\r\n  return true\r\n}\r\n\r\nexport const fetchSectionsIfNeeded = (): any => (dispatch: any, getState: any) => {\r\n  if (shouldfetchSections(getState())) {\r\n    return dispatch(fetchSections());\r\n  }\r\n}","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport Form from 'react-bootstrap/Form'\r\n\r\nimport { fetchSectionsIfNeeded } from 'src/actions/sections'\r\n\r\nimport type { ResponseSection, ResponseSections } from 'src/api'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { State } from 'src/reducers'\r\n\r\ntype SectionSelectProps = {\r\n  defaultValue: string,\r\n  selected: string,\r\n  className: string,\r\n  id: string,\r\n  style?: {},\r\n  size: ?string,\r\n  onChange: (e: any, section: ResponseSection | null) => void\r\n}\r\n\r\ntype StateProps = {\r\n  items: ResponseSections,\r\n  tree: {}\r\n}\r\n\r\ntype Props = SectionSelectProps & StateProps & DefaultProps;\r\n\r\nclass SectionSelect extends Component<Props> {\r\n\r\n  componentDidMount() {\r\n    const { dispatch } = this.props;\r\n    dispatch(fetchSectionsIfNeeded());\r\n  }\r\n\r\n  onSelect: (e: SyntheticEvent<HTMLSelectElement>) => void = (e: SyntheticEvent<HTMLSelectElement>) => {\r\n\r\n    const { items, onChange } = this.props;\r\n\r\n    if (onChange) {\r\n      const shortn = e.currentTarget.value;\r\n      const arr = items.filter(val => val.shortn === shortn);\r\n      if (arr.length > 0)\r\n        onChange(e, arr[0]);\r\n      else\r\n        onChange(e, null);\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    const { id, tree, defaultValue, selected, style, size } = this.props;\r\n\r\n    let sectionsElem = [];\r\n    for (let forum in tree) {\r\n\r\n      let group =\r\n        <optgroup key={forum} label={forum}>\r\n          {tree[forum].map((item, i) => (\r\n            <option key={item.id} value={item.shortn}>\r\n              {item.fulln}\r\n            </option>\r\n          ))}\r\n        </optgroup>\r\n\r\n      sectionsElem.push(group);\r\n    }\r\n\r\n    return (\r\n      <Form.Control as=\"select\"\r\n        onChange={this.onSelect}\r\n        value={selected}\r\n        style={style}\r\n        className='input'\r\n        size={size}\r\n        id={id}\r\n      >\r\n        <option value=\"\">{defaultValue}</option>\r\n        {sectionsElem}\r\n      </Form.Control>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  const { items, tree } = state.sections;\r\n\r\n  return {\r\n    items,\r\n    tree\r\n  }\r\n}\r\n\r\nexport { SectionSelect };\r\nexport default (connect(mapStateToProps)(SectionSelect): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { withRouter } from 'react-router-dom'\r\nimport { connect } from 'react-redux'\r\nimport queryString from 'query-string'\r\n\r\nimport Login from '../login'\r\nimport SectionSelect from './section_select'\r\nimport { fetchSectionsIfNeeded } from 'src/actions/sections'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype StateProps = {\r\n}\r\n\r\ntype Props = StateProps & DefaultProps;\r\n\r\nclass Header extends Component<Props> {\r\n\r\n    componentDidMount() {\r\n        const { dispatch } = this.props;\r\n        dispatch(fetchSectionsIfNeeded());\r\n    }\r\n    \r\n    onSectionSelect = (e, value) => {\r\n        if (value)\r\n            this.props.history.push(`/index.php?section=${value.shortn}`);\r\n        else\r\n            this.props.history.push(`/`);\r\n    }\r\n\r\n    render() {\r\n\r\n        const { location } = this.props;\r\n        const params = queryString.parse(location.search);\r\n\r\n        return (\r\n            <div className=\"flex-row\">\r\n                <div className=\"user-td\">\r\n                    <Login />\r\n                </div>\r\n                <div className=\"section-td\" style={{marginLeft: \"auto\"}}>\r\n                    <SectionSelect \r\n                        defaultValue=\"--Все секции--\" \r\n                        selected={params.section} \r\n                        onChange={this.onSectionSelect}\r\n                        size=\"sm\" \r\n                    />\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ( connect()(withRouter(Header)): any );","import React from 'react'\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport { getMaxPage } from 'src/utils'\r\n\r\n\r\nconst Pages = (props) => {\r\n\r\n    const { answ, topicId } = props;\r\n\r\n    let pages = [];\r\n    if (answ > 100) {\r\n        let maxPage = getMaxPage(answ);\r\n        for (let i = 1; i <= maxPage; i++) {\r\n            let href = `/topic.php?id=${topicId}&page=${i}`;\r\n            let text;\r\n            if (i > 3 && i < maxPage)\r\n                text = '•';\r\n            else\r\n                text = i;\r\n            pages.push(<Link key={i}  className=\"agh\" style={{ margin: \"3px\" }} to={href}>{text}</Link>);\r\n        }\r\n    }\r\n\r\n    if (answ > 20) {\r\n        let href = `/topic.php?id=${topicId}&page=last20#F`;\r\n        pages.push(<Link key=\"last20\" className=\"agh\" style={{ margin: \"3px\" }} to={href}>»</Link>);\r\n    }\r\n\r\n    return (\r\n        <span className=\"topic-pages\">\r\n            {pages}\r\n        </span>\r\n    )\r\n}\r\n\r\nexport default Pages;","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport classNames from 'classnames'\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport type { ResponseTopicsListItem } from 'src/api'\r\nimport type { State } from 'src/reducers'\r\n\r\nimport type { LoginState } from 'src/reducers/login'\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { TopicPreviewState } from 'src/reducers/topic_preview'\r\n\r\nimport Pages from './pages';\r\n\r\ntype TopicNameCellProps = {\r\n    data: ResponseTopicsListItem,\r\n    preview: ?number\r\n};\r\n\r\ntype StateProps = {\r\n    login: LoginState,\r\n    topicPreview: TopicPreviewState\r\n};\r\n\r\ntype Props = TopicNameCellProps & StateProps & DefaultProps;\r\n\r\nclass TopicNameCell extends Component<Props> {\r\n\r\n    componentDidMount(){\r\n\r\n    }\r\n\r\n    render() {\r\n\r\n        const { data, login } = this.props;\r\n\r\n        let href = `/topic.php?id=${data.id}`;\r\n        let classes = classNames('agb', 'mr5', {\r\n            'bold': data.answ >= 100,\r\n            'mytopics': data.user0 === login.username\r\n        });\r\n\r\n        let isVoting;\r\n        if (data.is_voting === 1) {\r\n            isVoting = <span className=\"agh separator\">[±]</span>\r\n        }\r\n        \r\n        let sectionHref = `/index.php?section=${data.sect2}`;\r\n        let section;\r\n\r\n        if (data.sect1) {\r\n            section = (\r\n            <span className=\"topic-section\">\r\n                <span className=\"agh\" style={{margin: \"0px 5px\"}}>/</span>\r\n                <Link key=\"1\" rel=\"nofollow\" className=\"agh\" to={sectionHref} >{data.sect1}</Link>\r\n            </span>    \r\n            )\r\n        }\r\n\r\n        let closed;\r\n        let down;\r\n        let text = data.text;\r\n        if (data.closed)\r\n            closed = <span className=\"agh\">Ø</span>\r\n\r\n        if (data.down === 1)\r\n            down = <span className=\"agh\">↓</span>\r\n\r\n        if (data.sect2 === 'job' && text.substr(0, 3) !== 'JOB')\r\n            text = 'JOB: ' + text;\r\n\r\n        else if (data.forum === 'life' && text.substr(0, 3) !== 'OFF')\r\n            text = 'OFF: ' + text;\r\n\r\n        else if (data.sect2 === 'v7' && text.substr(0, 2) !== 'v7')\r\n            text = 'v7: ' + text;\r\n\r\n        return (\r\n            <div className=\"cell-title\">\r\n                <Link to={href} className={classes} dangerouslySetInnerHTML={{ __html: text }} style={{overflowWrap: \"anywhere\"}}></Link>\r\n                {isVoting}\r\n                <Pages answ={data.answ} topicId={data.id} />\r\n                {closed}\r\n                {down}\r\n                {section}\r\n            </div>\r\n        )\r\n\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n    return {\r\n        login: state.login,\r\n        topicPreview: state.topicPreview\r\n    }\r\n}\r\n\r\nexport default ( connect(mapStateToProps)(TopicNameCell): any );","//@flow\r\nimport type { State } from '../reducers'\r\n\r\nexport type TooltipKeys = {\r\n  type: 'TOPIC' | 'TOPIC_PREVIEW',\r\n  topicId: string,\r\n  number: number\r\n}\r\n\r\nexport type Coords = {\r\n  x: number,\r\n  y: number\r\n}\r\n\r\nexport type TooltipItem = {\r\n  keys: TooltipKeys,\r\n  coords: Coords\r\n}\r\n\r\nexport type CREATE_TOOLTIP = {\r\n  type: 'CREATE_TOOLTIP',\r\n} & TooltipItem\r\n\r\nexport type CLEAR_TOOLTIPS = {\r\n  type: 'CLEAR_TOOLTIPS',\r\n}\r\n\r\nexport type CLOSE_TOOLTIP = {\r\n  type: 'CLOSE_TOOLTIP',\r\n  keys: TooltipKeys\r\n}\r\n\r\nexport type TooltipsAction = CREATE_TOOLTIP | CLOSE_TOOLTIP | CLEAR_TOOLTIPS;\r\n\r\nexport const showTooltip = (keys: TooltipKeys, coords: Coords): any => async (dispatch: any) => {\r\n\r\n  if (keys.type === 'TOPIC' || keys.type === 'TOPIC_PREVIEW') {\r\n\r\n    const action: CREATE_TOOLTIP = {\r\n      type: 'CREATE_TOOLTIP',\r\n      keys,\r\n      coords\r\n    }\r\n    dispatch(action);\r\n\r\n  }\r\n}\r\n\r\nexport const closeTooltip = (keys: TooltipKeys): any => (dispatch: any) => {\r\n  dispatch({\r\n    type: 'CLOSE_TOOLTIP',\r\n    keys\r\n  });\r\n}\r\n\r\nexport const clearTooltipsIfNeeded = (): any => (dispatch: any, getState: any) => {\r\n  const state: State = getState();\r\n  if (state.tooltips.items.length > 0) {\r\n\r\n    const action: CLEAR_TOOLTIPS = {\r\n      type: 'CLEAR_TOOLTIPS'\r\n    };\r\n\r\n    dispatch(action);\r\n  }\r\n}","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { showTooltip } from '../../actions/tooltips'\r\n\r\nimport { getMaxPage, childrenToText } from 'src/utils';\r\nimport { getTopicInfo } from 'src/api'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { ResponseInfo, ResponseMessages } from 'src/api'\r\n\r\ntype LinkToPostProps = {\r\n  topicId: string,\r\n  number: number,\r\n  isPreview: boolean,\r\n  style: {}\r\n}\r\n\r\ntype StateProps = {\r\n  info: ResponseInfo,\r\n  items: ResponseMessages,\r\n  tooltipDelay: string\r\n}\r\n\r\ntype Props = LinkToPostProps & StateProps & DefaultProps;\r\n\r\nclass LinkToPost extends Component<Props, { text: string }> {\r\n\r\n  timer;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const { children, number } = this.props;\r\n    if (children)\r\n      this.state = { text: childrenToText(children).join('') };\r\n    else\r\n      this.state = { text: String(number) };\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(props) {\r\n    if (!props.children) {\r\n      this.setState({ text: String(props.number) });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n\r\n    if (this.state.text.startsWith(\"http\")) {\r\n\r\n      const { topicId } = this.props;\r\n      getTopicInfo({ id: topicId })\r\n        .then(response => {\r\n          this.setState({\r\n            text: response.text\r\n          })\r\n        });\r\n\r\n    }\r\n  }\r\n\r\n  onMouseOver = (event) => {\r\n    event.persist();\r\n    const { tooltipDelay } = this.props;\r\n    this.timer = setTimeout(() => this.showToolTip(event), +tooltipDelay);\r\n  }\r\n\r\n  onClick = (event) => {\r\n    event.stopPropagation();\r\n    clearTimeout(this.timer);\r\n    this.showToolTip(event);\r\n  }\r\n\r\n  onMouseOut = (event) => {\r\n    clearTimeout(this.timer);\r\n  }\r\n\r\n  showToolTip = (e) => {\r\n    const { topicId, number, dispatch, isPreview } = this.props;\r\n\r\n    const coords = {\r\n      x: e.pageX,\r\n      y: e.pageY - 50 // remove navbar margin-top\r\n    }\r\n\r\n    const keys = {\r\n      type: isPreview ? 'TOPIC_PREVIEW' : 'TOPIC',\r\n      topicId,\r\n      number\r\n    }\r\n\r\n    dispatch(showTooltip(\r\n      keys,\r\n      coords\r\n    ));\r\n  }\r\n\r\n  render() {\r\n\r\n    const { topicId, number, style, info } = this.props;\r\n    const page = getMaxPage(number);\r\n\r\n    let pageParam = '';\r\n    if (page > 1)\r\n      pageParam = `&page=${page}`;\r\n\r\n    let a;\r\n    if (topicId === info.id || !isNaN(this.state.text))\r\n      a = (\r\n        <span\r\n          onMouseOver={this.onMouseOver}\r\n          onMouseOut={this.onMouseOut}\r\n          onClick={this.onClick}\r\n          className='link'\r\n          style={{ ...style }}\r\n        >{this.state.text}</span>\r\n      )\r\n    else\r\n      a = (\r\n        <span>\r\n          <a href={`${window.hash}/topic.php?id=${topicId}${pageParam}#${number}`}\r\n            style={{ ...style }}\r\n          >{this.state.text}</a>{' '}\r\n                    (<span onMouseOver={this.onMouseOver}\r\n            onMouseOut={this.onMouseOut}\r\n            onClick={this.onClick}\r\n            className='link'\r\n          >{number}</span>)\r\n        </span>\r\n      )\r\n\r\n    return a;\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  const {\r\n    items, info\r\n  } = state.topic;\r\n\r\n  return {\r\n    items,\r\n    info,\r\n    tooltipDelay: state.options.items['tooltipDelay']\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(LinkToPost): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype PreviewLinkProps = {\r\n    topicId: string,\r\n    expanded: boolean\r\n};\r\n\r\ntype Props = PreviewLinkProps & DefaultProps;\r\n\r\nclass PreviewLink extends Component<Props> {\r\n\r\n    onClick = () => {\r\n        const { topicId, dispatch } = this.props;\r\n\r\n        dispatch({\r\n            type: 'TOGGLE_PREVIEW',\r\n            topicId \r\n        });\r\n    }\r\n\r\n    render() {\r\n\r\n        const { expanded } = this.props;\r\n        let text;\r\n        if (expanded)\r\n            text = '-'\r\n        else\r\n            text = '+'    \r\n\r\n        return (\r\n            <div className=\"cell-preview-link\" onClick={this.onClick}>\r\n                <span>{text}</span>\r\n            </div>\r\n        )        \r\n    }\r\n\r\n}\r\n\r\nexport default ( connect()(PreviewLink): any );","//@flow\r\nimport React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Link } from 'react-router-dom'\r\nimport dateFormat from 'dateformat'\r\n\r\nimport TopicNameCell from './topic_name_cell';\r\nimport LinkToPost from 'src/components/extensions/link_to_post'\r\nimport PreviewLink from './preview_link'\r\n\r\nimport { today } from 'src/utils'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { TopicsListItem } from 'src/reducers/topics_list'\r\nimport type { LoginState } from 'src/reducers/login'\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype RowProps = {\r\n  columns: any,\r\n  data: TopicsListItem\r\n}\r\n\r\ntype StateProps = {\r\n  login: LoginState,\r\n  showTooltipOnTopicsList: string\r\n}\r\n\r\ntype Props = RowProps & StateProps & DefaultProps;\r\n\r\nconst Row = (props: Props) => {\r\n\r\n  const { data, showTooltipOnTopicsList } = props;\r\n  let time = new Date(+data.utime * 1000);\r\n  if (today(time)) {\r\n    time = dateFormat(time, 'HH:MM')\r\n  } else {\r\n    time = dateFormat(time, 'dd.mm.yy');\r\n  }\r\n  return (\r\n    <div className=\"topics-list-row\">\r\n      {/*{cells}*/}\r\n      <div className=\"cell-forum\">\r\n        {data.forum}\r\n      </div>\r\n      <div className=\"cell-section\">\r\n        {data.sect1}\r\n      </div>\r\n      <div className=\"cell-answ\">\r\n        <i className=\"fa fa-comments-o\" aria-hidden=\"true\" style={{marginRight: \"3px\"}}></i>\r\n        {showTooltipOnTopicsList === 'true' ?\r\n          <LinkToPost topicId={data.id} number={data.answ} style={{ color: \"inherit\" }} isPreview />\r\n          :\r\n          data.answ\r\n        }\r\n      </div>\r\n      <PreviewLink topicId={data.id} expanded={data.showPreview} />\r\n      <TopicNameCell data={data} />\r\n      <div className=\"cell-author\">\r\n        <i aria-hidden=\"true\" className=\"fa fa-user-circle\" style={{marginRight: \"3px\"}}></i>\r\n        {data.user0}\r\n      </div>\r\n      <div className=\"cell-lastuser\">\r\n        <div style={{ display: \"flex\" }}>\r\n          <span className=\"cell-lastuser-time\">{time}</span>\r\n          <span className=\"cell-lastuser-user\">{data.user}</span>\r\n        </div>\r\n      </div>\r\n      <div className=\"cell-last20\">\r\n        <Link to={`/topic.php?id=${String(data.id)}&page=last20`} style={{ color: \"inherit\", display: \"block\", width: \"100%\", textAlign: \"center\" }}>{'>'}</Link>\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  return {\r\n    login: state.login,\r\n    showTooltipOnTopicsList: state.options.items.showTooltipOnTopicsList\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(Row): any );","//@flow\r\nimport React from 'react'\r\nimport { Pagination } from 'react-bootstrap'\r\n\r\nimport { paramsToString } from 'src/api'\r\nimport './pages.css'\r\n\r\ntype Props = {\r\n  locationParams: { page?: string },\r\n  baseUrl: string,\r\n  maxPage: number,\r\n  last20?: boolean\r\n}\r\n\r\nconst Pages = (props: Props): any => {\r\n\r\n  const { locationParams, baseUrl, maxPage, last20 } = props;\r\n  let currentPage;\r\n  if (!locationParams.page)\r\n    currentPage = 1;\r\n  else if (locationParams.page === \"last20\")\r\n    currentPage = \"last20\";\r\n  else\r\n    currentPage = parseInt(locationParams.page, 10) || 1;\r\n\r\n  let pages = [];\r\n  for (let i = 1; i <= maxPage; i++) {\r\n    let params = { ...locationParams, page: i };\r\n    let href = `${window.hash}/${baseUrl}` + paramsToString('?', params);\r\n\r\n    pages.push(<Pagination.Item active={currentPage === i} key={i} href={href}>{i}</Pagination.Item>);\r\n  }\r\n\r\n  if (last20 === true) {\r\n    let params = { ...locationParams, page: \"last20\" };\r\n    let href = `${window.hash}/${baseUrl}` + paramsToString('?', params);\r\n    pages.push(<Pagination.Item active={currentPage === \"last20\"} key=\"last20\" href={href}>»</Pagination.Item>);\r\n  }\r\n\r\n  return (\r\n    <Pagination style={{ margin: \"0px\" }}>\r\n      {pages}\r\n    </Pagination>\r\n  )\r\n\r\n}\r\n\r\nexport default Pages;","//@flow\r\nimport * as API from '../api'\r\nimport type { RequestNewTopic } from 'src/api'\r\nimport type { State } from 'src/reducers'\r\nimport type { ResponseSection } from 'src/api'\r\n\r\nexport type postNewTopicParams = {\r\n  subject: string,\r\n  text: string,\r\n  section: number,\r\n  forum: string,\r\n  isVoting: boolean,\r\n  votingItems?: Array<string>,\r\n  onSuccess?: () => void\r\n};\r\n\r\nexport type POST_NEW_TOPIC_START = {\r\n  type: 'POST_NEW_TOPIC_START'\r\n}\r\n\r\nexport type POST_NEW_TOPIC_COMPLETE = {\r\n  type: 'POST_NEW_TOPIC_COMPLETE'\r\n}\r\n\r\nexport type POST_NEW_TOPIC_ERROR = {\r\n  type: 'POST_NEW_TOPIC_ERROR',\r\n  error: string\r\n}\r\n\r\nexport type NEW_TOPIC_TEXT = {\r\n  type: 'NEW_TOPIC_TEXT',\r\n  text: string\r\n}\r\n\r\nexport type NEW_TOPIC_SUBJECT = {\r\n  type: 'NEW_TOPIC_SUBJECT',\r\n  text: string\r\n}\r\n\r\nexport type NEW_TOPIC_CLEAR = {\r\n  type: 'NEW_TOPIC_CLEAR'\r\n}\r\n\r\nexport type NEW_TOPIC_SHOW_VOTING = {\r\n  type: 'SHOW_VOTING',\r\n  data: boolean\r\n}\r\n\r\nexport type NEW_TOPIC_SECTION = {\r\n  type: 'NEW_TOPIC_SECTION',\r\n  section: ResponseSection\r\n}\r\n\r\nexport type NewTopicAction = POST_NEW_TOPIC_START | POST_NEW_TOPIC_COMPLETE | POST_NEW_TOPIC_ERROR |\r\n  NEW_TOPIC_CLEAR | NEW_TOPIC_TEXT | NEW_TOPIC_SUBJECT | NEW_TOPIC_SHOW_VOTING | NEW_TOPIC_SECTION;\r\n\r\nexport const shouldPostNewTopic = (state: State): boolean => {\r\n  const newTopic = state.newTopic;\r\n  if (!newTopic) {\r\n    return false\r\n  }\r\n  if (newTopic.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const postNewTopicIfNeeded = (params: postNewTopicParams): any => (dispatch: any, getState: any) => {\r\n  if (shouldPostNewTopic(getState())) {\r\n    return dispatch(postNewTopic(params));\r\n  }\r\n}\r\n\r\nconst postNewTopic = (params: postNewTopicParams) => async (dispatch: any) => {\r\n\r\n  dispatch({\r\n    type: 'POST_NEW_TOPIC_START'\r\n  });\r\n\r\n  let fetchParams: RequestNewTopic = {\r\n    message_text: encodeURIComponent(params.text),\r\n    topic_text: encodeURIComponent(params.subject),\r\n    target_section: String(params.section),\r\n    target_forum: params.forum.toLowerCase(),\r\n    action: 'new',\r\n    rnd: Math.round(Math.random() * 10000000000),\r\n    voting: params.isVoting ? 1 : 0\r\n  };\r\n\r\n  if (params.votingItems)\r\n    for (let i = 0; i < params.votingItems.length; i++) {\r\n      fetchParams[`section${i + 1}`] = params.votingItems[i];\r\n    }\r\n\r\n  await API.postNewTopic(fetchParams);\r\n\r\n  dispatch({\r\n    type: 'POST_NEW_TOPIC_COMPLETE'\r\n  });\r\n\r\n  if (params.onSuccess)\r\n    params.onSuccess();\r\n}","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { FormControl, Button, ButtonGroup, Form } from 'react-bootstrap'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\n\r\nimport './text_editor.css'\r\n\r\ntype TextEditorProps = {\r\n  placeholder: string,\r\n  showVoting: boolean,\r\n  isVoting: boolean,\r\n  text: string,\r\n  isFetching: boolean,\r\n  formName: string,\r\n  onChange?: (e: any, text: string) => void,\r\n}\r\n\r\ntype Props = TextEditorProps & DefaultProps;\r\n\r\nclass TextEditor extends Component<Props> {\r\n\r\n  textArea;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.textArea = React.createRef();\r\n  }\r\n\r\n  onButtonCode1c = (e) => {\r\n\r\n    e.preventDefault();\r\n\r\n    var openTag = '[1C]\\n';\r\n    var closeTag = '\\n[/1C]';\r\n\r\n    var textArea: any = this.textArea.current;\r\n\r\n    var start = textArea.selectionStart;\r\n    var end = textArea.selectionEnd;\r\n\r\n    var oldText = textArea.value;\r\n    var len = oldText.length;\r\n    var selectedText = oldText.substring(start, end);\r\n    var replacement = openTag + selectedText + closeTag;\r\n    var newText = oldText.substring(0, start) + replacement + oldText.substring(end, len);\r\n\r\n    const { dispatch, formName } = this.props;\r\n    dispatch({\r\n      type: formName + '_TEXT',\r\n      text: newText\r\n    })\r\n\r\n  }\r\n\r\n  onVotingChange = (e: SyntheticEvent<HTMLInputElement>) => {\r\n    const { dispatch } = this.props;\r\n    dispatch({\r\n      type: 'SHOW_VOTING',\r\n      data: e.currentTarget.checked\r\n    })\r\n  }\r\n\r\n  onChange = (e: SyntheticEvent<HTMLTextAreaElement>) => {\r\n    const { dispatch, formName } = this.props;\r\n    dispatch({\r\n      type: formName + '_TEXT',\r\n      text: e.currentTarget.value\r\n    })\r\n  }\r\n\r\n  onKeyPress = (e: SyntheticKeyboardEvent<HTMLTextAreaElement>) => {\r\n\r\n    if (e.key === 'Enter' && e.ctrlKey) {\r\n      let parent = e.currentTarget.parentElement;\r\n      while (parent && parent.tagName.toUpperCase() !== \"FORM\") {\r\n        parent = parent.parentElement;\r\n      }\r\n      if (parent)\r\n        parent.dispatchEvent(new Event(\"submit\", { cancelable: true, bubbles: true }));\r\n    }\r\n\r\n  }\r\n\r\n  render() {\r\n\r\n    const { placeholder, showVoting, isVoting, isFetching, text } = this.props;\r\n\r\n    return (\r\n      <div>\r\n        <FormControl\r\n          as=\"textarea\"\r\n          placeholder={placeholder}\r\n          cols=\"70\" rows=\"3\"\r\n          value={text}\r\n          onChange={this.onChange}\r\n          onKeyPress={this.onKeyPress}\r\n          ref={this.textArea}\r\n          className=\"text-editor input\"\r\n        />\r\n        <div className=\"flex-row\">\r\n          <ButtonGroup>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"light\"\r\n              onClick={this.onButtonCode1c}\r\n              style={{ marginRight: \"5px\" }}\r\n              className='button'\r\n            >Код 1С</Button>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"light\"\r\n              disabled={isFetching}\r\n              type=\"submit\"\r\n              className='button'\r\n            >\r\n              {isFetching ? 'Отправляется' : 'Отправить'}\r\n            </Button>\r\n          </ButtonGroup>\r\n          {showVoting &&\r\n            <Form.Check\r\n              type=\"checkbox\"\r\n              checked={isVoting}\r\n              onChange={this.onVotingChange}\r\n              label=\"Голосование\"\r\n              style={{ margin: \"auto 0px auto auto\" }} />\r\n          }\r\n        </div>\r\n      </div>\r\n    )\r\n\r\n  }\r\n}\r\n\r\nexport default (connect()(TextEditor): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport Form from 'react-bootstrap/Form'\r\nimport InputGroup from 'react-bootstrap/InputGroup'\r\nimport { FormGroup } from 'react-bootstrap'\r\n\r\nimport type { ResponseSection } from 'src/api'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { State } from 'src/reducers'\r\nimport type { SectionsState } from 'src/reducers/sections'\r\nimport type { NewTopicState } from 'src/reducers/new_topic'\r\n\r\nimport { postNewTopicIfNeeded } from 'src/actions/new_topic'\r\nimport type { NewTopicAction, postNewTopicParams } from 'src/actions/new_topic'\r\n\r\nimport SectionSelect from './section_select'\r\nimport TextEditor from '../common/text_editor'\r\nimport ErrorElem from '../common/error'\r\n\r\nimport './new_topic.css'\r\n\r\ntype StateProps = {\r\n  sections: SectionsState,\r\n  newTopic: NewTopicState,\r\n}\r\n\r\ntype NewTopicProps = {\r\n  onSubmitSuccess?: () => void\r\n};\r\n\r\ntype Props = NewTopicProps & StateProps & DefaultProps;\r\n\r\nclass NewTopic extends Component<Props> {\r\n\r\n  currentSection: ?ResponseSection;\r\n\r\n  onSectionChange = (e: any, section: ResponseSection) => {\r\n    const { dispatch } = this.props;\r\n    this.currentSection = section;\r\n\r\n    const action: NewTopicAction = {\r\n      type: 'NEW_TOPIC_SECTION',\r\n      section\r\n    };\r\n\r\n    dispatch(action);\r\n  }\r\n\r\n  onSubmit = (e) => {\r\n\r\n    e.preventDefault();\r\n    const { dispatch, newTopic } = this.props;\r\n\r\n    let action: NewTopicAction;\r\n    if (!this.currentSection) {\r\n      action = {\r\n        type: 'POST_NEW_TOPIC_ERROR',\r\n        error: 'Не выбрана секция'\r\n      };\r\n      dispatch(action);\r\n      return;\r\n    }\r\n\r\n    let subject = newTopic.subject;\r\n    if (!subject) {\r\n      action = {\r\n        type: 'POST_NEW_TOPIC_ERROR',\r\n        error: 'Не указана тема'\r\n      };\r\n      dispatch(action);\r\n      return;\r\n    }\r\n\r\n    if (!newTopic.text) {\r\n      action = {\r\n        type: 'POST_NEW_TOPIC_ERROR',\r\n        error: 'Не указано сообщение'\r\n      };\r\n      dispatch(action);\r\n      return;\r\n\r\n    }\r\n\r\n    let params: postNewTopicParams = {\r\n      subject,\r\n      text: newTopic.text,\r\n      section: this.currentSection.id,\r\n      forum: this.currentSection.forum,\r\n      isVoting: newTopic.isVoting,\r\n      votingItems: [],\r\n      onSuccess: this.onSubmitSuccess\r\n    };\r\n\r\n    if (newTopic.isVoting) {\r\n      params.votingItems = [];\r\n      for (let i = 1; i <= 10; i++) {\r\n        let val = this.refs[`vote${i}`].value;\r\n        if (val) {\r\n          params.votingItems.push(val);\r\n        }\r\n      }\r\n    }\r\n\r\n    dispatch(postNewTopicIfNeeded(params));\r\n  }\r\n\r\n  onSubjectChange = (e) => {\r\n\r\n    const { dispatch } = this.props;\r\n    dispatch({\r\n      type: 'NEW_TOPIC_SUBJECT',\r\n      text: e.target.value\r\n    });\r\n\r\n  }\r\n\r\n\r\n  onSubmitSuccess = () => {\r\n\r\n    const { dispatch } = this.props;\r\n    dispatch({\r\n      type: 'NEW_TOPIC_CLEAR',\r\n      text: ''\r\n    });\r\n\r\n    if (this.props.onSubmitSuccess) {\r\n      this.props.onSubmitSuccess();\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    const { sections, newTopic } = this.props;\r\n\r\n    let groupsElem = [];\r\n    for (let forum in sections.tree) {\r\n      groupsElem.push(<option key={forum} value={forum.toLowerCase()}>{forum}</option>);\r\n    }\r\n\r\n    let votingOptions = [];\r\n\r\n    if (newTopic.isVoting) {\r\n      votingOptions.push(<div key=\"p\">Варианты:</div>);\r\n      for (let i = 1; i <= 10; i++) {\r\n        votingOptions.push(\r\n          <InputGroup key={i} size=\"sm\" style={{ marginBottom: \"3px\", width: \"100%\" }}>\r\n            <InputGroup.Prepend>\r\n              <InputGroup.Text\r\n                style={{ width: \"40px\" }} className='input'>\r\n                {`${i}.`}\r\n              </InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            <Form.Control\r\n              type=\"text\"\r\n              maxLength=\"50\"\r\n              ref={`vote${i}`}\r\n              className='input'\r\n            />\r\n          </InputGroup>\r\n        );\r\n      }\r\n    }\r\n\r\n    return (\r\n      <form className=\"new-topic-container\" onSubmit={this.onSubmit}>\r\n        <div id=\"newtopic_form\" className=\"new-topic-text\">\r\n          <div><b>Новая тема:</b></div>\r\n          {newTopic.error && <ErrorElem text={newTopic.error} />}\r\n          <div className=\"flex-row\" style={{ marginBottom: \"3px\" }}>\r\n            <Form.Control as=\"select\"\r\n              size=\"sm\"\r\n              readOnly={true}\r\n              value={newTopic.forum}\r\n              style={{ flex: \"0 1 90px\" }}\r\n              className='input'\r\n            >\r\n              {groupsElem}\r\n            </Form.Control>\r\n            <SectionSelect\r\n              defaultValue=\"Секция\"\r\n              id=\"target_section\"\r\n              size=\"sm\"\r\n              style={{ flex: \"1 1 auto\" }}\r\n              onChange={this.onSectionChange}\r\n            />\r\n          </div>\r\n          <Form.Control\r\n            type=\"text\"\r\n            size=\"sm\"\r\n            value={newTopic.subject}\r\n            onChange={this.onSubjectChange}\r\n            style={{ marginBottom: \"3px\" }}\r\n            className='input'\r\n            placeholder=\"Тема\"\r\n            maxLength=\"90\"\r\n          />\r\n          <TextEditor\r\n            placeholder=\"Сообщение\"\r\n            showVoting={true}\r\n            isVoting={newTopic.isVoting}\r\n            text={newTopic.text}\r\n            isFetching={newTopic.isFetching}\r\n            formName=\"NEW_TOPIC\"\r\n          />\r\n        </div>\r\n        <FormGroup className=\"new-topic-voting\">\r\n          {votingOptions}\r\n        </FormGroup>\r\n      </form>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  return {\r\n    sections: state.sections,\r\n    newTopic: state.newTopic\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(NewTopic): any );","\r\nfunction highlight(text) {\r\n\r\n  const keywords = new Set(\r\n    \"|if|если|then|тогда|elsif|иначеесли|else|иначе|endif|конецесли|do|цикл|for|для|to|по|each|каждого|in|из|while|пока|enddo|конеццикла|procedure|процедура|endprocedure|конецпроцедуры|function|функция|endfunction|конецфункции|var|перем|export|экспорт|goto|перейти|and|и|or|или|not|не|val|знач|break|прервать|continue|продолжить|return|возврат|try|попытка|except|исключение|endtry|конецпопытки|raise|вызватьисключение|false|ложь|true|истина|undefined|неопределено|null|new|новый|execute|выполнить|\"\r\n      .split('|')\r\n  );\r\n\r\n  const Спецсиволы = new Set(\"():;.,=+-*<>?[]%/\".split(''));\r\n  const НачалоТега = \"<span class=\";\r\n  const КонецТега = \"</span>\";\r\n\r\n  const мЦветФона = \"bg>\";\r\n  const мЦветЧисла = \"num>\";\r\n  const мЦветСтроки = \"str>\";\r\n  //const мЦветПараметра = \"par>\";\r\n  const мЦветКомментария = \"com>\";\r\n  const мЦветСпецСимвола = \"sp>\";\r\n  const мЦветПрепроцессора = \"pr>\";\r\n  const мЦветКлючевогоСлова1 = \"key>\";\r\n\r\n\r\n  let СтрокаРезультат;\r\n  let УстановленЦвет;\r\n  let ПоследнийЦвет;\r\n\r\n  let ВСтроке = false;\r\n  let Токен = \"\";\r\n\r\n  function ПустаяСтрока(Строка) {\r\n    return Строка.trim() === '';\r\n  }\r\n\r\n  function Сред(Строка, Нач, Длина) {\r\n    return Строка.substr(Нач - 1, Длина);\r\n  }\r\n\r\n  function Прав(Строка, Длина) {\r\n    return Строка.substr(-Длина);\r\n  }\r\n\r\n  function isKeyword(token) {\r\n    return keywords.has(token.toLowerCase().trim());\r\n  }\r\n\r\n  function ДобавитьЧастьСтроки1С(Часть, Цвет) {\r\n\r\n    if (Часть === \" \" || ПоследнийЦвет === Цвет) {\r\n      СтрокаРезультат = СтрокаРезультат + Часть;\r\n    } else {\r\n      if (УстановленЦвет) {\r\n        СтрокаРезультат = СтрокаРезультат + КонецТега;\r\n        УстановленЦвет = false;\r\n      };\r\n\r\n      СтрокаРезультат = СтрокаРезультат + НачалоТега + Цвет + Часть;\r\n      УстановленЦвет = true;\r\n      ПоследнийЦвет = Цвет;\r\n    };\r\n  }\r\n\r\n  function РазукраситьСтроку(СтрокаКода) {\r\n\r\n    //  https://infostart.ru/profile/34707/public/\r\n    let ВСтрокеСкобка = false;\r\n    let ВСтрокеТильда = false;\r\n    let НачалоСтроки = 1;\r\n    let ТокенДоТочки = true;\r\n    // Заменяем 8 символьную табуляцию на 4 символьную пробелами\r\n\r\n    // Последовательно перебираются все символы строки кода\r\n    let Поз = 1;\r\n    for (Поз = 1; Поз <= СтрокаКода.length; Поз++) {\r\n\r\n      let ТекущийСимвол = СтрокаКода.charAt(Поз - 1);\r\n      if (ВСтроке) {\r\n\r\n        // Операции встрече символа \"кавычка\"\r\n        if (ТекущийСимвол === '\"') {\r\n          // Нашли парную кавычку - окрашиваем как строку\r\n          ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\r\n          ВСтроке = false;\r\n          Токен = \"\";\r\n          ТокенДоТочки = true;\r\n        } else {\r\n          Токен = Токен + ТекущийСимвол;\r\n        };\r\n\r\n      } else if (ВСтрокеСкобка) {\r\n\r\n        // Операции встрече символа \"кавычка\" литерал\r\n        if (ТекущийСимвол === \"'\") {\r\n          // Нашли парную скобку - окрашиваем как комментарий\r\n          ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\r\n          ВСтрокеСкобка = false;\r\n          Токен = \"\";\r\n          ТокенДоТочки = true;\r\n        } else {\r\n          Токен = Токен + ТекущийСимвол;\r\n        };\r\n\r\n      } else if (ТекущийСимвол === \" \") {\r\n        // Операции при встрече символа табуляции или пробела\r\n        if (!ПустаяСтрока(Токен)) {\r\n          // Пробел после токена, значит\r\n          // токен - ключевое слово...\r\n          if (ВСтрокеТильда) {\r\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветСтроки);\r\n            ВСтрокеТильда = false;\r\n\r\n          } else if (isKeyword(Токен.trim())) {\r\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветКлючевогоСлова1);\r\n\r\n          } else if (!isNaN(parseInt(Токен, 10))) {\r\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветЧисла);\r\n\r\n          } else {\r\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветФона);\r\n          };\r\n          Токен = \"\";\r\n        } else {\r\n          СтрокаРезультат = СтрокаРезультат + \" \";\r\n        };\r\n        ТокенДоТочки = true;\r\n\r\n      } else if (Спецсиволы.has(ТекущийСимвол)) {\r\n\r\n        // Встретился один из специальных символов\r\n        if (!ПустаяСтрока(Токен)) {\r\n          // Чтобы избежать окраски метода объекта с совпадающим именем\r\n          // с одним из ключевых слов, проверяем текущий символ на \".\"\r\n          if (ВСтрокеТильда) {\r\n\r\n            ДобавитьЧастьСтроки1С(Токен, мЦветСтроки);\r\n            ВСтрокеТильда = false;\r\n            ТокенДоТочки = (ТекущийСимвол !== \".\");\r\n\r\n          } else if (ТокенДоТочки && isKeyword(Токен)) {\r\n            ДобавитьЧастьСтроки1С(Токен, мЦветКлючевогоСлова1);\r\n            ТокенДоТочки = (ТекущийСимвол !== \".\");\r\n\r\n          } else {\r\n            // Не ключевое слово - значит число\r\n            if (!isNaN(parseInt(Токен, 10))) {\r\n              ДобавитьЧастьСтроки1С(Токен, мЦветЧисла);\r\n\r\n            } else {\r\n              ДобавитьЧастьСтроки1С(Токен, мЦветФона);\r\n            };\r\n            ТокенДоТочки = (ТекущийСимвол !== \".\");\r\n          };\r\n          Токен = \"\";\r\n        };\r\n        // Один из специальных символов\r\n        if (ТекущийСимвол === \".\" && ПоследнийЦвет === мЦветЧисла) {\r\n          // Продолжение числа\r\n          ДобавитьЧастьСтроки1С(ТекущийСимвол, мЦветЧисла);\r\n          continue;\r\n\r\n        } else if (ТекущийСимвол === \"=\" && Сред(СтрокаКода, Поз - 1, 1) === \"<\") {\r\n          // Знак \"меньше или равно\" - вторая ошибка движка Инфостарт\r\n          ПоследнийЦвет = undefined;\r\n\r\n        } else if (ТекущийСимвол === \"/\" && Сред(СтрокаКода, Поз + 1, 1) === \"/\") {\r\n          // Проверяется на комментарий\r\n          ДобавитьЧастьСтроки1С(Прав(СтрокаКода, СтрокаКода.length - Поз + 1), мЦветКомментария);\r\n          return;\r\n        };\r\n        ДобавитьЧастьСтроки1С(ТекущийСимвол, мЦветСпецСимвола);\r\n\r\n      } else if (ТекущийСимвол === '\"' || ТекущийСимвол === \"|\") {\r\n\r\n        // Операции встрече символа \"кавычка\"\r\n        // Первая кавычка, запоминаем позицию и взводим флаг нахождения в строке\r\n        if (ПустаяСтрока(Токен)) {\r\n          НачалоСтроки = Поз;\r\n          ВСтроке = true;\r\n        } else {\r\n          // Ошибка синтаксиса\r\n          ДобавитьЧастьСтроки1С(Токен + ТекущийСимвол, мЦветСтроки);\r\n          Токен = \"\";\r\n        };\r\n        ТокенДоТочки = true;\r\n\r\n      } else if (ТекущийСимвол === \"'\") {\r\n\r\n        // Операции встрече символа \"кавычка\" литерал\r\n        // Первая кавычка, запоминаем позицию и взводим флаг нахождения в строке\r\n        if (ПустаяСтрока(Токен)) {\r\n          НачалоСтроки = Поз;\r\n          ВСтрокеСкобка = true;\r\n        } else {\r\n          // Ошибка синтаксиса\r\n          ДобавитьЧастьСтроки1С(Токен + ТекущийСимвол, мЦветСтроки);\r\n          Токен = \"\";\r\n        };\r\n        ТокенДоТочки = true;\r\n\r\n      } else if (ТекущийСимвол === \"#\" || (ТекущийСимвол === \"&\" && ПустаяСтрока(СтрокаРезультат))) {\r\n\r\n        // Встретился символ препроцессора\r\n        ДобавитьЧастьСтроки1С(Прав(СтрокаКода, СтрокаКода.length - Поз + 1), мЦветПрепроцессора);\r\n        Поз = СтрокаКода.length;\r\n        break;\r\n\r\n      } else if (ТекущийСимвол === \"~\") {\r\n        Токен = Токен + ТекущийСимвол;\r\n        ВСтрокеТильда = true;\r\n      } else {\r\n        // Остальные символы\r\n        Токен = Токен + ТекущийСимвол;\r\n      }\r\n    }\r\n\r\n    if (ВСтроке) {\r\n\r\n      // Многострочная строка\r\n      ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\r\n\r\n    } else if (ВСтрокеСкобка) {\r\n\r\n      // Незавершенный литерал\r\n      ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\r\n\r\n    } else if (!ПустаяСтрока(Токен)) {\r\n\r\n      // Анализируем последний токен строки кода\r\n      if (isKeyword(Токен)) {\r\n        ДобавитьЧастьСтроки1С(Токен, мЦветКлючевогоСлова1);\r\n\r\n      } else if (!isNaN(parseInt(Токен, 10))) {\r\n        ДобавитьЧастьСтроки1С(Токен, мЦветЧисла);\r\n\r\n      } else {\r\n        ДобавитьЧастьСтроки1С(Токен, мЦветФона);\r\n      };\r\n\r\n    };\r\n\r\n  }\r\n\r\n  ВСтроке = false;\r\n  Токен = \"\";\r\n  УстановленЦвет = false;\r\n  ПоследнийЦвет = undefined;\r\n  СтрокаРезультат = '';\r\n\r\n  let result = [];\r\n\r\n  for (let СтрокаКода of text.split('\\n')) {\r\n\r\n    if (ПустаяСтрока(СтрокаКода)) {\r\n      result.push('');\r\n      continue;\r\n    }\r\n\r\n    СтрокаРезультат = '';\r\n    РазукраситьСтроку(СтрокаКода);\r\n    if (УстановленЦвет && !ВСтроке) {\r\n      СтрокаРезультат += '</span>';\r\n      УстановленЦвет = false;\r\n      ПоследнийЦвет = '';\r\n      Токен = '';\r\n    } else if (!ВСтроке) {\r\n      ПоследнийЦвет = '';\r\n      Токен = '';\r\n    }\r\n\r\n    result.push(СтрокаРезультат);\r\n  }\r\n\r\n  return result.join('\\n');\r\n}\r\n\r\nexport default highlight;","import React, { Component } from 'react'\r\nimport { childrenToText } from 'src/utils'\r\nimport highlight from './code_highlight'\r\nimport './code1c.css'\r\n\r\nclass Code extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.onShowClick = this.onShowClick.bind(this);\r\n    this.state = { hidden: true };\r\n\r\n    const { children } = props;\r\n    if (children) {\r\n\r\n      const textArr = childrenToText(children);\r\n      this.text = textArr.join('');\r\n\r\n      // replace double new-lines\r\n      this.text = this.text\r\n        .replace(/\\n<br>/g, '\\n')\r\n        .replace(/<br>\\n/g, '\\n')\r\n        .replace(/\\r<br>/g, '\\n')\r\n        .replace(/<br>\\r/g, '\\n')\r\n        .replace(/<br>/g, '\\n');\r\n\r\n      // remove all leading|ending new-lines\r\n      while (this.text[0] === '\\n') {\r\n        this.text = this.text.substr(1);\r\n      }\r\n\r\n      while (this.text.substr(-1) === '\\n') {\r\n        this.text = this.text.substr(0, this.text.length - 1);\r\n      }\r\n\r\n      this.text = highlight(this.text);\r\n    }\r\n  }\r\n\r\n  onShowClick() {\r\n    this.setState({\r\n      hidden: !this.state.hidden\r\n    })\r\n  }\r\n\r\n  render() {\r\n\r\n    let buttonText;\r\n    let linesCount = 0;\r\n    if (this.text)\r\n      linesCount = this.text.split(\"\\n\").length;\r\n\r\n    if (this.state.hidden)\r\n      buttonText = `Показать: ${linesCount} строк`;\r\n    else\r\n      buttonText = 'Скрыть';\r\n\r\n    let buttonShow;\r\n    if (linesCount > 7)\r\n      buttonShow = (\r\n        <div className=\"expand-button-div\">\r\n          <span className=\"expand-button-span\" onClick={this.onShowClick}>{buttonText}</span>\r\n        </div>\r\n      );\r\n\r\n    let preStyle = {\r\n    }\r\n\r\n    if (this.state.hidden && linesCount > 7) {\r\n      preStyle.overflow = \"hidden\";\r\n      preStyle.height = \"135px\";\r\n    } else {\r\n      preStyle.overflow = \"auto\";\r\n      preStyle.height = \"auto\";\r\n    }\r\n\r\n    return (\r\n      <div style={{ marginTop: \"5px\" }}>\r\n        <pre className=\"code-pre\" style={preStyle} dangerouslySetInnerHTML={{ __html: this.text }}>\r\n        </pre>\r\n        {buttonShow}\r\n      </div>\r\n    )\r\n  }\r\n\r\n}\r\n\r\nexport default Code;","//@flow\r\nimport React, { Component } from 'react'\r\n\r\ntype LinkToUserProps = {\r\n  href: string,\r\n  children: any\r\n}\r\n\r\nclass LinkToUser extends Component<LinkToUserProps> {\r\n\r\n  render() {\r\n    const { href, children } = this.props;\r\n    return <a href={href} className=\"registered-user\">{children}</a>\r\n  }\r\n}\r\n\r\nexport default (LinkToUser: any);","//@flow\r\nimport React, { Component } from 'react'\r\nimport queryString from 'query-string'\r\n\r\ntype YoutubeLinkProps = {\r\n  href: string,\r\n}\r\n\r\nclass YoutubeLink extends Component<YoutubeLinkProps> {\r\n\r\n  state: any;\r\n\r\n  constructor(props: YoutubeLinkProps) {\r\n    super(props);\r\n    this.state = { hrefName: props.href, title: '' };\r\n  }\r\n\r\n  getVideoId(href: string): ?string {\r\n\r\n    if (href.search(/youtube/) !== -1) {\r\n      let arr = href.split('?');\r\n      return queryString.parse(arr[1]).v;\r\n    }\r\n\r\n    if (href.search(/youtu\\.be/) !== -1) {\r\n      let arr = href.match(/e\\/(.+?)(&|\\?|$)/);\r\n\r\n      if (arr && arr.length > 1)\r\n        return arr[1];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async getVideoParams(videoId: string): any {\r\n\r\n    const apiKey = localStorage.getItem('youtubeApiKey') || 'AIzaSyCztN2QW4Fxw_1YuAHBTOZdYLbzigPz25g';\r\n    let apiUrl = `https://www.googleapis.com/youtube/v3/videos?key=${apiKey}&fields=items(snippet(title))&part=snippet&id=${videoId}`;\r\n    const response = await fetch(apiUrl);\r\n    const json = await response.json();\r\n\r\n    let title = json.items[0].snippet.title;\r\n    let hrefName = title;\r\n    let maxLength = 50;\r\n    if (title.length > maxLength + 5)\r\n      hrefName = hrefName.substring(0, maxLength) + '...'\r\n\r\n    return {\r\n      hrefName,\r\n      title\r\n    }\r\n  }\r\n\r\n  async componentDidMount() {\r\n\r\n    const { href } = this.props;\r\n    const videoId = this.getVideoId(href);\r\n    if (!videoId)\r\n      return;\r\n\r\n    try {\r\n      const params = await this.getVideoParams(videoId);\r\n      this.setState({\r\n        ...params\r\n      });\r\n\r\n    } catch (e) {\r\n      console.error('youtube', e.message);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let prefix = 'youtube';\r\n    return <a href={this.props.href} title={this.state.title}>{`${prefix}: ${this.state.hrefName}`}</a>\r\n  }\r\n}\r\n\r\nexport default (YoutubeLink: any);","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport URL from 'url-parse'\r\n\r\nimport LinkToPost from './link_to_post'\r\nimport LinkToUser from './link_to_user'\r\nimport YoutubeLink from './youtube_link'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\n\r\nimport { childrenToText } from 'src/utils'\r\n\r\ntype CustomLinkProps = {\r\n  href: string,\r\n  parentText: string,\r\n  target: string,\r\n  class: string,\r\n  rel: string,\r\n  showTooltipOnPostLink: string,\r\n  showYoutubeVideoTitle: string,\r\n  replaceCatalogMista: string,\r\n  fixBrokenLinks: string,\r\n}\r\n\r\ntype Props = CustomLinkProps & DefaultProps;\r\n\r\nclass CustomLink extends Component<Props> {\r\n\r\n  fixBrokenLink(href: string, parentText: string): string {\r\n    let escapedHref = href\r\n      .replace(/\\[/g, '\\\\[')\r\n      .replace(/\\]/g, '\\\\]')\r\n      .replace(/\\./g, '\\\\.')\r\n      .replace(/\\./g, '.')\r\n      .replace(/\\*/g, '\\\\*')\r\n      .replace(/\\+/g, '\\\\+')\r\n      .replace(/\\(/g, '\\\\(')\r\n      .replace(/\\)/g, '\\\\)')\r\n      .replace(/\\?/g, '\\\\?')\r\n      .replace(/\\//g, '\\\\/');\r\n\r\n    try {\r\n      let regExp = new RegExp(escapedHref + '<\\\\/a>(\\\\)|[а-яёА-ЯЁ0-9#\\\\-\\\\+\\\\_\\\\%\\\\?=]*)');\r\n      let arr = parentText.match(regExp);\r\n      if (arr && arr.length > 1) {\r\n        if (arr[1] === ')' && href.search('\\\\(') === -1) {\r\n          return href;\r\n        }\r\n        href = href + arr[1];\r\n        return href;\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    return href;\r\n  }\r\n\r\n  render() {\r\n\r\n    const { href, children, parentText,\r\n      showTooltipOnPostLink, showYoutubeVideoTitle, replaceCatalogMista, fixBrokenLinks } = this.props;\r\n\r\n    try {\r\n      var url = new URL(href, true);\r\n    } catch (error) {\r\n      console.error(error.message, href);\r\n      return <a href={href}>{href}</a>;\r\n    }\r\n\r\n\r\n    let newHref = href;\r\n    if (newHref.startsWith('/')) {\r\n      url.set('protocol', 'https')\r\n      url.set('hostname', 'forum.mista.ru')\r\n      newHref = url.href;\r\n    }\r\n\r\n    if (showTooltipOnPostLink === 'true') {\r\n      if (url.hostname.search(/forum\\.mista.ru/) !== -1) {\r\n\r\n        if (url.pathname === '/topic.php') {\r\n          return (\r\n            <LinkToPost topicId={url.query.id} number={url.hash.replace('#', '') || \"0\"}>\r\n              {childrenToText(children)}\r\n            </LinkToPost>\r\n          )\r\n        } else if (url.pathname === '/users.php') {\r\n          return (\r\n            <LinkToUser href={url.href} >\r\n              {children}\r\n            </LinkToUser>\r\n          )\r\n        }\r\n      }\r\n\r\n      if (url.hostname === 'a-sitnikov.github.io' &&\r\n        url.pathname === '/react.mista/') {\r\n\r\n        if (Object.keys(url.query).length === 0) {\r\n\r\n          url = new URL(href.replace(/#\\//, ''), true);\r\n          if (url.pathname === '/react.mista/topic.php')\r\n            return (\r\n              <LinkToPost topicId={url.query.id} number={url.hash.replace('#', '') || \"0\"}>\r\n                {childrenToText(children)}\r\n              </LinkToPost>\r\n            )\r\n        }\r\n      }\r\n    }\r\n\r\n    if (showYoutubeVideoTitle === 'true')\r\n      if (url.hostname.search(/youtube/) !== -1\r\n        || url.hostname.search(/youtu\\.be/) !== -1) {\r\n        return <YoutubeLink href={href} />\r\n      }\r\n\r\n    if (replaceCatalogMista === 'true')\r\n      if (url.hostname.search(/catalog\\.mista/) !== -1) {\r\n        url.set('hostname', 'infostart.ru')\r\n\r\n        return (\r\n          <a target={this.props.target}\r\n            className={this.props.class}\r\n            rel={this.props.rel}\r\n            href={url.href} >{url.href} </a>\r\n        )\r\n      }\r\n\r\n    if (fixBrokenLinks === 'true' && parentText) {\r\n      newHref = this.fixBrokenLink(newHref, parentText);\r\n    }\r\n\r\n    return (\r\n      <a target={this.props.target}\r\n        className={this.props.class}\r\n        rel={this.props.rel}\r\n        href={newHref} >{children}</a>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n\r\n  const {\r\n    showTooltipOnPostLink,\r\n    showYoutubeVideoTitle,\r\n    replaceCatalogMista,\r\n    fixBrokenLinks\r\n  } = state.options.items;\r\n\r\n  return {\r\n    showTooltipOnPostLink,\r\n    showYoutubeVideoTitle,\r\n    replaceCatalogMista,\r\n    fixBrokenLinks\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(CustomLink): any );","//@flow\r\nimport React from 'react'\r\nimport { domain } from 'src/api'\r\n\r\nimport type { ResponseVoteItem } from 'src/api'\r\n\r\ntype Props = {\r\n  topicId: string,\r\n  data: ResponseVoteItem,\r\n  colors: Array<string>,\r\n  total: number,\r\n  n: number\r\n}\r\n\r\nconst VoteItem = (props: Props) => {\r\n\r\n  const { topicId, data, total, n, colors } = props;\r\n\r\n  const img = `${domain}/css/voting${n}.png`;\r\n\r\n  let percent = 0;\r\n\r\n  if (total) {\r\n    percent = Math.round(100 * data.result / total);\r\n  }\r\n\r\n  const imgStyle = { maxWwidth: \"500px\", width: \"100%\", height: \"15px\" };\r\n\r\n  return (\r\n    <div className=\"voting-item\">\r\n      <div className=\"voting-title\">\r\n        <a rel=\"nofollow\" style={{ textDecoration: \"none\" }} href={`${window.hash}/topic.php?id=${topicId}&sel=${n}`}>\r\n          <b><span style={{ color: colors[n - 1] }}>{`${n}. ${data.select}`}</span></b>\r\n        </a>\r\n      </div>\r\n      <div className=\"voting-percentage\">\r\n        {/*<div className=\"div-va-middle\">*/}\r\n        <b><span style={{ color: colors[n - 1] }}>{`${percent}% (${data.result})`}</span></b>\r\n        {/*</div>*/}\r\n      </div>\r\n      <div className=\"voting-bar\">\r\n        <div style={{ width: `${percent}%` }}>\r\n          <a href={img}>\r\n            <img src={img} style={imgStyle} alt={`п${n}`} />\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default (VoteItem: any);","//@flow\r\nimport React from 'react'\r\nimport VoteItem from './vote_item'\r\nimport type { ResponseVoteItem } from 'src/api'\r\n\r\ntype Props = {\r\n  items: Array<ResponseVoteItem>,\r\n  topicId: string,\r\n  colors: Array<string>\r\n}\r\n\r\nconst VoteChart = (props: Props) => {\r\n\r\n  const { items, topicId, colors } = props;\r\n\r\n  let total = items.reduce((sum, e) => sum + e.result, 0);\r\n\r\n  return (\r\n    <div style={{ marginBottom: \"10px\" }}>\r\n      {items.filter(val => val.select).map((data, i) => <VoteItem key={i} data={data} total={total} n={i + 1} topicId={topicId} colors={colors} />)}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default (VoteChart: any);","import React, { Component } from 'react'\r\n\r\nclass Vote extends Component {\r\n\r\n  render() {\r\n    const { colors, info, vote } = this.props;\r\n\r\n    const voteOption = info[vote - 1];\r\n    return (\r\n      <div style={{ marginTop: \"5px\" }}>\r\n        <b><span style={{ color: colors[vote - 1] }}>{`${vote}. ${voteOption.select}`}</span></b>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Vote;","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport activeHtml from 'react-active-html';\r\n\r\nimport Code from 'src/components/extensions/code1c'\r\nimport LinkToPost from 'src/components/extensions/link_to_post'\r\nimport CustomLink from 'src/components/extensions/custom_link'\r\n\r\nimport VoteChart from './vote_chart'\r\nimport Vote from './vote'\r\n\r\nimport type { ResponseInfo, ResponseMessage } from 'src/api'\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { State } from 'src/reducers'\r\n\r\ntype MsgTextProps = {\r\n  topicId: string,\r\n  n: string,\r\n  html: string,\r\n  vote: number,\r\n  data: ResponseMessage,\r\n  style: {}\r\n}\r\n\r\ntype StateProps = {\r\n  info: ResponseInfo,\r\n  showTooltips: string,\r\n  voteColors?: Array<string>\r\n}\r\n\r\ntype Props = MsgTextProps & StateProps & DefaultProps;\r\n\r\nclass MsgText extends Component<Props> {\r\n\r\n  processLinksToPosts(text: string): string {\r\n\r\n    const { topicId } = this.props;\r\n\r\n    const regexp = /(\\()(\\d+)(\\))/gi; // (12)\r\n    return text.replace(regexp, (res, ...segments) => {\r\n      const number = segments[1];\r\n      return `(<link data-topicid='${topicId}' data-number='${number}' ></link>)`\r\n    });\r\n  }\r\n\r\n  processCode1C(text: string): string {\r\n\r\n    const regexp = /(\\[1[CС]\\])((.|\\n|\\r)*?)(\\[\\/1[CС]\\])/gi; // [1C] text [/1C]\r\n    return text.replace(regexp, (res, ...segments) => {\r\n      let txt = segments[1];\r\n\r\n      //remove first <br>\r\n      if (txt.substr(0, 4) === \"<br>\")\r\n        txt = txt.substr(4);\r\n      return `<code>${txt}</code>`\r\n    });\r\n  }\r\n\r\n  processText(text: ?string): ?string {\r\n\r\n    if (!text)\r\n      return text;\r\n\r\n    const { showTooltips } = this.props;\r\n\r\n    text = this.processCode1C(text);\r\n\r\n    if (showTooltips === 'true')\r\n      text = this.processLinksToPosts(text);\r\n\r\n    return text;\r\n  }\r\n\r\n  render() {\r\n    const { topicId, n, html, vote, info, style, voteColors } = this.props;\r\n\r\n    let voteElement;\r\n    if (vote && info.voting && topicId === info.id) {\r\n      let voteOption = info.voting[vote - 1];\r\n      if (voteOption)\r\n        voteElement = <Vote info={info.voting} vote={vote} colors={voteColors} />\r\n    }\r\n\r\n    let voteChart;\r\n    if (n === \"0\" && info.is_voting === 1 && info.voting) {\r\n      voteChart = <VoteChart items={info.voting} topicId={topicId} colors={voteColors} />\r\n    }\r\n\r\n    let processedHtml = this.processText(html);\r\n    const componentsMap = {\r\n      link: props => <LinkToPost topicId={props['data-topicid']} number={props['data-number']} key={props.key} />,\r\n      code: props => <Code {...props} />,\r\n      a: props => <CustomLink {...props} parentText={processedHtml} />\r\n    };\r\n    let textComponent = activeHtml(processedHtml, componentsMap);\r\n\r\n    return (\r\n      <div className=\"message\" style={{ ...style }}>\r\n        {voteChart}\r\n        <div>\r\n          {textComponent}\r\n        </div>\r\n        {voteElement}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  const { info } = state.topic;\r\n\r\n  return {\r\n    info,\r\n    voteColors: state.options.voteColors,\r\n    showTooltips: state.options.items['showTooltips']\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(MsgText): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport dateFormat from 'dateformat'\r\n\r\nimport './topic_preview.css'\r\n\r\ntype TopicPreviewProps = {\r\n    user: ?string,\r\n    utime: ?number,\r\n    topicId: string,\r\n    n: number,\r\n    onFirst: any,   \r\n    onLast: any,   \r\n    onPrev: any,   \r\n    onNext: any\r\n}\r\n\r\nclass PreviewHeader extends Component<TopicPreviewProps> {\r\n\r\n    render() {\r\n        const { user, utime, topicId, n } = this.props;\r\n\r\n        if (utime)\r\n            var date = new Date(utime*1000);\r\n\r\n        return (\r\n            <div>\r\n                <span className=\"plus-nav\" onClick={this.props.onFirst}>[← </span>\r\n                <span className=\"plus-nav\" onClick={this.props.onPrev}> « </span>\r\n                <Link className=\"plus-nav\" title={`Перейти к сообщению ${n}`} to={`/topic.php?id=${topicId}#${n}`}>{n}</Link>\r\n                <span className=\"plus-nav\" onClick={this.props.onNext}> » </span>\r\n                <span className=\"plus-nav\" onClick={this.props.onLast}> →]</span>\r\n                <b style={{margin: \"auto 5px\"}}>{user}</b>\r\n                <span className=\"agh\">{dateFormat(date, 'dd.mm.yy - HH:MM')}</span>\r\n            </div>\r\n        )    \r\n    }\r\n\r\n}\r\n\r\nexport default ( PreviewHeader: any );","//@flow\r\nimport React, { Component } from 'react'\r\n\r\nimport * as API from 'src/api'\r\n\r\nimport MsgText from 'src/components/topic/row/msg_text'\r\n\r\nimport PreviewHeader from './preview_header'\r\nimport './topic_preview.css'\r\n\r\ntype TopicPreviewProps = {\r\n    topicId: string,\r\n    n: number   \r\n}\r\n\r\ntype Props = TopicPreviewProps;\r\ntype State = {\r\n    n: number,\r\n    data: ?any,\r\n    error: ?string    \r\n}\r\n\r\nclass TopicPreview extends Component<Props, State> {\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {\r\n            n: props.n,\r\n            data: null,\r\n            error: null\r\n        }\r\n    }\r\n\r\n    async componentDidMount() {\r\n        await this.fetchData(this.state.n);\r\n    }\r\n\r\n    fetchData = async (n: number) => {\r\n        let data, error;\r\n        try {\r\n            data = await API.getMessage(this.props.topicId, n);\r\n            if (!data)\r\n                error = `Сообщение не найдено ${n}`;\r\n\r\n        } catch(e) {\r\n            error = e.message\r\n        };\r\n        this.setState({\r\n            n,\r\n            data,\r\n            error\r\n        })\r\n    }\r\n\r\n    onClickFirst = () => {\r\n        this.fetchData(0);\r\n    }\r\n    \r\n    onClickNext = () => {\r\n        this.fetchData(this.state.n + 1);\r\n    }\r\n\r\n    onClickPrev = () => {\r\n        if (this.state.n > 0)\r\n            this.fetchData(this.state.n - 1);\r\n    }\r\n\r\n    onClickLast = async () => {\r\n        const n = await API.getTopicMessagesCount(this.props.topicId);\r\n        this.fetchData(n);\r\n    }\r\n\r\n    render() {\r\n        const { topicId } = this.props;\r\n        const { data, error, n } = this.state;\r\n        if (!data && !error)\r\n            return null;\r\n\r\n        if (data)\r\n            var { user, utime } = data;\r\n\r\n        return (\r\n            <div className=\"topic-preview\">\r\n                <PreviewHeader \r\n                    user={user}\r\n                    utime={+utime}\r\n                    topicId={topicId}\r\n                    n={n}\r\n                    onFirst={this.onClickFirst}\r\n                    onLast={this.onClickLast}\r\n                    onNext={this.onClickNext}\r\n                    onPrev={this.onClickPrev}\r\n                />\r\n                {data && <MsgText \r\n                    data={data} \r\n                    html={data.text} \r\n                    topicId={topicId} \r\n                    style={{maxHeight: \"500px\", overflowY: \"auto\", overflowWrap: \"break-word\"}}\r\n                />}\r\n                {error && <p>{error}</p>}\r\n            </div>\r\n        )    \r\n    }\r\n\r\n}\r\n\r\nexport default ( TopicPreview: any );","import React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport queryString from 'query-string'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { DefaultProps, Location } from 'src/components'\r\n\r\nimport type { TopicsListState } from 'src/reducers/topics_list'\r\nimport type { SectionsState } from 'src/reducers/sections'\r\nimport type { LoginState } from 'src/reducers/login'\r\n\r\nimport { fetchTopicsListIfNeeded } from 'src/actions/topics_list'\r\n\r\nimport Header from './header'\r\nimport Row from './row'\r\nimport Pages from 'src/components/common/pages'\r\nimport NewTopic from './new_topic'\r\nimport Error from 'src/components/common/error'\r\n\r\nimport TopicPreview from 'src/components/preview/topic_preview'\r\n\r\nimport './topics_list.css'\r\n\r\ntype StateProps = {\r\n  topicsList: TopicsListState,\r\n  sections: SectionsState,\r\n  login: LoginState,\r\n  topicsPerPage: string,\r\n  autoRefreshTopicsList: string,\r\n  autoRefreshTopicsListInterval: string\r\n}\r\n\r\ntype Props = {\r\n  fetchTopicsListIfNeeded: any\r\n} & DefaultProps & StateProps;\r\n\r\nclass TopicsList extends Component<Props> {\r\n\r\n  location: Location;\r\n  locationParams: { page?: string };\r\n  page: string;\r\n  timer: any;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.locationParams = { page: '1' };\r\n  }\r\n\r\n  componentDidMount() {\r\n\r\n    let { location } = this.props;\r\n\r\n    this.location = location;\r\n    this.updateTopicsList();\r\n\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    clearTimeout(this.timer);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n\r\n    const { location, topicsPerPage } = this.props;\r\n\r\n    if (this.location.search !== location.search\r\n      || this.props.topicsPerPage !== topicsPerPage) {\r\n\r\n      this.location = location;\r\n      this.updateTopicsList();\r\n      window.scrollTo(0, 0);\r\n    }\r\n\r\n    document.title = 'React.Mista';\r\n  }\r\n\r\n  updateTopicsList = () => {\r\n\r\n    const { fetchTopicsListIfNeeded } = this.props;\r\n    let { autoRefreshTopicsList, autoRefreshTopicsListInterval } = this.props;\r\n\r\n    this.locationParams = queryString.parse(this.location.search);\r\n    fetchTopicsListIfNeeded(this.locationParams);\r\n\r\n    if (autoRefreshTopicsList === 'true') {\r\n\r\n      autoRefreshTopicsListInterval = +autoRefreshTopicsListInterval;\r\n      if (autoRefreshTopicsListInterval < 60) autoRefreshTopicsListInterval = 60;\r\n\r\n      clearTimeout(this.timer);\r\n      this.timer = setTimeout(this.updateTopicsList, autoRefreshTopicsListInterval * 1000);\r\n    }\r\n  }\r\n\r\n  onPostNewTopicSuccess = () => {\r\n    this.updateTopicsList();\r\n  }\r\n\r\n  render() {\r\n\r\n    const { topicsList, sections } = this.props;\r\n\r\n    let rows = [];\r\n    for (let item of topicsList.items) {\r\n\r\n      rows.push(<Row key={item.id} data={item} />);\r\n      if (item.showPreview)\r\n        rows.push(\r\n          <div key={`preview${String(item.id)}`} className=\"preview-container\">\r\n            <TopicPreview topicId={String(item.id)} n={0} />\r\n          </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <Header history={this.props.history} />\r\n        {topicsList.error && (<Error text={topicsList.error} />)}\r\n        <div className=\"table\">\r\n          <div className=\"th\" style={{ position: \"sticky\", top: \"39px\" }}>\r\n            <div style={{letterSpacing: \"-1px\"}}>Раздел</div>\r\n            <div>Re</div>\r\n            <div></div>\r\n            <div>Тема</div>\r\n            <div>Автор</div>\r\n            <div><span style={{ cursor: \"pointer\" }} title=\"Обновить список\" onClick={this.updateTopicsList}>{topicsList.isFetching ? \"Обновляется\" : \"Обновлено\"}</span></div>\r\n          </div>\r\n          {rows}\r\n          <div className=\"tf\">\r\n            <Pages baseUrl='index.php' locationParams={this.locationParams} maxPage={10} />\r\n          </div>\r\n        </div>\r\n        <div id=\"F\" className=\"newtopic\" style={{ marginBottom: \"10px\", marginTop: \"5px\", position: 'relative' }}>\r\n          <NewTopic sections={sections.items} onSubmitSuccess={this.onPostNewTopicSuccess} locationParams={this.locationParams} />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  return {\r\n    topicsList: state.topicsList,\r\n    sections: state.sections,\r\n    login: state.login,\r\n    topicsPerPage: state.options.items.topicsPerPage,\r\n    autoRefreshTopicsList: state.options.items.autoRefreshTopicsList,\r\n    autoRefreshTopicsListInterval: state.options.items.autoRefreshTopicsListInterval,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n  fetchTopicsListIfNeeded: (...params) => dispatch(fetchTopicsListIfNeeded(...params)),\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TopicsList);","//@flow\r\nimport * as API from 'src/api'\r\n\r\nimport type { ResponseInfo, ResponseMessage, ResponseMessages } from 'src/api'\r\n\r\nexport type REQUEST_TOPIC = {\r\n  type: 'REQUEST_TOPIC'\r\n}\r\n\r\nexport type RECEIVE_TOPIC = {\r\n  type: 'RECEIVE_TOPIC',\r\n  info: ResponseInfo,\r\n  item0: ResponseMessage,\r\n  items: ResponseMessages,\r\n  receivedAt: Date\r\n}\r\n\r\nexport type RECEIVE_TOPIC_FAILED = {\r\n  type: 'RECEIVE_TOPIC_FAILED',\r\n  error: any,\r\n  receivedAt: Date\r\n}\r\n\r\nexport type REQUEST_NEW_MESSAGES = {\r\n  type: 'REQUEST_NEW_MESSAGES'\r\n}\r\n\r\nexport type RECEIVE_NEW_MESSAGES = {\r\n  type: 'RECEIVE_NEW_MESSAGES',\r\n  items: ResponseMessages,\r\n  receivedAt: Date\r\n}\r\n\r\nexport type CLOSE_TOPIC = {\r\n  type: 'CLOSE_TOPIC'\r\n}\r\n\r\n\r\nexport type TopicAction = REQUEST_TOPIC | RECEIVE_TOPIC | RECEIVE_TOPIC_FAILED | CLOSE_TOPIC | REQUEST_NEW_MESSAGES | RECEIVE_NEW_MESSAGES;\r\n\r\nexport const requestTopic = (): any => ({\r\n  type: 'REQUEST_TOPIC'\r\n})\r\n\r\nexport const receiveTopic = (info: ResponseInfo, item0: ?ResponseMessage, items: ResponseMessages): any => {\r\n\r\n  return {\r\n    type: 'RECEIVE_TOPIC',\r\n    info,\r\n    item0,\r\n    items,\r\n    receivedAt: Date.now()\r\n  }\r\n}\r\n\r\nexport const closeTopic = (): any => {\r\n\r\n  return {\r\n    type: 'CLOSE_TOPIC',\r\n  }\r\n}\r\n\r\nexport const fetchTopic = (params: any, item0: ?ResponseMessage): any => async (dispatch: any) => {\r\n\r\n  dispatch(requestTopic())\r\n\r\n  let info;\r\n  try {\r\n    info = await API.getTopicInfo({ id: params.id });\r\n  } catch (e) {\r\n    console.error(e);\r\n    info = {\r\n      id: params.id,\r\n      text: '',\r\n      answers_count: \"0\"\r\n    };\r\n  }\r\n\r\n  try {\r\n    let page = params.page || 1;\r\n\r\n    let _item0 = item0;\r\n    let _items;\r\n    if (page === 'last20') {\r\n\r\n      if (+info.answers_count > 21) {\r\n\r\n        if (!_item0) {\r\n          let items = await API.getTopicMessages({\r\n            id: params.id,\r\n            from: 0,\r\n            to: 1\r\n          });\r\n          _item0 = items[0];\r\n        }\r\n\r\n        let first = +info.answers_count - 20;\r\n        _items = await API.getTopicMessages({\r\n          id: params.id,\r\n          from: first,\r\n          to: 1010\r\n        });\r\n\r\n      } else {\r\n        let items = await API.getTopicMessages({\r\n          id: params.id,\r\n          from: 0,\r\n          to: 1010\r\n        });\r\n        _item0 = items[0];\r\n        _items = items.slice(1);\r\n      }\r\n\r\n    } else {\r\n\r\n      page = +page;\r\n      let first = 0;\r\n      let last = page * 100 - 1;\r\n\r\n      if (page > 1) {\r\n\r\n        first = (page - 1) * 100;\r\n        if (!_item0) {\r\n          let items = await API.getTopicMessages({\r\n            id: params.id,\r\n            from: 0,\r\n            to: 1\r\n          });\r\n          _item0 = items[0];\r\n        }\r\n\r\n        _items = await API.getTopicMessages({\r\n          id: params.id,\r\n          from: first,\r\n          to: last\r\n        });\r\n\r\n      } else {\r\n        if (_item0)\r\n          first = 1;\r\n        else\r\n          first = 0;\r\n\r\n        let items = await API.getTopicMessages({\r\n          id: params.id,\r\n          from: first,\r\n          to: last\r\n        });\r\n\r\n        if (_item0) {\r\n          _items = items;\r\n        } else {\r\n          _item0 = items[0];\r\n          _items = items.slice(1);\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    if (info.answers_count === \"0\" && _items.length > 0)\r\n      info.answers_count = _items[_items.length - 1].n;\r\n\r\n    if (page === 'last20' && _items.length > 20) {\r\n      _items = _items.slice(-20);\r\n    }\r\n\r\n    dispatch(receiveTopic(info, _item0, _items));\r\n\r\n  } catch (error) {\r\n\r\n    console.error('Failed to fetch topic:', error);\r\n\r\n    dispatch({\r\n      type: 'RECEIVE_TOPIC_FAILED',\r\n      error,\r\n      receivedAt: Date.now()\r\n    });\r\n\r\n  }\r\n}\r\n\r\nconst shouldFetch = (state) => {\r\n  const topic = state.topic;\r\n  if (!topic) {\r\n    return true\r\n  }\r\n  if (topic.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const fetchTopicIfNeeded = (params: any, item0: ?ResponseMessage): any => (dispatch: any, getState: any) => {\r\n  if (shouldFetch(getState())) {\r\n    return dispatch(fetchTopic(params, item0));\r\n  }\r\n}\r\n\r\nexport type FetchNewMessageseParams = {\r\n  id: number | string,\r\n  last: number\r\n}\r\n\r\nexport const fetchNewMessages = (params: FetchNewMessageseParams): any => async (dispatch: any) => {\r\n\r\n  dispatch({\r\n    type: 'REQUEST_NEW_MESSAGES'\r\n  });\r\n\r\n  try {\r\n    const json = await API.getTopicMessages({\r\n      id: params.id,\r\n      from: params.last + 1,\r\n      to: 1002\r\n    });\r\n\r\n    dispatch({\r\n      type: 'RECEIVE_NEW_MESSAGES',\r\n      items: json,\r\n      receivedAt: Date.now()\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Failed to fetch new messages:', error);\r\n\r\n    dispatch({\r\n      type: 'RECEIVE_NEW_MESSAGES_FAILED',\r\n      error,\r\n      receivedAt: Date.now()\r\n    });\r\n  }\r\n\r\n}\r\n\r\nexport const fetchNewMessagesIfNeeded = (params: FetchNewMessageseParams): any => (dispatch: any, getState: any) => {\r\n  if (shouldFetch(getState())) {\r\n    return dispatch(fetchNewMessages(params));\r\n  }\r\n}","// @flow\r\nimport * as React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport Login from '../login'\r\n\r\ntype Props = {\r\n  info: { forum: string }\r\n}\r\n\r\nclass Header extends React.Component<Props> {\r\n\r\n  render() {\r\n\r\n    const { info } = this.props;\r\n\r\n    const forums = {\r\n      '1c': '1С:Предприятие',\r\n      'life': 'О жизни',\r\n      'it': 'Информационные технологии',\r\n      'job': 'Работа'\r\n    };\r\n\r\n    return (\r\n\r\n      <div className=\"flex-row\">\r\n        <div className=\"user-td\">\r\n          <Login />\r\n        </div>\r\n        <div className=\"section-td\">\r\n          <span id=\"forum_string\" className=\"bold120\">\r\n            <a rel=\"nofollow\" href={`${window.hash}/index.php?forum=${info.forum}`} style={{ textDecoration: \"none\" }}>{forums[info.forum]}</a>\r\n          </span>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n\r\n  const {\r\n    info\r\n  } = state.topic || {\r\n    info: {\r\n      forum: ''\r\n    }\r\n  }\r\n\r\n  return {\r\n    info\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(Header): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport { defaultTopicState } from 'src/reducers/topic'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { ResponseInfo } from 'src/api'\r\nimport { domain, urlTopicInfo, urlTopicMessages } from 'src/api'\r\n\r\ntype StateProps = {\r\n  info: ResponseInfo\r\n}\r\n\r\nclass TopicInfo extends Component<StateProps> {\r\n\r\n  render() {\r\n\r\n    const { info } = this.props;\r\n\r\n    let yandexUrl = \"https://www.yandex.ru/yandsearch?rpt=rad&text=\" + encodeURIComponent(info.text);\r\n\r\n    return (\r\n      <div className=\"topic-row\">\r\n        <div className=\"cell-userinfo\">\r\n          <div className=\"topic-tools\">\r\n            <a title=\"API.info\" href={`${domain}/${urlTopicInfo}?id=${info.id}`} className=\"agh\" style={{ display: \"block\", lineHeight: \"1em\" }}>i</a>\r\n            <a title=\"API.messages\" href={`${domain}/${urlTopicMessages}?id=${info.id}&from=0&to=20`} className=\"agh\" style={{ display: \"block\", lineHeight: \"1em\" }}>m</a>\r\n            {/*<a href=\"add_voting.php?topic_id=815217\" title=\"Добавить голосование\">vote</a> &nbsp;&nbsp;*/}\r\n          </div>\r\n        </div>\r\n        <div className=\"cell-message\">\r\n          <div className=\"flex-row\">\r\n            <div style={{ flex: 1, textAlign: \"center\" }}>\r\n              <a href={`${domain}/topic.php?id=${info.id}`}>\r\n                <h1 className=\"topic-title\" dangerouslySetInnerHTML={{ __html: info.text }}></h1>\r\n              </a>\r\n              <div className=\"moder-action\"></div>\r\n            </div>\r\n            <div style={{ flex: \"0 0 20px\", position: \"relative\" }}>\r\n              <div className=\"div-va-middle\">\r\n                <a rel=\"noopener noreferrer\" href={yandexUrl} title=\"Искать в Яндексе\" target=\"_blank\" className=\"yandex\">Я</a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  const {\r\n    info\r\n  } = state.topic || defaultTopicState;\r\n\r\n  return {\r\n    info\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(TopicInfo): any );","//@flow\r\nimport * as API from '../api'\r\nimport type { RequestNewMessage } from 'src/api'\r\n\r\nexport type POST_NEW_MESSAGE_START = {\r\n  type: 'POST_NEW_MESSAGE_START'\r\n}\r\n\r\nexport type POST_NEW_MESSAGE_COMPLETE = {\r\n  type: 'POST_NEW_MESSAGE_COMPLETE'\r\n}\r\n\r\nexport type NEW_MESSAGE_TEXT = {\r\n  type: 'NEW_MESSAGE_TEXT',\r\n  text: string\r\n}\r\n\r\nexport type ADD_MESSAGE_TEXT = {\r\n  type: 'ADD_MESSAGE_TEXT',\r\n  text: string\r\n}\r\n\r\n\r\nexport type NewMessageAction = POST_NEW_MESSAGE_START | POST_NEW_MESSAGE_COMPLETE | NEW_MESSAGE_TEXT | ADD_MESSAGE_TEXT;\r\n\r\nexport type PostNewmessageParams = {\r\n  text: string,\r\n  topicId: string,\r\n  voting_select?: number,\r\n  onSuccess?: () => void\r\n}\r\n\r\nexport const postNewMessage = (params: PostNewmessageParams): any => async (dispatch: any) => {\r\n\r\n  dispatch({\r\n    type: 'POST_NEW_MESSAGE_START'\r\n  });\r\n\r\n  let fetchParams: RequestNewMessage = {\r\n    message_text: encodeURIComponent(params.text),\r\n    action: \"new\",\r\n    topic_id: params.topicId,\r\n    rnd: Math.round(Math.random() * 10000000000)\r\n  };\r\n\r\n  if (params.voting_select)\r\n    fetchParams.voting_select = params.voting_select;\r\n\r\n  try {\r\n    await API.postNewMessage(fetchParams);\r\n    await dispatch({\r\n      type: 'POST_NEW_MESSAGE_COMPLETE'\r\n    });\r\n    if (params.onSuccess)\r\n      params.onSuccess();\r\n\r\n  } catch (err) {\r\n    console.error(\"Failed to post new message: \" + err);\r\n  }\r\n}\r\n\r\nexport const addMessageText = (text: string): any => (dispatch: any) => {\r\n  dispatch({\r\n    type: 'ADD_MESSAGE_TEXT',\r\n    text\r\n  })\r\n}","//@flow\r\nimport React, { Component, Fragment } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport dateFormat from 'dateformat'\r\nimport classNames from 'classnames'\r\nimport { domain } from 'src/api'\r\n\r\nimport { addMessageText } from 'src/actions/new_message'\r\n\r\nimport type { ResponseMessage } from 'src/api'\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype UserInfoProps = {\r\n  data: ResponseMessage,\r\n  isAuthor: boolean,\r\n  isYou?: boolean,\r\n  isTooltip?: boolean\r\n}\r\n\r\ntype Props = UserInfoProps & DefaultProps;\r\n\r\nclass UserInfo extends Component<Props> {\r\n\r\n  onClick = () => {\r\n    const { dispatch, data } = this.props;\r\n    dispatch(addMessageText(`(${data.n})`));\r\n\r\n    let elem = document.getElementById('message_text');\r\n    if (elem)\r\n      window.scrollTo(0, elem.offsetTop);\r\n  }\r\n\r\n  onImageLoad = (event) => {\r\n    event.target.style.visibility = 'visible';\r\n  }\r\n\r\n  render() {\r\n    const { data, isAuthor, isYou, isTooltip } = this.props;\r\n    const href = `${domain}/users.php?id=${data.userId}`;\r\n    let dataStr;\r\n    if (!data) {\r\n      dataStr = '';\r\n    } else if (data.n === \"0\") {\r\n      dataStr = dateFormat(new Date(+data.utime * 1000), 'dd.mm.yy - HH:MM');\r\n    } else {\r\n      dataStr = (\r\n        <Fragment>\r\n          <span className=\"message-number\">{data.n}</span>{' - ' + dateFormat(new Date(+data.utime * 1000), 'dd.mm.yy - HH:MM')}\r\n        </Fragment>\r\n      )\r\n    }\r\n\r\n    const userClassNames = classNames(\"registered-user\", {\r\n      \"is-author\": isAuthor,\r\n      \"is-you\": isYou\r\n    });\r\n\r\n    let img;\r\n    if (isTooltip !== true && window.innerWidth > 768)\r\n      img = <img src={`${domain}/css/user_icons/${data.userId}_16x16.png`} \r\n              onLoad={this.onImageLoad} \r\n              style={{visibility:\"hidden\", marginBottom:\"4px\", marginRight:\"1px\"}}/>\r\n\r\n    let timeElem;  \r\n    if (isTooltip) {\r\n      timeElem = \r\n       <span className=\"message-time\">{dataStr}</span>\r\n    } else {\r\n      timeElem =\r\n        <div className=\"message-time\">\r\n          <span className=\"ah\" >{dataStr}</span>\r\n          <button className=\"button ah\" onClick={this.onClick}>{dataStr}</button>\r\n        </div>\r\n    }  \r\n\r\n    return (\r\n      <div className=\"user-info\">\r\n        {img}\r\n        <a className={userClassNames} href={href}>{data.user}</a>\r\n        {timeElem}\r\n      </div>\r\n    )\r\n  }\r\n\r\n}\r\n\r\nexport default (connect()(UserInfo): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport UserInfo from './user_info'\r\nimport MsgText from './msg_text'\r\n\r\nimport type { ResponseMessage } from 'src/api'\r\nimport type { State } from 'src/reducers'\r\nimport type { LoginState } from 'src/reducers/login'\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype RowProps = {\r\n    data: ResponseMessage\r\n}\r\n\r\ntype StateProps = {\r\n    topicId: string,\r\n    author: string,\r\n    login: LoginState\r\n}\r\n\r\ntype Props = RowProps & StateProps & DefaultProps;\r\n\r\nclass Row extends Component<Props> {\r\n\r\n    render() {\r\n        const { data, author, topicId, login } = this.props;\r\n\r\n        if (!data)\r\n            return null;\r\n\r\n        return (\r\n            <div className=\"topic-row\" id={data.n}>\r\n                <div className=\"cell-userinfo\">\r\n                    <UserInfo data={data} isAuthor={data.user === author} isYou={data.user === login.username}/>\r\n                </div>\r\n                <div className=\"cell-message\">\r\n                    <MsgText data={data} html={data.text} topicId={topicId} n={data.n} vote={+data.vote}/>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n    const {\r\n        info,\r\n        item0,\r\n    } = state.topic || {\r\n        info: {},\r\n        item0: {},\r\n    }\r\n\r\n    return {\r\n        topicId: info.id,\r\n        author: item0 ? item0.user : '',\r\n        login: state.login\r\n    }\r\n}\r\n\r\nexport default ( connect(mapStateToProps)(Row): any );","//@flow\r\nimport * as API from 'src/api'\r\nimport type { RequestBookmark } from 'src/api'\r\n\r\nexport type ADD_BOOKMARK_START = {\r\n  type: 'ADD_BOOKMARK_START'\r\n}\r\n\r\nexport type ADD_BOOKMARK_COMPLETE = {\r\n  type: 'ADD_BOOKMARK_COMPLETE'\r\n}\r\n\r\nexport type ADD_BOOKMARK_FAIL = {\r\n  type: 'ADD_BOOKMARK_FAIL'\r\n}\r\n\r\nexport type AddBookmarkAction = ADD_BOOKMARK_START | ADD_BOOKMARK_COMPLETE | ADD_BOOKMARK_FAIL;\r\n\r\n\r\nexport const addBookmark = (params: RequestBookmark): any => async (dispatch: any) => {\r\n\r\n  dispatch({\r\n    type: \"ADD_BOOKMARK_START\"\r\n  });\r\n\r\n  try {\r\n    await API.postBookmark(params);\r\n\r\n    dispatch({\r\n      type: \"ADD_BOOKMARK_COMPLETE\"\r\n    });\r\n\r\n  } catch (err) {\r\n    console.error('Error adding bookmark:', err);\r\n    dispatch({\r\n      type: \"ADD_BOOKMARK_FAIL\"\r\n    });\r\n  }\r\n\r\n}\r\n","//@flow\r\nimport * as React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Button } from 'react-bootstrap'\r\n\r\nimport { fetchNewMessagesIfNeeded } from 'src/actions/topic'\r\nimport { addBookmark } from 'src/actions/bookmark'\r\nimport { getMaxPage } from 'src/utils'\r\n\r\ntype FooterProps = {\r\n  info: any,\r\n  dispatch: any,\r\n  bookmark: any,\r\n  isFetching: boolean,\r\n  params: any\r\n}\r\n\r\nclass Footer extends React.Component<FooterProps> {\r\n\r\n  onBookmarkClick = () => {\r\n    const { info, dispatch } = this.props;\r\n    dispatch(addBookmark(info));\r\n  }\r\n\r\n  onRefreshClick = () => {\r\n\r\n    const { info, dispatch } = this.props;\r\n\r\n    dispatch(fetchNewMessagesIfNeeded({\r\n      id: info.id,\r\n      last: parseInt(info.answers_count, 10)\r\n    }));\r\n\r\n  }\r\n\r\n  render() {\r\n\r\n    const { info, bookmark, isFetching, params } = this.props;\r\n    const maxPage = getMaxPage(info.answers_count);\r\n\r\n    let updateButton;\r\n    let page = params.page || 1;\r\n    if (page === 'last20' || page === maxPage)\r\n      updateButton =\r\n        <Button\r\n          onClick={this.onRefreshClick}\r\n          disabled={bookmark.isFetching}\r\n          size=\"sm\"\r\n          className='button'\r\n          variant=\"light\">\r\n          {isFetching ? 'Обновляется' : 'Обновить ветку'}\r\n        </Button>\r\n\r\n    return (\r\n      <div className=\"flex-row\" id=\"F\">\r\n        <div className=\"ta-left va-top\" style={{ width: \"50%\" }}>\r\n          <Button\r\n            onClick={this.onBookmarkClick}\r\n            disabled={bookmark.isFetching}\r\n            size=\"sm\"\r\n            className='button'\r\n            variant=\"light\">\r\n            {bookmark.isFetching ? 'Подождите...' : 'Закладка'}\r\n          </Button>\r\n        </div>\r\n        <div className=\"ta-right va-middle\" style={{ marginLeft: \"auto\" }}>\r\n          {updateButton}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n\r\nconst mapStateToProps = state => {\r\n\r\n  const {\r\n    isFetching,\r\n    lastUpdated,\r\n    info,\r\n  } = state.topic || {\r\n    isFetching: true,\r\n    info: {},\r\n  }\r\n\r\n  return {\r\n    info,\r\n    isFetching,\r\n    lastUpdated,\r\n    bookmark: state.bookmark || {}\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(Footer): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { FormGroup, Form } from 'react-bootstrap'\r\n\r\nimport TextEditor from 'src/components/common/text_editor'\r\nimport { postNewMessage } from 'src/actions/new_message'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { NewMessageState } from 'src/reducers/new_message'\r\n\r\nimport type { ResponseInfo } from 'src/api'\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype NewMessageProps = {\r\n  onSubmitSuccess?: () => void\r\n}\r\n\r\ntype StateProps = {\r\n  info: ResponseInfo,\r\n  newMessage: NewMessageState\r\n}\r\n\r\ntype Props = NewMessageProps & StateProps & DefaultProps;\r\ntype ComponentState = {\r\n  voting?: number\r\n}\r\n\r\nclass NewMessage extends Component<Props, ComponentState> {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { voting: undefined };\r\n  }\r\n\r\n  onSubmit = (e) => {\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const { dispatch, info, newMessage } = this.props;\r\n\r\n    let params = {\r\n      text: newMessage.text,\r\n      topicId: info.id,\r\n      onSuccess: this.onSubmitSuccess,\r\n      voting_select: undefined\r\n    };\r\n\r\n    if (this.state.voting) {\r\n      params.voting_select = this.state.voting;\r\n    }\r\n\r\n    dispatch(postNewMessage(params));\r\n  }\r\n\r\n  onSubmitSuccess = () => {\r\n\r\n    const { dispatch } = this.props;\r\n\r\n    dispatch({\r\n      type: 'NEW_MESSAGE_TEXT',\r\n      text: ''\r\n    });\r\n\r\n    this.setState({\r\n      ...this.state,\r\n      voting: undefined\r\n    });\r\n\r\n    if (this.props.onSubmitSuccess) {\r\n      this.props.onSubmitSuccess();\r\n    }\r\n  }\r\n\r\n  clearVoting = (e) => {\r\n\r\n    e.preventDefault();\r\n\r\n    this.setState({\r\n      ...this.state,\r\n      voting: undefined\r\n    })\r\n\r\n  }\r\n\r\n  setVotingOption = (i) => {\r\n    this.setState({\r\n      ...this.state,\r\n      voting: i\r\n    })\r\n  }\r\n\r\n  render() {\r\n\r\n    const { info, newMessage } = this.props;\r\n\r\n    let votingElem;\r\n    if (info.is_voting && info.voting) {\r\n\r\n      let votingOptions = [];\r\n      for (let i = 1; i <= info.voting.length; i++) {\r\n\r\n        const item = info.voting[i - 1];\r\n        if (!item.select)\r\n          continue;\r\n\r\n        votingOptions.push(\r\n          <Form.Check\r\n            type=\"radio\"\r\n            key={i}\r\n            name=\"voting\"\r\n            checked={this.state.voting === i}\r\n            onChange={() => this.setVotingOption(i)}\r\n            label={`${i}. ${item.select}`}\r\n          />\r\n        );\r\n      }\r\n\r\n\r\n      votingElem = (\r\n        <FormGroup>\r\n          <legend>\r\n            <small>Ваш выбор:\r\n              <span href=\"\" id=\"voting_clear\" style={{ marginLeft: \"5px\", cursor: \"pointer\" }} onClick={this.clearVoting}>очистить</span>\r\n            </small>\r\n          </legend>\r\n          {votingOptions}\r\n          Обоснуйте свой выбор!\r\n        </FormGroup>\r\n      );\r\n\r\n    }\r\n\r\n    return (\r\n      <form style={{ marginTop: \"5px\" }} onSubmit={this.onSubmit}>\r\n        <div className=\"bold\">Добавить сообщение в тему:</div>\r\n        <div className=\"new-message-container\">\r\n          <div className=\"new-message-text\">\r\n            <TextEditor\r\n              isFetching={newMessage.isFetching}\r\n              text={newMessage.text}\r\n              placeholder=\"Сообщение\"\r\n              formName=\"NEW_MESSAGE\"\r\n            />\r\n          </div>\r\n          <div className=\"new-message-voting\">\r\n            {votingElem}\r\n          </div>\r\n        </div>\r\n      </form>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  return {\r\n    info: state.topic.info,\r\n    newMessage: state.newMessage\r\n  };\r\n\r\n}\r\n\r\nexport default (connect(mapStateToProps)(NewMessage): any );","//@flow\r\nimport React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport queryString from 'query-string'\r\nimport { fetchTopicIfNeeded, fetchNewMessagesIfNeeded, closeTopic } from 'src/actions/topic'\r\n\r\nimport type { DefaultProps, Location } from 'src/components'\r\nimport type { ResponseInfo, ResponseMessage, ResponseMessages } from 'src/api'\r\nimport type { State } from 'src/reducers'\r\nimport type { LoginState } from 'src/reducers/login'\r\nimport type { OptionsItems } from 'src/reducers/options'\r\n\r\nimport Error from 'src/components/common/error'\r\nimport Pages from 'src/components/common/pages'\r\nimport Header from './header'\r\nimport TopicInfo from './topic_info'\r\nimport Row from './row'\r\nimport Footer from './footer'\r\nimport NewMessage from './new_message';\r\nimport { getMaxPage } from 'src/utils';\r\n\r\nimport './topic.css'\r\n\r\ntype TopicLocationParams = {\r\n  id: string,\r\n  page?: string,\r\n  hash?: string\r\n}\r\n\r\ntype StateProps = {\r\n  login: LoginState,\r\n  info: ResponseInfo,\r\n  item0?: ?ResponseMessage,\r\n  items: ResponseMessages,\r\n  error?: any,\r\n  options: OptionsItems\r\n}\r\n\r\ntype Props = {\r\n  fetchTopicIfNeeded: any,\r\n  fetchNewMessagesIfNeeded: any,\r\n  closeTopic: any,\r\n  clearText: any\r\n} & DefaultProps & StateProps\r\n\r\nclass Topic extends Component<Props> {\r\n\r\n  locationParams: TopicLocationParams;\r\n  location: Location;\r\n  timer: any;\r\n  scrolledToHash: boolean;\r\n  nodeF: any;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.locationParams = { id: '' };\r\n    this.scrolledToHash = false;\r\n  }\r\n\r\n  componentDidMount() {\r\n\r\n    this.location = this.props.location;\r\n    this.updateTopic();\r\n\r\n    if (this.props.options.autoRefreshTopic === 'true') {\r\n\r\n      let autoRefreshTopicInterval = +this.props.options.autoRefreshTopicInterval;\r\n      if (autoRefreshTopicInterval < 60) autoRefreshTopicInterval = 60;\r\n\r\n      this.timer = setInterval(this.autoUpdate, autoRefreshTopicInterval * 1000);\r\n    }\r\n\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    \r\n    const { location, items, info } = this.props;\r\n    if (!this.scrolledToHash &&\r\n      location.hash &&\r\n      items.length > 0) {\r\n\r\n      this.scrolledToHash = true;\r\n      let nodeHash = document.getElementById(location.hash.slice(1));\r\n      if (nodeHash)\r\n        setTimeout(() => window.scrollTo(0, nodeHash.offsetTop), 1);\r\n    }\r\n\r\n    let title = info.text;\r\n    if (title && document.title !== title) {\r\n      \r\n      const parser = new DOMParser();\r\n      const floatingElement = parser.parseFromString(title, 'text/html');\r\n      title = floatingElement.firstChild.innerText;\r\n\r\n      document.title = title;\r\n    }\r\n    \r\n    if (this.location.search !== location.search) {\r\n      this.location = location;\r\n      this.updateTopic();\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n\r\n    const { closeTopic, clearText } = this.props;\r\n\r\n    clearInterval(this.timer);\r\n    closeTopic();\r\n    clearText();\r\n  }\r\n\r\n  autoUpdate = () => {\r\n    const { info, fetchNewMessagesIfNeeded } = this.props;\r\n    const isLastPage = (this.locationParams.page === 'last20' || this.locationParams.page === getMaxPage(+info.answers_count));\r\n\r\n    if (isLastPage)\r\n      fetchNewMessagesIfNeeded({\r\n        id: info.id,\r\n        last: parseInt(info.answers_count, 10)\r\n      })\r\n  }\r\n\r\n  updateTopic = () => {\r\n\r\n    let { fetchTopicIfNeeded, item0 } = this.props;\r\n    let locationParams = queryString.parse(this.location.search);\r\n\r\n    if (!locationParams.page)\r\n      locationParams.page = 1;\r\n\r\n    else if (locationParams.page !== 'last20') {\r\n      locationParams.page = +locationParams.page;\r\n      if (isNaN(locationParams.page))\r\n        locationParams.page = 1;\r\n    }\r\n\r\n    if (locationParams.id !== this.locationParams.id)\r\n      item0 = null;\r\n\r\n    this.locationParams = locationParams;\r\n    fetchTopicIfNeeded(this.locationParams, item0);\r\n  }\r\n\r\n  onPostNewMessageSuccess = () => {\r\n\r\n    const { fetchNewMessagesIfNeeded, info } = this.props;\r\n\r\n    const isLastPage = (this.locationParams.page === 'last20' || this.locationParams.page === getMaxPage(+info.answers_count));\r\n\r\n    if (isLastPage)\r\n      fetchNewMessagesIfNeeded({\r\n        id: info.id,\r\n        last: parseInt(info.answers_count, 10)\r\n      });\r\n\r\n  }\r\n\r\n  render() {\r\n\r\n    const { login, items, item0, info, error } = this.props;\r\n    const maxPage = getMaxPage(+info.answers_count);\r\n\r\n    return (\r\n      <div style={{ marginBottom: \"5px\" }}>\r\n        {error && <Error text={error.message} />}\r\n        <Header currentPage={this.locationParams.page} />\r\n        <div className=\"topic-table\">\r\n          <TopicInfo />\r\n          <Row key='0' data={item0} />\r\n          {items.map((item, i) => (\r\n            <Row key={item.n} data={item} />\r\n          ))}\r\n          {(maxPage > 1 || this.locationParams.page === \"last20\") &&\r\n            <div className=\"tf\">\r\n              <Pages baseUrl='topic.php' locationParams={this.locationParams} maxPage={maxPage} last20 />\r\n            </div>\r\n          }\r\n        </div>\r\n        <Footer params={this.locationParams} />\r\n        {login.logged &&\r\n          <NewMessage onSubmitSuccess={this.onPostNewMessageSuccess} />\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  const {\r\n    isFetching,\r\n    lastUpdated,\r\n    info,\r\n    item0,\r\n    items,\r\n    error\r\n  } = state.topic;\r\n\r\n  return {\r\n    login: state.login,\r\n    info,\r\n    item0,\r\n    items,\r\n    isFetching,\r\n    lastUpdated,\r\n    error,\r\n    options: state.options.items\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n  fetchTopicIfNeeded: (...params) => dispatch(fetchTopicIfNeeded(...params)),\r\n  fetchNewMessagesIfNeeded: (...params) => dispatch(fetchNewMessagesIfNeeded(...params)),\r\n  closeTopic: (...params) => dispatch(closeTopic(...params)),\r\n  clearText: () => dispatch({ type: 'NEW_MESSAGE_TEXT', text: '' })\r\n})\r\n\r\nexport default (connect(mapStateToProps, mapDispatchToProps)(Topic): any );","//@flow\r\nimport React, { Component } from 'react'\r\n\r\ntype RadioOptionProps = {\r\n  name: string,\r\n  label: string,\r\n  value: string,\r\n  values: Array<{ name: string, descr: string }>,\r\n  onChange: any,\r\n  oneLine: boolean\r\n}\r\n\r\nclass RadioOption extends Component<RadioOptionProps> {\r\n\r\n  onChange = (e: any) => {\r\n    const { name } = this.props;\r\n    this.props.onChange(e, name, e.target.value);\r\n  }\r\n\r\n  render() {\r\n\r\n    const { name, label, values, oneLine } = this.props;\r\n\r\n    let valuesElem = [];\r\n    for (let i = 0; i < values.length; i++) {\r\n      let item = values[i];\r\n      valuesElem.push(\r\n        <label key={i} htmlFor={item.name} style={{ marginRight: \"5px\" }}>\r\n          <input type=\"radio\" name={name} value={item.name} checked={item.name === this.props.value} onChange={this.onChange} />\r\n          {item.descr}\r\n        </label>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <span>\r\n        <span style={{ marginRight: \"5px\" }}>{label}</span>\r\n        {oneLine ? null : <br />}\r\n        {valuesElem}\r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\nexport default (RadioOption: any);","//@flow\r\nimport React, { Component } from 'react'\r\n\r\ntype StringOptionProps = {\r\n  name: string,\r\n  label: string,\r\n  value: string,\r\n  onChange: any,\r\n  postfix: ?string\r\n}\r\n\r\nclass StringOption extends Component<StringOptionProps> {\r\n\r\n  onChange = (e: any) => {\r\n    const { name } = this.props;\r\n    this.props.onChange(e, name, e.target.value);\r\n  }\r\n\r\n  render() {\r\n\r\n    const { name, value, label, postfix } = this.props;\r\n\r\n    return (\r\n      <label htmlFor={name} style={{ marginRight: \"5px\" }}>\r\n        <span style={{ marginRight: \"5px\" }}>{label}</span>\r\n        <input type=\"string\" name={name} value={value} onChange={this.onChange} className='input' />\r\n        {postfix !== undefined ?\r\n          <span style={{ marginLeft: \"5px\" }}>{postfix}</span>\r\n          : null}\r\n      </label>\r\n    );\r\n  }\r\n}\r\n\r\nexport default (StringOption: any);","//@flow\r\nimport React, { Component } from 'react'\r\nimport { withRouter } from 'react-router-dom'\r\nimport { connect } from 'react-redux'\r\nimport { Form, FormControl, Button } from 'react-bootstrap'\r\n\r\nimport RadioOption from './radio_option'\r\nimport StringOption from './string_option'\r\n\r\nimport { saveOptions } from 'src/actions/options'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { OptionsState } from 'src/reducers/options'\r\nimport { defaultOptionsState } from 'src/reducers/options'\r\nimport type { DefaultProps } from 'src/components'\r\n\r\nimport './options.css'\r\n\r\ntype Props = OptionsState & DefaultProps;\r\n\r\nclass Options extends Component<Props> {\r\n\r\n  optionsParams: any;\r\n  state: any;\r\n  form: any;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      items: props.options.items\r\n    };\r\n\r\n    this.optionsParams = {\r\n      'theme': {\r\n        type: 'radio',\r\n        label: 'Цветовая палитра:',\r\n        oneLine: true,\r\n        values: [\r\n          { name: 'yellow', descr: 'Золотая' },\r\n          { name: 'lightgray', descr: 'Серая' },\r\n          { name: 'dark', descr: 'Темная' }\r\n        ]\r\n      },\r\n      'topicsPerPage': {\r\n        type: 'number',\r\n        label: 'Тем на странице (max 99):',\r\n        min: 1,\r\n        max: 99\r\n      },\r\n      'autoRefreshTopicsList': {\r\n        type: 'checkbox',\r\n        label: 'Автообновление списка тем'\r\n      },\r\n      'autoRefreshTopicsListInterval': {\r\n        type: 'number',\r\n        label: '',\r\n        min: 60,\r\n        max: 1000000,\r\n        postfix: 'сек'\r\n      },\r\n      'autoRefreshTopic': {\r\n        type: 'checkbox',\r\n        label: 'Автообновление темы'\r\n      },\r\n      'autoRefreshTopicInterval': {\r\n        type: 'number',\r\n        label: '',\r\n        min: 60,\r\n        max: 1000000,\r\n        postfix: 'сек'\r\n      },\r\n      //Tooltips   \r\n      'showTooltips': {\r\n        type: 'checkbox',\r\n        label: 'Показывать тултипы, задержка'\r\n      },\r\n      'tooltipDelay': {\r\n        type: 'number',\r\n        max: 1000000,\r\n        label: '',\r\n        postfix: 'мс'\r\n      },\r\n      'showTooltipOnTopicsList': {\r\n        type: 'checkbox',\r\n        label: 'Показывать тултипы на главной странице, при наведении на кол-во ответов'\r\n      },\r\n      'showTooltipOnPostLink': {\r\n        type: 'checkbox',\r\n        label: 'Показывать тултип ссыки на другую ветку'\r\n      },\r\n      //links   \r\n      'showYoutubeVideoTitle': {\r\n        type: 'checkbox',\r\n        label: 'Показывать наименования роликов youtube'\r\n      },\r\n      'replaceCatalogMista': {\r\n        type: 'checkbox',\r\n        label: 'Обратно заменять catalog.mista.ru на infostart.ru'\r\n      },\r\n      'fixBrokenLinks': {\r\n        type: 'checkbox',\r\n        label: 'Чинить поломанные ссылки (с русскими символами)'\r\n      },\r\n    }\r\n\r\n    this.form = [\r\n      {\r\n        tabName: 'Общие',\r\n        rows: [\r\n          ['theme'],\r\n          ['topicsPerPage'],\r\n          ['autoRefreshTopicsList', 'autoRefreshTopicsListInterval'],\r\n          ['autoRefreshTopic', 'autoRefreshTopicInterval'],\r\n        ]\r\n      },\r\n      {\r\n        tabName: 'Тултипы',\r\n        rows: [\r\n          ['showTooltips', 'tooltipDelay'],\r\n          ['showTooltipOnTopicsList'],\r\n          ['showTooltipOnPostLink']\r\n        ]\r\n      },\r\n      {\r\n        tabName: 'Ссылки',\r\n        rows: [\r\n          ['showYoutubeVideoTitle'],\r\n          ['replaceCatalogMista'],\r\n          ['fixBrokenLinks'],\r\n        ]\r\n      }\r\n    ]\r\n\r\n  }\r\n\r\n  closeForm = () => {\r\n    const { history } = this.props;\r\n    history.push('/' + window.hash);\r\n  }\r\n\r\n  resetOptions = () => {\r\n    this.setState({\r\n      ...this.state,\r\n      items: Object.assign({}, defaultOptionsState.items)\r\n    })\r\n  }\r\n\r\n  applyOptions = () => {\r\n\r\n    const { dispatch } = this.props;\r\n    dispatch(saveOptions(this.state.items));\r\n    this.closeForm();\r\n  }\r\n\r\n  onTabClick = (e) => {\r\n    this.setState({\r\n      ...this.state,\r\n      activeTab: e.target.textContent\r\n    });\r\n  }\r\n\r\n  onChange = (e, name, value) => {\r\n\r\n    let items = Object.assign({}, this.state.items);\r\n    items[name] = value;\r\n    this.setState({\r\n      ...this.state,\r\n      items\r\n    })\r\n  }\r\n\r\n  render() {\r\n\r\n    let tabs = [];\r\n    for (let tab of this.form) {\r\n\r\n      let rows = [];\r\n      for (let i in tab.rows) {\r\n\r\n        const row = tab.rows[i];\r\n        let rowElem = [];\r\n        for (let name of row) {\r\n\r\n          const item = this.optionsParams[name];\r\n          if (!item) continue;\r\n\r\n          const value = this.state.items[name];\r\n\r\n          if (item.type === 'radio') {\r\n            rowElem.push(\r\n              <RadioOption\r\n                key={name}\r\n                name={name}\r\n                label={item.label}\r\n                values={item.values}\r\n                value={value}\r\n                oneLine={item.oneLine}\r\n                onChange={this.onChange}\r\n              />\r\n            );\r\n          } else if (item.type === 'number') {\r\n\r\n            if (item.label)\r\n              rowElem.push(\r\n                <label\r\n                  htmlFor={name}\r\n                  key={name + '_label'}\r\n                  style={{ fontWeight: \"inherit\" }}>\r\n                  {item.label}\r\n                </label>\r\n              );\r\n\r\n            rowElem.push(\r\n              <FormControl\r\n                key={name}\r\n                type=\"number\"\r\n                min={item.min}\r\n                max={item.max}\r\n                value={value}\r\n                onChange={(e) => this.onChange(e, name, e.target.value)}\r\n                style={{ flex: \"0 0 100px\", marginLeft: \"5px\" }}\r\n                className='input'\r\n                size=\"sm\"\r\n              >\r\n              </FormControl>\r\n            );\r\n\r\n            if (item.postfix) {\r\n              rowElem.push(\r\n                <span key={name + '_postfix'} style={{ marginLeft: \"5px\", flex: \"0 0 auto\", }}>{item.postfix}</span>\r\n              )\r\n            };\r\n\r\n          } else if (item.type === 'string') {\r\n            rowElem.push(\r\n              <StringOption\r\n                key={name}\r\n                name={name}\r\n                label={item.label}\r\n                postfix={item.postfix}\r\n                value={value}\r\n                onChange={this.onChange}\r\n              />\r\n            );\r\n          } else if (item.type === 'checkbox') {\r\n            rowElem.push(\r\n              <Form.Check\r\n                type=\"checkbox\"\r\n                label={item.label}\r\n                key={name}\r\n                name={name}\r\n                checked={String(value) === 'true'}\r\n                onChange={(e) => this.onChange(e, name, e.target.checked)}\r\n                style={{ flex: \"0 0 auto\", margin: \"0px\", width: \"100%\" }}\r\n              />\r\n            );\r\n          }\r\n        }\r\n\r\n        rows.push(\r\n          <div key={i} className=\"options-row\">\r\n            {rowElem}\r\n          </div>\r\n        );\r\n\r\n      }\r\n\r\n      tabs.push(\r\n        <div key={tab.tabName}>\r\n          <div className=\"tab-header\">\r\n            {tab.tabName}\r\n          </div>\r\n          <div className=\"tab-content\">\r\n            {rows}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n\r\n    return (\r\n      <div className=\"options-form\">\r\n        <div className=\"options-header\" style={{ cursor: \"default\" }}>\r\n          <b>Настройки</b>\r\n        </div>\r\n        {tabs}\r\n        <div className=\"button-row\">\r\n          <Button\r\n            id=\"applyOptions\"\r\n            size=\"sm\"\r\n            variant=\"light\"\r\n            style={{ margin: \"5px\" }}\r\n            className='button'\r\n            onClick={this.applyOptions}>\r\n            OK\r\n                        </Button>\r\n          <Button\r\n            id=\"cancelOptions\"\r\n            size=\"sm\"\r\n            variant=\"light\"\r\n            style={{ margin: \"5px\", float: \"left\" }}\r\n            className='button'\r\n            onClick={this.closeForm}>\r\n            Отмена\r\n                        </Button>\r\n          <Button\r\n            id=\"defaultOptions\"\r\n            size=\"sm\"\r\n            variant=\"light\"\r\n            style={{ margin: \"5px\", float: \"right\" }}\r\n            className='button'\r\n            onClick={this.resetOptions}>\r\n            Сбросить настройки\r\n                        </Button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n}\r\n\r\nconst mapStateToProps = (state: State) => {\r\n\r\n  return {\r\n    options: state.options\r\n  };\r\n\r\n}\r\n\r\nexport default (connect(mapStateToProps)(withRouter(Options)): any );","import type { OptionsItems } from 'src/reducers/options'\r\n\r\nexport type READ_OPTIONS = {\r\n  type: 'READ_OPTIONS',\r\n}\r\nexport type SAVE_OPTIONS = {\r\n  type: 'SAVE_OPTIONS',\r\n  options: OptionsItems\r\n}\r\n\r\nexport type OptionsAction = READ_OPTIONS | SAVE_OPTIONS;\r\n\r\nexport const readOptions = () => (dispatch: any) => {\r\n\r\n  let action: OptionsAction = {\r\n    type: 'READ_OPTIONS'\r\n  };\r\n  dispatch(action);\r\n\r\n}\r\n\r\nexport const saveOptions = (options: OptionsItems) => (dispatch: any) => {\r\n\r\n  let action: OptionsAction = {\r\n    type: 'SAVE_OPTIONS',\r\n    options\r\n  };\r\n  dispatch(action);\r\n\r\n}\r\n","//@flow\r\nimport { HashRouter, Switch, Route } from 'react-router-dom'\r\nimport React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\nimport TopicsList from './topics_list'\r\nimport Topic from './topic'\r\nimport Options from './options'\r\nimport { clearTooltipsIfNeeded } from 'src/actions/tooltips'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\n\r\nclass Container extends Component<DefaultProps> {\r\n\r\n  onClick = (e: SyntheticEvent<HTMLElement>) => {\r\n    const { dispatch } = this.props;\r\n    dispatch(clearTooltipsIfNeeded());\r\n  }\r\n\r\n  render() {\r\n\r\n    const routes =\r\n      <Switch>\r\n        <Route exact path='/' component={TopicsList} />\r\n        <Route path='/index.php' component={TopicsList} />\r\n        <Route path='/topic.php' component={Topic} />\r\n        <Route path='/options.php' component={Options} />\r\n      </Switch>\r\n\r\n    if (window.hash)\r\n\r\n      return (\r\n        <div onClick={this.onClick} style={{ flex: \"auto\" }}>\r\n          <div className=\"container\" >\r\n            <HashRouter>\r\n              {routes}\r\n            </HashRouter >\r\n          </div>\r\n        </div>\r\n      )\r\n\r\n    else\r\n      return (\r\n        <div onClick={this.onClick} style={{ flex: \"auto\" }}>\r\n          <div className=\"container\">\r\n            {routes}\r\n          </div>\r\n        </div>\r\n      )\r\n  }\r\n\r\n}\r\n\r\nexport default ( connect()(Container): any );","import React from 'react'\r\nimport { domain } from 'src/api'\r\n\r\nconst NavBarFooter = (props) => {\r\n\r\n    return (\r\n        <footer className=\"flex-row navbar-footer\">\r\n            <a href={`${domain}/rules.php`}>Правила</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/about.php`}>Описание</a>\r\n            <span className=\"separator\">|</span>\r\n            <b><a href={`${domain}/ad.php`}>Реклама на сайте</a>  </b>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/find.php`}>Поиск</a>\r\n            <span className=\"separator\">|</span>\r\n            <a rel=\"nofollow\" href={`${domain}/sections_list.php`}>Секции</a>\r\n            <span className=\"separator\">|</span>\r\n            <a rel=\"nofollow\" href={`${domain}/rating.php`}>Рейтинг</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href=\"http://kb.mista.ru\">Книга знаний</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href=\"http://wiki.mista.ru\">Вики-миста (КЗ2)</a>\r\n            <span className=\"separator\">|</span>\r\n            <a rel=\"nofollow\" href=\"http://m.mista.ru/\">Мобильная</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/archive.php`}>Архив</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/moders.php`}>Модераторы</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/users_gallery.php`}>Галерея</a>\r\n            <span className=\"separator\">|</span>\r\n            <span>18+</span>\r\n        </footer>\r\n    )\r\n}\r\n\r\nexport default NavBarFooter;","import React from 'react'\r\n\r\nconst TooltipHeader = ({children, closeWindow}) => {\r\n    return (\r\n        <div className=\"tooltip-header\">\r\n            {children}\r\n            <div className=\"tooltip-close\" onClick={closeWindow} onTouchEnd={closeWindow}>\r\n                <span className=\"tooltip-close-x\">x</span>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default TooltipHeader;","import React from 'react'\r\n\r\nconst TooltipBody = ({children, onScroll}) => {\r\n    \r\n    var startX = 0;\r\n\r\n    function onTouchStart(e) {\r\n        startX = e.nativeEvent.changedTouches[0].clientX;\r\n    }\r\n    \r\n    function onTouchEnd(e) {\r\n        let endX = e.nativeEvent.changedTouches[0].clientX;\r\n        if (Math.abs(endX - startX) > 100)\r\n            onScroll(-endX + startX);\r\n    }\r\n\r\n    return (\r\n        <div className=\"tooltip-text\" onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}>\r\n            {children}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default TooltipBody;","//@flow\r\nimport React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\nimport Draggable from 'react-draggable';\r\n\r\nimport TooltipHeader from './tooltip_header'\r\nimport TooltipBody from './tooltip_body'\r\n\r\nimport './tooltip.css'\r\n\r\nimport { closeTooltip } from 'src/actions/tooltips'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { TooltipItemState } from 'src/reducers/tooltips'\r\n\r\ntype TooltipProps = {\r\n  tooltip: TooltipItemState,\r\n  onScroll: (delta: any) => void\r\n}\r\n\r\ntype Props = TooltipProps & DefaultProps;\r\n\r\nclass TooltipWindow extends Component<Props> {\r\n\r\n  onCloseClick = () => {\r\n    const { dispatch, tooltip } = this.props;\r\n    dispatch(closeTooltip(tooltip.keys));\r\n  }\r\n\r\n  onWheel = (e) => {\r\n    e.preventDefault();\r\n    this.props.onScroll(-e.nativeEvent.deltaY);\r\n  }\r\n\r\n  render() {\r\n    const { coords, i } = this.props.tooltip;\r\n\r\n    let axis;\r\n    let position;\r\n    if (window.innerWidth <= 768) {\r\n      axis = \"y\";\r\n      position = { top: coords.y, left: 5 };\r\n    } else {\r\n      axis = \"both\";\r\n      position = { top: coords.y, left: Math.min(coords.x, window.innerWidth - 670) }\r\n    }\r\n\r\n    let [header, body] = React.Children.toArray(this.props.children);\r\n\r\n    return (\r\n      <Draggable\r\n        axis={axis}\r\n        handle=\".tooltip-header\"\r\n        defaultClassNameDragging=\"dragging\"\r\n        key={i}>\r\n\r\n        <div className=\"tooltip-window\" style={{ ...position }} onWheelCapture={this.onWheel}>\r\n          <TooltipHeader closeWindow={this.onCloseClick}>\r\n            {header.props.children}\r\n          </TooltipHeader>\r\n          <TooltipBody onScroll={this.props.onScroll}>\r\n            {body.props.children}\r\n          </TooltipBody>\r\n        </div>\r\n      </Draggable>\r\n    )\r\n  }\r\n}\r\n\r\nexport default (connect()(TooltipWindow): any );","//@flow\r\nimport React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\nimport * as API from 'src/api'\r\n\r\nimport MsgText from '../topic/row/msg_text'\r\nimport UserInfo from '../topic/row/user_info';\r\n\r\nimport TooltipWindow from './tooltip_window'\r\nimport TooltipHeader from './tooltip_header'\r\nimport TooltipBody from './tooltip_body'\r\nimport './tooltip.css'\r\n\r\nimport type { DefaultProps } from 'src/components'\r\nimport type { TooltipItemState } from 'src/reducers/tooltips'\r\nimport type { TooltipKeys } from 'src/actions/tooltips'\r\n\r\ntype TooltipProps = {\r\n  tooltip: TooltipItemState,\r\n  info: any,\r\n  items: any,\r\n  item0: any\r\n}\r\n\r\ntype Props = TooltipProps & DefaultProps;\r\ntype State = {\r\n  data: any,\r\n  text: string,\r\n  number: number\r\n}\r\n\r\nclass Tooltip extends Component<Props, State> {\r\n\r\n  data: any;\r\n  text: string;\r\n  fetchData: any;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const { tooltip, info, items, item0 } = props;\r\n    const { keys } = tooltip;\r\n\r\n    let text = '';\r\n    let data;\r\n    if (keys.topicId === info.id) {\r\n      if (keys.number === 0)\r\n        data = item0;\r\n      else\r\n        data = items.find(item => item.n === String(keys.number));\r\n\r\n      if (data)\r\n        text = data.text;\r\n    }\r\n\r\n    this.state = {\r\n      data,\r\n      text,\r\n      number: keys.number\r\n    }\r\n  }\r\n\r\n  fetchData = async (number: number) => {\r\n\r\n    if (number < 0) return;\r\n\r\n    let data;\r\n    let text = '';\r\n    const topicId = this.props.tooltip.keys.topicId;\r\n\r\n    try {\r\n      data = await API.getMessage(topicId, number);\r\n      if (data)\r\n        text = data.text;\r\n      else\r\n        text = `Сообщение не найдено ${number}`;\r\n\r\n    } catch (e) {\r\n      text = e.message;\r\n    }\r\n\r\n    this.setState({ data, text, number });\r\n  }\r\n\r\n  onScroll = (delta) => {\r\n\r\n    const { keys } = this.props.tooltip;\r\n    if (keys.type !== 'TOPIC_PREVIEW') return;\r\n    if (delta > 0) {\r\n      this.fetchData(this.state.number + 1)\r\n    } else {\r\n      this.fetchData(this.state.number - 1)\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n\r\n    if (!this.state.data)\r\n      this.fetchData(this.state.number);\r\n\r\n  }\r\n\r\n  render() {\r\n    const { keys } = this.props.tooltip;\r\n\r\n    if (!this.state.text)\r\n      return null;\r\n\r\n    let header;\r\n    if (!this.state.data) {\r\n      header = <b>Заголовок</b>\r\n    } else {\r\n      header = <UserInfo data={this.state.data} isAuthor={false} isTooltip={true}/>\r\n    }\r\n\r\n    if (keys.type === 'TOPIC' || keys.type === 'TOPIC_PREVIEW')\r\n      return (\r\n        <TooltipWindow tooltip={this.props.tooltip} onScroll={this.onScroll}>\r\n          <TooltipHeader>\r\n            {header}\r\n          </TooltipHeader>\r\n          <TooltipBody>\r\n            <MsgText\r\n              data={this.state.data}\r\n              html={this.state.text}\r\n              topicId={keys.topicId}\r\n              style={{ maxHeight: \"min(550px, 80vh)\", overflowY: \"auto\" }}\r\n            />\r\n          </TooltipBody>\r\n        </TooltipWindow>\r\n      )\r\n    else\r\n      return null;\r\n  }\r\n}\r\nconst mapStateToProps = (state) => {\r\n\r\n  const {\r\n    info,\r\n    items,\r\n    item0\r\n  } = state.topic;\r\n\r\n  return {\r\n    info,\r\n    items,\r\n    item0\r\n  }\r\n}\r\n\r\nexport default (connect(mapStateToProps)(Tooltip): any );","//@flow\r\nimport React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\nimport Tooltip from './tooltip'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { TooltipItemState } from 'src/reducers/tooltips'\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype StateProps = {\r\n    items: Array<TooltipItemState>\r\n}\r\n\r\ntype Props = StateProps & DefaultProps;\r\n\r\nclass TooltipsList extends Component<Props> {\r\n\r\n    render() {\r\n\r\n        const { items } = this.props;\r\n\r\n        return (\r\n            <div>\r\n                {items.map((item, i) => {\r\n                    return (\r\n                        <Tooltip key={item.hash} tooltip={item} keys={item.keys}>\r\n                        </Tooltip>\r\n                    )}\r\n                )}\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n    const {\r\n        items\r\n    } = state.tooltips\r\n\r\n    return {\r\n        items,\r\n    }\r\n}\r\n\r\nexport default ( connect(mapStateToProps)(TooltipsList): any );","//@flow\r\nimport React, { Component, Fragment, useEffect } from 'react';\r\nimport { connect } from 'react-redux'\r\nimport NavBar from './components/nav_bar';\r\nimport Container from './components/container';\r\nimport NavBarFooter from './components/nav_bar_footer';\r\nimport TooltipsList from './components/tooltips/tooltips_list';\r\n\r\nimport { readOptions } from 'src/actions/options'\r\n\r\nimport type { State } from 'src/reducers'\r\nimport type { DefaultProps } from 'src/components'\r\n\r\ntype StateProps = {\r\n  theme: string\r\n}\r\n\r\ntype Props = StateProps & DefaultProps\r\n\r\nfunction App(props): Props {\r\n\r\n  useEffect(() => {\r\n    document.body.setAttribute('theme', props.theme);\r\n  })\r\n\r\n  return (\r\n    <Fragment>\r\n      <NavBar />\r\n      <Container />\r\n      <NavBarFooter />\r\n      <TooltipsList />\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: State): StateProps => {\r\n\r\n  return {\r\n    theme: state.options.items.theme\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps)(App);\r\n","//@flow\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport registerServiceWorker from './registerServiceWorker';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport { Provider } from 'react-redux'\r\nimport { createStore, applyMiddleware } from 'redux'\r\n\r\nimport thunk from 'redux-thunk'\r\n\r\n// eslint-disable-next-line \r\nimport { createLogger } from 'redux-logger'\r\n\r\nimport reducer from './reducers'\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nconst middleware = [thunk];\r\n\r\nif (process.env.NODE_ENV !== 'production') {\r\n    //middleware.push(createLogger())\r\n}\r\n\r\nconst store = createStore(\r\n    reducer,\r\n    applyMiddleware(...middleware)\r\n)\r\n\r\nconst Root = ({ store }) => (\r\n    <Provider store={store}>\r\n        <BrowserRouter>\r\n            <App/>\r\n        </BrowserRouter>\r\n    </Provider>\r\n)\r\n\r\n// for github pages\r\nwindow.hash = \"#\";\r\n\r\nReactDOM.render(<Root store={store} />,\r\n    document.getElementById('root'));\r\n\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}