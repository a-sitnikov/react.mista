{"version":3,"sources":["components/common/search.tsx","utils.ts","api/index.ts","api/topicslist.ts","data/topicslist/actions.ts","components/navigation/nav_bar.tsx","data/topicslist/reducer.ts","data/topicslist/index.ts","data/topic/index.ts","api/topicinfo.ts","api/topicMessages.ts","data/topic/actions.ts","data/topic/reducer.ts","api/sections.ts","data/sections/actions.ts","data/sections/reducer.ts","data/sections/index.ts","data/options/index.ts","data/options/actions.ts","data/options/reducer.ts","api/cookies.ts","api/login.ts","data/login/actions.ts","data/login/reducer.ts","data/login/index.ts","data/tooltips/actions.ts","data/tooltips/reducer.ts","data/tooltips/index.ts","api/newtopic.ts","data/newtopic/actions.ts","data/newtopic/reducer.ts","data/newtopic/index.ts","api/newmessage.ts","data/newmessage/actions.ts","data/store.ts","data/newmessage/reducer.ts","data/newmessage/index.ts","components/login/logged_user.tsx","components/login/login_form.tsx","components/common/error.tsx","components/login/index.tsx","components/topics_list/sections.tsx","components/topics_list/header.tsx","components/topics_list/row/pages.tsx","components/topics_list/row/topic_name_cell.tsx","components/topics_list/row/preview_link.tsx","components/topics_list/row/index.tsx","components/common/pages.tsx","components/common/text_editor.tsx","components/topics_list/new_topic.tsx","components/preview/preview_buttons.tsx","components/extensions/code_highlight.ts","components/topic/index.tsx","components/extensions/code1c.tsx","components/extensions/link_to_post.tsx","components/extensions/link_to_user.tsx","components/extensions/youtube_link.tsx","components/extensions/custom_link.tsx","components/topic/row/vote_item.tsx","components/topic/row/vote_chart.tsx","components/topic/row/vote.tsx","components/topic/row/msg_text.tsx","components/topic/row/user_info.tsx","components/preview/preview_content.tsx","components/preview/topic_preview.tsx","components/topics_list/index.tsx","components/topic/header.tsx","components/topic/topic_info.tsx","components/topic/row/index.tsx","components/topic/footer.tsx","components/topic/new_message.tsx","components/options/radio_option.tsx","components/options/string_option.tsx","components/options/formscheme.ts","components/options/tab.tsx","components/options/index.tsx","components/approutes.tsx","components/navigation/nav_bar_footer.tsx","components/tooltips/tooltip_header.tsx","components/tooltips/tooltip_body.tsx","components/tooltips/tooltip_window.tsx","components/tooltips/tooltip.tsx","components/tooltips/tooltips_list.tsx","App.tsx","index.tsx"],"names":["Search","useState","searchEngine","setSearchEngine","text","setText","doSearch","url","window","open","InputGroup","size","DropdownButton","id","title","style","marginRight","className","variant","onSelect","eventKey","Dropdown","Item","FormControl","type","placeholder","paddingRight","onKeyPress","e","key","onChange","target","value","Text","marginLeft","marginTop","marginBottom","cursor","onClick","zIndex","parseJSON","JSON","parse","replace","console","error","message","log","getMaxPage","count","Math","min","ceil","childrenToText","children","map","displayName","props","number","domain","localStorage","getItem","urlTopicsList","urlTopicInfo","urlTopicMessages","urlLogin","urlLogout","urlCookies","urlSections","urlNewMessage","urlNewTopic","paramsToString","paramsPrefix","params","searchParams","URLSearchParams","Reflect","get","undefined","append","str","toString","length","fetchJsonpAndGetJson","options","a","fullUrl","fetchJsonp","response","json","responseJson","utils","fetchAndGetJson","init","mode","credentials","fetch","convertResponse","forum","section","sect1","sectionCode","sect2","author","user0","lastUser","user","created","updated","utime","answ","closed","down","pinned","isVoting","is_voting","showPreview","fetchTopicsList","list","requestTopicsList","createAction","receiveTopicsList","payload","receiveTopicsListFailed","clearTopicsList","togglePreview","msgNumber","getTopicsListIfNeeded","dispatch","getState","state","topicsList","isFetching","shouldGetTopicsList","page","reqestParams","topicsPerPage","items","topicsCount","topics","section_short_name","user_id","mytopics","API","data","slice","getTopicsList","NavBar","location","useLocation","useDispatch","search","Navbar","bg","expand","fixed","Brand","as","Link","to","Toggle","aria-controls","Collapse","Nav","name","link","item","i","active","href","Form","reducer","createReducer","builder","addCase","action","lastUpdated","Date","getTime","ind","findIndex","Object","assign","previewMsgNumber","defaultInfo","initialState","info","voting","x","select","result","parseInt","sectionId","authorId","user_name","updated_name","answers_count","deleted","fetchTopicInfo","n","userId","time","vote","fetchTopicMessages","fetchTopicMessage","from","find","requestTopic","receiveTopic","item0","receiveTopicFailed","clearTopicMessages","requestNewMessages","receiveNewMessages","receiveNewMessagesFailed","shouldFetch","topic","getTopicIfNeeded","topicId","_item0","first","_items","last","getTopic","getNewMessagesIfNeeded","getNewMessages","concat","code","shortn","fulln","fetchSections","requestSections","receiveSections","receiveSectionsFailed","getSectionsIfNeeded","sections","shouldGetSections","tree","getKey","reduce","previous","currentItem","group","push","defaultOptionsState","voteColors","theme","autoRefreshTopicsList","autoRefreshTopicsListInterval","autoRefreshTopic","autoRefreshTopicInterval","showTooltips","tooltipDelay","showYoutubeVideoTitle","replaceCatalogMista","fixBrokenLinks","readOptions","saveOptions","readOption","defaultValue","readAllOptions","String","setItem","session","Number","userName","userHash","user_hash","lastError","last_error","fetchCookies","fetchLogin","method","body","username","user_password","password","headers","redirect","fetchLogout","loginStart","loginComplete","loginFailed","logoutStart","logoutComplete","checkLoginStart","shouldLogin","login","checkLogin","trim","doLoginIfNeeded","doLogin","logged","createTooltip","keys","coords","closeTooltip","clearTooltips","hash","stringify","index","filter","val","fetchNewTopic","postNewTopicStart","postNewTopicComplete","postNewTopicError","newTopicText","newTopicClear","newTopicSubject","newTopicSection","newTopicShowVoting","show","postNewTopic","fetchParams","message_text","topic_text","subject","target_section","target_forum","toLowerCase","rnd","round","random","votingItems","onSuccess","fetchNewMessage","topic_id","postNewMessageStart","postNewMessageComplete","newMessageText","addMessageText","tooltips","newTopic","newMessage","store","configureStore","devTools","process","useAppDispatch","useSelector","CustomToggle","React","forwardRef","ref","preventDefault","LoggedUser","onLogout","event","float","Menu","Divider","connector","connect","setUsername","setPassword","flexWrap","flex","maxLength","autoComplete","Button","margin","rel","ErrorElem","dangerouslySetInnerHTML","__html","elem","useEffect","selected","sectionsElem","label","Select","currentTarget","arr","Header","navigate","useNavigate","queryString","Pages","pages","maxPage","classes","classNames","sectionHref","substring","aria-hidden","overflowWrap","PreviewLink","expanded","setTime","updateTime","useCallback","msg","timeF","date","td","d","getDate","getMonth","getFullYear","today","dateFormat","display","color","width","textAlign","last20","pathName","pathname","currentPage","locationParams","set","Pagination","TextEditor","formName","showVoting","textAreaRef","useRef","cols","rows","ctrlKey","parent","parentElement","tagName","toUpperCase","dispatchEvent","Event","cancelable","bubbles","ButtonGroup","textAreaNode","current","start","selectionStart","end","selectionEnd","oldText","len","replacement","newText","disabled","Check","checked","onSubmitSuccess","currentSection","setSection","Array","fill","votes","setVotes","onVoteTextChange","votesCopy","this_onSubmitSuccess","groupsElem","votingOptions","Control","onSubmit","shouldPostNewTopic","postNewTopicIfNeeded","FormGroup","PreviewButtons","onFirst","onPrev","onNext","onLast","highlight","scrolledToHash","СтрокаРезультат","УстановленЦвет","ПоследнийЦвет","keywords","Set","split","Спецсиволы","мЦветФона","мЦветЧисла","мЦветСтроки","мЦветКлючевогоСлова1","ВСтроке","Токен","ПустаяСтрока","Строка","Сред","Нач","Длина","Прав","isKeyword","token","has","ДобавитьЧастьСтроки1С","Часть","Цвет","РазукраситьСтроку","СтрокаКода","ВСтрокеСкобка","ВСтрокеТильда","НачалоСтроки","ТокенДоТочки","Поз","ТекущийСимвол","charAt","isNaN","join","Code","hidden","setHidden","newtext","prepareText","buttonText","linesCount","buttonShow","preStyle","overflow","height","timer","onMouseOver","persist","setTimeout","showToolTip","stopPropagation","clearTimeout","onMouseOut","showTooltip","pageX","y","pageY","this","setState","startsWith","then","pageParam","Component","LinkToUser","getVideoId","fullHref","URL","hostname","getVideoParams","videoId","apiKey","apiUrl","snippet","hrefName","YoutubeLink","run","parentText","newHref","query","isMistaCatalog","class","escapedHref","regExp","RegExp","match","fixBrokenLink","VoteItem","total","colors","img","percent","textDecoration","src","maxWwidth","alt","VoteChart","max","Vote","html","_voteText","voteText","setVoteText","getVoteText","_info","voteChart","showVote","processedHtml","res","txt","substr","processCode1C","processLinksToPosts","processText","componentsMap","textComponent","activeHtml","UserInfo","imgDisplay","setImgDisplay","isAuthor","isYou","isTooltip","dataStr","imgElem","timeElem","userClassNames","innerWidth","onLoad","onError","document","getElementById","scrollTo","offsetTop","PreviewContent","loggedUserId","onDataLoaded","setData","setError","_data","getData","overflowY","TopicPreview","initialMsgNumber","deltaX","setDeltaX","setDispaly","onClickLast","swipeable","useSwipeable","onSwiping","eventData","abs","onSwiped","dir","delta","transform","flexDirection","order","updateTopicsList","position","top","letterSpacing","yandexUrl","encodeURIComponent","lineHeight","showUpdateButton","votingElem","setVoting","afterSubmit","setVotingOption","voting_select","postNewMessage","locationPage","updateTopic","updateNewMessages","htmltext","DOMParser","parseFromString","firstChild","innerText","setInterval","clearInterval","nodeHash","RadioOption","values","oneLine","onChangeValue","descr","inline","StringOption","postfix","htmlFor","formTabs","tabName","formParams","Tab","closeForm","tabs","tab","row","rowElem","fontWeight","AppRoutes","Container","path","element","NavBarFooter","TooltipHeader","closeWindow","onTouchEnd","TooltipBody","onScroll","startX","onTouchStart","nativeEvent","changedTouches","clientX","endX","TooltipWindow","axis","tooltip","left","Children","toArray","header","handle","defaultClassNameDragging","fetchData","maxHeight","setAttribute","Root","ReactDOM","render"],"mappings":"ggBA+DeA,EAvDA,WAEb,MAAwCC,mBAAS,wCAAjD,mBAAOC,EAAP,KAAqBC,EAArB,KACA,EAAwBF,mBAAS,IAAjC,mBAAOG,EAAP,KAAaC,EAAb,KAQMC,EAAW,WAEf,IAAIC,EACiB,yCAAjBL,EACFK,EAAG,6CAAyCH,EAAzC,wBAEqB,WAAjBF,IACPK,EAAG,yCAAqCH,EAArC,yBAELI,OAAOC,KAAKF,GACZF,EAAQ,KAGV,OACE,eAACK,EAAA,EAAD,CAAYC,KAAK,KAAjB,UACE,eAACC,EAAA,EAAD,CACEC,GAAG,gBACHC,MAAM,GACNH,KAAK,KACLI,MAAO,CAAEC,YAAa,OACtBC,UAAU,SACVC,QAAQ,QACRC,SAAU,SAAAC,GAAQ,OAAIjB,EAAgBiB,IAPxC,UASE,cAACC,EAAA,EAASC,KAAV,CAAeF,SAAS,uCAAxB,kDACA,cAACC,EAAA,EAASC,KAAV,CAAeF,SAAS,SAAxB,uBAEF,cAACG,EAAA,EAAD,CACEC,KAAK,OACLC,YAAW,UAAKvB,EAAL,oCACXa,MAAO,CAAEC,YAAa,MAAOU,aAAc,QAC3CT,UAAU,QACVU,WAtCa,SAACC,GACJ,UAAVA,EAAEC,KACJvB,KAqCEwB,SAAU,SAAAF,GAAC,OAAIvB,EAAQuB,EAAEG,OAAOC,QAChCA,MAAO5B,IAET,cAACM,EAAA,EAAWuB,KAAZ,CAAiBlB,MAAO,CAAEmB,WAAY,QAASC,UAAW,OAAQC,aAAc,OAAQC,OAAQ,WAAaC,QAAShC,EAAtH,SACE,mBAAGW,UAAU,qBAAqBF,MAAO,CAAEwB,OAAQ,a,+CClDpD,IAQMC,EAAY,SAACpC,GAExB,IACE,OAAOqC,KAAKC,MAAMtC,GAClB,MAAOwB,IAIT,IAaE,OAZAxB,EAAOA,EACJuC,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,IAChBA,QAAQ,MAAO,QACfA,QAAQ,MAAO,QACfA,QAAQ,MAAO,OACfA,QAAQ,cAAe,SAGnBF,KAAKC,MAAMtC,GAGlB,MAAOwB,GAIP,OAHAgB,QAAQC,MAAMjB,EAAEkB,SAChBF,QAAQG,IAAI3C,GAEL,KAIE4C,EAAa,SAACC,GAAD,OAA2BC,KAAKC,IAAID,KAAKE,KAAKH,EAAQ,KAAM,KAAO,GAEhFI,EAAiB,SAACC,GAE7B,OAAKA,EAEEA,EAASC,KAAI,SAAAvB,GAClB,MAAuB,kBAAXA,EACHA,EACiB,OAAfA,EAAMR,KACR,OAC6B,wBAA3BQ,EAAMR,KAAKgC,aAAoE,eAA3BxB,EAAMR,KAAKgC,YACjExB,EAAMyB,MAAMC,QAEnBd,QAAQG,IAAIf,GACLA,MAXWsB,GC/CXK,EAAiBC,aAAaC,QAAQ,WAAa,yBAEnDC,EAAwBF,aAAaC,QAAQ,kBAAoB,gBACjEE,EAAuBH,aAAaC,QAAQ,iBAAmB,oBAC/DG,EAA2BJ,aAAaC,QAAQ,qBAAuB,kBACvEI,EAAmBL,aAAaC,QAAQ,aAAe,4BACvDK,EAAoBN,aAAaC,QAAQ,cAAgB,wBACzDM,EAAqBP,aAAaC,QAAQ,eAAiB,kBAC3DO,EAAsBR,aAAaC,QAAQ,gBAAkB,2BAC7DQ,EAAwBT,aAAaC,QAAQ,kBAAoB,0BACjES,EAAsBV,aAAaC,QAAQ,gBAAkB,YAmB7DU,GAlByBX,aAAaC,QAAQ,kBAC1BD,aAAaC,QAAQ,aAiBxB,SAACW,EAAsBC,GACnD,IAAKA,EACH,MAAO,GAET,IAAIC,EAAe,IAAIC,gBACvB,IAAK,IAAI9C,KAAO4C,EAAQ,CACtB,IAAMzC,EAAQ4C,QAAQC,IAAIJ,EAAQ5C,QACpBiD,IAAV9C,GACF0C,EAAaK,OAAOlD,EAAKG,GAG7B,IAAIgD,EAAMN,EAAaO,WACvB,OAAID,EAAIE,OAAS,EACRV,EAAeQ,EAEf,KAGEG,EAAoB,uCAAG,WAAO5E,EAAakE,EAAaW,GAAjC,qBAAAC,EAAA,6DAE9BC,EAF8B,UAEjB3B,EAFiB,YAEPpD,GAFO,OAEDgE,EAAe,IAAKE,IAFnB,SAGXc,IAAWD,GAHA,cAG5BE,EAH4B,gBAITA,EAASC,OAJA,OAMlC,GAA8B,kBAF1BC,EAJ8B,QAQhC,IACED,EAAOhD,KAAKC,MAAMgD,GAClB,MAAO9D,GACP6D,EAAOE,EAAgBD,QAGzBD,EAAOC,EAdyB,yBAgB3BD,GAhB2B,2CAAH,0DAmBpBG,EAAe,uCAAG,WAAOrF,EAAakE,EAAaoB,GAAjC,iBAAAR,EAAA,6DAEzBC,EAFyB,UAEZ3B,EAFY,YAEFpD,GAFE,OAEIgE,EAAe,IAAKE,IAEhDoB,IACHA,EAAO,CACLC,KAAM,OACNC,YAAa,gBAPY,SAUNC,MAAMV,EAASO,GAVT,cAUvBL,EAVuB,gBAWhBA,EAASC,OAXO,mFAAH,0DCpC5B,SAASQ,EAAgBT,GAEvB,MAAQ,CACN3E,GAAI2E,EAAS3E,GACbqF,MAAOV,EAASU,MAChBC,QAASX,EAASY,MAClBC,YAAab,EAASc,MACtBC,OAAQf,EAASgB,MACjBC,SAAUjB,EAASkB,KACnBC,QAA4B,IAAnBnB,EAASmB,QAClBC,QAA0B,IAAjBpB,EAASqB,MAClB5D,MAAOuC,EAASsB,KAChB1G,KAAMoF,EAASpF,KACf2G,OAA4B,IAApBvB,EAASuB,OACjBC,KAAwB,IAAlBxB,EAASwB,KACfC,OAA2B,aAAnBzB,EAASqB,MACjBK,SAAiC,IAAvB1B,EAAS2B,UACnBC,aAAa,G,SAKFC,E,8EAAf,WAA+B5C,GAA/B,eAAAY,EAAA,sEAIqBO,EAAgB9B,EAAeW,GAJpD,cAIQ6C,EAJR,yBAKSA,EAAK/D,IAAI0C,IALlB,4C,sBChDO,IAAMsB,EAAoBC,YAAa,uBACjCC,EAAoBD,YAAa,uBAAuB,SAAAF,GAAI,MAAK,CAC5EI,QAAS,CACPJ,QAEFzE,OAAO,MAEI8E,EAA0BH,YAAa,uBAAuB,SAAA3E,GAAK,MAAK,CACnF6E,QAAS7E,EACTA,OAAO,MAEI+E,EAAkBJ,YAAa,qBAC/BK,EAAgBL,YAAa,kBAAkB,SAAC3G,EAAIiH,GAAL,MAAoB,CAC9EJ,QAAU,CACR7G,KACAiH,iBAuDSC,EAAwB,SAACtD,GAAD,OAAsB,SAACuD,EAAeC,GACzE,GAZ0B,SAACC,GAC3B,IAAMC,EAAaD,EAAMC,WACzB,OAAKA,IAGDA,EAAWC,WAOXC,CAAoBJ,KACtB,OAAOD,EArDW,SAACvD,GAAD,8CAAiB,WAAOuD,EAAeC,GAAtB,yBAAA5C,EAAA,6DAErC2C,EAAST,KAEHe,EAAO7D,EAAO6D,MAAQ,EACxBC,EAAoB,IAEpBC,GAAiBP,IAAW7C,QAAQqD,MAAMD,eAC1B,KAAIA,EAAgB,IAEpCE,EAAcJ,EAAOE,EACzBD,EAAaI,OAASD,EAElBjE,EAAO0B,UACToC,EAAaK,mBAAqBnE,EAAO0B,SAEvC1B,EAAOyB,QACTqC,EAAarC,MAAQzB,EAAOyB,OAE1BzB,EAAOoE,UACTN,EAAaM,QAAUpE,EAAOoE,SAE5BpE,EAAOqE,WACTP,EAAaO,SAAWrE,EAAOqE,UAvBI,oBA0BhBC,EAAoBR,GA1BJ,QA0B7B9C,EA1B6B,OA4B/BuD,EAAOvD,EAAKwD,OAAOT,GACvBR,EAASP,EAAkBuB,IA7BQ,mDAiCnChB,EAASL,EAAwB,GAAD,OAAI,KAAE7E,QAAN,YAAiBa,EAAjB,YAA2BG,KAC3DlB,QAAQC,MAAM,KAAEC,SAlCmB,2DAAjB,wDAqDFoG,CAAczE,MCRnB0E,G,OA1DA,WAEb,IAAMC,EAAWC,cACXrB,EAAWsB,cAGXpD,EADiB,IAAIvB,gBAAgByE,EAASG,QACvB1E,IAAI,SAkBjC,OACE,eAAC2E,EAAA,EAAD,CAAQC,GAAG,OAAOvI,QAAQ,OAAOwI,OAAO,KAAKC,MAAM,MAAnD,UACE,cAACH,EAAA,EAAOI,MAAR,CACEC,GAAIC,IACJC,GAAE,IACFzH,QArBU,WACd0F,EAASD,EAAsB,MAiB7B,yBAMA,cAACyB,EAAA,EAAOQ,OAAR,CAAeC,gBAAc,qBAC7B,eAACT,EAAA,EAAOU,SAAR,WACE,eAACC,EAAA,EAAD,CAAKlJ,UAAU,UAAf,UAtBgB,CACpB,CAAEmJ,KAAM,KAAMC,KAAK,uBACnB,CAAED,KAAM,KAAMC,KAAK,uBACnB,CAAED,KAAM,MAAOC,KAAK,wBACpB,CAAED,KAAM,OAAQC,KAAK,0BAmBA9G,KAAI,SAAC+G,EAAMC,GAAP,OACjB,cAACJ,EAAA,EAAI7I,KAAL,UACE,cAAC6I,EAAA,EAAIL,KAAL,CAAUC,GAAIO,EAAKD,KAAMG,OAAQF,EAAKF,OAASlE,EAAO2D,GAAIC,IAA1D,SACGQ,EAAKF,QAFK,IAAKG,MAjBR,CACpB,CAAEH,KAAM,OAAQC,KAAM,yBACtB,CAAED,KAAM,sEAAgBC,KAAM,wBAqBT9G,KAAI,SAAC+G,EAAMC,GAAP,OACjB,cAACJ,EAAA,EAAI7I,KAAL,UACE,cAAC6I,EAAA,EAAIL,KAAL,CAAUW,KAAMH,EAAKD,KAArB,SACGC,EAAKF,QAFK,IAAKG,SAOxB,cAACG,EAAA,EAAD,CAAMzJ,UAAU,SAAhB,SACE,cAAC,EAAD,c,qCC1BK0J,GAlCCC,YCwB8B,CAC5CxC,YAAY,EACZK,MAAO,KD1BmC,SAACoC,GAC3CA,EACGC,QAAQvD,GAAmB,SAACW,GAC3BA,EAAME,YAAa,KAEpB0C,QAAQrD,GAAmB,SAACS,EAAO6C,GAE9BA,EAAOlI,MACTqF,EAAMrF,MAAQkI,EAAOrD,QAAQzC,YAE7BiD,EAAMO,MAAQsC,EAAOrD,QAAQJ,YACtBY,EAAMrF,OAEfqF,EAAM8C,aAAc,IAAIC,MAAOC,UAC/BhD,EAAME,YAAa,KAEpB0C,QAAQlD,GAAiB,SAACM,GACzBA,EAAMO,MAAQ,GACdP,EAAME,YAAa,SACZF,EAAMrF,aACNqF,EAAM8C,eAEdF,QAAQjD,GAAe,SAACK,EAAO6C,GAC9B,IAAItC,EAAQP,EAAMO,MAAMQ,QAClBkC,EAAM1C,EAAM2C,WAAU,SAAAd,GAAI,OAAIA,EAAKzJ,KAAOkK,EAAOrD,QAAQ7G,MAE3DyJ,EAAOe,OAAOC,OAAO,GAAI7C,EAAM0C,IACnCb,EAAKlD,aAAekD,EAAKlD,YACzBkD,EAAKiB,iBAAmBR,EAAOrD,QAAQI,UACvCW,EAAM0C,GAAOb,EACbpC,EAAMO,MAAQA,QEUP+C,GAA0B,CACrC3K,GAAI,EACJC,MAAO,GACPmC,MAAO,GAGIwI,GAA4B,CACvCrD,YAAY,EACZK,MAAO,GACPiD,KAAMF,IC7BR,SAASvF,GAAgBT,GAEvB,IAAImG,EAAS,GAOb,OANInG,EAASmG,SACXA,EAASnG,EAASmG,OAAOpI,KAAI,SAAAqI,GAAC,MAAK,CACjCxL,KAAMwL,EAAEC,OACR5I,MAAO2I,EAAEE,YAGL,CACNjL,GAAIkL,SAASvG,EAAS3E,IACtBC,MAAO0E,EAASpF,KAChB8F,MAAOV,EAASU,MAChB8F,UAAWxG,EAASW,QACpBQ,QAAsC,IAA7BoF,SAASvG,EAASmB,SAC3BsF,SAAUzG,EAASqD,QACnBtC,OAAQf,EAAS0G,UACjBtF,QAAsC,IAA7BmF,SAASvG,EAASoB,SAC3BH,SAAUjB,EAAS2G,aACnBlJ,MAAO8I,SAASvG,EAAS4G,eACzBpF,KAAMxB,EAASwB,KACfD,OAAQvB,EAASuB,OACjBsF,QAAS7G,EAAS6G,QAClBnF,SAAU1B,EAAS2B,UACnBwE,U,SAKWW,G,iFAAf,WAA8BzL,GAA9B,eAAAwE,EAAA,sEAEqBO,EAAgB7B,EAAc,CAAElD,OAFrD,cAEQ6K,EAFR,yBAGSzF,GAAgByF,IAHzB,4C,sBC/BA,SAASzF,GAAgBT,GAEvB,MAAQ,CACN3E,GAAIkL,SAASvG,EAAS3E,IACtB0L,EAAGR,SAASvG,EAAS+G,GACrB7F,KAAMlB,EAASkB,KACf8F,OAAQT,SAASvG,EAASgH,QAC1BpM,KAAMoF,EAASpF,KACfqM,KAAiC,IAA3BV,SAASvG,EAASqB,OACxB6F,KAAMlH,EAASkH,M,SAKJC,G,iFAAf,WAAkClI,GAAlC,eAAAY,EAAA,sEAEqBO,EAAgB5B,EAAkBS,GAFvD,cAEQ6C,EAFR,yBAGSA,EAAK/D,IAAI0C,KAHlB,4C,+BAOe2G,G,mFAAf,WAAiC/L,EAAY0L,GAA7C,iBAAAlH,EAAA,6DAEQ0E,EAAY,IAANwC,EAAWA,EAAE,EAAIA,EAF/B,SAIqB3G,EAAgB5B,EAAkB,CAACnD,KAAIgM,KAAMN,EAAGxC,OAJrE,cAIQzC,EAJR,yBAKSA,EAAK/D,IAAI0C,IAAiB6G,MAAK,SAACxC,GAAD,OAAyBA,EAAKiC,IAAMA,MAL5E,4C,sBCrCO,IAAMQ,GAAevF,YAAa,iBAC5BwF,GAAexF,YAAa,iBAAiB,SAACkE,EAAMuB,EAAO3F,GAAd,MAAwB,CAChFI,QAAS,CACPgE,OACAuB,QACA3F,QAEFzE,OAAO,MAEIqK,GAAqB1F,YAAa,iBAAiB,SAAA3E,GAAK,MAAK,CACxE6E,QAAS7E,EACTA,OAAO,MAEIsK,GAAqB3F,YAAa,wBAElC4F,GAAqB5F,YAAa,wBAClC6F,GAAqB7F,YAAa,wBAAwB,SAACF,GAAD,MAAW,CAChFI,QAAS,CACPJ,QAEFzE,OAAO,MAEIyK,GAA2B9F,YAAa,wBAAwB,SAAA3E,GAAK,MAAK,CACrF6E,QAAS7E,EACTA,OAAO,MAwGH0K,GAAc,SAACrF,GACnB,IAAMsF,EAAQtF,EAAMsF,MACpB,OAAKA,IAGDA,EAAMpF,YAMCqF,GAAmB,SAACC,EAAiBpF,EAAsB2E,GAAxC,OAA4D,SAACjF,EAAeC,GAC1G,GAAIsF,GAAYtF,KACd,OAAOD,EAlHa,SAAC0F,EAAiBpF,EAAuB2E,GAAzC,8CAAkE,WAAOjF,GAAP,6BAAA3C,EAAA,6DAExF2C,EAAS+E,MAF+E,kBAMzET,GAAeoB,GAN0D,OAMtFhC,EANsF,uDAQtF9I,QAAQC,MAAR,MACA6I,EAAO,CACL7K,GAAI6M,EACJ5M,MAAO,GACPmC,MAAO,GAZ6E,qBAgBlF0K,EAASV,EAEA,WAAT3E,EAlBkF,sBAoBhFoD,EAAKzI,MAAQ,IApBmE,oBAsB7E0K,EAtB6E,kCAuBjEf,GAAkBc,EAAS,GAvBsC,QAuBhFC,EAvBgF,sBA0B9EC,EAAQlC,EAAKzI,MAAQ,GA1ByD,UA2BnE0J,GAAmB,CAChC9L,GAAI6M,EACJb,KAAMe,EACN7D,GAAI,OA9B4E,QA2BlF8D,EA3BkF,gDAkChElB,GAAmB,CACnC9L,GAAI6M,EACJb,KAAM,EACN9C,GAAI,OArC4E,QAkC9EtB,EAlC8E,OAuClFkF,EAASlF,EAAM,GACfoF,EAASpF,EAAMQ,MAAM,GAxC6D,mCA8ChF2E,EAAQ,EACRE,EAAc,KAFlBxF,GAAQA,GAEgB,IAEpBA,EAAO,GAjDyE,oBAmDlFsF,EAAqB,KAAZtF,EAAO,GACXqF,EApD6E,kCAqDjEf,GAAkBc,EAAS,GArDsC,QAqDhFC,EArDgF,gCAwDnEhB,GAAmB,CAChC9L,GAAI6M,EACJb,KAAMe,EACN7D,GAAI+D,IA3D4E,QAwDlFD,EAxDkF,sCAgEhFD,EADED,EACM,EAEA,EAlEwE,UAoEhEhB,GAAmB,CACnC9L,GAAI6M,EACJb,KAAMe,EACN7D,GAAI+D,IAvE4E,QAoE9ErF,EApE8E,OA0E9EkF,EACFE,EAASpF,GAETkF,EAASlF,EAAM,GACfoF,EAASpF,EAAMQ,MAAM,IA9E2D,QAoFnE,IAAfyC,EAAKzI,OAAe4K,EAAO3I,OAAS,IACtCwG,EAAKzI,MAAQ4K,EAAOA,EAAO3I,OAAS,GAAGqH,GAE5B,WAATjE,GAAqBuF,EAAO3I,OAAS,KACvC2I,EAASA,EAAO5E,OAAO,KAGzBjB,EAASgF,GAAatB,EAAMiC,EAAQE,IA3FkD,mDA+FtFjL,QAAQC,MAAM,yBAAd,MACAmF,EAASkF,GAAmB,KAAMpK,UAhGoD,iEAAlE,sDAkHJiL,CAASL,EAASpF,EAAM2E,MA4B/Be,GAAyB,kBAAM,SAAChG,EAAeC,GAC1D,IAAMC,EAAQD,IACd,EAAsBC,EAAMsF,MAAM9B,KAA1B7K,EAAR,EAAQA,GAAIoC,EAAZ,EAAYA,MACZ,GAAIsK,GAAYrF,GACd,OAAOF,EAvBmB,SAACnH,EAAYoC,GAAb,8CAA+B,WAAO+E,GAAP,eAAA3C,EAAA,6DAE3D2C,EAASoF,MAFkD,kBAKtCT,GAAmB,CACpC9L,GAAIA,EACJgM,KAAM5J,EAAQ,EACd8G,GAAI,OARmD,OAKnDzC,EALmD,OAUzDU,EAASqF,GAAmB/F,IAV6B,gDAazD1E,QAAQC,MAAM,gCAAiC,KAAaC,SAC5DkF,EAASsF,GAAyB,KAAaxK,UAdU,yDAA/B,sDAuBVmL,CAAepN,EAAIoC,MCtIxB0H,GAxCCC,YAAca,IAAc,SAACZ,GAC3CA,EACGC,QAAQiC,IAAc,SAAC7E,GACtBA,EAAME,YAAa,KAEpB0C,QAAQkC,IAAc,SAAC9E,EAAO6C,GAEzBA,EAAOlI,MACTqF,EAAMrF,MAAQkI,EAAOrD,QAAQzC,YAE7BiD,EAAMO,MAAQsC,EAAOrD,QAAQJ,KAC7BY,EAAM+E,MAAQlC,EAAOrD,QAAQuF,MAC7B/E,EAAMwD,KAAOX,EAAOrD,QAAQgE,YACrBxD,EAAMrF,OAEfqF,EAAM8C,aAAc,IAAIC,MAAOC,UAC/BhD,EAAME,YAAa,KAEpB0C,QAAQqC,IAAoB,SAACjF,GAC5BA,EAAMO,MAAQ,GACdP,EAAMwD,KAAOF,UACNtD,EAAM+E,aACN/E,EAAMrF,SAEdiI,QAAQsC,IAAoB,SAAClF,GAC5BA,EAAME,YAAa,KAEpB0C,QAAQuC,IAAoB,SAACnF,EAAO6C,GAC/BA,EAAOlI,MACTqF,EAAMrF,MAAQkI,EAAOrD,QAAQzC,YAE7BiD,EAAME,YAAa,EACf2C,EAAOrD,QAAQJ,KAAKpC,OAAS,IAC/BgD,EAAMO,MAAQP,EAAMO,MAAMyF,OAAOnD,EAAOrD,QAAQJ,MAChDY,EAAMwD,KAAKzI,MAAQiF,EAAMO,MAAMP,EAAMO,MAAMvD,OAAS,GAAGqH,UC7BjE,SAAStG,GAAgBT,GAEvB,MAAQ,CACN3E,GAAI2E,EAAS3E,GACbqF,MAAOV,EAASU,MAChBiI,KAAM3I,EAAS4I,OACfhE,KAAM5E,EAAS6I,OAKZ,IAAMC,GAAa,uCAAG,4BAAAjJ,EAAA,sEACRF,EAAqBf,GADb,cACrBkD,EADqB,yBAEpBA,EAAK/D,IAAI0C,KAFW,2CAAH,qDChBbsI,GAAkB/G,YAAa,oBAC/BgH,GAAkBhH,YAAa,oBAAoB,SAAAF,GAAI,MAAK,CACvEI,QAAS,CACPJ,QAEFzE,OAAO,MAGI4L,GAAwBjH,YAAa,oBAAoB,SAAA3E,GAAK,MAAK,CAC9E6E,QAAS7E,EACTA,OAAO,MAqCI6L,GAAsB,kBAAW,SAAC1G,EAAeC,GAC5D,GAjBwB,SAACC,GAEzB,IAAMyG,EAAWzG,EAAMyG,SAEvB,OAAKA,IAGDA,EAASvG,cAGTuG,EAASlG,MAAMvD,OAAS,GAOxB0J,CAAkB3G,KACpB,OAAOD,EApCgB,uCAAM,WAAOA,GAAP,eAAA3C,EAAA,6DAE/B2C,EAASuG,MAFsB,kBAMVD,KANU,OAMvBhH,EANuB,OAO7BU,EAASwG,GAAgBlH,IAPI,gDAW7BU,EAASyG,GAAsB,KAAE3L,UACjCF,QAAQC,MAAR,MAZ6B,yDAAN,yDCOZ8H,GAnBCC,YCegC,CAC9CxC,YAAY,EACZK,MAAO,GACPoG,KAAM,KDlBoC,SAAChE,GAC3CA,EACGC,QAAQyD,IAAiB,SAACrG,GACzBA,EAAME,YAAa,KAEpB0C,QAAQ0D,IAAiB,SAACtG,EAAO6C,GdLf,IAAyBzD,EAAWwH,EcOjD/D,EAAOlI,MACTqF,EAAMrF,MAAQkI,EAAOrD,QAAQzC,YAE7BiD,EAAMO,MAAQsC,EAAOrD,QAAQJ,KAC7BY,EAAM2G,MdXkCvH,EcWnBY,EAAMO,MdXwBqG,EcWjB,SAAAxE,GAAI,OAAIA,EAAKpE,OdVrDoB,EAAKyH,QAAO,SAACC,EAAUC,GACrB,IAAMC,EAAQJ,EAAOG,GAGrB,OAFKD,EAASE,KAAQF,EAASE,GAAS,IACxCF,EAASE,GAAOC,KAAKF,GACdD,IACN,YcMU9G,EAAMrF,OAEfqF,EAAM8C,aAAc,IAAIC,MAAOC,UAC/BhD,EAAME,YAAa,QEDZgH,GAAqC,CAChDC,WAAY,CACV,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEF5G,MAAO,CACL6G,MAAO,YACP9G,cAAe,KACf+G,sBAAuB,QACvBC,8BAA+B,KAC/BC,iBAAkB,OAClBC,yBAA0B,KAE1BC,aAAc,OACdC,aAAc,MAEdC,sBAAuB,OACvBC,oBAAqB,OACrBC,eAAgB,SC5CPC,GAAcxI,YAAa,gBAC3ByI,GAAczI,YAAa,gBAAgB,SAAApC,GAAO,MAAK,CAClEsC,QAAS,CACPtC,eCAE8K,GAAa,SAAC9F,EAAc+F,GAChC,OAAO3P,OAAOoD,aAAaC,QAAQuG,IAAS+F,GA+B/BxF,GAlBCC,YAVO,WAErB,IAAI1C,EAAuBkH,GAC3B,IAAK,IAAIvN,KAAOqG,EAAMO,MACpBP,EAAMO,MAAM5G,GAAOqO,GAAWrO,EAAKqG,EAAMO,MAAM5G,IAGjD,OAAOqG,EAGqBkI,IAAkB,SAACvF,GAC/CA,EACGC,QAAQkF,IAAa,SAAC9H,GACrB,IAAIO,EAAQ4C,OAAOC,OAAO,GAAI8D,GAAoB3G,OAClD,IAAK,IAAI5G,KAAO4G,EACdA,EAAM5G,GAAOqO,GAAWrO,EAAKuN,GAAoB3G,MAAM5G,IAEzDqG,EAAMO,MAAQA,KAEfqC,QAAQmF,IAAa,SAAC/H,EAAO6C,GAC5B,IAAK,IAAIlJ,KAAOkJ,EAAOrD,QAAQtC,QAAS,CACtC,IAAMpD,EAAQqO,OAAOtF,EAAOrD,QAAQtC,QAAQvD,IAC5CrB,OAAOoD,aAAa0M,QAAQzO,EAAKG,GACjCkG,EAAMO,MAAM5G,GAAOG,SCM3B,SAASiE,GAAgBT,GAEvB,IAAQ+K,EAAY/K,EAAZ+K,QAER,MAAQ,CACN/D,OAAQgE,OAAM,OAACD,QAAD,IAACA,OAAD,EAACA,EAAS1H,SACxB4H,SAAQ,OAAEF,QAAF,IAAEA,OAAF,EAAEA,EAASrE,UACnBwE,SAAQ,OAAEH,QAAF,IAAEA,OAAF,EAAEA,EAASI,UACnBC,UAAS,OAAEL,QAAF,IAAEA,OAAF,EAAEA,EAASM,Y,SAKTC,K,8EAAf,4BAAAzL,EAAA,sEAEyBF,EAAqBhB,GAF9C,cAEQqB,EAFR,yBAGSS,GAAgBT,IAHzB,4C,sBC5CO,IAAMuL,GAAU,uCAAG,WAAOtM,GAAP,SAAAY,EAAA,sEAClBW,MAAM,GAAD,OAAIrC,EAAJ,YAAcM,GAAY,CACnC+M,OAAQ,OACRC,KAAM1M,EAAe,GAAI,CAAC2H,UAAWzH,EAAOyM,SAAUC,cAAe1M,EAAO2M,WAC5EtL,KAAM,UACNC,YAAa,UACbsL,QAAS,CACP,OAAU,kDACV,eAAgB,qCAElBC,SAAU,WAVY,2CAAH,sDAcVC,GAAW,uCAAG,4BAAAlM,EAAA,6DACnBC,EADmB,UACN3B,EADM,YACIO,GADJ,SAEnB8B,MAAMV,EAAS,CACnBQ,KAAM,UACNC,YAAa,YAJU,2CAAH,qDCfXyL,GAAahK,YAAa,eAC1BiK,GAAgBjK,YAAa,kBAAkB,SAACgF,EAAQiE,EAAUC,GAAnB,MAAiC,CAC3FhJ,QAAS,CACP8E,SACAiE,WACAC,YAEF7N,OAAO,MAEI6O,GAAclK,YAAa,kBAAkB,SAAA3E,GAAK,MAAK,CAClE6E,QAAS7E,EACTA,OAAO,MAGI8O,GAAcnK,YAAa,gBAC3BoK,GAAiBpK,YAAa,mBAE9BqK,GAAkBrK,YAAa,qBAEtCsK,GAAc,SAAC5J,GACnB,IAAQ6J,EAAU7J,EAAV6J,MACR,OAAKA,IAGDA,EAAM3J,YAMC4J,GAAa,yDAAM,WAAOhK,GAAP,eAAA3C,EAAA,6DAE9B2C,EAAS6J,MAFqB,kBAMff,KANe,OAM5BrL,EAN4B,8DAQ5BuC,EAAS0J,GAAY,KAAE5O,UARK,2BAY1B2C,GAAQA,EAAK+G,QAGD,qHADD/G,EAAKmL,WAAa,IAAIqB,QACY,GAC/CjK,EAASyJ,GACPhM,EAAK+G,OACL/G,EAAKgL,SACLhL,EAAKiL,YAGP1I,EAAS0J,GAAY,KAtBO,yDAAN,uDAiEbQ,GAAkB,SAAChB,EAAkBE,GAAnB,OAA6C,SAACpJ,EAAeC,GAC1F,GAAI6J,GAAY7J,KACd,OAAOD,EArBY,SAACkJ,EAAkBE,GAAnB,8CAA6C,WAAOpJ,GAAP,SAAA3C,EAAA,6DAElE2C,EAASwJ,MAFyD,kBAK1DT,GAAW,CACfG,SAAUA,EACVE,SAAUA,IAPoD,OAUhEpJ,EAASgK,MAVuD,gDAahEpP,QAAQC,MAAM,gBAAd,MACAmF,EAAS0J,GAAY,KAAI5O,UAduC,yDAA7C,sDAqBHqP,CAAQjB,EAAUE,MC/DvBzG,GApCCC,YCcyB,CACvCxC,YAAY,IDf8B,SAACyC,GAC3CA,EACGC,QAAQ0G,IAAY,SAACtJ,GACpBA,EAAME,YAAa,KAEpB0C,QAAQ+G,IAAiB,SAAC3J,GACzBA,EAAME,YAAa,KAEpB0C,QAAQ2G,IAAe,SAACvJ,EAAO6C,GAC1BA,EAAOlI,OACTqF,EAAMkK,QAAS,EACflK,EAAMrF,MAAQkI,EAAOrD,QAAQzC,aAG7BiD,EAAMsE,OAASzB,EAAOrD,QAAQ8E,OAC9BtE,EAAMuI,SAAW1F,EAAOrD,QAAQ+I,SAChCvI,EAAMwI,SAAW3F,EAAOrD,QAAQgJ,SAChCxI,EAAMkK,QAAS,SACRlK,EAAMrF,OAEfqF,EAAM8C,aAAc,IAAIC,MAAOC,UAC/BhD,EAAME,YAAa,KAEpB0C,QAAQ6G,IAAa,SAACzJ,GACrBA,EAAME,YAAa,KAEpB0C,QAAQ8G,IAAgB,SAAC1J,GACxBA,EAAME,YAAa,EACnBF,EAAMkK,QAAS,SACRlK,EAAMsE,cACNtE,EAAMuI,gBACNvI,EAAMwI,gBACNxI,EAAMrF,YEhCNwP,GAAgB7K,YAAa,kBAAkB,SAAC8K,EAAMC,GAAP,MAAmB,CAC7E7K,QAAS,CACP4K,OACAC,cAGSC,GAAehL,YAAa,iBAAiB,SAAA8K,GAAI,MAAK,CACjE5K,QAAS,CACP4K,YAGSG,GAAgBjL,YAAa,kBCkB3BmD,GA7BCC,YCmB4B,CAC1CnC,MAAO,KDpBmC,SAACoC,GAC3CA,EACGC,QAAQuH,IAAe,SAACnK,EAAO6C,GAC9B,IAAM2H,EAAOjQ,KAAKkQ,UAAU5H,EAAOrD,QAAQ4K,MACrCM,EAAQ1K,EAAMO,MAAM2C,WAAU,SAAAd,GAAI,OAAIA,EAAKoI,OAASA,KACtDnQ,EAAS,EACT2F,EAAMO,MAAMvD,SACd3C,EAAS2F,EAAMO,MAAMP,EAAMO,MAAMvD,OAAS,GAAG3C,OAAS,IACxC,IAAZqQ,EACF1K,EAAMO,MAAM0G,KAAK,CACfmD,KAAMvH,EAAOrD,QAAQ4K,KACrBC,OAAQxH,EAAOrD,QAAQ6K,OACvBG,OACAnQ,WAIF2F,EAAMO,MAAMP,EAAMO,MAAMvD,OAAS,GAAG3C,OAASA,KAGhDuI,QAAQ0H,IAAc,SAACtK,EAAO6C,GAC7B,IAAI2H,EAAOjQ,KAAKkQ,UAAU5H,EAAOrD,QAAQ4K,MACzCpK,EAAMO,MAAQP,EAAMO,MAAMoK,QAAO,SAAAC,GAAG,OAAIA,EAAIJ,OAASA,QAEtD5H,QAAQ2H,IAAe,SAACvK,GACvBA,EAAMO,MAAQ,SEPPsK,GAAa,uCAAG,WAAOtO,GAAP,SAAAY,EAAA,sEAErBW,MAAM,GAAD,OAAIrC,EAAJ,YAAcW,GAAe,CACtC0M,OAAQ,OACRC,KAAM1M,EAAe,GAAIE,GACzBqB,KAAM,UACNC,YAAa,UACbsL,QAAS,CACP,eAAgB,uCARO,2CAAH,sDCPb2B,GAAoBxL,YAAa,wBACjCyL,GAAuBzL,YAAa,2BACpC0L,GAAoB1L,YAAa,wBAAwB,SAAA3E,GAAK,MAAK,CAC9E6E,QAAS7E,EACTA,OAAO,MAEIsQ,GAAe3L,YAAa,kBAAkB,SAAApH,GAAI,MAAK,CAClEsH,QAAS,CACPtH,QAEFyC,OAAO,MAEIuQ,GAAgB5L,YAAa,mBAC7B6L,GAAkB7L,YAAa,qBAAqB,SAAApH,GAAI,MAAK,CACxEsH,QAAS,CACPtH,QAEFyC,OAAO,MAEIyQ,GAAkB9L,YAAa,qBAAqB,SAAArB,GAAO,MAAK,CAC3EuB,QAAS,CACPvB,WAEFtD,OAAO,MAEI0Q,GAAqB/L,YAAa,eAAe,SAAAgM,GAAI,MAAK,CACrE9L,QAAS,CACP8L,QAEF3Q,OAAO,MAoBH4Q,GAAe,SAAChP,GAAD,8CAAgC,WAAOuD,GAAP,iBAAA3C,EAAA,sDAcnD,GAZA2C,EAASgL,MAELU,EAAwB,CAC1BC,aAAclP,EAAOrE,KACrBwT,WAAYnP,EAAOoP,QACnBC,eAAgBzD,OAAO5L,EAAO0B,SAC9B4N,aAActP,EAAOyB,MAAM8N,cAC3BjJ,OAAQ,MACRkJ,IAAK/Q,KAAKgR,MAAsB,KAAhBhR,KAAKiR,UACrBxI,OAAQlH,EAAOyC,SAAW,EAAI,GAG5BzC,EAAO2P,YACT,IAAS7J,EAAI,EAAGA,EAAI9F,EAAO2P,YAAYlP,OAAQqF,IAC7CmJ,EAAY,UAAD,OAAWnJ,EAAI,IAAO9F,EAAO2P,YAAY7J,GAhBL,gBAmB7CwI,GAAcW,GAnB+B,OAqBnD1L,EAASiL,MAELxO,EAAO4P,WACT5P,EAAO4P,YAxB0C,2CAAhC,uDCxBN1J,GAjCCC,YCK2B,CACzCxC,YAAY,EACZjC,QAAS,KACT/F,KAAM,GACNyT,QAAS,GACT3N,MAAO,KACPgB,UAAU,IDXgC,SAAC2D,GAC3CA,EACGC,QAAQkI,IAAmB,SAAC9K,GAC3BA,EAAME,YAAa,SACZF,EAAMrF,SAEdiI,QAAQmI,IAAsB,SAAC/K,GAC9BA,EAAME,YAAa,KAEpB0C,QAAQoI,IAAmB,SAAChL,EAAO6C,GAClC7C,EAAME,YAAa,EACnBF,EAAMrF,MAAQkI,EAAOrD,WAEtBoD,QAAQqI,IAAc,SAACjL,EAAO6C,GAC7B7C,EAAM9H,KAAO2K,EAAOrD,QAAQtH,QAE7B0K,QAAQsI,IAAe,SAAClL,GACvBA,EAAM9H,KAAO,GACb8H,EAAM2L,QAAU,GAChB3L,EAAMhB,UAAW,KAElB4D,QAAQuI,IAAiB,SAACnL,EAAO6C,GAChC7C,EAAM2L,QAAU9I,EAAOrD,QAAQtH,QAEhC0K,QAAQyI,IAAoB,SAACrL,EAAO6C,GACnC7C,EAAMhB,SAAW6D,EAAOrD,QAAQ8L,QAEjC1I,QAAQwI,IAAiB,SAACpL,EAAO6C,GAChC7C,EAAM/B,QAAU4E,EAAOrD,QAAQvB,QAC/B+B,EAAMhC,MAAkC,MAA1B6E,EAAOrD,QAAQvB,QAAkB,GAAK4E,EAAOrD,QAAQvB,QAAQD,MAAM8N,oBExB1EM,GAAe,uCAAG,WAAO7P,GAAP,mBAAAY,EAAA,6DAEvB9E,EAAM8D,EAAc1B,QAAQ,MAAO8B,EAAO8P,UAE1CnP,EAAuB,CAC3B4L,OAAQ,OACRC,KAAM1M,EAAe,GAAIE,GACzBqB,KAAM,UACNC,YAAa,UACbsL,QAAS,CACP,OAAU,kDACV,eAAgB,qCAElBC,SAAU,UAbiB,SAgBRtL,MAAM,GAAD,OAAIrC,EAAJ,YAAcpD,GAAO6E,GAhBlB,cAgBvB0G,EAhBuB,yBAiBtBA,GAjBsB,2CAAH,sDCTf0I,GAAsBhN,YAAa,0BACnCiN,GAAyBjN,YAAa,6BACtCkN,GAAiBlN,YAAa,oBAAoB,SAAApH,GAAI,MAAK,CACtEsH,QAAS,CACPtH,YAGSuU,GAAiBnN,YAAa,oBAAoB,SAAApH,GAAI,MAAK,CACtEsH,QAAS,CACPtH,YCCEuK,GAAU,CACdxC,cACAqF,SACAmB,YACAvJ,WACA2M,SACA6C,YACAC,YACAC,WChBclK,YCC8B,CAC5CxC,YAAY,EACZhI,KAAM,KDHoC,SAACyK,GAC3CA,EACGC,QAAQ0J,IAAqB,SAACtM,GAC7BA,EAAME,YAAa,KAEpB0C,QAAQ2J,IAAwB,SAACvM,GAChCA,EAAME,YAAa,KAEpB0C,QAAQ4J,IAAgB,SAACxM,EAAO6C,GAC/B7C,EAAM9H,KAAO2K,EAAOrD,QAAQtH,QAE7B0K,QAAQ6J,IAAgB,SAACzM,EAAO6C,GAC/B7C,EAAM9H,MAAQ2K,EAAOrD,QAAQtH,QAE9B0K,QAAQqC,IAAoB,SAACjF,GAC5BA,EAAM9H,KAAO,UDIb2U,GAAQC,YAAe,CAC3BrK,WAEAsK,UAAUC,IAMCC,GAAiB,kBAAM7L,eAGrByL,IAFgDK,IAEhDL,IGtBTM,GAAeC,IAAMC,YAAuC,WAAwBC,GAAxB,IAAGlS,EAAH,EAAGA,SAAUhB,EAAb,EAAaA,QAAb,OAChE,sBACEkT,IAAKA,EACLzU,MAAO,CAAEsB,OAAQ,WACjBpB,UAAU,OACVqB,QAAS,SAACV,GACRA,EAAE6T,iBACFnT,EAAQV,IANZ,SASG0B,OAqCUoS,GAjCgB,SAAC,GAAwC,IAAtClJ,EAAqC,EAArCA,OAAQiE,EAA6B,EAA7BA,SAElCzI,EAAWmN,KAEXQ,EAAW,SAACC,GAChBA,EAAMH,iBACNzN,EfiCoB,uCAAM,WAAOA,GAAP,SAAA3C,EAAA,6DAE5B2C,EAAS2J,MAFmB,kBAKpBJ,KALoB,sDAO1B3O,QAAQC,MAAR,MAP0B,OAU5BmF,EAAS4J,MACT5J,EAASgK,MAXmB,yDAAN,wDexBtB,OACE,qBAAKjR,MAAO,CAAE8U,MAAO,QAArB,SACE,eAACxU,EAAA,EAAD,CAAUR,GAAG,uBAAuBM,SARnB,SAACC,EAAewU,GAClB,SAAbxU,GACFuU,EAASC,IAMT,UACE,0EACA,eAACvU,EAAA,EAAS2I,OAAV,CAAiBH,GAAIwL,GAArB,UAAoC5E,EAApC,aACA,eAACpP,EAAA,EAASyU,KAAV,WACE,cAACzU,EAAA,EAASC,KAAV,CAAeF,SAAS,UAAUqJ,KAAI,UAAK9G,EAAL,yBAA4B6I,GAAlE,wDACA,cAACnL,EAAA,EAASC,KAAV,CAAeF,SAAS,WAAWqJ,KAAI,8BAAyB+B,GAAhE,yDACA,cAACnL,EAAA,EAAS0U,QAAV,IACA,cAAC1U,EAAA,EAASC,KAAV,CAAeF,SAAS,UAAUqJ,KAAI,gBAAtC,oEACA,cAACpJ,EAAA,EAAS0U,QAAV,IACA,cAAC1U,EAAA,EAASC,KAAV,CAAeF,SAAS,OAAxB,qD,SCSK4U,GApDGC,aAJD,SAAC/N,GAChB,OAAOA,EAAM6J,QAuDAiE,EAnDyC,SAACvS,GAEvD,IAAMuE,EAAWmN,KAEjB,EAAgClV,mBAAS,IAAzC,mBAAOiR,EAAP,KAAiBgF,EAAjB,KACA,EAAgCjW,mBAAS,IAAzC,mBAAOmR,EAAP,KAAiB+E,EAAjB,KAOA,OACE,gCACE,uBAAM/L,KAAK,YAAYnJ,UAAU,WAAWF,MAAO,CAAEqV,SAAU,QAA/D,UACE,cAAC7U,EAAA,EAAD,CACEC,KAAK,OACLC,YAAY,qBACZO,MAAOkP,EACPpP,SAAU,SAAAF,GAAC,OAAIsU,EAAYtU,EAAEG,OAAOC,QACpCrB,KAAK,KACLM,UAAU,QACVF,MAAO,CAAEC,YAAa,MAAOqV,KAAM,eAErC,cAAC9U,EAAA,EAAD,CACEC,KAAK,WACLC,YAAY,uCACZ6U,UAAW,GACXC,aAAa,MACbvU,MAAOoP,EACPtP,SAAU,SAAAF,GAAC,OAAIuU,EAAYvU,EAAEG,OAAOC,QACpCrB,KAAK,KACLM,UAAU,QACVF,MAAO,CAAEC,YAAa,MAAOqV,KAAM,eAErC,cAACG,GAAA,EAAD,CACE7V,KAAK,KACLO,QAAQ,QACRD,UAAU,SACVqB,QAhCQ,SAACsT,GACfA,EAAMH,iBACNzN,EAASkK,GAAgBhB,EAAUE,KA0B/B,+CAOF,oBAAGrQ,MAAO,CAAE0V,OAAQ,OAApB,uHAAkD,mBAAGhM,KAAK,0BAAR,+BAClD,mBAAGiM,IAAI,WAAWjM,KAAK,+CAAvB,gFACA,sBAAM1J,MAAO,CAAE0V,OAAQ,OAAvB,eACA,mBAAGC,IAAI,WAAWjM,KAAK,+CAAvB,8FCxCSkM,I,OATe,SAAC,GAAmC,IAAjCvW,EAAgC,EAAhCA,KAC/B,OAAKA,EAIH,qBAAKa,UAAU,QAAQ2V,wBAAyB,CAAEC,OAAQzW,KAHnD,OC4BI4V,GAzBGC,aAJD,SAAC/N,GAChB,OAAOA,EAAM6J,QA4BAiE,EAxBqC,SAAC,GAAuD,IAQtGc,EARiD1E,EAAoD,EAApDA,OAAQ5F,EAA4C,EAA5CA,OAAQiE,EAAoC,EAApCA,SAAU5N,EAA0B,EAA1BA,MAEzEmF,EAAWmN,KAcjB,OAZA4B,qBAAU,WACR/O,GlB0CoC,SAACA,EAAeC,GACtD,GAAI6J,GAAY7J,KACd,OAAOD,EAASgK,WkB3Cf,CAAChK,IAIF8O,GADa,IAAX1E,EACK,cAAC,GAAD,CAAY5F,OAAQA,EAAQiE,SAAUA,KAC3B,IAAX2B,EACA,cAAC,GAAD,IAEA,KAGP,qCACG0E,EACAjU,GAAS,cAAC,GAAD,CAAWzC,KAAMyC,UCkDlBmT,GAxDGC,aAVD,SAAC/N,GAEhB,MAAwBA,EAAMyG,SAE9B,MAAO,CACLlG,MAHF,EAAQA,MAINoG,KAJF,EAAeA,QAgEFmH,EAvDiD,SAACvS,GAE/D,IAAMuE,EAAWmN,KAEjB4B,qBAAU,WACR/O,EAAS0G,QACR,CAAC1G,IAEJ,IAcQnH,EAAkD4C,EAAlD5C,GAAIgO,EAA8CpL,EAA9CoL,KAAMsB,EAAwC1M,EAAxC0M,aAAc6G,EAA0BvT,EAA1BuT,SAAUjW,EAAgB0C,EAAhB1C,MAAOJ,EAAS8C,EAAT9C,KAE7CsW,EAAe,GACnB,IAAK,IAAI/Q,KAAS2I,EAAM,CAEtB,IAAIK,EACF,0BAAsBgI,MAAOhR,EAA7B,SACG2I,EAAK3I,GAAO3C,KAAI,SAAC+G,GAAD,OACf,wBAAsBtI,MAAOsI,EAAK6D,KAAlC,SACG7D,EAAKF,MADKE,EAAKzJ,QAFPqF,GAQjB+Q,EAAa9H,KAAKD,GAGpB,OACE,eAACxE,EAAA,EAAKyM,OAAN,CACErV,SAjC0D,SAACF,GAE7D,IAAQ6G,EAAoBhF,EAApBgF,MAAO3G,EAAa2B,EAAb3B,SAEf,GAAIA,EAAU,CACZ,IAAMqM,EAAOvM,EAAEwV,cAAcpV,MACvBqV,EAAM5O,EAAMoK,QAAO,SAAAvI,GAAI,OAAIA,EAAK6D,OAASA,KAC3CkJ,EAAInS,OAAS,EACfpD,EAASF,EAAGyV,EAAI,IAEhBvV,EAASF,EAAG,QAwBdI,MAAOgV,EACPjW,MAAOA,EACPE,UAAU,QACVN,KAAMA,EACNE,GAAIA,EANN,UAQE,wBAAQmB,MAAM,GAAd,SAAkBmO,IACjB8G,QC/BQK,GArCA,WAEb,IAAMtP,EAAWsB,cACXiO,EAAWC,cACXpO,EAAWC,cACX5E,EAASgT,KAAY/U,MAAM0G,EAASG,QAE1CwN,qBAAU,WACR/O,EAAS0G,QACR,CAAC1G,IASJ,OACE,sBAAK/G,UAAU,WAAf,UACE,qBAAKA,UAAU,cAAf,SACE,cAAC,GAAD,MAEF,qBAAKA,UAAU,eAAf,SACE,cAAC,GAAD,CACEJ,GAAG,OACHsP,aAAa,8DACb6G,SAAU3G,OAAO5L,EAAO0B,UAAY,GACpCrE,SAjBgB,SAACF,EAAGI,GAExBuV,EADEvV,EACO,sBAAD,OAAuBA,EAAMmM,MAE5B,MAcLxN,KAAK,a,4BCAA+W,GA5BW,SAAC,GAAsC,IAApCzU,EAAmC,EAAnCA,MAAOyK,EAA4B,EAA5BA,QAE9BiK,EAAQ,GACZ,GAAI1U,EAAQ,IAEV,IADA,IAAI2U,EAAU5U,EAAWC,GAChBsH,EAAI,EAAGA,GAAKqN,EAASrN,IAAK,CACjC,IAAIE,EAAI,wBAAoBiD,EAApB,iBAAoCnD,GACxCnK,OAAY,EAEdA,EADEmK,EAAI,GAAKA,EAAIqN,EACR,SAEAvH,OAAO9F,GAChBoN,EAAMxI,KAAK,cAAC,IAAD,CAAclO,UAAU,MAAMF,MAAO,CAAE0V,OAAQ,OAAS1M,GAAIU,EAA5D,SAAmErK,GAAxDmK,IAI1B,GAAItH,EAAQ,GAAI,CACd,IAAIwH,EAAI,wBAAoBiD,EAApB,kBACRiK,EAAMxI,KAAK,cAAC,IAAD,CAAmBlO,UAAU,MAAMF,MAAO,CAAE0V,OAAQ,OAAS1M,GAAIU,EAAjE,iBAAU,WAGvB,OACE,sBAAMxJ,UAAU,cAAhB,SACG0W,KC6CQ3B,GA3DGC,aAND,SAAC/N,GAChB,MAAO,CACL6J,MAAO7J,EAAM6J,SA+DFiE,EA1DsD,SAAC,GAAmC,IASnG9O,EATkE8B,EAAgC,EAAhCA,KAAM+I,EAA0B,EAA1BA,MAExEtH,EAAI,wBAAoBzB,EAAKnI,IAC7BgX,EAAUC,KAAW,MAAO,MAAO,CACrC,KAAQ9O,EAAK/F,OAAS,IACtB,SAAY+F,EAAKzC,SAAWwL,EAAMtB,SAClC,OAAUzH,EAAK/B,SAIb+B,EAAK9B,WACPA,EAAW,sBAAMjG,UAAU,gBAAhB,qBAGb,IACIkF,EAWAY,EACAC,EAbA+Q,EAAW,6BAAyB/O,EAAK3C,aAGzC2C,EAAK7C,UACPA,EACE,uBAAMlF,UAAU,gBAAhB,UACE,sBAAMA,UAAU,MAAMF,MAAO,CAAE0V,OAAQ,WAAvC,eACA,cAAC,IAAD,CAAcC,IAAI,WAAWzV,UAAU,MAAM8I,GAAIgO,EAAjD,SAAgE/O,EAAK7C,SAA3D,SAOhB,IAAI/F,EAAO4I,EAAK5I,KAgBhB,OAfI4I,EAAKjC,SACPA,EAAS,sBAAM9F,UAAU,MAAhB,mBAEP+H,EAAKhC,OACPA,EAAO,sBAAM/F,UAAU,MAAhB,qBAEgB,QAArB+H,EAAK3C,aAAkD,QAAzBjG,EAAK4X,UAAU,EAAG,GAClD5X,EAAO,QAAUA,EAEK,SAAf4I,EAAK9C,OAA6C,QAAzB9F,EAAK4X,UAAU,EAAG,GAClD5X,EAAO,QAAUA,EAEW,OAArB4I,EAAK3C,aAAiD,OAAzBjG,EAAK4X,UAAU,EAAG,KACtD5X,EAAO,OAASA,GAGhB,sBAAKa,UAAU,aAAf,UACG+H,EAAK/B,QAAU,mBAAGhG,UAAU,uBAAuBgX,cAAY,OAAOlX,MAAO,CAACC,YAAa,SAC5F,cAAC,IAAD,CAAM+I,GAAIU,EAAMxJ,UAAW4W,EAASjB,wBAAyB,CAAEC,OAAQzW,GAAQW,MAAO,CAAEmX,aAAc,cACrGhR,EACD,cAAC,GAAD,CAAOjE,MAAO+F,EAAK/F,MAAOyK,QAAS1E,EAAKnI,KACvCkG,EACAC,EACAb,QC3CQgS,GAnBiB,SAAC,GAAyC,IAAvCzK,EAAsC,EAAtCA,QAAS0K,EAA6B,EAA7BA,SAEpCpQ,EAAWmN,KAMX/U,EAAOgY,EACT,mBAAGnX,UAAU,2BAA2BgX,cAAY,SACpD,mBAAGhX,UAAU,0BAA0BgX,cAAY,SACvD,OACE,qBAAKhX,UAAU,oBAAoBqB,QARrB,WACd0F,EAASH,EAAc6F,EAAS,KAOhC,SACE,+BAAOtN,OCkEE4V,GArEGC,aAND,SAAC/N,GAEhB,MAAO,CACL6J,MAAO7J,EAAM6J,SAwEFiE,EA9D4C,SAAC,GAAqC,IAAnChN,EAAkC,EAAlCA,KAAM0E,EAA4B,EAA5BA,QAE5D1F,EAAWmN,KAEjB,EAAwBlV,mBAAS+I,EAAKpC,SAAtC,mBAAO6F,EAAP,KAAa4L,EAAb,KACMC,EAAaC,sBAAW,sBAAC,4BAAAlT,EAAA,sEACXuH,GAAkBc,EAAS1E,EAAK/F,OADrB,OACvBuV,EADuB,OAE7BH,EAAQG,EAAI/L,MAFiB,2CAG5B,CAACiB,EAAS1E,EAAK/F,QAElB8T,qBAAU,WACJ/N,EAAK/B,QACPqR,MACD,CAACtP,EAAK/B,OAAQqR,IAEjB,IAKIG,EADAC,EAAO,IAAIzN,KAAKwB,GASpB,OANEgM,EADW,eAAThM,EACM,G7ChDL,SAAekM,GACpB,IAAIC,EAAI,IAAI3N,KACZ,OAAO0N,EAAGE,YAAcD,EAAEC,WAAaF,EAAGG,aAAeF,EAAEE,YAAcH,EAAGI,gBAAkBH,EAAEG,c6C+CrFC,CAAMN,GACPO,aAAWxM,EAAM,SAEjBwM,aAAWxM,EAAM,YAGzB,sBAAKxL,UAAU,kBAAf,UACE,qBAAKA,UAAU,aAAf,SACG+H,EAAK9C,QAER,qBAAKjF,UAAU,eAAf,SACG+H,EAAK7C,UAER,sBAAKlF,UAAU,YAAYqB,QArBV,WACnB0F,EAASH,EAAc6F,EAAS1E,EAAK/F,SAoBnC,UACE,mBAAGhC,UAAU,mBAAmBgX,cAAY,OAAOlX,MAAO,CAACC,YAAa,SACxE,+BAAOgI,EAAK/F,WAEd,cAAC,GAAD,CAAayK,QAAS1E,EAAKnI,GAAIuX,SAAUpP,EAAK5B,cAC9C,cAAC,GAAD,CAAe4B,KAAMA,IACrB,sBAAK/H,UAAU,cAAf,UACE,mBAAGgX,cAAY,OAAOhX,UAAU,oBAAoBF,MAAO,CAACC,YAAa,SACxEgI,EAAKzC,UAER,qBAAKtF,UAAU,gBAAf,SACE,sBAAKF,MAAO,CAAEmY,QAAS,QAAvB,UACE,sBAAMjY,UAAU,qBAAhB,SAAsCwX,IACtC,sBAAMxX,UAAU,qBAAhB,SAAsC+H,EAAKvC,gBAG/C,qBAAKxF,UAAU,cAAf,SACE,cAAC,IAAD,CAAM8I,GAAE,wBAAmBsG,OAAOrH,EAAKnI,IAA/B,kBAAoDE,MAAO,CAAEoY,MAAO,UAAWD,QAAS,QAASE,MAAO,OAAQC,UAAW,UAAnI,SACE,mBAAGpY,UAAU,oBAAoBgX,cAAY,mB,UC3BxCP,I,OA3CW,SAAC,GAAuC,IAArCE,EAAoC,EAApCA,QAAS0B,EAA2B,EAA3BA,OAE9BlQ,EAAWC,cACbkQ,EAAWnQ,EAASoQ,SACP,MAAbD,IACFA,EAAW,cAEb,IAEIE,EAFEC,EAAiB,IAAI/U,gBAAgByE,EAASG,QAG9CjB,EAAOoR,EAAe7U,IAAI,QAI9B4U,EAHGnR,EAEa,WAATA,EACO,SAEAyD,SAASzD,EAAM,KAAO,EAJtB,EAOhB,IADA,IAAIqP,EAAQ,GACHpN,EAAI,EAAGA,GAAKqN,EAASrN,IAAK,CACjCmP,EAAeC,IAAI,OAAQtJ,OAAO9F,IAClC,IAAIE,EAAO,IAAM8O,EAAW,IAAMG,EAAezU,WAEjD0S,EAAMxI,KACJ,cAACyK,GAAA,EAAWtY,KAAZ,CAAiBkJ,OAAQiP,IAAgBlP,EAAWE,KAAMA,EAA1D,SACGF,GAD8CA,IAKrD,IAAe,IAAX+O,EAAiB,CACnBI,EAAeC,IAAI,OAAQ,UAC3B,IAAIlP,EAAO,IAAM8O,EAAW,IAAMG,EAAezU,WACjD0S,EAAMxI,KAAK,cAACyK,GAAA,EAAWtY,KAAZ,CAAiBkJ,OAAwB,WAAhBiP,EAAuChP,KAAMA,EAAtE,iBAAuD,WAGpE,OACE,cAACmP,GAAA,EAAD,CAAY7Y,MAAO,CAAE0V,OAAQ,OAA7B,SACGkB,M,mBCuEQkC,I,OAvGgB,SAAC,GAAqF,IAAnFC,EAAkF,EAAlFA,SAAUrY,EAAwE,EAAxEA,YAAasY,EAA2D,EAA3DA,WAAY7S,EAA+C,EAA/CA,SAAUkB,EAAqC,EAArCA,WAAYhI,EAAyB,EAAzBA,KAEnF4H,EAAWmN,KACX6E,EAAcC,mBAsDpB,OACE,gCACE,cAAC1Y,EAAA,EAAD,CACEsI,GAAG,WACHpI,YAAaA,EACbyY,KAAM,GAAIC,KAAM,EAChBnY,MAAO5B,EACP0B,SA5BW,SAACF,GAChBoG,EAAS,CACPxG,KAAMsY,EAAW,QACjBpS,QAAS,CACPtH,KAAMwB,EAAEwV,cAAcpV,UAyBtBL,WApBa,SAACC,GAElB,GAAc,UAAVA,EAAEC,KAAmBD,EAAEwY,QAAS,CAElC,IADA,IAAIC,EAASzY,EAAEwV,cAAckD,cACtBD,GAA2C,SAAjCA,EAAOE,QAAQC,eAC9BH,EAASA,EAAOC,cAEdD,GACFA,EAAOI,cAAc,IAAIC,MAAM,SAAU,CAAEC,YAAY,EAAMC,SAAS,OAatEpF,IAAKwE,EACL/Y,UAAU,sBAEZ,sBAAKA,UAAU,WAAf,UACE,eAAC4Z,GAAA,EAAD,WACE,cAACrE,GAAA,EAAD,CACE7V,KAAK,KACLO,QAAQ,QACRoB,QArEa,SAACV,GAEtBA,EAAE6T,iBAEF,IAGMqF,EAAed,EAAYe,QAE3BC,EAAQF,EAAaG,eACrBC,EAAMJ,EAAaK,aAEnBC,EAAUN,EAAa9Y,MACvBqZ,EAAMD,EAAQlW,OAEdoW,EAXU,SAUKF,EAAQpD,UAAUgD,EAAOE,GAT7B,UAWbK,EAAUH,EAAQpD,UAAU,EAAGgD,GAASM,EAAcF,EAAQpD,UAAUkD,EAAKG,GAEjFrT,EAAS,CACPxG,KAAMsY,EAAW,QACjBpS,QAAS,CACPtH,KAAMmb,MAiDFxa,MAAO,CAAEC,YAAa,OACtBC,UAAU,SALZ,wCAOA,cAACuV,GAAA,EAAD,CACE7V,KAAK,KACLO,QAAQ,QACRsa,SAAUpT,EACV5G,KAAK,SACLP,UAAU,SALZ,SAOGmH,EAAa,2EAAiB,8DAGlC2R,GACC,cAACrP,EAAA,EAAK+Q,MAAN,CACE5a,GAAG,cACHW,KAAK,WACLka,QAASxU,EACTpF,SA7Da,SAACF,GACtBoG,EAASuL,GAAmB3R,EAAEwV,cAAcsE,WA6DpCxE,MAAM,qEACNnW,MAAO,CAAE0V,OAAQ,gCCwEdT,I,OA3JGC,aARD,SAAC/N,GAEhB,MAAO,CACLyG,SAAUzG,EAAMyG,SAChBkG,SAAU3M,EAAM2M,YA+JLmB,EA1JiD,SAAC,GAA2D,IAAD,EAAxDrH,EAAwD,EAAxDA,SAAUkG,EAA8C,EAA9CA,SAAU8G,EAAoC,EAApCA,gBAE/E3T,EAAWmN,KACjB,EAAqClV,mBAAS,MAA9C,mBAAO2b,EAAP,KAAuBC,EAAvB,KAEA,EAA0B5b,mBAAS6b,MAAM,IAAIC,KAAK,KAAlD,mBAAOC,EAAP,KAAcC,EAAd,KAOMC,EAAmB,SAAC3R,GAAD,OAAe,SAAC3I,GACvC,IAAIua,EAAYH,EAAM/S,QACtBkT,EAAU5R,GAAK3I,EAAEG,OAAOC,MACxBia,EAASE,KAmDLC,EAAuB,WAE3BpU,EAASoL,MAELuI,GACFA,KAGAU,EAAa,GACjB,IAAK,IAAInW,KAASyI,EAASE,KACzBwN,EAAWlN,KAAK,wBAAoBnN,MAAOkE,EAAM8N,cAAjC,SAAiD9N,GAApCA,IAG/B,IAAIoW,EAAgB,GAEpB,GAAIzH,EAAS3N,SAAU,CACrBoV,EAAcnN,KAAK,mFAAS,MAC5B,IAAK,IAAI5E,EAAI,EAAGA,GAAK,GAAIA,IACvB+R,EAAcnN,KACZ,eAACzO,EAAA,EAAD,CAAoBC,KAAK,KAAKI,MAAO,CAAEqB,aAAc,MAAOgX,MAAO,QAAnE,UACE,cAAC1Y,EAAA,EAAWuB,KAAZ,CACElB,MAAO,CAAEqY,MAAO,QAChBnY,UAAU,QAFZ,mBAIMsJ,EAJN,OAMA,cAACG,EAAA,EAAK6R,QAAN,CACE/a,KAAK,OACL8U,UAAW,GACXrV,UAAU,QACVe,MAAOga,EAAMzR,EAAI,GACjBzI,SAAUoa,EAAiB3R,EAAI,OAZlBA,IAmBvB,OACE,uBAAMtJ,UAAU,sBAAsBub,SAvFvB,SAAC5a,GAIhB,GAFAA,EAAE6T,iBAEGmG,EAAL,CAKA,IAAI/H,EAAUgB,EAAShB,QACvB,GAAKA,EAKL,GAAKgB,EAASzU,KAAd,CAMA,IAAIqE,EAAS,CACXoP,UACAzT,KAAMyU,EAASzU,KACf+F,QAASyV,EAAe/a,GACxBqF,MAAO0V,EAAe1V,MACtBgB,SAAU2N,EAAS3N,SACnBkN,YAAa,GACbC,UAAW+H,GAGb,GAAIvH,EAAS3N,SAAU,CACrBzC,EAAO2P,YAAc,GACrB,IAAK,IAAI7J,EAAI,EAAGA,GAAK,GAAIA,IAAK,CAC5B,IAAIuI,EAAMkJ,EAAMzR,EAAI,GAChBuI,GACFrO,EAAO2P,YAAYjF,KAAK2D,IAK9B9K,EpB9BgC,SAACvD,GAAD,OAAqC,SAACuD,EAAeC,GACvF,GAZgC,SAACC,GACjC,IAAM2M,EAAW3M,EAAM2M,SACvB,QAAKA,IAGDA,EAASzM,WAOTqU,CAAmBxU,KACrB,OAAOD,EAASyL,GAAahP,KoB4BpBiY,CAAqBjY,SAzB5BuD,EAASkL,GAAkB,wHAL3BlL,EAASkL,GAAkB,0FAN3BlL,EAASkL,GAAkB,kGAkF7B,UACE,sBAAKrS,GAAG,gBAAgBI,UAAU,iBAAlC,UACE,8BAAK,2FACJ4T,EAAShS,OAAS,cAAC,GAAD,CAAWzC,KAAMyU,EAAShS,QAC7C,sBAAK5B,UAAU,WAAWF,MAAO,CAAEqB,aAAc,OAAjD,UACE,cAACsI,EAAA,EAAKyM,OAAN,CACEqE,UAAQ,EACR7a,KAAK,KACLqB,MAAO6S,EAAS3O,MAChBnF,MAAO,CAAEsV,KAAM,YACfpV,UAAU,QALZ,SAOGob,IAEH,cAAC,GAAD,CACExb,GAAG,iBACHsP,aAAa,uCACb6G,SAAQ,UAAEnC,EAAS1O,eAAX,aAAE,EAAkBgI,KAC5BxN,KAAK,KACLI,MAAO,CAAEsV,KAAM,YACfvU,SAtHc,SAACF,EAAQuE,GAC/B0V,EAAW1V,GACX6B,EAASsL,GAAgBnN,UAuHrB,cAACuE,EAAA,EAAK6R,QAAN,CACE/a,KAAK,OACLb,KAAK,KACLqB,MAAO6S,EAAShB,QAChB/R,SAtEgB,SAACF,GACvBoG,EAASqL,GAAgBzR,EAAEG,OAAOC,SAsE5BjB,MAAO,CAAEqB,aAAc,OACvBnB,UAAU,QACVQ,YAAY,2BACZ6U,UAAW,KAEb,cAAC,GAAD,CACE7U,YAAY,yDACZsY,YAAY,EACZ7S,SAAU2N,EAAS3N,SACnB9G,KAAMyU,EAASzU,KACfgI,WAAYyM,EAASzM,WACrB0R,SAAS,iBAGb,cAAC6C,GAAA,EAAD,CAAW1b,UAAU,mBAArB,SACGqb,W,iBC/HMM,I,MAnCoB,SAAC,GAAgE,IAA9DlP,EAA6D,EAA7DA,QAASmP,EAAoD,EAApDA,QAASC,EAA2C,EAA3CA,OAAQC,EAAmC,EAAnCA,OAAQC,EAA2B,EAA3BA,OAEhEhV,EAAWmN,KAKjB,OACE,sBAAKlU,UAAU,uBAAf,UACE,qBAAKA,UAAU,kCAAkCqB,QAASua,EAAS/b,MAAM,oDAAzE,SACE,mBAAGG,UAAU,0BAA0BgX,cAAY,WAErD,qBAAKhX,UAAU,kCAAkCqB,QAASwa,EAAQhc,MAAM,4EAAxE,SACE,mBAAGG,UAAU,mBAAmBgX,cAAY,WAE9C,qBAAKhX,UAAU,kCAAkCqB,QAASya,EAAQjc,MAAM,sEAAxE,SACE,mBAAGG,UAAU,oBAAoBgX,cAAY,WAE/C,qBAAKhX,UAAU,kCAAkCqB,QAAS0a,EAAQlc,MAAM,sEAAxE,SACE,mBAAGG,UAAU,2BAA2BgX,cAAY,WAEtD,sBAAKhX,UAAU,qCAAqCqB,QAlBnC,WACnB0F,EAASH,EAAc6F,EAAS,KAiB9B,UACE,mBAAGzM,UAAU,oBAAoBgX,cAAY,SAC7C,mBAAGhX,UAAU,mBAAmBgX,cAAY,OAAOlX,MAAO,CAACmB,WAAY,aAEzE,qBAAKjB,UAAU,oCAAf,SACE,cAAC,IAAD,CAAM8I,GAAE,wBAAmB2D,EAAnB,kBAAR,SACE,mBAAGzM,UAAU,eAAegX,cAAY,OAAOlX,MAAO,CAACoY,MAAM,gC,oBC+OxD8D,ICtQXC,GDsQWD,GAxRf,SAAmB7c,GAEjB,IA0BI+c,EACAC,EACAC,EA5BEC,EAAW,IAAIC,IACnB,gvDAQGC,MAAM,MAGLC,EAAa,IAAIF,IAAI,oBAAoBC,MAAM,KAI/CE,EAAY,MACZC,EAAa,OACbC,EAAc,OAKdC,EAAuB,OAOzBC,GAAU,EACVC,EAAQ,GAEZ,SAASC,EAAaC,GACpB,MAAyB,KAAlBA,EAAOhM,OAGhB,SAASiM,EAAKD,EAAgBE,EAAaC,GACzC,OAAOH,EAAOjG,UAAUmG,EAAM,EAAGA,EAAK,EAAIC,GAG5C,SAASC,EAAKJ,EAAgBG,GAC5B,OAAOH,EAAOjG,UAAUiG,EAAO/Y,OAASkZ,GAG1C,SAASE,EAAUC,GACjB,OAAOjB,EAASkB,IAAID,EAAMvK,cAAc/B,QAG1C,SAASwM,EAAsBC,EAAeC,GAE9B,MAAVD,GAAiBrB,IAAkBsB,EACrCxB,GAAoCuB,GAEhCtB,IACFD,GAzCY,UA0CZC,GAAiB,GAGnBD,EAAkBA,EA9CH,eA8CkCwB,EAAOD,EACxDtB,GAAiB,EACjBC,EAAgBsB,GAIpB,SAASC,EAAkBC,GAGzB,IAAIC,GAAgB,EAChBC,GAAgB,EAChBC,EAAe,EACfC,GAAe,EAIfC,EAAM,EACV,IAAKA,EAAM,EAAGA,GAAOL,EAAW3Z,OAAQga,IAAO,CAE7C,IAAIC,EAAgBN,EAAWO,OAAOF,EAAM,GAC5C,GAAIpB,EAGoB,MAAlBqB,GAEFV,EAAsBP,EAAKW,EAAYG,EAAcE,EAAMF,EAAe,GAAIpB,GAC9EE,GAAU,EACVC,EAAQ,GACRkB,GAAe,GAEflB,GAAgBoB,OAGb,GAAIL,EAGa,MAAlBK,GAEFV,EAAsBP,EAAKW,EAAYG,EAAcE,EAAMF,EAAe,GAAIpB,GAC9EkB,GAAgB,EAChBf,EAAQ,GACRkB,GAAe,GAEflB,GAAgBoB,OAGb,GAAsB,MAAlBA,EAEJnB,EAAaD,GAkBhBZ,GAAoC,KAfhC4B,GACFN,EAAsBV,EAAQ,IAAKH,GACnCmB,GAAgB,GAEPT,EAAUP,EAAM9L,QACzBwM,EAAsBV,EAAQ,IAAKF,GAEzBwB,MAAMtT,SAASgS,EAAO,KAIhCU,EAAsBV,EAAQ,IAAKL,GAHnCe,EAAsBV,EAAQ,IAAKJ,GAKrCI,EAAQ,IAIVkB,GAAe,OAEV,GAAIxB,EAAWe,IAAIW,GAAgB,CA6BxC,GA1BKnB,EAAaD,KAGZgB,GAEFN,EAAsBV,EAAOH,GAC7BmB,GAAgB,EAChBE,EAAkC,MAAlBE,GAEPF,GAAgBX,EAAUP,IACnCU,EAAsBV,EAAOF,GAC7BoB,EAAkC,MAAlBE,IAIXE,MAAMtT,SAASgS,EAAO,KAIzBU,EAAsBV,EAAOL,GAH7Be,EAAsBV,EAAOJ,GAK/BsB,EAAkC,MAAlBE,GAElBpB,EAAQ,IAGY,MAAlBoB,GAAyB9B,IAAkBM,EAAY,CAEzDc,EAAsBU,EAAexB,GACrC,SAEK,GAAsB,MAAlBwB,GAA0D,MAAjCjB,EAAKW,EAAYK,EAAM,EAAG,GAE5D7B,OAAgBvY,OAEX,GAAsB,MAAlBqa,GAA0D,MAAjCjB,EAAKW,EAAYK,EAAM,EAAG,GAG5D,YADAT,EAAsBJ,EAAKQ,EAAYA,EAAW3Z,OAASga,EAAM,GArJhD,QAwJnBT,EAAsBU,EAvJH,YAyJd,GAAsB,MAAlBA,GAA2C,MAAlBA,EAI9BnB,EAAaD,IACfiB,EAAeE,EACfpB,GAAU,IAGVW,EAAsBV,EAAQoB,EAAevB,GAC7CG,EAAQ,IAEVkB,GAAe,OAEV,GAAsB,MAAlBE,EAILnB,EAAaD,IACfiB,EAAeE,EACfJ,GAAgB,IAGhBL,EAAsBV,EAAQoB,EAAevB,GAC7CG,EAAQ,IAEVkB,GAAe,MAEV,IAAsB,MAAlBE,GAA4C,MAAlBA,GAAyBnB,EAAab,GAAmB,CAG5FsB,EAAsBJ,EAAKQ,EAAYA,EAAW3Z,OAASga,EAAM,GAvL5C,OAwLrBA,EAAML,EAAW3Z,OACjB,MAE2B,MAAlBia,GACTpB,GAAgBoB,EAChBJ,GAAgB,GAGhBhB,GAAgBoB,GAIhBrB,GAKOgB,EAFTL,EAAsBP,EAAKW,EAAYG,EAAcE,EAAMF,EAAe,GAAIpB,GAOpEI,EAAaD,KAGnBO,EAAUP,GACZU,EAAsBV,EAAOF,GAEnBwB,MAAMtT,SAASgS,EAAO,KAIhCU,EAAsBV,EAAOL,GAH7Be,EAAsBV,EAAOJ,IAUnCG,GAAU,EACVC,EAAQ,GACRX,GAAiB,EACjBC,OAAgBvY,EAChBqY,EAAkB,GAElB,IA7PuC,EA6PnCrR,EAAS,GA7P0B,cA+PhB1L,EAAKod,MAAM,OA/PK,IA+PvC,2BAAyC,CAAC,IAAjCqB,EAAgC,QAEnCb,EAAaa,GACf/S,EAAOqD,KAAK,KAIdgO,EAAkB,GAClByB,EAAkBC,GACdzB,IAAmBU,GACrBX,GAAmB,UACnBC,GAAiB,EACjBC,EAAgB,GAChBU,EAAQ,IACED,IACVT,EAAgB,GAChBU,EAAQ,IAGVjS,EAAOqD,KAAKgO,KAlRyB,8BAqRvC,OAAOrR,EAAOwT,KAAK,OElMNC,I,OAzDE,SAAC,GAAgC,IAA9Bjc,EAA6B,EAA7BA,SAElB,EAA4BrD,oBAAS,GAArC,mBAAOuf,EAAP,KAAeC,EAAf,KAEIrf,EAAe,GACfkD,IAKFlD,EAhCgB,SAACA,GAWnB,IARA,IAAIsf,EAAUtf,EACXuC,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MACnBA,QAAQ,QAAS,MAGE,OAAf+c,EAAQ,IACbA,EAAUA,EAAQ1H,UAAU,GAG9B,KAAiD,OAA1C0H,EAAQ1H,UAAU0H,EAAQxa,OAAS,IACxCwa,EAAUA,EAAQ1H,UAAU,EAAG0H,EAAQxa,OAAS,GAGlD,OAAO+X,GAAUyC,GAaRC,CAFPvf,EADgBiD,EAAeC,GAChBgc,KAAK,MAKtB,IAIIM,EACAC,EAAa,EACbzf,IACFyf,EAAazf,EAAKod,MAAM,MAAMtY,QAG9B0a,EADEJ,EACQ,4DAAgBK,EAAhB,mCAEG,uCAEf,IAAIC,EAAkC,KAClCD,EAAa,IACfC,EACE,qBAAK7e,UAAU,oBAAf,SACE,sBAAMA,UAAU,qBAAqBqB,QAlBvB,WAClBmd,GAAWD,IAiBP,SAA4DI,OAIlE,IAAIG,EAAgC,GAWpC,OARIP,GAAUK,EAAa,GACzBE,EAASC,SAAW,SACpBD,EAASE,OAAS,UAElBF,EAASC,SAAW,OACpBD,EAASE,OAAS,QAIlB,sBAAKlf,MAAO,CAAEoB,UAAW,OAAzB,UACE,qBAAKlB,UAAU,WAAWF,MAAOgf,EAAUnJ,wBAAyB,CAAEC,OAAQzW,KAE7E0f,O,oCC6DQ9J,GA5GGC,aAbD,SAAC/N,GAEhB,MAEIA,EAAMsF,MAEV,MAAO,CACL/E,MALF,EACEA,MAKAiD,KANF,EACSA,KAMPkE,aAAc1H,EAAM9C,QAAQqD,MAAd,gBAgHHuN,C,oDAvGb,WAAYvS,GAAQ,IAAD,wBACjB,cAAMA,IAHRyc,WAEmB,IA+BnBC,YAAc,SAACve,GACbA,EAAEwe,UACF,IAAQxQ,EAAiB,EAAKnM,MAAtBmM,aACR,EAAKsQ,MAAQ1f,OAAO6f,YAAW,kBAAM,EAAKC,YAAY1e,MAAKgO,IAlC1C,EAqCnBtN,QAAU,SAACV,GACTA,EAAE2e,kBACFC,aAAa,EAAKN,OAClB,EAAKI,YAAY1e,IAxCA,EA2CnB6e,WAAa,WACXD,aAAa,EAAKN,QA5CD,EA+CnBI,YAAc,SAAC1e,GACb,MAAsC,EAAK6B,MAAnCiK,EAAR,EAAQA,QAAShK,EAAjB,EAAiBA,QAWjBsE,EAXA,EAAyBA,U7BlEF,SAACsK,EAAoBC,GAArB,8CAA8C,WAAOvK,GAAP,SAAA3C,EAAA,sDACvE2C,EAASqK,GAAcC,EAAMC,IAD0C,2CAA9C,sD6B6EdmO,CAJkB,CACzBhT,SAAUA,EACVhK,QAASA,GAPI,CACbkI,EAAGhK,EAAE+e,MACLC,EAAGhf,EAAEif,MAAQ,OAjDf,MAA6B,EAAKpd,MAA1BH,EAAR,EAAQA,SAAUI,EAAlB,EAAkBA,OAHD,OAKf,EAAKwE,MADH5E,EACW,CAAElD,KAAMiD,EAAeC,GAAUgc,KAAK,KAEtC,CAAElf,KAAMiQ,OAAO3M,IAPb,E,qEAUnB,SAAiCD,GAC1BA,EAAMH,UACTwd,KAAKC,SAAS,CAAE3gB,KAAMiQ,OAAO5M,EAAMC,Y,+BAIvC,WAAqB,IAAD,OAEdod,KAAK5Y,MAAM9H,KAAK4gB,WAAW,SAG7B1U,IADoBwU,KAAKrd,MAAjBiK,SAELuT,MAAK,SAAAzb,GACJ,EAAKub,SAAS,CACZ3gB,KAAMoF,EAAS1E,a,oBAyCzB,WAEE,MAAyCggB,KAAKrd,MAAtCiK,EAAR,EAAQA,QAAShK,EAAjB,EAAiBA,OAAQ3C,EAAzB,EAAyBA,MAAO2K,EAAhC,EAAgCA,KAC1BpD,EAAOtF,EAAWU,GAEpBwd,EAAY,GA6BhB,OA5BI5Y,EAAO,IACT4Y,EAAS,gBAAY5Y,IAGlBoD,IAAUgC,IAAYhC,EAAK7K,KAASwe,OAAOyB,KAAK5Y,MAAM9H,MAEvD,sBACE+f,YAAaW,KAAKX,YAClBM,WAAYK,KAAKL,WACjBne,QAASwe,KAAKxe,QACdrB,UAAU,OACVF,MAAK,gBAAOA,GALd,SAME+f,KAAK5Y,MAAM9H,OAIb,iCACE,mBAAGqK,KAAI,yBAAoBiD,GAApB,OAA8BwT,EAA9B,YAA2Cxd,GAChD3C,MAAK,gBAAOA,GADd,SAEE+f,KAAK5Y,MAAM9H,OAAU,IAHzB,IAIa,sBAAM+f,YAAaW,KAAKX,YACjCM,WAAYK,KAAKL,WACjBne,QAASwe,KAAKxe,QACdrB,UAAU,OAHD,SAITyC,IARJ,W,GA3FiByd,c,oBCrBVC,GAJgB,SAAC,GAAsC,IAApC3W,EAAmC,EAAnCA,KAAMnH,EAA6B,EAA7BA,SACtC,OAAO,mBAAGmH,KAAMA,EAAMxJ,UAAU,kBAAzB,SAA4CqC,KCD/C+d,GAAa,SAAC5W,GAElB,IAAI6W,EAAW7W,GACc,IAAzBA,EAAKlB,OAAO,UAAgB+X,EAAW,UAAYA,GAEvD,IACE,IAAI/gB,EAAM,IAAIghB,IAAID,GAClB,MAAO1f,GACP,OAAO,KAGT,OAAwC,IAApCrB,EAAIihB,SAASjY,OAAO,WACfhJ,EAAImE,aAAaG,IAAI,MAEmB,IAAtCtE,EAAIihB,SAASjY,OAAO,aACtBhJ,EAAIiZ,SAASxB,UAAU,GAGzB,MAGHyJ,GAAc,uCAAG,WAAOC,GAAP,yBAAArc,EAAA,6DAEfsc,EAAS/d,aAAaC,QAAQ,kBAAoB,0CACpD+d,EAHiB,2DAG4CD,EAH5C,yDAGmGD,GAHnG,SAIE1b,MAAM4b,GAJR,cAIfpc,EAJe,gBAKFA,EAASC,OALP,cAKfA,EALe,OAOjB3E,EAAQ2E,EAAKgD,MAAM,GAAGoZ,QAAQ/gB,MAC9BghB,EAAWhhB,EACC,GACZA,EAAMoE,OAASoR,KACjBwL,EAAWA,EAAS9J,UAAU,EAFhB,IAEgC,OAX3B,kBAad,CACL8J,WACAhhB,UAfmB,4CAAH,sDAsDLihB,GAnCiB,SAAC,GAA4B,IAA1BtX,EAAyB,EAAzBA,KAEjC,EAAwBxK,mBAAS,CAC/B6hB,SAAUrX,EACV3J,MAAO,KAFT,mBAAKoH,EAAL,KAAY6Y,EAAZ,KAKAhK,qBAAU,YAEC,uCAAG,8BAAA1R,EAAA,yDAEJqc,EAAUL,GAAW5W,GAFjB,0EAOagX,GAAeC,GAP5B,OAOFjd,EAPE,OAQRsc,EAAS,gBACJtc,IATG,kDAaR7B,QAAQC,MAAM,UAAW,KAAEC,SAbnB,0DAAH,qDAiBTkf,KACC,CAACvX,IAGJ,OACE,mBAAGA,KAAMA,EAAM3J,MAAOoH,EAAMpH,MAA5B,mBAFa,UAEb,aAAkDoH,EAAM4Z,aCqF7C9L,GAhFGC,aAfD,SAAC/N,GAEhB,MAIIA,EAAM9C,QAAQqD,MAElB,MAAO,CACLoH,sBAPF,EACEA,sBAOAC,oBARF,EAEEA,oBAOAC,eATF,EAGEA,kBA0FWiG,EA/EmD,SAACvS,GAEjE,IAAQgH,EACyDhH,EADzDgH,KAAMnH,EACmDG,EADnDH,SAAU2e,EACyCxe,EADzCwe,WACtBpS,EAA+DpM,EAA/DoM,sBAAuBC,EAAwCrM,EAAxCqM,oBAAqBC,EAAmBtM,EAAnBsM,eAE9C,IACE,IAAIxP,EAAM,IAAIghB,KAAI9W,GAAM,GACxB,MAAO7I,GAEP,OADAgB,QAAQC,MAAOjB,EAAYkB,QAAS2H,GAC7B,mBAAGA,KAAMA,EAAT,SAAgBA,IAGzB,IA3CiB+W,EA2CbU,EAAUzX,EAOd,GANIyX,EAAQlB,WAAW,OACrBzgB,EAAIoZ,IAAI,WAAY,SACpBpZ,EAAIoZ,IAAI,WAAY,kBACpBuI,EAAU3hB,EAAIkK,OAGgC,IAA5ClK,EAAIihB,SAASjY,OAAO,mBAA2B,CAEjD,GAAqB,eAAjBhJ,EAAIiZ,SACN,OACE,cAAC,GAAD,CAAY9L,QAASnN,EAAI4hB,MAAMthB,GAAI6C,OAAQnD,EAAImS,KAAK/P,QAAQ,IAAK,KAAO,IAAxE,SACGU,EAAeC,KAGf,GAAqB,eAAjB/C,EAAIiZ,SACb,OACE,cAAC,GAAD,CAAY/O,KAAMlK,EAAIkK,KAAtB,SACGnH,IAKP,GAAqB,yBAAjB/C,EAAIihB,UACW,kBAAjBjhB,EAAIiZ,UAEkC,IAAlCnO,OAAOiH,KAAK/R,EAAI4hB,OAAOjd,QAGJ,4BADrB3E,EAAM,IAAIghB,KAAI9W,EAAK9H,QAAQ,MAAO,KAAK,IAC/B6W,SACN,OACE,cAAC,GAAD,CAAY9L,QAASnN,EAAI4hB,MAAMthB,GAAI6C,OAAQnD,EAAImS,KAAK/P,QAAQ,IAAK,KAAO,IAAxE,SACGU,EAAeC,KAO5B,MAA8B,SAA1BuM,IAjFgC,KADnB2R,EAmFDjhB,EAAIihB,UAlFPjY,OAAO,aACmB,IAAlCiY,EAASjY,OAAO,aAoFO,SAAxBuG,GA9EiB,SAAC0R,GACtB,OAA2C,IAAvCA,EAASjY,OAAO,kBA8Ed6Y,CAAe7hB,EAAIihB,WACrBjhB,EAAIoZ,IAAI,WAAY,gBAGlB,oBAAG5X,OAAQ0B,EAAM1B,OACfd,UAAWwC,EAAM4e,MACjB3L,IAAKjT,EAAMiT,IACXjM,KAAMlK,EAAIkK,KAHZ,UAGoBlK,EAAIkK,KAHxB,SAOiB,SAAnBsF,GAA6BkS,IAC/BC,EAhIkB,SAACzX,EAAcwX,GACnC,IAAIK,EAAc7X,EACf9H,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,KACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OAElB,IACE,IAAI4f,EAAS,IAAIC,OAAOF,EAAc,6EAClCjL,EAAM4K,EAAWQ,MAAMF,GAC3B,GAAIlL,GAAOA,EAAInS,OAAS,EACtB,MAAe,MAAXmS,EAAI,KAAsC,IAAxB5M,EAAKlB,OAAO,OACzBkB,EAETA,GAAc4M,EAAI,GAGpB,MAAOzV,GACPgB,QAAQC,MAAMjB,GAEhB,OAAO6I,EAsGKiY,CAAcR,EAASD,IAIjC,mBAAGlgB,OAAQ0B,EAAM1B,OACfd,UAAWwC,EAAM4e,MACjB3L,IAAKjT,EAAMiT,IACXjM,KAAMyX,EAHR,SAGmB5e,KAtBV,cAAC,GAAD,CAAamH,KAAMA,O,SCxFjBkY,GAnCc,SAAC,GAAuD,IAArDjV,EAAoD,EAApDA,QAAS1E,EAA2C,EAA3CA,KAAM4Z,EAAqC,EAArCA,MAAOrW,EAA8B,EAA9BA,EAAGsW,EAA2B,EAA3BA,OAEjDC,EAAG,UAAMnf,EAAN,sBAA0B4I,EAA1B,QAELwW,EAAU,EAEVH,IACFG,EAAU7f,KAAKgR,MAAM,IAAMlL,EAAK/F,MAAQ2f,IAK1C,OACE,sBAAK3hB,UAAU,cAAf,UACE,qBAAKA,UAAU,eAAf,SACE,mBAAGyV,IAAI,WAAW3V,MAAO,CAAEiiB,eAAgB,QAAUvY,KAAI,yBAAoBiD,EAApB,gBAAmCnB,GAA5F,SACE,4BAAG,sBAAMxL,MAAO,CAAEoY,MAAO0J,EAAOtW,EAAI,IAAjC,mBAA2CA,EAA3C,aAAiDvD,EAAK5I,cAG7D,qBAAKa,UAAU,oBAAf,SAEE,4BAAG,sBAAMF,MAAO,CAAEoY,MAAO0J,EAAOtW,EAAI,IAAjC,mBAA2CwW,EAA3C,cAAwD/Z,EAAK/F,MAA7D,WAGL,qBAAKhC,UAAU,aAAf,SACE,qBAAKF,MAAO,CAAEqY,MAAM,GAAD,OAAK2J,EAAL,MAAnB,SACE,mBAAGtY,KAAMqY,EAAT,SACE,qBAAKG,IAAKH,EAAK/hB,MAjBR,CAAEmiB,UAAW,QAAS9J,MAAO,OAAQ6G,OAAQ,QAiBpBkD,IAAG,gBAAM5W,eCnBtC6W,GAXe,SAAC,GAA8C,IAA5C3a,EAA2C,EAA3CA,MAAOiF,EAAoC,EAApCA,QAASmV,EAA2B,EAA3BA,OAE3CD,EAAQ1f,KAAKmgB,IAAL,MAAAngB,KAAI,aAAQuF,EAAMlF,KAAI,SAAA+G,GAAI,OAAIA,EAAKrH,WAE/C,OACE,qBAAKlC,MAAO,CAAEqB,aAAc,QAA5B,SACGqG,EAAMoK,QAAO,SAAAvI,GAAI,OAAIA,EAAKlK,QAAMmD,KAAI,SAACyF,EAAMuB,GAAP,OAAa,cAAC,GAAD,CAAkBvB,KAAMA,EAAM4Z,MAAOA,EAAOrW,EAAGhC,EAAI,EAAGmD,QAASA,EAASmV,OAAQA,GAAjEtY,SCCxD+Y,GATU,SAAC,GAAuC,IAArCT,EAAoC,EAApCA,OAAQtW,EAA4B,EAA5BA,EAAGnM,EAAyB,EAAzBA,KAErC,OACE,qBAAKW,MAAO,CAAEoB,UAAW,OAAzB,SACE,4BAAG,sBAAMpB,MAAO,CAAEoY,MAAO0J,EAAOtW,EAAI,IAAjC,mBAA2CA,EAA3C,aAAiDnM,UC8G3C4V,GAvDGC,aAVD,SAAC/N,GAIhB,MAAO,CACLwD,KAHexD,EAAMsF,MAAf9B,KAIN2D,WAAYnH,EAAM9C,QAAQiK,WAC1BM,aAAczH,EAAM9C,QAAQqD,MAAd,gBA0DHuN,EArDb,SAAC,GAAuE,IAArEtI,EAAoE,EAApEA,QAASnB,EAA2D,EAA3DA,EAAGgX,EAAwD,EAAxDA,KAAM7W,EAAkD,EAAlDA,KAAMhB,EAA4C,EAA5CA,KAAM3K,EAAsC,EAAtCA,MAAOsO,EAA+B,EAA/BA,WAEtC,GAAI3C,GAAQhB,EAAKC,QAAU+B,IAAYhC,EAAK7K,GAC1C,IAAI2iB,EAAY9X,EAAKC,OAAOe,EAAO,GAAGtM,UAEtCojB,EAAY,KAEd,MAAgCvjB,mBAASujB,GAAzC,mBAAOC,EAAP,KAAiBC,EAAjB,KAEMC,EAAW,uCAAG,4BAAAte,EAAA,+EAEIiH,GAAeoB,GAFnB,OAEVkW,EAFU,OAGhBF,EAAYE,EAAMjY,OAAOe,EAAO,GAAGtM,MAHnB,gDAKhBwC,QAAQC,MAAM,KAAEC,SALA,yDAAH,qDASjBiU,qBAAU,WACJrK,EACI8W,GACJG,IAEEF,GACFC,EAAY,QAEf,CAAChX,IAEJ,IACImX,EADEC,EAAqB,IAATpX,GAA6B,OAAb+W,EAExB,IAANlX,GAAWb,EAAKxE,UAAYwE,EAAKC,SACnCkY,EAAY,cAAC,GAAD,CAAWpb,MAAOiD,EAAKC,OAAQ+B,QAASA,EAASmV,OAAQxT,KAGvE,IAAI0U,EA1DY,SAAC3jB,EAAcsN,GAEjC,IAAKtN,EACH,OAAOA,EAET,IAAIsf,EAlBgB,SAACtf,GAGrB,OAAOA,EAAKuC,QADG,qDACa,SAACqhB,GAC3B,IAAIC,EAAG,wCAKP,MAFyB,SAArBA,EAAIC,OAAO,EAAG,KAChBD,EAAMA,EAAIC,OAAO,IACb,SAAN,OAAgBD,EAAhB,cASYE,CAAc/jB,GAG5B,OA9B0B,SAACA,EAAcsN,GAGzC,OAAOtN,EAAKuC,QADG,mBACa,SAACqhB,GAC3B,IAAMtgB,EAAM,wCACZ,MAAM,wBAAN,OAA+BgK,EAA/B,0BAAwDhK,EAAxD,kBAuBQ0gB,CAAoB1E,EAAShS,GAoDjB2W,CAAYd,EAAM7V,GAChC4W,EAAgB,CACpBja,KAAM,SAAC5G,GAAD,OAAgB,cAAC,GAAD,CAAYiK,QAASjK,EAAM,gBAAiBC,OAAQD,EAAM,gBAAqBA,EAAM5B,MAC3GsM,KAAM,SAAC1K,GAAD,OAAgB,cAAC,GAAD,gBAAUA,KAChC4B,EAAG,SAAC5B,GAAD,OAAgB,cAAC,GAAD,6BAAgBA,GAAhB,IAAuBwe,WAAY8B,OAElDQ,EAAgBC,KAAWT,EAAeO,GAEhD,OACE,sBAAKrjB,UAAU,UAAUF,MAAOA,EAAhC,UACG8iB,EACD,8BACGU,IAEFT,GAAY,cAAC,GAAD,CAAM1jB,KAAMqjB,EAAUlX,EAAGG,EAAMmW,OAAQxT,UCzB7CoV,GA5Ec,SAAChhB,GAE5B,IAAMuE,EAAWmN,KAEjB,EAAoClV,mBAAS,QAA7C,mBAAOykB,EAAP,KAAmBC,EAAnB,KAmBQ3b,EAAqCvF,EAArCuF,KAAM4b,EAA+BnhB,EAA/BmhB,SAAUC,EAAqBphB,EAArBohB,MAAOC,EAAcrhB,EAAdqhB,UAC/B/N,qBAAU,WACR4N,EAAc,UACb,CAAC3b,EAAKuD,IAET,IACIwY,EADEta,EAAI,UAAM9G,EAAN,yBAA6BqF,EAAKwD,QAK1CuY,EAHG/b,EAEiB,IAAXA,EAAKuD,EACJ0M,aAAW,IAAIhO,KAAKjC,EAAKyD,MAAO,oBAGxC,qCACE,sBAAMxL,UAAU,iBAAhB,SAAkC+H,EAAKuD,IAAU,MAAQ0M,aAAW,IAAIhO,KAAKjC,EAAKyD,MAAO,uBANnF,GAWZ,IAKIuY,EAQAC,EAbEC,EAAiBpN,KAAW,kBAAmB,CACnD,YAAa8M,EACb,SAAUC,IAsBZ,OAlBIrkB,OAAO2kB,WAAa,QACtBH,EAAU,qBAAK/B,IAAG,UAAKtf,EAAL,2BAA8BqF,EAAKwD,OAAnC,cAChB2W,IAAI,WACJiC,OApCgB,WAClBT,EAAc,WAoCZU,QAjCiB,WACnBV,EAAc,SAiCZ5jB,MAAO,CAAEmY,QAASwL,EAAYtiB,aAAc,MAAOpB,YAAa,UAIlEikB,EADEH,EACS,qBAAK7jB,UAAU,KAAKF,MAAO,CAAEmY,QAAS,eAAgBhX,WAAY,OAAlE,SAA4E6iB,IAGrF,sBAAK9jB,UAAU,eAAf,UACE,sBAAMA,UAAU,KAAhB,SAAuB8jB,IACvB,wBAAQ9jB,UAAU,YAAYqB,QAxDpB,WACd,IAAQ0G,EAASvF,EAATuF,KACRhB,EAAS2M,GAAe,IAAD,OAAK3L,EAAKuD,EAAV,OAEvB,IAAIuK,EAAOwO,SAASC,eAAe,gBAC/BzO,GACFtW,OAAOglB,SAAS,EAAG1O,EAAK2O,YAkDtB,SAAiDV,OAKrD,sBAAK9jB,UAAU,YAAf,UACG+jB,EACD,mBAAG/jB,UAAWikB,EAAgBza,KAAMA,EAApC,SAA2CzB,EAAKtC,OAC/Cue,MCfQS,GArDoB,SAAC,GAAsE,IAApEhY,EAAmE,EAAnEA,QAASnB,EAA0D,EAA1DA,EAAGhG,EAAuD,EAAvDA,OAAQof,EAA+C,EAA/CA,aAAcC,EAAiC,EAAjCA,aAEtE,EAAwB3lB,mBAA+B,MAAvD,mBAAO+I,EAAP,KAAa6c,EAAb,KACA,EAA0B5lB,mBAAwB,MAAlD,mBAAO4C,EAAP,KAAcijB,EAAd,KA0BA,OAxBA/O,qBAAU,YAEK,uCAAG,4BAAA1R,EAAA,+EAEQuH,GAAkBc,EAASnB,GAFnC,QAENwZ,EAFM,SAIVF,EAAQE,GACRD,EAAS,MACLF,GAAcA,MAElBC,EAAQ,MACRC,EAAS,kHAAD,OAAyBvZ,KATvB,gDAYZsZ,EAAQ,MACRC,EAAS,KAAahjB,SAbV,yDAAH,qDAkBbkjB,KAEC,CAACtY,EAASnB,EAAGqZ,IAEX5c,GAASnG,EAIZ,qCACGmG,GACC,sBAAK/H,UAAU,kBAAf,UACE,qBAAKA,UAAU,yBAAf,SACE,cAAC,GAAD,CAAU+H,KAAMA,EAAM4b,SAAU5b,EAAKtC,OAASH,EAAQse,MAAO7b,EAAKwD,SAAWmZ,EAAcb,WAAS,MAEtG,cAAC,GAAD,CACEpX,QAASA,EACTnB,EAAGA,EACHvD,KAAMA,EACNua,KAAMva,EAAK5I,KACXsM,KAAM1D,EAAK0D,KACX3L,MAAO,CAAEklB,UAAW,OAAQ/N,aAAc,mBAG/CrV,GAAS,+BAAOA,OAlBZ,MCyFIqjB,GA1HkB,SAAC,GAAuE,IAArExY,EAAoE,EAApEA,QAASyY,EAA2D,EAA3DA,iBAAkB5f,EAAyC,EAAzCA,OAAQof,EAAiC,EAAjCA,aAErE,EAA4B1lB,mBAAS,GAArC,mBAAOmmB,EAAP,KAAeC,EAAf,KACA,EAA8BpmB,mBAAS,QAAvC,mBAAOiZ,EAAP,KAAgBoN,EAAhB,KACA,EAA0BrmB,mBAAS,CACjC6H,UAAWqe,EACXtkB,IAAK,IAFP,mBAAOqG,EAAP,KAAc6Y,EAAd,KA2BMwF,EAAW,uCAAG,4BAAAlhB,EAAA,sEACCiH,GAAeoB,GADhB,OACZhC,EADY,OAElBqV,EAAS,CACPjZ,UAAW4D,EAAKzI,MAChBpB,IAAKqG,EAAMrG,MAJK,2CAAH,qDAiCX2kB,EAAYC,wBAAa,CAC7BC,UA1BgB,SAACC,GACbzjB,KAAK0jB,IAAID,EAAUP,QAAU,GAC/BC,EAAU,GAEVA,EAAUM,EAAUP,SAuBtBS,SApBe,SAACF,GAEZzjB,KAAK0jB,IAAID,EAAUP,QAAU,MACT,SAAlBO,EAAUG,IACZ/F,EAAS,CACPjZ,UAAWI,EAAMJ,UAAY,EAC7BjG,IAAKqG,EAAMrG,IAAM,IAEQ,UAAlB8kB,EAAUG,KAAmB5e,EAAMJ,UAAY,GACxDiZ,EAAS,CACPjZ,UAAWI,EAAMJ,UAAY,EAC7BjG,IAAKqG,EAAMrG,IAAM,KAIvBwkB,EAAU,IAMVU,MAAO,KAOLte,EAAQ,CAACP,EAAMJ,WAEfse,EAAS,EACX3d,EAAM0G,KAAKjH,EAAMJ,UAAY,GACtBse,EAAS,GAAKle,EAAMJ,UAAY,GACvCW,EAAM0G,KAAKjH,EAAMJ,UAAY,GAE/B,IAAM/G,EAA6B,CACjCimB,UAAU,eAAD,OAAiBZ,EAAjB,iBACTa,cAAeb,EAAS,EAAI,cAAgB,OAG9C,OACE,qBAAKnlB,UAAU,oBAAoBF,MAAO,CAAEmY,WAA5C,SACE,sBAAKjY,UAAU,gBAAf,UACE,cAAC,GAAD,CACEyM,QAASA,EACTmP,QAlFa,WACnBkE,EAAS,CACPjZ,UAAW,EACXjG,IAAKqG,EAAMrG,OAgFPmb,OAAQuJ,EACRxJ,OA7EY,WAClBgE,EAAS,CACPjZ,UAAWI,EAAMJ,UAAY,EAC7BjG,IAAKqG,EAAMrG,OA2EPib,OAvEY,WACd5U,EAAMJ,UAAY,GACpBiZ,EAAS,CACPjZ,UAAWI,EAAMJ,UAAY,EAC7BjG,IAAKqG,EAAMrG,SAqEX,gDAAKZ,UAAU,oBAAuBulB,GAAtC,IAAiDzlB,MAAOA,EAAxD,UACE,qBAAKE,UAAU,wBAAwCF,MAAO,CAAEmmB,MAAO,GAAvE,SACE,cAAC,GAAD,CACExZ,QAASA,EACTnB,EAAG9D,EAAM,GACTkd,aAAcA,EACdpf,OAAQA,EACRqf,aAjCY,WACtBU,EAAW,aA0BuCpe,EAAMrG,KASjD4G,EAAMvD,OAAS,GACd,qBAAKjE,UAAU,wBAA4CF,MAAO,CAAEmmB,MAAO,GAA3E,SACE,cAAC,GAAD,CACExZ,QAASA,EACTnB,EAAG9D,EAAM,GACTkd,aAAcA,EACdpf,OAAQA,KALgC2B,EAAMrG,IAAM,aChCrDmU,I,OA9DGC,aAVD,SAAC/N,GAEhB,MAAO,CACLC,WAAYD,EAAMC,WAClBwG,SAAUzG,EAAMyG,SAChBoD,MAAO7J,EAAM6J,MACb3M,QAAS8C,EAAM9C,WAkEJ4Q,EA7D0C,SAAC,GAAmD,IAAjD7N,EAAgD,EAAhDA,WAAsB4J,GAA0B,EAApCpD,SAAoC,EAA1BoD,OAE1E/J,EAAWmN,KACX/L,EAAWC,cAEX8d,EAAmB5O,uBAAY,SAACmB,GACpC1R,EAASD,EAAsB2R,MAC9B,CAAC1R,IAEJ+O,qBAAU,WACRuO,SAASxkB,MAAQ,gBAChB,IAEHiW,qBAAU,WACR,IAAM2C,EAAiBjC,KAAY/U,MAAM0G,EAASG,QAClD4d,EAAiBzN,KAChB,CAACtQ,EAASG,OAAQ4d,IAErB,IAlB0G,EAkBtGhN,EAAO,GAlB+F,cAmBzFhS,EAAWM,OAnB8E,IAmB1G,2BAAmC,CAAC,IAA3B6B,EAA0B,QAEjC6P,EAAKhL,KAAK,cAAC,GAAD,CAAmBnG,KAAMsB,EAAMoD,QAASpD,EAAKzJ,IAAnCyJ,EAAKzJ,KACrByJ,EAAKlD,aACP+S,EAAKhL,KACH,cAAC,GAAD,CAEEzB,QAASpD,EAAKzJ,GACdslB,iBAAkB7b,EAAKiB,iBACvBhF,OAAQ+D,EAAK/D,OACbof,aAAc5T,EAAMvF,QALtB,iBACiBlC,EAAKzJ,OAzB8E,8BAkC1G,OACE,gCACE,cAAC,GAAD,IACCsH,EAAWtF,OAAU,cAAC,GAAD,CAAOzC,KAAM+H,EAAWtF,QAC9C,sBAAK5B,UAAU,mBAAf,UACE,sBAAKA,UAAU,KAAKF,MAAO,CAAEqmB,SAAU,SAAUC,IAAK,QAAtD,UACE,qBAAKtmB,MAAO,CAAEumB,cAAe,QAA7B,kDACA,wBACA,2DACA,qCACA,iEACA,8BAAK,sBAAMvmB,MAAO,CAAEsB,OAAQ,WAAavB,MAAM,wFAAkBwB,QAAS6kB,EAArE,SAAwFhf,EAAWC,WAAa,qEAAgB,gEAEtI+R,EACD,qBAAKlZ,UAAU,KAAf,SACE,cAAC,GAAD,CAAO2W,QAAS,UAGpB,qBAAK/W,GAAG,IAAII,UAAU,WAAWF,MAAO,CAAEqB,aAAc,OAAQD,UAAW,MAAOilB,SAAU,YAA5F,SACE,cAAC,GAAD,CACEzL,gBAAiBwL,aC5CZnR,GA1BGC,aAND,SAAC/N,GAChB,MAAO,CACLwD,KAAMxD,EAAMsF,MAAM9B,KAClBqG,MAAO7J,EAAM6J,SA6BFiE,EAxBuC,SAAC,GAAmC,IAAjCtK,EAAgC,EAAhCA,KAAgC,EAA1BqG,MAS7D,OAEE,sBAAK9Q,UAAU,WAAf,UACE,qBAAKA,UAAU,cAAf,SACE,cAAC,GAAD,MAEF,qBAAKA,UAAU,eAAf,SACE,sBAAMJ,GAAG,eAAeI,UAAU,UAAlC,SACE,cAAC,IAAD,CAAM8I,GAAE,2BAAsB2B,EAAKxF,OAASnF,MAAO,CAAEiiB,eAAgB,QAArE,SAfO,CACb,KAAM,6EACN,KAAQ,wCACR,GAAM,oJACN,IAAO,wCAWsFtX,EAAKxF,mBCmBvF8P,GAlCGC,aAVD,SAAC/N,GAMhB,MAAO,CACLwD,KAHExD,EAAMsF,MADR9B,QAyCWsK,EAjCyC,SAAC,GAA4B,IAA1BtK,EAAyB,EAAzBA,KAErD6b,EAAY,sCAAwCC,mBAAmB9b,EAAK5K,OAEhF,OACE,sBAAKG,UAAU,YAAf,UACE,qBAAKA,UAAU,gBAAf,SACE,sBAAKA,UAAU,cAAf,UACE,mBAAGH,MAAM,WAAW2J,KAAI,UAAK9G,EAAL,YAAeI,EAAf,eAAkC2H,EAAK7K,IAAMI,UAAU,MAAMF,MAAO,CAAEmY,QAAS,QAASuO,WAAY,OAA5H,eACA,mBAAG3mB,MAAM,eAAe2J,KAAI,UAAK9G,EAAL,YAAeK,EAAf,eAAsC0H,EAAK7K,GAA3C,iBAA8DI,UAAU,MAAMF,MAAO,CAAEmY,QAAS,QAASuO,WAAY,OAAjJ,oBAIJ,qBAAKxmB,UAAU,eAAf,SACE,sBAAKA,UAAU,WAAf,UACE,sBAAKF,MAAO,CAAEsV,KAAM,EAAGgD,UAAW,UAAlC,UACE,mBAAG5O,KAAI,UAAK9G,EAAL,yBAA4B+H,EAAK7K,IAAxC,SACE,oBAAII,UAAU,cAAc2V,wBAAyB,CAAEC,OAAQnL,EAAK5K,WAEtE,qBAAKG,UAAU,oBAEjB,qBAAKF,MAAO,CAAEsV,KAAM,WAAY+Q,SAAU,YAA1C,SACE,qBAAKnmB,UAAU,gBAAf,SACE,mBAAGyV,IAAI,sBAAsBjM,KAAM8c,EAAWzmB,MAAM,yFAAmBiB,OAAO,SAASd,UAAU,SAAjG,mCCQC+U,GApBGC,aAjBD,SAAC/N,GAEhB,MAGIA,EAAMsF,OAAS,CACjB9B,KAAM,GACNuB,MAAO,IAJPvB,EADF,EACEA,KACAuB,EAFF,EAEEA,MAMF,MAAO,CACLS,QAAShC,EAAK7K,GACd0F,OAAQ0G,EAAQA,EAAMvG,KAAO,GAC7BqL,MAAO7J,EAAM6J,SAwBFiE,EAnB4C,SAACvS,GAExD,IAAQuF,EAAiCvF,EAAjCuF,KAAMzC,EAA2B9C,EAA3B8C,OAAQmH,EAAmBjK,EAAnBiK,QAASqE,EAAUtO,EAAVsO,MAE/B,OAAK/I,EAIH,sBAAK/H,UAAU,YAAYJ,GAAIwP,OAAOrH,EAAKuD,GAA3C,UACE,qBAAKtL,UAAU,gBAAf,SACE,cAAC,GAAD,CAAU+H,KAAMA,EAAM4b,SAAU5b,EAAKtC,OAASH,EAAQse,MAAO7b,EAAKtC,OAASqL,EAAMtB,aAEnF,qBAAKxP,UAAU,eAAf,SACE,cAAC,GAAD,CAAS+H,KAAMA,EAAMua,KAAMva,EAAK5I,KAAMsN,QAASA,EAASnB,EAAGvD,EAAKuD,EAAGG,KAAM1D,EAAK0D,YAR3E,QCwCEsJ,GAjDGC,aAjBD,SAAC/N,GAEhB,MAIIA,EAAMsF,OAAS,CACjBpF,YAAY,EACZsD,KAAMF,IALNpD,EADF,EACEA,WACA4C,EAFF,EAEEA,YAOF,MAAO,CACLU,KAVF,EAGEA,KAQAtD,aACA4C,iBAoDWgL,EA9C+C,SAAC,GAA8C,IAA5CtK,EAA2C,EAA3CA,KAAMtD,EAAqC,EAArCA,WAAYE,EAAyB,EAAzBA,KAE3EN,EAAWmN,KAUXyC,EAAU5U,EAAW0I,EAAKzI,OAE5BykB,GAAmB,EAIvB,MAHa,WAATpf,GAAqBA,IAASsP,IAChC8P,GAAmB,GAGnB,sBAAKzmB,UAAU,WAAWJ,GAAG,IAA7B,UACE,qBAAKI,UAAU,iBAAiBF,MAAO,CAAEqY,MAAO,OAAhD,SACE,cAAC5C,GAAA,EAAD,CACElU,QAlBgB,aAmBhBkZ,UAAU,EACV7a,KAAK,KACLM,UAAU,SACVC,QAAQ,QALV,SAMG,uDAGL,qBAAKD,UAAU,qBAAqBF,MAAO,CAAEmB,WAAY,QAAzD,SACGwlB,GACC,cAAClR,GAAA,EAAD,CACElU,QAzBa,WACrB0F,EAASgG,OAyBDwN,SAAUpT,EACVzH,KAAK,KACLM,UAAU,SACVC,QAAQ,QALV,SAMGkH,EAAa,qEAAgB,4FC8D3B4N,GA1GGC,aATD,SAAC/N,GAEhB,MAAO,CACLwD,KAAMxD,EAAMsF,MAAM9B,KAClBoJ,WAAY5M,EAAM4M,cA+GPkB,EAxGmD,SAAC,GAAyD,IA8CtH2R,EA9C+Djc,EAAsD,EAAtDA,KAAMoJ,EAAgD,EAAhDA,WAAY6G,EAAoC,EAApCA,gBAErF,EAA4B1b,qBAA5B,mBAAO0L,EAAP,KAAeic,EAAf,KACM5f,EAAWmN,KAqBX0S,EAAc,WAElB7f,EAAS0M,GAAe,KAExBkT,OAAU9iB,GAEN6W,GACFA,KAgBJ,IAAQ,OAAJjQ,QAAI,IAAJA,OAAA,EAAAA,EAAMxE,YAAN,OAAkBwE,QAAlB,IAAkBA,OAAlB,EAAkBA,EAAMC,QAAQ,CAGlC,IADA,IAAI2Q,EAAgB,GAFc,WAGzB/R,GAEP,IAAMD,EAAOoB,EAAKC,OAAOpB,EAAI,GAC7B,IAAKD,EAAKlK,KACR,iBAEFkc,EAAcnN,KACZ,cAACzE,EAAA,EAAK+Q,MAAN,CACEja,KAAK,QAEL4I,KAAK,SACLsR,QAAS/P,IAAWpB,EACpBzI,SAAU,kBApBM,SAACyI,GACvBqd,EAAUrd,GAmBYud,CAAgBvd,IAChC2M,MAAK,UAAK3M,EAAL,aAAWD,EAAKlK,OAJhBmK,KATFA,EAAI,EAAGA,GAAKmB,EAAKC,OAAOzG,OAAQqF,IAAK,EAArCA,GAmBTod,EACE,eAAChL,GAAA,EAAD,WACE,iCACE,uFACE,sBAAM9b,GAAG,eAAeE,MAAO,CAAEmB,WAAY,MAAOG,OAAQ,WAAaC,QAtC/D,SAACV,GAEnBA,EAAE6T,iBACFmS,OAAU9iB,IAmCF,mEAGHwX,EANH,qHAaJ,OACE,uBAAMvb,MAAO,CAAEoB,UAAW,OAASqa,SA/EpB,SAAC5a,GAEhBA,EAAE6T,iBACF7T,EAAE2e,kBAEF,IAAI9b,EAA+B,CACjCrE,KAAM0U,EAAW1U,KACjBsN,QAAS2C,OAAM,OAAC3E,QAAD,IAACA,OAAD,EAACA,EAAM7K,IACtBwT,UAAWwT,EACXE,mBAAejjB,GAGb6G,IACFlH,EAAOsjB,cAAgBpc,GAGzB3D,ErCvB0B,SAACvD,GAAD,8CAAuC,WAAOuD,GAAP,eAAA3C,EAAA,6DAEnE2C,EAASwM,MAELd,EAAwB,CAC1BC,aAAclP,EAAOrE,KACrB2K,OAAQ,MACRwJ,SAAU9P,EAAOiJ,QACjBuG,IAAK/Q,KAAKgR,MAAsB,KAAhBhR,KAAKiR,WAGnB1P,EAAOsjB,gBACTrU,EAAYqU,cAAgBtjB,EAAOsjB,eAZ8B,kBAe3DzT,GAAgBZ,GAf2C,uBAgB3D1L,EAASyM,MAhBkD,OAiB7DhQ,EAAO4P,WACT5P,EAAO4P,YAlBwD,kDAqBjEzR,QAAQC,MAAM,qCArBmD,0DAAvC,sDqCuBjBmlB,CAAevjB,KA+DxB,UACE,qBAAKxD,UAAU,OAAf,sJACA,sBAAKA,UAAU,wBAAf,UACE,qBAAKA,UAAU,mBAAf,SACE,cAAC,GAAD,CACEmH,WAAY0M,EAAW1M,WACvBhI,KAAM0U,EAAW1U,KACjBqB,YAAY,yDACZqY,SAAS,kBAGb,qBAAK7Y,UAAU,qBAAf,SACG0mB,alBmBI3R,I,OAzFGC,aA9BD,SAAC/N,GAEhB,MAOIA,EAAMsF,MANRpF,EADF,EACEA,WACA4C,EAFF,EAEEA,YACAU,EAHF,EAGEA,KACAuB,EAJF,EAIEA,MACAxE,EALF,EAKEA,MACA5F,EANF,EAMEA,MAGF,MAAO,CACLkP,MAAO7J,EAAM6J,MACbrG,OACAuB,QACAxE,QACAL,aACA4C,cACAnI,QACAuC,QAAS8C,EAAM9C,QAAQqD,SAoGZuN,EAxFqC,SAAC,GAAwD,IARtFiS,EAQgClW,EAAqD,EAArDA,MAAOtJ,EAA8C,EAA9CA,MAAOwE,EAAuC,EAAvCA,MAAOvB,EAAgC,EAAhCA,KAAM7I,EAA0B,EAA1BA,MAE1EmF,EAAWmN,KACX/L,EAAWC,cAEbqQ,EAAiB,IAAI/U,gBAAgByE,EAASG,QAC5CmE,GAAWgM,EAAe7U,IAAI,MAC9ByD,GAfe2f,EAeMvO,EAAe7U,IAAI,SAbzB,WAAjBojB,EAAkC,SAClC5I,OAAO4I,GAAsB,GACzBA,EAHkB,EAepBrQ,EAAU5U,EAAW0I,EAAKzI,OAE1BilB,EAAc3P,uBAAY,WAC9B,IAAI5K,EAASV,EACTS,IAAYhC,EAAK7K,KACnB8M,EAAS,MAEX3F,EAASyF,GAAiBC,EAASpF,EAAMqF,MACxC,CAAC3F,EAAU0F,EAASpF,IAGjB6f,EAAoB5P,uBAAY,YACP,WAATjQ,GAAqBA,IAASsP,IAEhD5P,EAASgG,QACV,CAAChG,EAAUM,IAwCd,OAjCAyO,qBAAU,WnDhBuB,IAACqR,EmDiB5B1c,EAAK5K,QACPwkB,SAASxkB,OnDlBqBsnB,EmDkBO1c,EAAK5K,OnDjB/B,IAAIunB,WACYC,gBAAgBF,EAAU,aACjCG,WAA2BC,cmDgBhD,CAAC9c,EAAK5K,QAETiW,qBAAU,WACRmR,MACC,CAACA,EAAaxa,EAASpF,IAE1ByO,qBAAU,WAER,IAAMmJ,EAAQ1f,OAAOioB,YAAYN,EAAmB,KAOpD,OALmB,WACjBngB,EAASmF,MACT+P,QAAiBpY,EACbob,GAAOwI,cAAcxI,MAI1B,CAAClY,EAAUmgB,IAEdpR,qBAAU,WACR,IAAKmG,IACH9T,EAASsJ,MACTjK,EAAMvD,OAAS,EAAG,CAClB,IAAIyjB,EAAWrD,SAASC,eAAenc,EAASsJ,KAAKzJ,MAAM,IACvD0f,GACFtI,YAAW,kBAAM7f,OAAOglB,SAAS,EAAGmD,EAASlD,aAAY,GAC3DvI,IAAiB,MAKnB,sBAAKnc,MAAO,CAAEqB,aAAc,OAA5B,UACE,cAAC,GAAD,IACCS,GAAS,cAAC,GAAD,CAAOzC,KAAMyC,IACvB,sBAAK5B,UAAU,cAAf,UACE,cAAC,GAAD,IACA,cAAC,GAAD,CAAa+H,KAAMiE,GAAV,KACRxE,EAAMlF,KAAI,SAAC+G,EAAMC,GAAP,OACT,cAAC,GAAD,CAAkBvB,KAAMsB,GAAdA,EAAKiC,OAEfqL,EAAU,GAAc,WAATtP,IACf,qBAAKrH,UAAU,KAAf,SACE,cAAC,GAAD,CAAO2W,QAASA,EAAS0B,QAAM,SAIrC,cAAC,GAAD,CAAQhR,KAAMA,IACbyJ,EAAMK,QACL,cAAC,GAAD,CAAYuJ,gBAxDc,WAC9BwM,IACAngB,EAAS0M,GAAe,emBxCbkU,GA3BiB,SAAC,GAAqE,IAAnExe,EAAkE,EAAlEA,KAAM8M,EAA4D,EAA5DA,MAAOlV,EAAqD,EAArDA,MAAO6mB,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,QAAShnB,EAA6B,EAA7BA,SAEhEinB,EAAgB,SAACnnB,GACrBE,EAASF,EAAGwI,EAAMxI,EAAEG,OAAOC,QAG7B,OACE,iCACE,uBAAMjB,MAAO,CAAEC,YAAa,OAA5B,cAAuCkW,EAAvC,OACC4R,GAAW,uBACXD,EAAOtlB,KAAI,SAAC+G,EAAMC,GAAP,OACV,cAACG,EAAA,EAAK+Q,MAAN,CACEja,KAAK,QACLX,GAAIyJ,EAAKF,KACT8M,MAAO5M,EAAK0e,MACZ5e,KAAM8M,EACNwE,QAASpR,EAAKF,OAASpI,EACvBA,MAAOsI,EAAKF,KACZ6e,OAAQH,EACRhnB,SAAUinB,GARKxe,UCOV2e,GApBkB,SAACzlB,GAEhC,IAKQ2G,EAAgC3G,EAAhC2G,KAAMpI,EAA0ByB,EAA1BzB,MAAOkV,EAAmBzT,EAAnByT,MAAOiS,EAAY1lB,EAAZ0lB,QAE5B,OACE,wBAAOC,QAAShf,EAAMrJ,MAAO,CAAEC,YAAa,OAA5C,UACE,sBAAMD,MAAO,CAAEC,YAAa,OAA5B,SAAsCkW,IACtC,uBAAO1V,KAAK,SAAS4I,KAAMA,EAAMpI,MAAOA,EAAOF,SAVlC,SAACF,GAChB,IAAQwI,EAAS3G,EAAT2G,KACR3G,EAAM3B,SAASF,EAAGwI,EAAMxI,EAAEG,OAAOC,QAQoCf,UAAU,eAChE6D,IAAZqkB,EACC,sBAAMpoB,MAAO,CAAEmB,WAAY,OAA3B,SAAqCinB,IACnC,SCzBGE,GAAW,CACtB,CACEC,QAAS,iCACTnP,KAAM,CACJ,CAAC,SACD,CAAC,iBACD,CAAC,wBAAyB,iCAC1B,CAAC,mBAAoB,8BAGzB,CACEmP,QAAS,6CACTnP,KAAM,CACJ,CAAC,eAAgB,gBACjB,CAAC,2BAGL,CACEmP,QAAS,uCACTnP,KAAM,CACJ,CAAC,yBACD,CAAC,uBACD,CAAC,qBAKMoP,GAAa,CACxB,MAAS,CACP/nB,KAAM,QACN0V,MAAO,+FACP4R,SAAS,EACTD,OAAQ,CACN,CAAEze,KAAM,SAAU4e,MAAO,8CACzB,CAAE5e,KAAM,YAAa4e,MAAO,kCAC5B,CAAE5e,KAAM,OAAQ4e,MAAO,0CAG3B,cAAiB,CACfxnB,KAAM,SACN0V,MAAO,6FACP/T,IAAK,EACLkgB,IAAK,IAEP,sBAAyB,CACvB7hB,KAAM,WACN0V,MAAO,gJAET,8BAAiC,CAC/B1V,KAAM,SACN0V,MAAO,GACP/T,IAAK,GACLkgB,IAAK,IACL8F,QAAS,sBAEX,iBAAoB,CAClB3nB,KAAM,WACN0V,MAAO,iHAET,yBAA4B,CAC1B1V,KAAM,SACN0V,MAAO,GACP/T,IAAK,GACLkgB,IAAK,IACL8F,QAAS,sBAGX,aAAgB,CACd3nB,KAAM,WACN0V,MAAO,6JAET,aAAgB,CACd1V,KAAM,SACN6hB,IAAK,IACLnM,MAAO,GACPiS,QAAS,gBAEX,sBAAyB,CACvB3nB,KAAM,WACN0V,MAAO,qNAGT,sBAAyB,CACvB1V,KAAM,WACN0V,MAAO,4LAET,oBAAuB,CACrB1V,KAAM,WACN0V,MAAO,0IAET,eAAkB,CAChB1V,KAAM,WACN0V,MAAO,4PCzEIsS,GAbS,SAAC,GAAsC,IAApCpf,EAAmC,EAAnCA,KAAM9G,EAA6B,EAA7BA,SAC/B,OACE,gCACE,qBAAKrC,UAAU,aAAf,SACGmJ,IAEH,qBAAKnJ,UAAU,cAAf,SACGqC,QCyLM0S,I,OA/KGC,aAND,SAAC/N,GAChB,MAAO,CACL9C,QAAS8C,EAAM9C,WAmLJ4Q,EA9KuC,SAACvS,GAErD,IAF6E,EAEvEuE,EAAWmN,KACXoC,EAAWC,cAEjB,EAA0BvX,mBAAS,CACjCwI,MAAOhF,EAAM2B,QAAQqD,QADvB,mBAAOP,EAAP,KAAc6Y,EAAd,KAIM0I,EAAY,WAChBlS,EAAS,OAgBLzV,EAAW,SAACF,EAAGwI,EAAMpI,GAEzB,IAAIyG,EAAQ4C,OAAOC,OAAO,GAAIpD,EAAMO,OACpCA,EAAM2B,GAAQpI,EACd+e,EAAS,6BACJ7Y,GADG,IAENO,YAIAihB,EAAO,GApCkE,cAqC7DL,IArC6D,IAqC7E,2BAA0B,CAAC,IAAlBM,EAAiB,QAEpBxP,EAAO,GACX,IAAK,IAAI5P,KAAKof,EAAIxP,KAAM,CAEtB,IAFsB,EAEhByP,EAAMD,EAAIxP,KAAK5P,GACjBsf,EAAU,GAHQ,cAILD,GAJK,yBAIbxf,EAJa,QAMdE,EAAOif,GAAWnf,GACxB,IAAKE,EAAM,iBAEX,IAAMtI,EAAQkG,EAAMO,MAAM2B,GAER,UAAdE,EAAK9I,KACPqoB,EAAQ1a,KACN,cAAC,GAAD,CAEE/E,KAAMA,EACN8M,MAAO5M,EAAK4M,MACZ2R,OAAQve,EAAKue,OACb7mB,MAAOA,EACP8mB,QAASxe,EAAKwe,QACdhnB,SAAUA,GANLsI,IASc,WAAdE,EAAK9I,MAEV8I,EAAK4M,OACP2S,EAAQ1a,KACN,uBACEia,QAAShf,EAETrJ,MAAO,CAAE+oB,WAAY,WAHvB,SAIGxf,EAAK4M,OAFD9M,EAAO,WAMlByf,EAAQ1a,KACN,sBAAKlO,UAAU,iBAAf,UACE,cAACM,EAAA,EAAD,CACEC,KAAK,SACL2B,IAAKmH,EAAKnH,IACVkgB,IAAK/Y,EAAK+Y,IACVrhB,MAAOA,EACPF,SAAU,SAACF,GAAD,OAAOE,EAASF,EAAGwI,EAAMxI,EAAEG,OAAOC,QAE5Cf,UAAU,QACVN,KAAK,OAGN2J,EAAK6e,SACJ,sBAA8BpoB,MAAO,CAAEmB,WAAY,MAAOmU,KAAM,YAAhE,SAAgF/L,EAAK6e,SAA1E/e,EAAO,cAbeA,KAiBhB,WAAdE,EAAK9I,KACdqoB,EAAQ1a,KACN,cAAC,GAAD,CAEE/E,KAAMA,EACN8M,MAAO5M,EAAK4M,MACZiS,QAAS7e,EAAK6e,QACdnnB,MAAOA,EACPF,SAAUA,GALLsI,IAQc,aAAdE,EAAK9I,MACdqoB,EAAQ1a,KACN,cAACzE,EAAA,EAAK+Q,MAAN,CACE5a,GAAIuJ,EACJ5I,KAAK,WACL0V,MAAO5M,EAAK4M,MAEZ9M,KAAMA,EACNsR,QAA2B,SAAlBrL,OAAOrO,GAChBF,SAAU,SAACF,GAAD,OAAOE,EAASF,EAAGwI,EAAMxI,EAAEG,OAAO2Z,UAC5C3a,MAAO,CAAEsV,KAAM,WAAYI,OAAQ,QAJ9BrM,KAlEb,2BAAsB,IAJA,8BAgFtB+P,EAAKhL,KACH,qBAAalO,UAAU,cAAvB,SACG4oB,GADOtf,IAOdmf,EAAKva,KACH,cAAC,GAAD,CAAuB/E,KAAMuf,EAAIL,QAAjC,SACGnP,GADOwP,EAAIL,WAjI2D,8BAuI7E,OACE,sBAAKroB,UAAU,eAAf,UACE,qBAAKA,UAAU,iBAAiBF,MAAO,CAAEsB,OAAQ,WAAjD,SACE,yFAEDqnB,EACD,sBAAKzoB,UAAU,aAAf,UACE,cAACuV,GAAA,EAAD,CACE3V,GAAG,eACHF,KAAK,KACLO,QAAQ,QACRH,MAAO,CAAE0V,OAAQ,OACjBxV,UAAU,SACVqB,QAhIa,WAEnB0F,EAASiI,GAAY/H,EAAMO,QAC3BghB,KAuHI,gBASA,cAACjT,GAAA,EAAD,CACE3V,GAAG,gBACHF,KAAK,KACLO,QAAQ,QACRH,MAAO,CAAE0V,OAAQ,MAAOZ,MAAO,QAC/B5U,UAAU,SACVqB,QAASmnB,EANX,kDASA,cAACjT,GAAA,EAAD,CACE3V,GAAG,iBACHF,KAAK,KACLO,QAAQ,QACRH,MAAO,CAAE0V,OAAQ,MAAOZ,MAAO,SAC/B5U,UAAU,SACVqB,QAzJa,WACnBye,EAAS,6BACJ7Y,GADG,IAENO,MAAO4C,OAAOC,OAAO,GAAI8D,GAAoB3G,WAgJ3C,+HCvJOshB,GAtBG,WAEhB,IAAM/hB,EAAWmN,KAMjB,OACE,qBAAK7S,QALS,WACd0F,GnDK4C,SAACA,EAAeC,GACrCA,IACf2M,SAASnM,MAAMvD,OAAS,GAChC8C,EAASyK,UmDJc1R,MAAO,CAAEsV,KAAM,QAAtC,SACE,cAAC2T,EAAA,EAAD,UACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAOC,KAAK,IAAIC,QAAS,cAAC,GAAD,MACzB,cAAC,IAAD,CAAOD,KAAK,aAAaC,QAAS,cAAC,GAAD,MAClC,cAAC,IAAD,CAAOD,KAAK,aAAaC,QAAS,cAAC,GAAD,MAClC,cAAC,IAAD,CAAOD,KAAK,eAAeC,QAAS,cAAC,GAAD,cCY/BC,GAnCM,WAEjB,OACI,yBAAQlpB,UAAU,yBAAlB,UACI,mBAAGwJ,KAAI,UAAK9G,EAAL,cAAP,wDACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGwJ,KAAI,UAAK9G,EAAL,cAAP,8DACA,sBAAM1C,UAAU,YAAhB,eACA,8BAAG,mBAAGwJ,KAAI,UAAK9G,EAAL,WAAP,oGAAH,QACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGwJ,KAAI,UAAK9G,EAAL,aAAP,4CACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGyV,IAAI,WAAWjM,KAAI,UAAK9G,EAAL,sBAAtB,kDACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGyV,IAAI,WAAWjM,KAAI,UAAK9G,EAAL,eAAtB,wDACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGwJ,KAAK,qBAAR,iFACA,sBAAMxJ,UAAU,YAAhB,eACA,mBAAGwJ,KAAK,uBAAR,qFACA,sBAAMxJ,UAAU,YAAhB,eACA,mBAAGyV,IAAI,WAAWjM,KAAK,qBAAvB,oEACA,sBAAMxJ,UAAU,YAAhB,eACA,mBAAGwJ,KAAI,UAAK9G,EAAL,gBAAP,4CACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGwJ,KAAI,UAAK9G,EAAL,eAAP,0EACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGwJ,KAAI,UAAK9G,EAAL,sBAAP,wDACA,sBAAM1C,UAAU,YAAhB,eACA,mBAAGwJ,KAAI,UAAK9G,EAAL,iBAAP,sCACA,sBAAM1C,UAAU,YAAhB,eACA,2C,oBCfGmpB,GAZmB,SAAC,GAA6C,IAA3C9mB,EAA0C,EAA1CA,SAAU+mB,EAAgC,EAAhCA,YAC7C,OACE,sBAAKppB,UAAU,iBAAf,UACGqC,EACD,sBAAKrC,UAAU,gBAAgBqB,QAAS+nB,EAAaC,WAAYD,EAAjE,UACE,mBAAGppB,UAAU,oBAAoBgX,cAAY,SAC7C,mBAAGhX,UAAU,mBAAmBgX,cAAY,OAAOlX,MAAO,CAAEmB,WAAY,iBCkBjEqoB,GAxBiB,SAAC,GAA0C,IAAxCjnB,EAAuC,EAAvCA,SAAUknB,EAA6B,EAA7BA,SAEvCC,EAAS,EAeb,OACE,qBAAKxpB,UAAU,eAAeypB,aAdX,SAAC9oB,GACpB6oB,EAAS7oB,EAAE+oB,YAAYC,eAAe,GAAGC,SAaiBP,WAVzC,SAAC1oB,GAElB,GAAK4oB,EAAL,CAEA,IAAIM,EAAOlpB,EAAE+oB,YAAYC,eAAe,GAAGC,QACvC3nB,KAAK0jB,IAAIkE,EAAOL,GAAU,KAC5BD,GAAUM,EAAOL,KAInB,SACGnnB,KCuCQynB,I,MA9CmB,SAAC,GAAiD,IAU9EC,EACA5D,EAX+B6D,EAA8C,EAA9CA,QAAS1oB,EAAqC,EAArCA,OAAQe,EAA6B,EAA7BA,SAE9C0E,EAAWmN,KAMT5C,EAAW0Y,EAAX1Y,OAQJ/R,OAAO2kB,YAAc,KACvB6F,EAAO,IACP5D,EAAW,CAAEC,IAAK9U,EAAOqO,EAAGsK,KAAM,KAElCF,EAAO,OACP5D,EAAW,CAAEC,IAAK9U,EAAOqO,EAAGsK,KAAMhoB,KAAKC,IAAIoP,EAAO3G,EAAGpL,OAAO2kB,WAAa,OAG3E,MAAqB7P,IAAM6V,SAASC,QAAQ9nB,GAA5C,mBAAK+nB,EAAL,KAAapa,EAAb,KAEA,OACE,cAAC,KAAD,CACE+Z,KAAMA,EACNM,OAAO,kBACPC,yBAAyB,WAH3B,SAME,sBAAKtqB,UAAU,iBAAiBF,MAAK,gBAAOqmB,GAA5C,UACE,cAAC,GAAD,CAAeiD,YA9BA,WACnBriB,EAASwK,GAAayY,EAAQ3Y,QA6B1B,SACI+Y,EAAwB5nB,MAAMH,WAElC,cAAC,GAAD,UACI2N,EAAsBxN,MAAMH,eAP7Bf,KCoEIyT,GA9EGC,aAfD,SAAC/N,GAEhB,MAIIA,EAAMsF,MAEV,MAAO,CACL9B,KAPF,EACEA,KAOAjD,MARF,EAEEA,MAOAwE,MATF,EAGEA,SAwFW+I,EA7EgD,SAACvS,GAAgC,IAAD,IAMzFuF,EAJIiiB,EAAgCxnB,EAAhCwnB,QAASvf,EAAuBjI,EAAvBiI,KAAMjD,EAAiBhF,EAAjBgF,MAAOwE,EAAUxJ,EAAVwJ,MACtBqF,EAAS2Y,EAAT3Y,KAEJlS,EAAO,GAEPkS,EAAK5E,UAAYhC,EAAK7K,KAEtBmI,EADkB,IAAhBsJ,EAAK5O,OACAuJ,EAEAxE,EAAMqE,MAAK,SAACxC,GAAD,OAAyBA,EAAKiC,IAAM+F,EAAK5O,aAG3DtD,EAAO4I,EAAK5I,MAGhB,IAiCIirB,EAjCJ,EAA0BprB,mBAAS,CACjC+I,OACA5I,SAFF,mBAAO8H,EAAP,KAAc6Y,EAAd,KAKMyK,EAAYjT,sBAAW,sBAAC,8BAAAlT,EAAA,0DAExB6C,EAAMc,KAFkB,wDAKxB5I,EAAO,GALiB,kBAQbwM,GAAkB0F,EAAK5E,QAAS4E,EAAK5O,QARxB,OAQ1BsF,EAR0B,OAUxB5I,EADE4I,EACKA,EAAK5I,KAER,yHAA2BkS,EAAK5O,QAZZ,kDAe1BtD,EAAO,KAAa0C,QAfM,QAkB5Bie,EAAS,CAAE/X,OAAM5I,SAlBW,0DAmB3B,CAACkS,EAAK5E,QAAS4E,EAAK5O,OAAQwE,EAAMc,OAMrC,OAJA+N,qBAAU,WACNyU,MACD,CAACA,IAECtjB,EAAM9H,MAOTirB,EAHGnjB,EAAMc,KAGA,cAAC,GAAD,CAAUA,KAAMd,EAAMc,KAAM4b,UAAU,EAAOC,OAAO,EAAOC,WAAW,IAFtE,uFAMT,eAAC,GAAD,CAAemG,QAASxnB,EAAMwnB,QAA9B,UACE,cAAC,GAAD,UACGI,IAEH,cAAC,GAAD,UACE,cAAC,GAAD,CACEriB,KAAMd,EAAMc,KACZuD,EAAC,UAAErE,EAAMc,YAAR,aAAE,EAAYuD,EACfG,KAAI,UAAExE,EAAMc,YAAR,aAAE,EAAY0D,KAClB6W,KAAMrb,EAAM9H,KACZsN,QAAS4E,EAAK5E,QACd3M,MAAO,CAAE0qB,UAAW,mBAAoBxF,UAAW,gBArBlD,QCvDIjQ,GAhBGC,aAXD,SAAC/N,GAMhB,MAAO,CACLO,MAHEP,EAAM0M,SADRnM,SAwBWuN,EAf4C,SAAC,GAA6B,IAA3BvN,EAA0B,EAA1BA,MAE5D,OACE,mCACGA,EAAMlF,KAAI,SAAC+G,GACV,OACE,cAAC,GAAD,CAAyB2gB,QAAS3gB,GAApBA,EAAKoI,cCUdsD,GAjBGC,aAPD,SAAC/N,GAEhB,MAAO,CACLoH,MAAOpH,EAAM9C,QAAQqD,MAAM6G,SAqBhB0G,EAhBmC,SAAC,GAA2B,IAA1B1G,EAAyB,EAAzBA,MAMlD,OAJAyH,qBAAU,WACRuO,SAASrU,KAAKya,aAAa,QAASpc,KACnC,CAACA,IAGF,eAAC,IAAD,WACE,cAAC,EAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,IACA,cAAC,GAAD,UCrBAqc,GAAO,SAAC,GAAD,IAAG5W,EAAH,EAAGA,MAAH,OACX,cAAC,IAAD,CAAUA,MAAOA,EAAjB,SACE,cAAC,GAAD,OAIJ6W,IAASC,OAAO,cAAC,GAAD,CAAM9W,MAAOA,KAC3BuQ,SAASC,eAAe,U","file":"static/js/main.9f317f78.chunk.js","sourcesContent":["import React, { ReactElement, useState } from 'react'\r\nimport InputGroup from 'react-bootstrap/InputGroup'\r\nimport FormControl from 'react-bootstrap/FormControl'\r\nimport Dropdown from 'react-bootstrap/Dropdown'\r\nimport DropdownButton from 'react-bootstrap/DropdownButton'\r\n\r\nimport './search.css'\r\n\r\nconst Search = (): ReactElement => {\r\n\r\n  const [searchEngine, setSearchEngine] = useState('Яндекс');\r\n  const [text, setText] = useState('');\r\n\r\n  const onKeyPress = (e: any) => {\r\n    if (e.key === 'Enter') {\r\n      doSearch();\r\n    }\r\n  }\r\n\r\n  const doSearch = () => {\r\n\r\n    let url: string;\r\n    if (searchEngine === 'Яндекс') \r\n      url = `https://www.yandex.ru/search/?text=${text}&site=forum.mista.ru`;\r\n\r\n    else if (searchEngine === 'Google') \r\n      url = `https://www.google.ru/search?q=${text}+site:forum.mista.ru`\r\n\r\n    window.open(url);\r\n    setText('');\r\n  }\r\n\r\n  return (\r\n    <InputGroup size=\"sm\">\r\n      <DropdownButton \r\n        id=\"search-engine\" \r\n        title=\"\" \r\n        size=\"sm\" \r\n        style={{ marginRight: \"2px\" }} \r\n        className='button' \r\n        variant=\"light\"\r\n        onSelect={eventKey => setSearchEngine(eventKey)}\r\n        >\r\n        <Dropdown.Item eventKey=\"Яндекс\">Яндекс</Dropdown.Item>\r\n        <Dropdown.Item eventKey=\"Google\">Google</Dropdown.Item>\r\n      </DropdownButton>\r\n      <FormControl\r\n        type=\"text\"\r\n        placeholder={`${searchEngine}: поиск`}\r\n        style={{ marginRight: \"4px\", paddingRight: \"27px\" }}\r\n        className='input'\r\n        onKeyPress={onKeyPress}\r\n        onChange={e => setText(e.target.value)}\r\n        value={text}\r\n      />\r\n      <InputGroup.Text style={{ marginLeft: \"-35px\", marginTop: \"auto\", marginBottom: \"auto\", cursor: \"pointer\" }} onClick={doSearch}>\r\n        <i className=\"fa fa-search input\" style={{ zIndex: 1000 }} />\r\n      </InputGroup.Text>\r\n    </InputGroup>\r\n  )\r\n\r\n}\r\n\r\nexport default Search;","\r\nexport function today(td: Date): boolean {\r\n  var d = new Date();\r\n  return td.getDate() === d.getDate() && td.getMonth() === d.getMonth() && td.getFullYear() === d.getFullYear();\r\n}\r\n\r\nexport const groupBy = <T, K extends keyof any>(list: T[], getKey: (item: T) => K) =>\r\n  list.reduce((previous, currentItem) => {\r\n    const group = getKey(currentItem);\r\n    if (!previous[group]) previous[group] = [];\r\n    previous[group].push(currentItem);\r\n    return previous;\r\n  }, {} as Record<K, T[]>)\r\n\r\nexport const parseJSON = (text: string): {} => {\r\n\r\n  try {\r\n    return JSON.parse(text);\r\n  } catch (e) {\r\n\r\n  }\r\n\r\n  try {\r\n    text = text\r\n      .replace(/\\\\</g, '<')\r\n      .replace(/\\\\>/g, '>')\r\n      .replace(/\\\\&/g, '&')\r\n      .replace(/\\\\'/g, \"'\")\r\n      .replace(/\\\\\"/g, \"\")\r\n      .replace(/ \"/g, ' \\\\\"')\r\n      .replace(/\"\"/g, '\\\\\"\"')\r\n      .replace(/\\t/g, '\\\\t')\r\n      .replace(/\"(\\.| |\\?)/g, '\\\\\"$1')\r\n\r\n    //           console.log(text);\r\n    return JSON.parse(text);\r\n\r\n    //return eval(text);\r\n  } catch (e) {\r\n    console.error(e.message);\r\n    console.log(text);\r\n\r\n    return {};\r\n  }\r\n}\r\n\r\nexport const getMaxPage = (count: number): number => Math.min(Math.ceil(count / 100), 10) || 1;\r\n\r\nexport const childrenToText = (children: any): string[]=> {\r\n\r\n  if (!children) return children;\r\n\r\n  return children.map(value => {\r\n    if (typeof (value) === 'string') {\r\n      return value;\r\n    } else if (value.type === 'br') {\r\n      return '<br>'\r\n    } else if (value.type.displayName === 'Connect(LinkToPost)' || value.type.displayName === 'Connect(t)') {\r\n      return value.props.number;\r\n    } else {\r\n      console.log(value);\r\n      return value;\r\n    }\r\n  })\r\n}\r\n\r\nexport const extractTextFromHTML = (htmltext: string): string => {\r\n  const parser = new DOMParser();\r\n  const floatingElement = parser.parseFromString(htmltext, 'text/html');\r\n  return (floatingElement.firstChild as HTMLElement).innerText;\r\n}","import fetchJsonp from 'fetch-jsonp'\r\nimport * as utils from 'src/utils'\r\n\r\nexport const domain: string = localStorage.getItem('domain') || 'https://forum.mista.ru';\r\n//export const domain = 'https://dev.mista.ru';\r\nexport const urlTopicsList: string = localStorage.getItem('urlTopicsList') || 'api/topic.php';\r\nexport const urlTopicInfo: string = localStorage.getItem('urlTopicInfo') || 'ajax_gettopic.php';\r\nexport const urlTopicMessages: string = localStorage.getItem('urlTopicMessages') || 'api/message.php';\r\nexport const urlLogin: string = localStorage.getItem('urlLogin') || 'users.php?action=do_enter';\r\nexport const urlLogout: string = localStorage.getItem('urlLogout') || 'users.php?action=exit';\r\nexport const urlCookies: string = localStorage.getItem('urlCookies') || 'ajax_cookie.php';\r\nexport const urlSections: string = localStorage.getItem('urlSections') || 'ajax_getsectionslist.php';\r\nexport const urlNewMessage: string = localStorage.getItem('urlNewMessage') || 'topic.php?id=:id&page=1';\r\nexport const urlNewTopic: string = localStorage.getItem('urlNewTopic') || 'index.php';\r\nexport const urlAddBookmark: string = localStorage.getItem('urlAddBookmark') || 'ajax_addbookmark.php';\r\nexport const urlSearch: string = localStorage.getItem('urlSearch') || 'ajax_find.php';\r\n\r\n//Bookmark\r\nexport type RequestBookmark = {\r\n  id: string\r\n}\r\n\r\nexport const postBookmark = async (params: RequestBookmark) => {\r\n\r\n  await fetch(`${domain}/${urlAddBookmark}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', params),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n  });\r\n}\r\n\r\nexport const paramsToString = (paramsPrefix: string, params?: {}): string => {\r\n  if (!params)\r\n    return '';\r\n\r\n  let searchParams = new URLSearchParams();\r\n  for (let key in params) {\r\n    const value = Reflect.get(params, key)\r\n    if (value !== undefined)\r\n      searchParams.append(key, value)\r\n  }\r\n\r\n  let str = searchParams.toString();\r\n  if (str.length > 0)\r\n    return paramsPrefix + str;\r\n  else\r\n    return '';\r\n}\r\n\r\nexport const fetchJsonpAndGetJson = async (url: string, params?: {}, options?: {}): Promise<any> => {\r\n\r\n  let fullUrl = `${domain}/${url}${paramsToString('?', params)}`;\r\n  const response = await fetchJsonp(fullUrl);\r\n  let responseJson = await response.json();\r\n  let json;\r\n  if (typeof (responseJson) === 'string') {\r\n\r\n    try {\r\n      json = JSON.parse(responseJson)\r\n    } catch (e) {\r\n      json = utils.parseJSON(responseJson);\r\n    }\r\n  } else {\r\n    json = responseJson;\r\n  }\r\n  return json;\r\n}\r\n\r\nexport const fetchAndGetJson = async (url: string, params?: {}, init?: RequestInit): Promise<any> => {\r\n\r\n  let fullUrl = `${domain}/${url}${paramsToString('?', params)}`;\r\n\r\n  if (!init)\r\n    init = {\r\n      mode: 'cors',\r\n      credentials: 'same-origin'  \r\n    }\r\n\r\n  const response = await fetch(fullUrl, init);\r\n  return await response.json();\r\n  \r\n}","import { fetchAndGetJson, urlTopicsList } from '.'\r\n\r\nimport type { ITopicsList, ITopicsListItem } from 'src/data/topicslist'\r\n\r\nexport interface IRequest {\r\n  itemsPerPage?: number | null,\r\n  page?: number | null,\r\n  beforeTime?: string | null,\r\n  forum?: string | null,\r\n  section?: string | null,\r\n  user_id?: string | null,\r\n  myTopics?: string | null\r\n}\r\n\r\ninterface IAPIResponse {\r\n  id: number,\r\n  forum: string,\r\n  sect1: string,\r\n  sect2: string,\r\n  v8: string,\r\n  closed: number,\r\n  down: number,\r\n  paid: number,\r\n  text: string,\r\n  message: string,\r\n  created: number,\r\n  utime: number,\r\n  user: string,\r\n  user0: string,\r\n  is_voting: number,\r\n  answ: number\r\n}\r\n\r\nfunction convertResponse(response: IAPIResponse): ITopicsListItem {\r\n\r\n  return ({\r\n    id: response.id,\r\n    forum: response.forum,\r\n    section: response.sect1,\r\n    sectionCode: response.sect2,\r\n    author: response.user0,\r\n    lastUser: response.user,\r\n    created: response.created * 1000,\r\n    updated: response.utime * 1000,\r\n    count: response.answ,\r\n    text: response.text,\r\n    closed: response.closed === 1,\r\n    down: response.down === 1,\r\n    pinned: response.utime === 2147483648,\r\n    isVoting: response.is_voting === 1,\r\n    showPreview: false\r\n  })\r\n\r\n}\r\n\r\nasync function fetchTopicsList(params?: IRequest): Promise<ITopicsList> {\r\n\r\n  //const request = convertRequest(params);\r\n\r\n  const list = await fetchAndGetJson(urlTopicsList, params);\r\n  return list.map(convertResponse);\r\n\r\n}\r\n\r\nexport { fetchTopicsList }","import { createAction } from '@reduxjs/toolkit'\r\n\r\nimport * as API from 'src/api/topicslist'\r\nimport { domain, urlTopicsList } from 'src/api/index';\r\n\r\nimport { RootState } from '../store';\r\n\r\nexport const requestTopicsList = createAction('REQUEST_TOPICS_LIST');\r\nexport const receiveTopicsList = createAction('RECEIVE_TOPICS_LIST', list => ({\r\n  payload: {\r\n    list\r\n  },\r\n  error: false\r\n}));\r\nexport const receiveTopicsListFailed = createAction('RECEIVE_TOPICS_LIST', error => ({\r\n  payload: error,\r\n  error: true\r\n}));\r\nexport const clearTopicsList = createAction('CLEAR_TOPICS_LIST');\r\nexport const togglePreview = createAction('TOGGLE_PREVIEW', (id, msgNumber) => ({\r\n  payload : {\r\n    id,\r\n    msgNumber\r\n  }\r\n}));\r\n\r\nconst getTopicsList = (params: any) => async (dispatch: any, getState: any) => {\r\n\r\n  dispatch(requestTopicsList())\r\n\r\n  const page = params.page || 1;\r\n  let reqestParams: any = {};\r\n\r\n  let topicsPerPage = +getState().options.items.topicsPerPage;\r\n  if (topicsPerPage > 99) topicsPerPage = 99;\r\n\r\n  let topicsCount = page * topicsPerPage;\r\n  reqestParams.topics = topicsCount;\r\n\r\n  if (params.section)\r\n    reqestParams.section_short_name = params.section;\r\n\r\n  if (params.forum)\r\n    reqestParams.forum = params.forum;\r\n\r\n  if (params.user_id)\r\n    reqestParams.user_id = params.user_id;\r\n\r\n  if (params.mytopics)\r\n    reqestParams.mytopics = params.mytopics;\r\n\r\n  try {\r\n    const json = await API.fetchTopicsList(reqestParams);\r\n\r\n    let data = json.slice(-topicsPerPage);\r\n    dispatch(receiveTopicsList(data));\r\n\r\n  } catch (e) {\r\n\r\n    dispatch(receiveTopicsListFailed(`${e.message} ${domain}/${urlTopicsList}`));\r\n    console.error(e.message);\r\n\r\n  }\r\n\r\n}\r\n\r\nconst shouldGetTopicsList = (state: RootState) => {\r\n  const topicsList = state.topicsList;\r\n  if (!topicsList) {\r\n    return true\r\n  }\r\n  if (topicsList.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const getTopicsListIfNeeded = (params: any): any => (dispatch: any, getState: any) => {\r\n  if (shouldGetTopicsList(getState())) {\r\n    return dispatch(getTopicsList(params));\r\n  }\r\n}\r\n","import React, { ReactElement } from 'react';\r\nimport { useDispatch } from 'react-redux'\r\n\r\nimport Navbar from 'react-bootstrap/Navbar'\r\nimport Nav from 'react-bootstrap/Nav'\r\nimport Form from 'react-bootstrap/Form'\r\nimport { Link, useLocation } from \"react-router-dom\";\r\n\r\nimport Search from 'src/components/common/search'\r\nimport { getTopicsListIfNeeded } from 'src/data/topicslist/actions'\r\n\r\nimport './nav_bar.css'\r\n\r\nconst NavBar = (): ReactElement => {\r\n\r\n  const location = useLocation();\r\n  const dispatch = useDispatch();\r\n\r\n  const locationParams = new URLSearchParams(location.search);\r\n  const forum = locationParams.get('forum');\r\n\r\n  const onClick = () => {\r\n    dispatch(getTopicsListIfNeeded({}));\r\n  }\r\n\r\n  const internalLinks = [\r\n    { name: '1C', link: `/index.php?forum=1C` },\r\n    { name: 'IT', link: `/index.php?forum=IT` },\r\n    { name: 'JOB', link: `/index.php?forum=JOB` },\r\n    { name: 'LIFE', link: `/index.php?forum=LIFE` },\r\n  ];\r\n\r\n  const externalLinks = [\r\n    { name: 'Wiki', link: 'https://wiki.mista.ru' },\r\n    { name: 'Книга знаний', link: 'https://kb.mista.ru' },\r\n  ];\r\n\r\n  return (\r\n    <Navbar bg=\"dark\" variant=\"dark\" expand=\"md\" fixed=\"top\">\r\n      <Navbar.Brand\r\n        as={Link}\r\n        to={`/`}\r\n        onClick={onClick}>\r\n        React.Mista\r\n      </Navbar.Brand>\r\n      <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\r\n      <Navbar.Collapse>\r\n        <Nav className=\"me-auto\">\r\n          {internalLinks.map((item, i) =>\r\n            <Nav.Item key={'i'+ i}>\r\n              <Nav.Link to={item.link} active={item.name === forum} as={Link}>\r\n                {item.name}\r\n              </Nav.Link>\r\n            </Nav.Item>\r\n          )}\r\n          {externalLinks.map((item, i) =>\r\n            <Nav.Item key={'e'+ i}>\r\n              <Nav.Link href={item.link}>\r\n                {item.name}\r\n              </Nav.Link>\r\n            </Nav.Item>\r\n          )}          \r\n        </Nav>\r\n        <Form className=\"d-flex\">\r\n          <Search />\r\n        </Form>\r\n      </Navbar.Collapse>\r\n    </Navbar>\r\n  )\r\n}\r\n\r\nexport default NavBar;","import { createReducer } from '@reduxjs/toolkit'\r\nimport { initialState } from '.'\r\nimport { requestTopicsList, receiveTopicsList, clearTopicsList, togglePreview } from './actions'\r\n\r\nconst reducer = createReducer(initialState, (builder) => {\r\n  builder\r\n    .addCase(requestTopicsList, (state) => {\r\n      state.isFetching = true\r\n    })\r\n    .addCase(receiveTopicsList, (state, action) => {\r\n\r\n      if (action.error) {\r\n        state.error = action.payload.toString();\r\n      } else {\r\n        state.items = action.payload.list;\r\n        delete state.error;\r\n      }\r\n      state.lastUpdated = new Date().getTime();\r\n      state.isFetching = false;\r\n    })\r\n    .addCase(clearTopicsList, (state) => {\r\n      state.items = [];\r\n      state.isFetching = false;\r\n      delete state.error;\r\n      delete state.lastUpdated;\r\n    })\r\n    .addCase(togglePreview, (state, action) => {\r\n      let items = state.items.slice();\r\n      const ind = items.findIndex(item => item.id === action.payload.id);\r\n\r\n      let item = Object.assign({}, items[ind]);\r\n      item.showPreview = !item.showPreview;\r\n      item.previewMsgNumber = action.payload.msgNumber;\r\n      items[ind] = item;\r\n      state.items = items;\r\n    })    \r\n})\r\n\r\nexport default reducer;\r\n","export interface ITopicsListItem {\r\n  id: number,\r\n  author: string,\r\n  lastUser: string,\r\n  forum: string,\r\n  sectionCode: string,\r\n  section: string,\r\n  count: number,\r\n  text: string,\r\n  created: number,\r\n  updated: number,\r\n  closed: boolean,\r\n  down: boolean,\r\n  pinned: boolean\r\n  isVoting: boolean,\r\n  showPreview: boolean,\r\n  previewMsgNumber?: number\r\n}\r\n\r\nexport interface ITopicsList extends Array<ITopicsListItem> { }\r\n\r\nexport interface ITopicsListState {\r\n  isFetching: boolean;\r\n  items: ITopicsList,\r\n  error?: string,\r\n  lastUpdated?: number\r\n}\r\n\r\nexport const initialState: ITopicsListState = {\r\n  isFetching: false,\r\n  items: []\r\n}","export interface IVotingItem {\r\n  text: string,\r\n  count: number\r\n}\r\n\r\nexport interface ITopicInfo {\r\n    id: number,\r\n    title: string,\r\n    forum?: string,\r\n    sectionId?: string,\r\n    created?: number,\r\n    authorId?: string,\r\n    author?: string,\r\n    updated?: number,\r\n    lastUser?: string,\r\n    count?: number,\r\n    down?: number,\r\n    closed?: number,\r\n    deleted?: number,\r\n    isVoting?: number,\r\n    voting?: IVotingItem[]\r\n  }\r\n\r\nexport interface ITopicMessage {\r\n  id: number,\r\n  n: number,\r\n  user: string,\r\n  userId: number,\r\n  text: string,\r\n  time: number,\r\n  vote: number\r\n}\r\n\r\nexport interface ITopicMessagesList extends Array<ITopicMessage> {}\r\n\r\nexport interface ITopicState {\r\n  isFetching: boolean;\r\n  items: ITopicMessagesList,\r\n  item0?: ITopicMessage,\r\n  info?: ITopicInfo,\r\n  error?: string,\r\n  lastUpdated?: number\r\n}\r\n\r\nexport const defaultInfo: ITopicInfo = {\r\n  id: 0,\r\n  title: \"\",\r\n  count: 0\r\n}\r\n\r\nexport const initialState: ITopicState = {\r\n  isFetching: false,\r\n  items: [],\r\n  info: defaultInfo\r\n}\r\n\r\n","import { fetchAndGetJson, urlTopicInfo } from '.'\r\nimport type { ITopicInfo } from 'src/data/topic'\r\n\r\ninterface IAPIResponse {\r\n  id: string,\r\n  text: string,\r\n  forum: string,\r\n  section: string,\r\n  created: string,\r\n  user_id: string,\r\n  user_name: string,\r\n  updated: string,\r\n  updated_name: string,\r\n  answers_count: string,\r\n  down: number,\r\n  closed: number,\r\n  deleted: number,\r\n  is_voting: number,\r\n  voting: {\r\n    select: string,\r\n    result: number\r\n  }[]\r\n}\r\n\r\nfunction convertResponse(response: IAPIResponse): ITopicInfo {\r\n\r\n  let voting = [];\r\n  if (response.voting)\r\n    voting = response.voting.map(x => ({\r\n      text: x.select,\r\n      count: x.result\r\n    }));\r\n    \r\n  return ({\r\n    id: parseInt(response.id),\r\n    title: response.text,\r\n    forum: response.forum,\r\n    sectionId: response.section,\r\n    created: parseInt(response.created) * 1000,\r\n    authorId: response.user_id,\r\n    author: response.user_name,\r\n    updated: parseInt(response.updated) * 1000,\r\n    lastUser: response.updated_name,\r\n    count: parseInt(response.answers_count),\r\n    down: response.down,\r\n    closed: response.closed,\r\n    deleted: response.deleted,\r\n    isVoting: response.is_voting,\r\n    voting\r\n  })\r\n\r\n}\r\n\r\nasync function fetchTopicInfo(id: number): Promise<ITopicInfo> {\r\n\r\n  const info = await fetchAndGetJson(urlTopicInfo, { id });\r\n  return convertResponse(info);\r\n\r\n}\r\n\r\nexport { fetchTopicInfo }","\r\nimport { fetchAndGetJson, urlTopicMessages } from '.'\r\nimport type { ITopicMessage, ITopicMessagesList } from 'src/data/topic'\r\n\r\ninterface IAPIRequest {\r\n  id: number,\r\n  from?: number,\r\n  to?: number\r\n}\r\n\r\nexport interface IRequest extends IAPIRequest {}\r\n\r\ninterface IAPIResponse {\r\n  id: string,\r\n  n: string,\r\n  user: string,\r\n  userId: string,\r\n  text: string,\r\n  utime: string,\r\n  vote: number\r\n}  \r\n\r\nfunction convertResponse(response: IAPIResponse): ITopicMessage {\r\n\r\n  return ({\r\n    id: parseInt(response.id),\r\n    n: parseInt(response.n),\r\n    user: response.user,\r\n    userId: parseInt(response.userId),\r\n    text: response.text,\r\n    time: parseInt(response.utime) * 1000,\r\n    vote: response.vote\r\n  })\r\n\r\n}\r\n\r\nasync function fetchTopicMessages(params?: IRequest): Promise<ITopicMessagesList> {\r\n\r\n  const list = await fetchAndGetJson(urlTopicMessages, params);\r\n  return list.map(convertResponse);\r\n\r\n}\r\n\r\nasync function fetchTopicMessage(id: number, n: number): Promise<ITopicMessage> {\r\n\r\n  const to = (n === 0) ? n+1 : n;\r\n\r\n  const list = await fetchAndGetJson(urlTopicMessages, {id, from: n, to});\r\n  return list.map(convertResponse).find((item: ITopicMessage) => item.n === n);\r\n\r\n}\r\n\r\nexport { fetchTopicMessages, fetchTopicMessage }","import { createAction } from '@reduxjs/toolkit'\r\n\r\nimport { fetchTopicInfo } from 'src/api/topicinfo'\r\nimport { fetchTopicMessage, fetchTopicMessages } from 'src/api/topicMessages'\r\nimport { ITopicInfo, ITopicMessage } from '.';\r\n\r\nexport const requestTopic = createAction('REQUEST_TOPIC');\r\nexport const receiveTopic = createAction('RECEIVE_TOPIC', (info, item0, list) => ({\r\n  payload: {\r\n    info,\r\n    item0,\r\n    list\r\n  },\r\n  error: false\r\n}));\r\nexport const receiveTopicFailed = createAction('RECEIVE_TOPIC', error => ({\r\n  payload: error,\r\n  error: true\r\n}));\r\nexport const clearTopicMessages = createAction('CLEAR_TOPIC_MESSAGES');\r\n\r\nexport const requestNewMessages = createAction('REQUEST_NEW_MESSAGES');\r\nexport const receiveNewMessages = createAction('RECEIVE_NEW_MESSAGES', (list) => ({\r\n  payload: {\r\n    list\r\n  },\r\n  error: false\r\n}));\r\nexport const receiveNewMessagesFailed = createAction('RECEIVE_NEW_MESSAGES', error => ({\r\n  payload: error,\r\n  error: true\r\n}));\r\n\r\nexport const getTopic = (topicId: number, page: number | string, item0: ITopicMessage) => async (dispatch: any) => {\r\n\r\n  dispatch(requestTopic())\r\n\r\n  let info: ITopicInfo;\r\n  try {\r\n    info = await fetchTopicInfo(topicId);\r\n  } catch (e) {\r\n    console.error(e);\r\n    info = {\r\n      id: topicId,\r\n      title: '',\r\n      count: 0\r\n    };\r\n  }\r\n  try {\r\n    let _item0 = item0;\r\n    let _items;\r\n    if (page === 'last20') {\r\n\r\n      if (info.count > 21) {\r\n\r\n        if (!_item0) {\r\n          _item0 = await fetchTopicMessage(topicId, 0);\r\n        }\r\n\r\n        let first = info.count - 20;\r\n        _items = await fetchTopicMessages({\r\n          id: topicId,\r\n          from: first,\r\n          to: 1010\r\n        });\r\n\r\n      } else {\r\n        let items = await fetchTopicMessages({\r\n          id: topicId,\r\n          from: 0,\r\n          to: 1010\r\n        });\r\n        _item0 = items[0];\r\n        _items = items.slice(1);\r\n      }\r\n\r\n    } else {\r\n\r\n      page = +page;\r\n      let first = 0;\r\n      let last = page * 100 - 1;\r\n\r\n      if (page > 1) {\r\n\r\n        first = (page - 1) * 100;\r\n        if (!_item0) {\r\n          _item0 = await fetchTopicMessage(topicId, 0);\r\n        }\r\n\r\n        _items = await fetchTopicMessages({\r\n          id: topicId,\r\n          from: first,\r\n          to: last\r\n        });\r\n\r\n      } else {\r\n        if (_item0)\r\n          first = 1;\r\n        else\r\n          first = 0;\r\n\r\n        let items = await fetchTopicMessages({\r\n          id: topicId,\r\n          from: first,\r\n          to: last\r\n        });\r\n\r\n        if (_item0) {\r\n          _items = items;\r\n        } else {\r\n          _item0 = items[0];\r\n          _items = items.slice(1);\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    if (info.count === 0 && _items.length > 0)\r\n      info.count = _items[_items.length - 1].n;\r\n\r\n    if (page === 'last20' && _items.length > 20) {\r\n      _items = _items.slice(-20);\r\n    }\r\n\r\n    dispatch(receiveTopic(info, _item0, _items));\r\n\r\n  } catch (error) {\r\n\r\n    console.error('Failed to fetch topic:', error);\r\n    dispatch(receiveTopicFailed(error.message));\r\n\r\n  }\r\n}\r\n\r\nconst shouldFetch = (state) => {\r\n  const topic = state.topic;\r\n  if (!topic) {\r\n    return true\r\n  }\r\n  if (topic.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const getTopicIfNeeded = (topicId: number, page: number |string, item0: any): any => (dispatch: any, getState: any) => {\r\n  if (shouldFetch(getState())) {\r\n    return dispatch(getTopic(topicId, page, item0));\r\n  }\r\n}\r\n\r\nexport type FetchNewMessageseParams = {\r\n  id: number | string,\r\n  last: number\r\n}\r\n\r\nexport const getNewMessages = (id: number, count: number) => async (dispatch: any) => {\r\n\r\n  dispatch(requestNewMessages());\r\n\r\n  try {\r\n    const list = await fetchTopicMessages({\r\n      id: id,\r\n      from: count + 1,\r\n      to: 1050\r\n    });\r\n    dispatch(receiveNewMessages(list));\r\n\r\n  } catch (e) {\r\n    console.error('Failed to fetch new messages:', (e as Error).message);\r\n    dispatch(receiveNewMessagesFailed((e as Error).message));\r\n  }\r\n\r\n}\r\n\r\nexport const getNewMessagesIfNeeded = () => (dispatch: any, getState: any) => {\r\n  const state = getState();\r\n  const { id, count } = state.topic.info;\r\n  if (shouldFetch(state)) {\r\n    return dispatch(getNewMessages(id, count));\r\n  }\r\n}","import { createReducer } from '@reduxjs/toolkit'\r\nimport { defaultInfo, initialState } from '.';\r\n\r\nimport { requestTopic, receiveTopic, clearTopicMessages, requestNewMessages, receiveNewMessages } from './actions'\r\n\r\nconst reducer = createReducer(initialState, (builder) => {\r\n  builder\r\n    .addCase(requestTopic, (state) => {\r\n      state.isFetching = true\r\n    })\r\n    .addCase(receiveTopic, (state, action) => {\r\n\r\n      if (action.error) {\r\n        state.error = action.payload.toString();\r\n      } else {\r\n        state.items = action.payload.list;\r\n        state.item0 = action.payload.item0;\r\n        state.info = action.payload.info;\r\n        delete state.error;\r\n      }\r\n      state.lastUpdated = new Date().getTime();\r\n      state.isFetching = false;\r\n    })\r\n    .addCase(clearTopicMessages, (state) => {\r\n      state.items = [];\r\n      state.info = defaultInfo;\r\n      delete state.item0;\r\n      delete state.error;\r\n    })\r\n    .addCase(requestNewMessages, (state) => {\r\n      state.isFetching = true\r\n    })\r\n    .addCase(receiveNewMessages, (state, action) => {\r\n      if (action.error) {\r\n        state.error = action.payload.toString();\r\n      } else {\r\n        state.isFetching = false;\r\n        if (action.payload.list.length > 0) {\r\n          state.items = state.items.concat(action.payload.list);\r\n          state.info.count = state.items[state.items.length - 1].n;\r\n        }  \r\n      }\r\n    })\r\n})\r\n\r\nexport default reducer;","import { fetchJsonpAndGetJson, urlSections } from '.'\r\nimport type { ISectionsList, ISectionItem } from 'src/data/sections'\r\n\r\ninterface IAPIResponse {\r\n  id: number,\r\n  forum: string,\r\n  shortn: string,\r\n  fulln: string\r\n}\r\n\r\nfunction convertResponse(response: IAPIResponse): ISectionItem {\r\n\r\n  return ({\r\n    id: response.id,\r\n    forum: response.forum,\r\n    code: response.shortn,\r\n    name: response.fulln,\r\n  })\r\n\r\n}\r\n\r\nexport const fetchSections = async (): Promise<ISectionsList> => {\r\n  const list = await fetchJsonpAndGetJson(urlSections);\r\n  return list.map(convertResponse);\r\n}\r\n","import { createAction } from '@reduxjs/toolkit'\r\n\r\nimport { fetchSections } from 'src/api/sections'\r\nimport { RootState } from '../store';\r\n\r\nexport const requestSections = createAction('REQUEST_SECTIONS');\r\nexport const receiveSections = createAction('RECEIVE_SECTIONS', list => ({\r\n  payload: {\r\n    list,\r\n  },\r\n  error: false\r\n}));\r\n\r\nexport const receiveSectionsFailed = createAction('RECEIVE_SECTIONS', error => ({\r\n  payload: error,\r\n  error: true\r\n}));\r\n\r\nexport const getSections = () => async (dispatch: any) => {\r\n\r\n  dispatch(requestSections());\r\n\r\n  try {\r\n    \r\n    const list = await fetchSections();\r\n    dispatch(receiveSections(list));\r\n\r\n  } catch (e) {\r\n\r\n    dispatch(receiveSectionsFailed(e.message));\r\n    console.error(e);\r\n\r\n  }\r\n\r\n}\r\n\r\nconst shouldGetSections = (state: RootState): boolean => {\r\n\r\n  const sections = state.sections;\r\n\r\n  if (!sections)\r\n    return true\r\n\r\n  if (sections.isFetching)\r\n    return false\r\n\r\n  if (sections.items.length > 0)\r\n    return false;\r\n\r\n  return true\r\n}\r\n\r\nexport const getSectionsIfNeeded = (): any => (dispatch: any, getState: any) => {\r\n  if (shouldGetSections(getState())) {\r\n    return dispatch(getSections());\r\n  }\r\n}","import { createReducer } from '@reduxjs/toolkit'\r\n\r\nimport { requestSections, receiveSections } from './actions'\r\nimport { groupBy } from 'src/utils'\r\nimport { initialState } from '.'\r\n\r\nconst reducer = createReducer(initialState, (builder) => {\r\n  builder\r\n    .addCase(requestSections, (state) => {\r\n      state.isFetching = true\r\n    })\r\n    .addCase(receiveSections, (state, action) => {\r\n\r\n      if (action.error) {\r\n        state.error = action.payload.toString();\r\n      } else {\r\n        state.items = action.payload.list;\r\n        state.tree = groupBy(state.items, item => item.forum);\r\n        delete state.error;\r\n      }\r\n      state.lastUpdated = new Date().getTime();\r\n      state.isFetching = false;\r\n    })\r\n})\r\n\r\nexport default reducer;\r\n","export interface ISectionItem {\r\n  id: number;\r\n  forum: string,\r\n  code: string,\r\n  name: string,\r\n}\r\n\r\nexport interface ISectionsList extends Array<ISectionItem> {}\r\n\r\nexport interface ISectionsTree{\r\n  [key: string]: ISectionItem[]\r\n}\r\n\r\nexport interface ISectionsListState {\r\n  isFetching: boolean;\r\n  items: ISectionsList,\r\n  tree?: {},\r\n  error?: string,\r\n  lastUpdated?: number\r\n}\r\n\r\nexport const initialState: ISectionsListState = {\r\n  isFetching: false,\r\n  items: [],\r\n  tree: {}\r\n}\r\n","export interface IOptionsItems {\r\n  theme: 'yellow' | 'lightgray' | 'dark',\r\n  topicsPerPage: string,\r\n  autoRefreshTopicsList: string,\r\n  autoRefreshTopicsListInterval: string,\r\n  autoRefreshTopic: string,\r\n  autoRefreshTopicInterval: string,\r\n  tooltipDelay: string,\r\n  showTooltips: string,\r\n  showYoutubeVideoTitle: string,\r\n  replaceCatalogMista: string,\r\n  fixBrokenLinks: string\r\n}\r\n\r\nexport interface IOptionsState {\r\n  voteColors: Array<string>,\r\n  items: IOptionsItems,\r\n  show?: boolean\r\n};\r\n\r\nexport const defaultOptionsState: IOptionsState = {\r\n  voteColors: [\r\n    \"#FF1616\", //1\r\n    \"#1A861A\", //2\r\n    \"#0023FF\", //3\r\n    \"#FF6B18\", //4\r\n    \"#9B3A6E\", //5\r\n    \"#567655\", //6\r\n    \"#233345\", //7\r\n    \"#CC0000\", //8\r\n    \"#00CCCC\", //9\r\n    \"#0000CC\", //10\r\n  ],\r\n  items: {\r\n    theme: 'lightgray',\r\n    topicsPerPage: '20',\r\n    autoRefreshTopicsList: 'false',\r\n    autoRefreshTopicsListInterval: '60',\r\n    autoRefreshTopic: 'true',\r\n    autoRefreshTopicInterval: '60',\r\n    //tooltips\r\n    showTooltips: 'true',\r\n    tooltipDelay: '500',\r\n    //links\r\n    showYoutubeVideoTitle: 'true',\r\n    replaceCatalogMista: 'true',\r\n    fixBrokenLinks: 'true',\r\n  }\r\n}","import { createAction } from '@reduxjs/toolkit'\r\n\r\nexport const readOptions = createAction('READ_OPTIONS');\r\nexport const saveOptions = createAction('SAVE_OPTIONS', options => ({\r\n  payload: {\r\n    options,\r\n  }\r\n}));\r\n","import { createReducer } from '@reduxjs/toolkit'\r\nimport { defaultOptionsState, IOptionsState } from '.';\r\nimport { readOptions, saveOptions } from './actions'\r\n\r\n\r\nconst readOption = (name: string, defaultValue: string): string => {\r\n  return window.localStorage.getItem(name) || defaultValue;\r\n}\r\n\r\nconst readAllOptions = (): IOptionsState => {\r\n  \r\n  let state: IOptionsState = defaultOptionsState;\r\n  for (let key in state.items) {\r\n    state.items[key] = readOption(key, state.items[key]);\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nconst reducer = createReducer(readAllOptions(), (builder) => {\r\n  builder\r\n    .addCase(readOptions, (state) => {\r\n      let items = Object.assign({}, defaultOptionsState.items);\r\n      for (let key in items) {\r\n        items[key] = readOption(key, defaultOptionsState.items[key]);\r\n      }\r\n      state.items = items;\r\n    })\r\n    .addCase(saveOptions, (state, action) => {\r\n      for (let key in action.payload.options) {\r\n        const value = String(action.payload.options[key]); \r\n        window.localStorage.setItem(key, value);\r\n        state.items[key] = value;\r\n      }\r\n    })\r\n  })\r\n\r\nexport default reducer;","import { fetchJsonpAndGetJson, urlCookies } from '.'\r\nimport { ILogin } from 'src/data/login';\r\n\r\nexport type IAPIResponse = {\r\n  cookie: {\r\n    entr_id: string,\r\n    entr_key: string,\r\n    entr_hash: string,\r\n    musthave: string,\r\n    hotlog: string\r\n  },\r\n  session: {\r\n    entered: number,\r\n    user_id: string,\r\n    user_name: string,\r\n    user_hash: string,\r\n    is_moderator: number,\r\n    light_moderator: number,\r\n    section: string,\r\n    show_moderator_tools: number,\r\n    kb: string,\r\n    registered_unixtime: string,\r\n    guid: string,\r\n    last_error?: string,\r\n    user: {\r\n      id: string,\r\n      name: string,\r\n      is_moderator: boolean,\r\n      light_moderator: boolean,\r\n      kb: boolean,\r\n      section_owner: boolean,\r\n      section: string,\r\n      registered_unixtime: string,\r\n      balance: number\r\n    }\r\n  }\r\n}\r\n\r\nfunction convertResponse(response: IAPIResponse): ILogin {\r\n\r\n  const { session } = response;\r\n\r\n  return ({\r\n    userId: Number(session?.user_id),\r\n    userName: session?.user_name,\r\n    userHash: session?.user_hash,\r\n    lastError: session?.last_error\r\n  })\r\n\r\n}\r\n\r\nasync function fetchCookies(): Promise<ILogin| undefined>  {\r\n\r\n  const response = await fetchJsonpAndGetJson(urlCookies);\r\n  return convertResponse(response);\r\n\r\n}\r\n\r\nexport { fetchCookies }","import { domain, urlLogin, urlLogout, paramsToString } from '.'\r\n\r\nexport interface IRequest {\r\n  username: string,\r\n  password: string,\r\n}\r\n\r\nexport const fetchLogin = async (params: IRequest): Promise<void> => {\r\n  await fetch(`${domain}/${urlLogin}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', {user_name: params.username, user_password: params.password}),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Accept': 'text/html,application/xhtml+xml,application/xml',\r\n      'Content-Type': 'application/x-www-form-urlencoded',\r\n    },\r\n    redirect: 'follow'\r\n  });\r\n}\r\n\r\nexport const fetchLogout = async (): Promise<void> => {\r\n  const fullUrl = `${domain}/${urlLogout}`;\r\n  await fetch(fullUrl, {\r\n    mode: 'no-cors',\r\n    credentials: 'include'\r\n  });\r\n}","import { createAction } from '@reduxjs/toolkit'\r\n\r\nimport { fetchCookies } from 'src/api/cookies';\r\nimport { fetchLogin, fetchLogout } from 'src/api/login'\r\nimport { RootState } from '../store';\r\n\r\nexport const loginStart = createAction('LOGIN_START');\r\nexport const loginComplete = createAction('LOGIN_COMPLETE', (userId, userName, userHash) => ({\r\n  payload: {\r\n    userId,\r\n    userName,\r\n    userHash,\r\n  },\r\n  error: false\r\n}));\r\nexport const loginFailed = createAction('LOGIN_COMPLETE', error => ({\r\n  payload: error,\r\n  error: true\r\n}));\r\n\r\nexport const logoutStart = createAction('LOGOUT_START');\r\nexport const logoutComplete = createAction('LOGOUT_COMPLETE');\r\n\r\nexport const checkLoginStart = createAction('CHECK_LOGIN_START');\r\n\r\nconst shouldLogin = (state: RootState): boolean => {\r\n  const { login } = state;\r\n  if (!login) {\r\n    return true\r\n  }\r\n  if (login.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const checkLogin = () => async (dispatch: any) => {\r\n\r\n  dispatch(checkLoginStart());\r\n\r\n  let json;\r\n  try {\r\n    json = await fetchCookies();\r\n  } catch (e) {\r\n    dispatch(loginFailed(e.message));\r\n    return;\r\n  }\r\n \r\n  if (json && json.userId){\r\n\r\n    let error = (json.lastError || '').trim();\r\n    if (error === 'Не указано сообщение.') error = '';\r\n    dispatch(loginComplete(\r\n      json.userId,\r\n      json.userName,\r\n      json.userHash\r\n    ));\r\n  } else\r\n    dispatch(loginFailed(''));\r\n}\r\n\r\nexport const checkLoginIfNeeded = () => (dispatch: any, getState: any) => {\r\n  if (shouldLogin(getState())) {\r\n    return dispatch(checkLogin())\r\n  }\r\n}\r\n\r\nexport const doLogout = () => async (dispatch: any) => {\r\n\r\n  dispatch(logoutStart());\r\n\r\n  try {\r\n    await fetchLogout();\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n  \r\n  dispatch(logoutComplete());\r\n  dispatch(checkLogin());\r\n\r\n}\r\n\r\nexport const doLogin = (username: string, password: string): any => async (dispatch: any) => {\r\n\r\n  dispatch(loginStart());\r\n  try {\r\n\r\n    await fetchLogin({\r\n      username: username,\r\n      password: password\r\n    })\r\n\r\n    dispatch(checkLogin());\r\n\r\n  } catch (err) {\r\n    console.error('Login error :', err);\r\n    dispatch(loginFailed(err.message));\r\n  }\r\n\r\n}\r\n\r\nexport const doLoginIfNeeded = (username: string, password: string): any => (dispatch: any, getState: any) => {\r\n  if (shouldLogin(getState())) {\r\n    return dispatch(doLogin(username, password))\r\n  }\r\n}","import { createReducer } from '@reduxjs/toolkit'\r\nimport { initialState } from '.';\r\nimport { loginStart, loginComplete, logoutStart, logoutComplete, checkLoginStart } from './actions'\r\n\r\nconst reducer = createReducer(initialState, (builder) => {\r\n  builder\r\n    .addCase(loginStart, (state) => {\r\n      state.isFetching = true;\r\n    })\r\n    .addCase(checkLoginStart, (state) => {\r\n      state.isFetching = true;\r\n    })    \r\n    .addCase(loginComplete, (state, action) => {\r\n      if (action.error) {\r\n        state.logged = false;\r\n        state.error = action.payload.toString();\r\n      } else {\r\n\r\n        state.userId = action.payload.userId;\r\n        state.userName = action.payload.userName;\r\n        state.userHash = action.payload.userHash;\r\n        state.logged = true;\r\n        delete state.error;\r\n      }\r\n      state.lastUpdated = new Date().getTime();\r\n      state.isFetching = false;\r\n    })\r\n    .addCase(logoutStart, (state) => {\r\n      state.isFetching = true;\r\n    })\r\n    .addCase(logoutComplete, (state) => {\r\n      state.isFetching = false;\r\n      state.logged = false;\r\n      delete state.userId;\r\n      delete state.userName;\r\n      delete state.userHash;\r\n      delete state.error;\r\n    })    \r\n})\r\n\r\nexport default reducer;\r\n","export interface ILogin {\r\n  userId?: number;\r\n  userName?: string,\r\n  userHash?: string,\r\n  lastError?: string,\r\n}\r\n\r\nexport interface ILoginState {\r\n  logged?: boolean,\r\n  userId?: number,\r\n  userName?: string,\r\n  userHash?: string,\r\n  lastError?: string,\r\n  error?: string,\r\n  lastUpdated?: number,\r\n  isFetching: boolean,\r\n}\r\n\r\nexport const initialState: ILoginState = {\r\n  isFetching: false\r\n}\r\n","import { createAction } from '@reduxjs/toolkit'\r\nimport { ICoords, ITooltipKeys } from '.';\r\nimport { RootState } from '../store'\r\n\r\nexport const createTooltip = createAction('CREATE_TOOLTIP', (keys, coords) => ({\r\n  payload: {\r\n    keys,\r\n    coords\r\n  },\r\n}));\r\nexport const closeTooltip = createAction('CLOSE_TOOLTIP', keys => ({\r\n  payload: {\r\n    keys\r\n  },\r\n}));\r\nexport const clearTooltips = createAction('CLEAR_TOOLTIPS');\r\n\r\nexport const showTooltip = (keys: ITooltipKeys, coords: ICoords): any => async (dispatch: any) => {\r\n  dispatch(createTooltip(keys, coords));\r\n}\r\n\r\nexport const clearTooltipsIfNeeded = (): any => (dispatch: any, getState: any) => {\r\n  const state: RootState = getState();\r\n  if (state.tooltips.items.length > 0) {\r\n    dispatch(clearTooltips());;\r\n  }\r\n}","import { createReducer } from '@reduxjs/toolkit'\r\nimport { initialState } from '.';\r\nimport { createTooltip, closeTooltip, clearTooltips } from './actions'\r\n\r\nconst reducer = createReducer(initialState, (builder) => {\r\n  builder\r\n    .addCase(createTooltip, (state, action) => {\r\n      const hash = JSON.stringify(action.payload.keys);\r\n      const index = state.items.findIndex(item => item.hash === hash);\r\n      let zIndex = 0;\r\n      if (state.items.length)\r\n        zIndex = state.items[state.items.length - 1].zIndex + 1;\r\n      if (index === - 1)\r\n        state.items.push({\r\n          keys: action.payload.keys,\r\n          coords: action.payload.coords,\r\n          hash,\r\n          zIndex \r\n        })\r\n      else {\r\n        //state.list = moveToEnd(state.list, index);\r\n        state.items[state.items.length - 1].zIndex = zIndex;\r\n      }  \r\n    })\r\n    .addCase(closeTooltip, (state, action) => {\r\n      let hash = JSON.stringify(action.payload.keys);\r\n      state.items = state.items.filter(val => val.hash !== hash);\r\n    })\r\n    .addCase(clearTooltips, (state) => {\r\n      state.items = [];\r\n    })    \r\n})\r\n\r\nexport default reducer;\r\n","export interface ITooltipKeys {\r\n  topicId: number,\r\n  number: number\r\n}\r\n\r\nexport interface ICoords {\r\n  x: number,\r\n  y: number\r\n}\r\n\r\nexport interface ITooltipItem {\r\n  hash: string,\r\n  keys: ITooltipKeys,\r\n  coords: ICoords,\r\n  zIndex: number\r\n}\r\n\r\nexport interface ITooltipsList extends Array<ITooltipItem> {}\r\n\r\nexport interface ITooltipsState {\r\n  items: ITooltipsList,\r\n}\r\n\r\nexport const initialState: ITooltipsState = {\r\n  items: []\r\n}","import { domain, paramsToString, urlNewTopic } from \".\";\r\n\r\nexport interface IRequest {\r\n  action: \"new\",\r\n  rnd: number,\r\n  topic_text: string,\r\n  message_text: string,\r\n  target_section: string,\r\n  target_forum: string,\r\n  voting: number,\r\n  select1?: string,\r\n  select2?: string,\r\n  select3?: string,\r\n  select4?: string,\r\n  select5?: string,\r\n  select6?: string,\r\n  select7?: string,\r\n  select8?: string,\r\n  select9?: string,\r\n  select10?: string\r\n}\r\n\r\nexport const fetchNewTopic = async (params: IRequest): Promise<any> => {\r\n\r\n  await fetch(`${domain}/${urlNewTopic}`, {\r\n    method: 'POST',\r\n    body: paramsToString('', params),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded'\r\n    }\r\n  });\r\n}","import { createAction } from '@reduxjs/toolkit'\r\n\r\nimport { fetchNewTopic, IRequest } from 'src/api/newtopic';\r\nimport { RootState } from '../store';\r\n\r\nexport type postNewTopicParams = {\r\n  subject: string,\r\n  text: string,\r\n  section: number,\r\n  forum: string,\r\n  isVoting: boolean,\r\n  votingItems?: Array<string>,\r\n  onSuccess?: () => void\r\n};\r\n\r\nexport const postNewTopicStart = createAction('POST_NEW_TOPIC_START');\r\nexport const postNewTopicComplete = createAction('POST_NEW_TOPIC_COMPLETE');\r\nexport const postNewTopicError = createAction('POST_NEW_TOPIC_ERROR', error => ({\r\n  payload: error,\r\n  error: true\r\n}));\r\nexport const newTopicText = createAction('NEW_TOPIC_TEXT', text => ({\r\n  payload: {\r\n    text\r\n  },\r\n  error: false\r\n}));\r\nexport const newTopicClear = createAction('NEW_TOPIC_CLEAR');\r\nexport const newTopicSubject = createAction('NEW_TOPIC_SUBJECT', text => ({\r\n  payload: {\r\n    text\r\n  },\r\n  error: false\r\n}));\r\nexport const newTopicSection = createAction('NEW_TOPIC_SECTION', section => ({\r\n  payload: {\r\n    section\r\n  },\r\n  error: false\r\n}));\r\nexport const newTopicShowVoting = createAction('SHOW_VOTING', show => ({\r\n  payload: {\r\n    show\r\n  },\r\n  error: false\r\n}));\r\n\r\nexport const shouldPostNewTopic = (state: RootState): boolean => {\r\n  const newTopic = state.newTopic;\r\n  if (!newTopic) {\r\n    return false\r\n  }\r\n  if (newTopic.isFetching) {\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const postNewTopicIfNeeded = (params: postNewTopicParams): any => (dispatch: any, getState: any) => {\r\n  if (shouldPostNewTopic(getState())) {\r\n    return dispatch(postNewTopic(params));\r\n  }\r\n}\r\n\r\nconst postNewTopic = (params: postNewTopicParams) => async (dispatch: any) => {\r\n\r\n  dispatch(postNewTopicStart());\r\n\r\n  let fetchParams: IRequest = {\r\n    message_text: params.text,\r\n    topic_text: params.subject,\r\n    target_section: String(params.section),\r\n    target_forum: params.forum.toLowerCase(),\r\n    action: 'new',\r\n    rnd: Math.round(Math.random() * 10000000000),\r\n    voting: params.isVoting ? 1 : 0\r\n  };\r\n\r\n  if (params.votingItems)\r\n    for (let i = 0; i < params.votingItems.length; i++) {\r\n      fetchParams[`section${i + 1}`] = params.votingItems[i];\r\n    }\r\n\r\n  await fetchNewTopic(fetchParams);\r\n\r\n  dispatch(postNewTopicComplete());\r\n\r\n  if (params.onSuccess)\r\n    params.onSuccess();\r\n}","import { createReducer } from '@reduxjs/toolkit'\r\n\r\nimport { postNewTopicStart, postNewTopicComplete, postNewTopicError, newTopicText, \r\n  newTopicClear, newTopicSubject, newTopicSection, newTopicShowVoting} from './actions'\r\n\r\nimport { initialState } from '.'\r\n\r\nconst reducer = createReducer(initialState, (builder) => {\r\n  builder\r\n    .addCase(postNewTopicStart, (state) => {\r\n      state.isFetching = true;\r\n      delete state.error;\r\n    })\r\n    .addCase(postNewTopicComplete, (state) => {\r\n      state.isFetching = false;\r\n    })\r\n    .addCase(postNewTopicError, (state, action) => {\r\n      state.isFetching = false;\r\n      state.error = action.payload;\r\n    })\r\n    .addCase(newTopicText, (state, action) => {\r\n      state.text = action.payload.text;\r\n    })    \r\n    .addCase(newTopicClear, (state) => {\r\n      state.text = '';\r\n      state.subject = '';\r\n      state.isVoting = false;\r\n    })    \r\n    .addCase(newTopicSubject, (state, action) => {\r\n      state.subject = action.payload.text;\r\n    })    \r\n    .addCase(newTopicShowVoting, (state, action) => {\r\n      state.isVoting = action.payload.show;\r\n    })   \r\n    .addCase(newTopicSection, (state, action) => {\r\n      state.section = action.payload.section;\r\n      state.forum = action.payload.section == null ? '' : action.payload.section.forum.toLowerCase()\r\n    })   \r\n  })\r\n\r\nexport default reducer;","import { ISectionItem } from \"../sections\";\r\n\r\nexport type NewTopicState = {\r\n  isFetching: boolean,\r\n  section: ISectionItem,\r\n  text: string,\r\n  subject: string,\r\n  forum: string,\r\n  isVoting: boolean,\r\n  error?: string\r\n};\r\n\r\nexport const initialState: NewTopicState = {\r\n  isFetching: false,\r\n  section: null,\r\n  text: '',\r\n  subject: '',\r\n  forum: '1C',\r\n  isVoting: false\r\n}","import { domain, paramsToString, urlNewMessage } from \".\";\r\n\r\n// New message\r\nexport interface IRequest {\r\n  message_text: string,\r\n  action: \"new\",\r\n  topic_id: string,\r\n  rnd: number,\r\n  voting_select?: number,\r\n  as_admin?: boolean\r\n}\r\n\r\nexport const fetchNewMessage = async (params: IRequest): Promise<any> => {\r\n  \r\n  const url = urlNewMessage.replace(':id', params.topic_id);\r\n\r\n  const options: RequestInit = {\r\n    method: 'POST',\r\n    body: paramsToString('', params),\r\n    mode: 'no-cors',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Accept': 'text/html,application/xhtml+xml,application/xml',\r\n      'Content-Type': 'application/x-www-form-urlencoded'  \r\n    },\r\n    redirect: 'follow'\r\n  }\r\n\r\n  const result = await fetch(`${domain}/${url}`, options);\r\n  return result;\r\n}","import { createAction } from '@reduxjs/toolkit'\r\nimport { fetchNewMessage, IRequest } from 'src/api/newmessage'\r\n\r\nexport const postNewMessageStart = createAction('POST_NEW_MESSAGE_START');\r\nexport const postNewMessageComplete = createAction('POST_NEW_MESSAGE_COMPLETE');\r\nexport const newMessageText = createAction('NEW_MESSAGE_TEXT', text => ({\r\n  payload: {\r\n    text,\r\n  }\r\n}));\r\nexport const addMessageText = createAction('ADD_MESSAGE_TEXT', text => ({\r\n  payload: {\r\n    text,\r\n  }\r\n}));\r\n\r\nexport type PostNewmessageParams = {\r\n  text: string,\r\n  topicId: string,\r\n  voting_select?: number,\r\n  onSuccess?: () => void\r\n}\r\n\r\nexport const postNewMessage = (params: PostNewmessageParams): any => async (dispatch: any) => {\r\n\r\n  dispatch(postNewMessageStart());\r\n\r\n  let fetchParams: IRequest = {\r\n    message_text: params.text,\r\n    action: \"new\",\r\n    topic_id: params.topicId,\r\n    rnd: Math.round(Math.random() * 10000000000)\r\n  };\r\n\r\n  if (params.voting_select)\r\n    fetchParams.voting_select = params.voting_select;\r\n\r\n  try {\r\n    await fetchNewMessage(fetchParams);\r\n    await dispatch(postNewMessageComplete());\r\n    if (params.onSuccess)\r\n      params.onSuccess();\r\n\r\n  } catch (err) {\r\n    console.error(\"Failed to post new message: \" + err);\r\n  }\r\n}\r\n","import { configureStore  } from '@reduxjs/toolkit'\r\nimport { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\r\nimport logger from 'redux-logger' // eslint-disable-line @typescript-eslint/no-unused-vars\r\n\r\nimport topicsList from './topicslist/reducer'\r\nimport topic from './topic/reducer'\r\nimport sections from './sections/reducer'\r\nimport options from './options/reducer'\r\nimport login from './login/reducer'\r\nimport tooltips from './tooltips/reducer'\r\nimport newTopic from './newtopic/reducer'\r\nimport newMessage from './newmessage/reducer'\r\n\r\nconst reducer = {\r\n  topicsList,\r\n  topic,\r\n  sections,\r\n  options,\r\n  login,\r\n  tooltips,\r\n  newTopic,\r\n  newMessage\r\n}\r\n\r\nconst store = configureStore({\r\n  reducer,\r\n  //middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(logger),\r\n  devTools: process.env.NODE_ENV !== 'production'\r\n})\r\n\r\nexport type RootState = ReturnType<typeof store.getState>\r\nexport type AppDispatch = typeof store.dispatch\r\n\r\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\r\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\r\n\r\nexport default store","import { createReducer } from '@reduxjs/toolkit'\r\nimport { initialState } from '.';\r\nimport { clearTopicMessages } from '../topic/actions';\r\nimport { addMessageText, newMessageText, postNewMessageComplete, postNewMessageStart } from './actions'\r\n\r\nconst reducer = createReducer(initialState, (builder) => {\r\n  builder\r\n    .addCase(postNewMessageStart, (state) => {\r\n      state.isFetching = true;\r\n    })\r\n    .addCase(postNewMessageComplete, (state) => {\r\n      state.isFetching = false;\r\n    })  \r\n    .addCase(newMessageText, (state, action) => {\r\n      state.text = action.payload.text;\r\n    })  \r\n    .addCase(addMessageText, (state, action) => {\r\n      state.text += action.payload.text;\r\n    })  \r\n    .addCase(clearTopicMessages, (state) => {\r\n      state.text = '';\r\n    })              \r\n  })\r\n\r\nexport default reducer;","\r\nexport type INewMessageState = {\r\n  isFetching: boolean;\r\n  text: string\r\n};\r\n\r\nexport const initialState: INewMessageState = {\r\n  isFetching: false,\r\n  text: ''\r\n}","import React, { FC, ReactElement } from 'react'\r\nimport { Dropdown } from 'react-bootstrap'\r\n\r\nimport { doLogout } from 'src/data/login/actions'\r\nimport { domain } from 'src/api'\r\n\r\nimport { useAppDispatch } from 'src/data/store'\r\n\r\ntype IProps = {\r\n  userId: number,\r\n  userName: string\r\n}\r\n\r\ntype HTMLProps = React.HTMLProps<HTMLSpanElement>\r\nconst CustomToggle = React.forwardRef<HTMLSpanElement, HTMLProps>(({ children, onClick }, ref) => (\r\n  <span\r\n    ref={ref}\r\n    style={{ cursor: \"pointer\" }}\r\n    className='link'\r\n    onClick={(e) => {\r\n      e.preventDefault();\r\n      onClick(e);\r\n    }}\r\n  >\r\n    {children}\r\n  </span>\r\n));\r\n\r\nconst LoggedUser: FC<IProps> = ({ userId, userName }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const onLogout = (event: any) => {\r\n    event.preventDefault();\r\n    dispatch(doLogout());\r\n  }\r\n\r\n  const onMenuSelect = (eventKey: any, event: any): any => {\r\n    if (eventKey === 'exit') {\r\n      onLogout(event);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ float: \"left\" }}>\r\n      <Dropdown id=\"dropdown-custom-menu\" onSelect={onMenuSelect}>\r\n        <span>Привет, </span>\r\n        <Dropdown.Toggle as={CustomToggle}>{userName} ▼</Dropdown.Toggle>\r\n        <Dropdown.Menu>\r\n          <Dropdown.Item eventKey=\"profile\" href={`${domain}/users.php?id=${userId}`}>Профиль</Dropdown.Item>\r\n          <Dropdown.Item eventKey=\"myTopics\" href={`#/index.php?user_id=${userId}`}>Мои темы</Dropdown.Item>\r\n          <Dropdown.Divider />\r\n          <Dropdown.Item eventKey=\"options\" href={`#/options.php`}>Настройки</Dropdown.Item>\r\n          <Dropdown.Divider />\r\n          <Dropdown.Item eventKey=\"exit\">Выход</Dropdown.Item>\r\n        </Dropdown.Menu>\r\n      </Dropdown>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default LoggedUser;","import React, { FC, ReactElement, useState } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport { FormControl, Button } from 'react-bootstrap'\r\n\r\nimport { doLoginIfNeeded } from 'src/data/login/actions'\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\n\r\nconst mapState = (state: RootState) => {\r\n  return state.login;\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst LoginForm: FC<ConnectedProps<typeof connector>> = (props): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n\r\n  const onLogin = (event) => {\r\n    event.preventDefault();\r\n    dispatch(doLoginIfNeeded(username, password));\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <form name=\"enterform\" className=\"flex-row\" style={{ flexWrap: \"wrap\" }}>\r\n        <FormControl\r\n          type=\"text\"\r\n          placeholder=\"Имя\"\r\n          value={username}\r\n          onChange={e => setUsername(e.target.value)}\r\n          size=\"sm\"\r\n          className='input'\r\n          style={{ marginRight: \"5px\", flex: \"0 1 300px\" }}\r\n        />\r\n        <FormControl\r\n          type=\"password\"\r\n          placeholder=\"Пароль\"\r\n          maxLength={20}\r\n          autoComplete=\"off\"\r\n          value={password}\r\n          onChange={e => setPassword(e.target.value)}\r\n          size=\"sm\"\r\n          className='input'\r\n          style={{ marginRight: \"5px\", flex: \"0 1 300px\" }}\r\n        />\r\n        <Button\r\n          size=\"sm\"\r\n          variant=\"light\"\r\n          className='button'          \r\n          onClick={onLogin}\r\n        >Войти</Button>\r\n      </form>\r\n      <p style={{ margin: \"0px\" }}>Войти можно на сайте <a href=\"https://forum.mista.ru/\">forum.mista.ru</a></p>\r\n      <a rel=\"nofollow\" href=\"https://forum.mista.ru/user_registration.php\">Регистрация</a>\r\n      <span style={{ margin: \"5px\" }}>|</span>\r\n      <a rel=\"nofollow\" href=\"https://forum.mista.ru/remember_password.php\">Забыли пароль?</a>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default connector(LoginForm);","import React, { FC, ReactElement } from 'react'\r\n\r\nimport './error.css'\r\n\r\ntype IProps = {\r\n  text: string\r\n}\r\n\r\nconst ErrorElem: FC<IProps> = ({ text }): ReactElement | null => {\r\n  if (!text)\r\n    return null;\r\n\r\n  return (\r\n    <div className=\"error\" dangerouslySetInnerHTML={{ __html: text }}></div>\r\n  )\r\n}\r\n\r\nexport default ErrorElem;","import React, { FC, ReactElement, useEffect } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport LoggedUser from './logged_user'\r\nimport LoginForm from './login_form'\r\nimport ErrorElem from '../common/error'\r\n\r\nimport { checkLoginIfNeeded } from 'src/data/login/actions'\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\n\r\nconst mapState = (state: RootState) => {\r\n  return state.login;\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst Login: FC<ConnectedProps<typeof connector>> = ({ logged, userId, userName, error }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(checkLoginIfNeeded());\r\n  }, [dispatch]);\r\n\r\n  let elem: ReactElement;\r\n  if (logged === true)\r\n    elem = <LoggedUser userId={userId} userName={userName} />\r\n  else if (logged === false)\r\n    elem = <LoginForm />\r\n  else\r\n    elem = null;\r\n\r\n  return (\r\n    <>\r\n      {elem}\r\n      {error && <ErrorElem text={error} />}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default connector(Login);","import React, { FC, ReactElement, useEffect } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport Form from 'react-bootstrap/Form'\r\n\r\nimport { getSectionsIfNeeded } from 'src/data/sections/actions'\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\nimport type { ISectionItem } from 'src/data/sections'\r\n\r\ntype IProps = {\r\n  id: string,\r\n  defaultValue: string,\r\n  selected?: string,\r\n  style?: {},\r\n  size?: 'sm' | 'lg',\r\n  onChange: (e: any, value: ISectionItem) => void\r\n}\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const { items, tree } = state.sections;\r\n\r\n  return {\r\n    items,\r\n    tree\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst Sections: FC<ConnectedProps<typeof connector> & IProps> = (props): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(getSectionsIfNeeded());\r\n  }, [dispatch]);\r\n\r\n  const onSelect: (e: React.ChangeEvent<HTMLElement>) => void = (e: any) => {\r\n\r\n    const { items, onChange } = props;\r\n\r\n    if (onChange) {\r\n      const code = e.currentTarget.value;\r\n      const arr = items.filter(item => item.code === code);\r\n      if (arr.length > 0)\r\n        onChange(e, arr[0]);\r\n      else\r\n        onChange(e, null);\r\n    }\r\n  }\r\n\r\n  const { id, tree, defaultValue, selected, style, size } = props;\r\n\r\n  let sectionsElem = [];\r\n  for (let forum in tree) {\r\n\r\n    let group =\r\n      <optgroup key={forum} label={forum}>\r\n        {tree[forum].map((item) => (\r\n          <option key={item.id} value={item.code}>\r\n            {item.name}\r\n          </option>\r\n        ))}\r\n      </optgroup>\r\n\r\n    sectionsElem.push(group);\r\n  }\r\n\r\n  return (\r\n    <Form.Select\r\n      onChange={onSelect}\r\n      value={selected}\r\n      style={style}\r\n      className='input'\r\n      size={size}\r\n      id={id}\r\n    >\r\n      <option value=\"\">{defaultValue}</option>\r\n      {sectionsElem}\r\n    </Form.Select>\r\n  )\r\n}\r\n\r\nexport { Sections };\r\nexport default connector(Sections);","import React, { ReactElement, useEffect } from 'react'\r\nimport { useLocation, useNavigate } from 'react-router-dom'\r\nimport { useDispatch } from 'react-redux'\r\nimport queryString from 'query-string'\r\n\r\nimport Login from '../login'\r\nimport Sections from './sections'\r\nimport { getSectionsIfNeeded } from 'src/data/sections/actions'\r\n\r\nconst Header = (): ReactElement => {\r\n\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate()\r\n  const location = useLocation();\r\n  const params = queryString.parse(location.search);\r\n\r\n  useEffect(() => {\r\n    dispatch(getSectionsIfNeeded());\r\n  }, [dispatch]);  \r\n\r\n  const onSectionChange = (e, value) => {\r\n    if (value)\r\n      navigate(`/index.php?section=${value.code}`);\r\n    else\r\n      navigate(`/`);\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex-row\">\r\n      <div className=\"header-left\">\r\n        <Login />\r\n      </div>\r\n      <div className=\"header-right\">\r\n        <Sections\r\n          id=\"sect\"\r\n          defaultValue=\"--Все секции--\"\r\n          selected={String(params.section) || \"\"}\r\n          onChange={onSectionChange}\r\n          size=\"sm\"\r\n        />\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default Header;","import React, { FC, ReactElement } from 'react'\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport { getMaxPage } from 'src/utils'\r\n\r\ntype IProps = {\r\n  count: number,\r\n  topicId: number\r\n}\r\n\r\nconst Pages: FC<IProps> = ({ count, topicId }): ReactElement => {\r\n\r\n  let pages = [];\r\n  if (count > 100) {\r\n    let maxPage = getMaxPage(count);\r\n    for (let i = 1; i <= maxPage; i++) {\r\n      let href = `/topic.php?id=${topicId}&page=${i}`;\r\n      let text: string;\r\n      if (i > 3 && i < maxPage)\r\n        text = '•';\r\n      else\r\n        text = String(i);\r\n      pages.push(<Link key={i} className=\"agh\" style={{ margin: \"3px\" }} to={href}>{text}</Link>);\r\n    }\r\n  }\r\n\r\n  if (count > 20) {\r\n    let href = `/topic.php?id=${topicId}&page=last20#F`;\r\n    pages.push(<Link key=\"last20\" className=\"agh\" style={{ margin: \"3px\" }} to={href}>»</Link>);\r\n  }\r\n\r\n  return (\r\n    <span className=\"topic-pages\">\r\n      {pages}\r\n    </span>\r\n  )\r\n}\r\n\r\nexport default Pages;","import React, { FC, ReactElement } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport classNames from 'classnames'\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport Pages from './pages';\r\nimport { ITopicsListItem } from 'src/data/topicslist';\r\nimport { RootState } from 'src/data/store';\r\n\r\ntype IProps = {\r\n  data: ITopicsListItem\r\n};\r\n\r\nconst mapState = (state: RootState) => {\r\n  return {\r\n    login: state.login\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst TopicNameCell: FC<ConnectedProps<typeof connector> & IProps> = ({ data, login }): ReactElement => {\r\n\r\n  let href = `/topic.php?id=${data.id}`;\r\n  let classes = classNames('agb', 'mr5', {\r\n    'bold': data.count >= 100,\r\n    'mytopics': data.author === login.userName,\r\n    'pinned': data.pinned\r\n  });\r\n\r\n  let isVoting;\r\n  if (data.isVoting) {\r\n    isVoting = <span className=\"agh separator\">[±]</span>\r\n  }\r\n\r\n  let sectionHref = `/index.php?section=${data.sectionCode}`;\r\n  let section;\r\n\r\n  if (data.section) {\r\n    section = (\r\n      <span className=\"topic-section\">\r\n        <span className=\"agh\" style={{ margin: \"0px 5px\" }}>/</span>\r\n        <Link key=\"1\" rel=\"nofollow\" className=\"agh\" to={sectionHref} >{data.section}</Link>\r\n      </span>\r\n    )\r\n  }\r\n\r\n  let closed;\r\n  let down;\r\n  let text = data.text;\r\n  if (data.closed)\r\n    closed = <span className=\"agh\">Ø</span>\r\n\r\n  if (data.down)\r\n    down = <span className=\"agh\">↓</span>\r\n\r\n  if (data.sectionCode === 'job' && text.substring(0, 3) !== 'JOB')\r\n    text = 'JOB: ' + text;\r\n\r\n  else if (data.forum === 'life' && text.substring(0, 3) !== 'OFF')\r\n    text = 'OFF: ' + text;\r\n\r\n  else if (data.sectionCode === 'v7' && text.substring(0, 2) !== 'v7')\r\n    text = 'v7: ' + text;\r\n\r\n  return (\r\n    <div className=\"cell-title\">\r\n      {data.pinned && <i className=\"fa fa-thumb-tack agh\" aria-hidden=\"true\" style={{marginRight: \"5px\"}}></i>}\r\n      <Link to={href} className={classes} dangerouslySetInnerHTML={{ __html: text }} style={{ overflowWrap: \"anywhere\" }}></Link>\r\n      {isVoting}\r\n      <Pages count={data.count} topicId={data.id} />\r\n      {closed}\r\n      {down}\r\n      {section}\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default connector(TopicNameCell);","import React, { FC, ReactElement } from 'react'\r\n\r\nimport { useAppDispatch } from 'src/data/store';\r\nimport { togglePreview } from 'src/data/topicslist/actions';\r\n\r\ntype IProps = {\r\n  topicId: number,\r\n  expanded: boolean\r\n};\r\n\r\nconst PreviewLink: FC<IProps> = ({ topicId, expanded }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const onClick = () => {\r\n    dispatch(togglePreview(topicId, 0));\r\n  }\r\n\r\n  const text = expanded \r\n    ? <i className=\"fa fa-minus-square-o agh\" aria-hidden=\"true\"></i> \r\n    : <i className=\"fa fa-plus-square-o agh\" aria-hidden=\"true\"></i>;\r\n  return (\r\n    <div className=\"cell-preview-link\" onClick={onClick}>\r\n      <span>{text}</span>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default PreviewLink;","import { FC, ReactElement, useCallback, useEffect, useState } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport { Link } from 'react-router-dom'\r\nimport dateFormat from 'dateformat'\r\n\r\nimport TopicNameCell from './topic_name_cell';\r\nimport PreviewLink from './preview_link'\r\n\r\nimport { today } from 'src/utils'\r\nimport { RootState, useAppDispatch } from 'src/data/store';\r\nimport { ITopicsListItem } from 'src/data/topicslist';\r\nimport { fetchTopicMessage } from 'src/api/topicMessages';\r\nimport { togglePreview } from 'src/data/topicslist/actions';\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  return {\r\n    login: state.login\r\n  }\r\n}\r\nconst connector = connect(mapState);\r\n\r\ntype IProps = {\r\n  data: ITopicsListItem,\r\n  topicId: number\r\n}\r\n\r\nconst Row: FC<ConnectedProps<typeof connector> & IProps> = ({ data, topicId }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const [time, setTime] = useState(data.updated);\r\n  const updateTime = useCallback(async () => {\r\n    const msg = await fetchTopicMessage(topicId, data.count);\r\n    setTime(msg.time);\r\n  }, [topicId, data.count])\r\n  \r\n  useEffect(() => {\r\n    if (data.pinned)\r\n      updateTime();\r\n  }, [data.pinned, updateTime])\r\n\r\n  const countOnClick = () => {\r\n    dispatch(togglePreview(topicId, data.count));\r\n  }\r\n\r\n  let date = new Date(time);\r\n  let timeF: string;\r\n  if (time === 2147483648000) {\r\n    timeF = '';\r\n  } else if (today(date)) {\r\n    timeF = dateFormat(time, 'HH:MM')\r\n  } else {\r\n    timeF = dateFormat(time, 'dd.mm.yy');\r\n  }\r\n  return (\r\n    <div className=\"topics-list-row\">\r\n      <div className=\"cell-forum\">\r\n        {data.forum}\r\n      </div>\r\n      <div className=\"cell-section\">\r\n        {data.section}\r\n      </div>\r\n      <div className=\"cell-answ\" onClick={countOnClick}>\r\n        <i className=\"fa fa-comments-o\" aria-hidden=\"true\" style={{marginRight: \"3px\"}}></i>\r\n        <span>{data.count}</span>\r\n      </div>\r\n      <PreviewLink topicId={data.id} expanded={data.showPreview} />\r\n      <TopicNameCell data={data}/>\r\n      <div className=\"cell-author\">\r\n        <i aria-hidden=\"true\" className=\"fa fa-user-circle\" style={{marginRight: \"3px\"}}></i>\r\n        {data.author}\r\n      </div>\r\n      <div className=\"cell-lastuser\">\r\n        <div style={{ display: \"flex\" }}>\r\n          <span className=\"cell-lastuser-time\">{timeF}</span>\r\n          <span className=\"cell-lastuser-user\">{data.lastUser}</span>\r\n        </div>\r\n      </div>\r\n      <div className=\"cell-last20\">\r\n        <Link to={`/topic.php?id=${String(data.id)}&page=last20#F`} style={{ color: \"inherit\", display: \"block\", width: \"100%\", textAlign: \"center\" }}>\r\n          <i className=\"fa fa-angle-right\" aria-hidden=\"true\"></i>\r\n        </Link>\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default connector(Row);","import { FC, ReactElement } from 'react'\r\nimport { Pagination } from 'react-bootstrap'\r\nimport { useLocation } from 'react-router-dom'\r\n\r\nimport './pages.css'\r\n\r\ntype IProps = {\r\n  maxPage: number,\r\n  last20?: boolean\r\n}\r\n\r\nconst Pages: FC<IProps> = ({ maxPage, last20 }): ReactElement => {\r\n\r\n  const location = useLocation();\r\n  let pathName = location.pathname;\r\n  if (pathName === '/')\r\n    pathName = '/index.php'\r\n\r\n  const locationParams = new URLSearchParams(location.search);\r\n\r\n  let currentPage: number | string;\r\n  const page = locationParams.get('page');\r\n  if (!page)\r\n    currentPage = 1;\r\n  else if (page === \"last20\")\r\n    currentPage = \"last20\";\r\n  else\r\n    currentPage = parseInt(page, 10) || 1;\r\n\r\n  let pages = [];\r\n  for (let i = 1; i <= maxPage; i++) {\r\n    locationParams.set('page', String(i));\r\n    let href = '#' + pathName + '?' + locationParams.toString();\r\n\r\n    pages.push(\r\n      <Pagination.Item active={currentPage === i} key={i} href={href}>\r\n        {i}\r\n      </Pagination.Item>);\r\n  }\r\n\r\n  if (last20 === true) {\r\n    locationParams.set(\"page\", \"last20\");\r\n    let href = '#' + pathName + '?' + locationParams.toString();\r\n    pages.push(<Pagination.Item active={currentPage === \"last20\"} key=\"last20\" href={href}>»</Pagination.Item>);\r\n  }\r\n\r\n  return (\r\n    <Pagination style={{ margin: \"0px\" }}>\r\n      {pages}\r\n    </Pagination>\r\n  )\r\n\r\n}\r\n\r\nexport default Pages;","import React, { FC, ReactElement, useRef } from 'react'\r\nimport { FormControl, Button, ButtonGroup, Form } from 'react-bootstrap'\r\n\r\nimport './text_editor.css'\r\nimport { useAppDispatch } from 'src/data/store'\r\nimport { newTopicShowVoting } from 'src/data/newtopic/actions'\r\n\r\ntype IProps = {\r\n  placeholder: string,\r\n  showVoting?: boolean,\r\n  isVoting?: boolean,\r\n  text: string,\r\n  isFetching: boolean,\r\n  formName: string,\r\n}\r\n\r\nconst TextEditor: FC<IProps> = ({ formName, placeholder, showVoting, isVoting, isFetching, text }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n  const textAreaRef = useRef() as React.MutableRefObject<HTMLTextAreaElement>;\r\n\r\n  const onButtonCode1c = (e: React.MouseEvent<HTMLButtonElement>) => {\r\n\r\n    e.preventDefault();\r\n\r\n    const openTag = '[1C]\\n';\r\n    const closeTag = '\\n[/1C]';\r\n\r\n    const textAreaNode = textAreaRef.current;\r\n\r\n    const start = textAreaNode.selectionStart;\r\n    const end = textAreaNode.selectionEnd;\r\n\r\n    const oldText = textAreaNode.value;\r\n    const len = oldText.length;\r\n    const selectedText = oldText.substring(start, end);\r\n    const replacement = openTag + selectedText + closeTag;\r\n    let newText = oldText.substring(0, start) + replacement + oldText.substring(end, len);\r\n\r\n    dispatch({\r\n      type: formName + '_TEXT',\r\n      payload: {\r\n        text: newText\r\n      }\r\n    })\r\n\r\n  }\r\n\r\n  const onVotingChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    dispatch(newTopicShowVoting(e.currentTarget.checked))\r\n  }\r\n\r\n  const onChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n    dispatch({\r\n      type: formName + '_TEXT',\r\n      payload: {\r\n        text: e.currentTarget.value\r\n      }\r\n    })\r\n  }\r\n\r\n  const onKeyPress = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\r\n    if (e.key === 'Enter' && e.ctrlKey) {\r\n      let parent = e.currentTarget.parentElement;\r\n      while (parent && parent.tagName.toUpperCase() !== \"FORM\") {\r\n        parent = parent.parentElement;\r\n      }\r\n      if (parent)\r\n        parent.dispatchEvent(new Event(\"submit\", { cancelable: true, bubbles: true }));\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <FormControl\r\n        as=\"textarea\"\r\n        placeholder={placeholder}\r\n        cols={70} rows={3}\r\n        value={text}\r\n        onChange={onChange}\r\n        onKeyPress={onKeyPress}\r\n        ref={textAreaRef}\r\n        className=\"text-editor input\"\r\n      />\r\n      <div className=\"flex-row\">\r\n        <ButtonGroup>\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"light\"\r\n            onClick={onButtonCode1c}\r\n            style={{ marginRight: \"5px\" }}\r\n            className='button'\r\n          >Код 1С</Button>\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"light\"\r\n            disabled={isFetching}\r\n            type=\"submit\"\r\n            className='button'\r\n          >\r\n            {isFetching ? 'Отправляется' : 'Отправить'}\r\n          </Button>\r\n        </ButtonGroup>\r\n        {showVoting &&\r\n          <Form.Check\r\n            id=\"show_voting\"\r\n            type=\"checkbox\"\r\n            checked={isVoting}\r\n            onChange={onVotingChange}\r\n            label=\"Голосование\"\r\n            style={{ margin: \"auto 0px auto auto\" }} />\r\n        }\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default TextEditor;","import React, { FC, ReactElement, useState } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport Form from 'react-bootstrap/Form'\r\nimport InputGroup from 'react-bootstrap/InputGroup'\r\nimport { FormGroup } from 'react-bootstrap'\r\n\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\nimport { newTopicClear, newTopicSection, newTopicSubject, postNewTopicError, postNewTopicIfNeeded } from 'src/data/newtopic/actions'\r\n\r\nimport Sections from './sections'\r\nimport TextEditor from '../common/text_editor'\r\nimport ErrorElem from '../common/error'\r\n\r\nimport './new_topic.css'\r\nimport { ISectionItem } from 'src/data/sections'\r\n\r\ntype IProps = {\r\n  onSubmitSuccess?: any\r\n};\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  return {\r\n    sections: state.sections,\r\n    newTopic: state.newTopic\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst NewTopic: FC<ConnectedProps<typeof connector> & IProps> = ({ sections, newTopic, onSubmitSuccess }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n  const [currentSection, setSection] = useState(null);\r\n\r\n  const [votes, setVotes] = useState(Array(10).fill(\"\"));\r\n\r\n  const onSectionChange = (e: any, section: ISectionItem) => {\r\n    setSection(section);\r\n    dispatch(newTopicSection(section));\r\n  }\r\n\r\n  const onVoteTextChange = (i: number) => (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    let votesCopy = votes.slice();\r\n    votesCopy[i] = e.target.value;\r\n    setVotes(votesCopy);\r\n  }\r\n\r\n  const onSubmit = (e: React.FormEvent<HTMLFormElement>) => {\r\n\r\n    e.preventDefault();\r\n\r\n    if (!currentSection) {\r\n      dispatch(postNewTopicError('Не выбрана секция'));\r\n      return;\r\n    }\r\n\r\n    let subject = newTopic.subject;\r\n    if (!subject) {\r\n      dispatch(postNewTopicError('Не указана тема'));\r\n      return;\r\n    }\r\n\r\n    if (!newTopic.text) {\r\n      dispatch(postNewTopicError('Не указано сообщение'));\r\n      return;\r\n\r\n    }\r\n\r\n    let params = {\r\n      subject,\r\n      text: newTopic.text,\r\n      section: currentSection.id,\r\n      forum: currentSection.forum,\r\n      isVoting: newTopic.isVoting,\r\n      votingItems: [],\r\n      onSuccess: this_onSubmitSuccess\r\n    };\r\n\r\n    if (newTopic.isVoting) {\r\n      params.votingItems = [];\r\n      for (let i = 1; i <= 10; i++) {\r\n        let val = votes[i - 1];\r\n        if (val) {\r\n          params.votingItems.push(val);\r\n        }\r\n      }\r\n    }\r\n\r\n    dispatch(postNewTopicIfNeeded(params));\r\n  }\r\n\r\n  const onSubjectChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    dispatch(newTopicSubject(e.target.value));\r\n  }\r\n\r\n  const this_onSubmitSuccess = () => {\r\n\r\n    dispatch(newTopicClear());\r\n\r\n    if (onSubmitSuccess) {\r\n      onSubmitSuccess();\r\n    }\r\n  }\r\n  let groupsElem = [];\r\n  for (let forum in sections.tree) {\r\n    groupsElem.push(<option key={forum} value={forum.toLowerCase()}>{forum}</option>);\r\n  }\r\n\r\n  let votingOptions = [];\r\n\r\n  if (newTopic.isVoting) {\r\n    votingOptions.push(<div key=\"p\">Варианты:</div>);\r\n    for (let i = 1; i <= 10; i++) {\r\n      votingOptions.push(\r\n        <InputGroup key={i} size=\"sm\" style={{ marginBottom: \"3px\", width: \"100%\" }}>\r\n          <InputGroup.Text\r\n            style={{ width: \"40px\" }}\r\n            className='input'\r\n          >\r\n            {`${i}.`}\r\n          </InputGroup.Text>\r\n          <Form.Control\r\n            type=\"text\"\r\n            maxLength={50}\r\n            className='input'\r\n            value={votes[i - 1]}\r\n            onChange={onVoteTextChange(i - 1)}\r\n          />\r\n        </InputGroup>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form className=\"new-topic-container\" onSubmit={onSubmit}>\r\n      <div id=\"newtopic_form\" className=\"new-topic-text\">\r\n        <div><b>Новая тема:</b></div>\r\n        {newTopic.error && <ErrorElem text={newTopic.error} />}\r\n        <div className=\"flex-row\" style={{ marginBottom: \"3px\" }}>\r\n          <Form.Select\r\n            disabled\r\n            size=\"sm\"\r\n            value={newTopic.forum}\r\n            style={{ flex: \"0 1 90px\" }}\r\n            className='input'\r\n          >\r\n            {groupsElem}\r\n          </Form.Select>\r\n          <Sections\r\n            id=\"target_section\"\r\n            defaultValue=\"Секция\"\r\n            selected={newTopic.section?.code}\r\n            size=\"sm\"\r\n            style={{ flex: \"1 1 auto\" }}\r\n            onChange={onSectionChange}\r\n          />\r\n        </div>\r\n        <Form.Control\r\n          type=\"text\"\r\n          size=\"sm\"\r\n          value={newTopic.subject}\r\n          onChange={onSubjectChange}\r\n          style={{ marginBottom: \"3px\" }}\r\n          className='input'\r\n          placeholder=\"Тема\"\r\n          maxLength={90}\r\n        />\r\n        <TextEditor\r\n          placeholder=\"Сообщение\"\r\n          showVoting={true}\r\n          isVoting={newTopic.isVoting}\r\n          text={newTopic.text}\r\n          isFetching={newTopic.isFetching}\r\n          formName=\"NEW_TOPIC\"\r\n        />\r\n      </div>\r\n      <FormGroup className=\"new-topic-voting\">\r\n        {votingOptions}\r\n      </FormGroup>\r\n    </form>\r\n  )\r\n}\r\n\r\nexport default connector(NewTopic);","import { FC, ReactElement } from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport { useAppDispatch } from 'src/data/store'\r\nimport { togglePreview } from 'src/data/topicslist/actions'\r\n\r\nimport './topic_preview.css'\r\n\r\ntype IProps = {\r\n  topicId: number,\r\n  onFirst: any,\r\n  onLast: any,\r\n  onPrev: any,\r\n  onNext: any\r\n}\r\n\r\nconst PreviewButtons: FC<IProps> = ({ topicId, onFirst, onPrev, onNext, onLast }): ReactElement => {\r\n \r\n  const dispatch = useAppDispatch()\r\n  const closePreview = () => {\r\n    dispatch(togglePreview(topicId, 0));\r\n  }\r\n\r\n  return (\r\n    <div className=\"topic-preview-rewind\">\r\n      <div className=\"topic-preview-button flex-small\" onClick={onFirst} title=\"К первому\">\r\n        <i className=\"fa fa-angle-double-left\" aria-hidden=\"true\"></i>\r\n      </div>\r\n      <div className=\"topic-preview-button flex-large\" onClick={onPrev} title=\"К предыдущему\">\r\n        <i className=\"fa fa-angle-left\" aria-hidden=\"true\"></i>\r\n      </div>\r\n      <div className=\"topic-preview-button flex-large\" onClick={onNext} title=\"К следующему\">\r\n        <i className=\"fa fa-angle-right\" aria-hidden=\"true\"></i>\r\n      </div>\r\n      <div className=\"topic-preview-button flex-small\" onClick={onLast} title=\"К последнему\"> \r\n        <i className=\"fa fa-angle-double-right\" aria-hidden=\"true\"></i>\r\n      </div>\r\n      <div className=\"topic-preview-button close-preview\" onClick={closePreview}> \r\n        <i className=\"fa fa-angle-right\" aria-hidden=\"true\"></i>\r\n        <i className=\"fa fa-angle-left\" aria-hidden=\"true\" style={{marginLeft: \"-2px\"}}></i>\r\n      </div>\r\n      <div className=\"topic-preview-button edit-preview\"> \r\n        <Link to={`/topic.php?id=${topicId}&page=last20#F`}>\r\n          <i className=\"fa fa-pencil\" aria-hidden=\"true\" style={{color:\"var(--font-color)\"}}></i>\r\n        </Link>  \r\n      </div>      \r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default PreviewButtons;","\nfunction highlight(text: string): string {\n\n  const keywords = new Set(\n    (\"if|если|then|тогда|elsif|иначеесли|else|иначе|endif|конецесли\" +\n    \"|do|цикл|for|для|to|по|each|каждого|in|из|while|пока|enddo|конеццикла\" +\n    \"|procedure|процедура|endprocedure|конецпроцедуры|function|функция|endfunction\" +\n    \"|конецфункции|var|перем|export|экспорт|goto|перейти|and|и|or|или|not|не\" +\n    \"|val|знач|break|прервать|continue|продолжить|return|возврат|try|попытка|except|исключение\" +\n    \"|endtry|конецпопытки|raise|вызватьисключение|false|ложь|true|истина\" +\n    \"|undefined|неопределено|null|new|новый|execute|выполнить\" +\n    \"|асинх|async|ждать|wait\")\n      .split('|')\n  );\n\n  const Спецсиволы = new Set(\"():;.,=+-*<>?[]%/\".split(''));\n  const НачалоТега = \"<span class=\";\n  const КонецТега = \"</span>\";\n\n  const мЦветФона = \"bg>\";\n  const мЦветЧисла = \"num>\";\n  const мЦветСтроки = \"str>\";\n  //const мЦветПараметра = \"par>\";\n  const мЦветКомментария = \"com>\";\n  const мЦветСпецСимвола = \"sp>\";\n  const мЦветПрепроцессора = \"pr>\";\n  const мЦветКлючевогоСлова1 = \"key>\";\n\n\n  let СтрокаРезультат: string;\n  let УстановленЦвет: boolean;\n  let ПоследнийЦвет: string | undefined;\n\n  let ВСтроке = false;\n  let Токен = \"\";\n\n  function ПустаяСтрока(Строка: string) {\n    return Строка.trim() === '';\n  }\n\n  function Сред(Строка: string, Нач: number, Длина: number) {\n    return Строка.substring(Нач - 1, Нач -1 + Длина);\n  }\n\n  function Прав(Строка: string, Длина: number) {\n    return Строка.substring(Строка.length - Длина);\n  }\n\n  function isKeyword(token: string) {\n    return keywords.has(token.toLowerCase().trim());\n  }\n\n  function ДобавитьЧастьСтроки1С(Часть: string, Цвет: string) {\n\n    if (Часть === \" \" || ПоследнийЦвет === Цвет) {\n      СтрокаРезультат = СтрокаРезультат + Часть;\n    } else {\n      if (УстановленЦвет) {\n        СтрокаРезультат = СтрокаРезультат + КонецТега;\n        УстановленЦвет = false;\n      };\n\n      СтрокаРезультат = СтрокаРезультат + НачалоТега + Цвет + Часть;\n      УстановленЦвет = true;\n      ПоследнийЦвет = Цвет;\n    };\n  }\n\n  function РазукраситьСтроку(СтрокаКода: string) {\n\n    //  https://infostart.ru/profile/34707/public/\n    let ВСтрокеСкобка = false;\n    let ВСтрокеТильда = false;\n    let НачалоСтроки = 1;\n    let ТокенДоТочки = true;\n    // Заменяем 8 символьную табуляцию на 4 символьную пробелами\n\n    // Последовательно перебираются все символы строки кода\n    let Поз = 1;\n    for (Поз = 1; Поз <= СтрокаКода.length; Поз++) {\n\n      let ТекущийСимвол = СтрокаКода.charAt(Поз - 1);\n      if (ВСтроке) {\n\n        // Операции встрече символа \"кавычка\"\n        if (ТекущийСимвол === '\"') {\n          // Нашли парную кавычку - окрашиваем как строку\n          ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\n          ВСтроке = false;\n          Токен = \"\";\n          ТокенДоТочки = true;\n        } else {\n          Токен = Токен + ТекущийСимвол;\n        };\n\n      } else if (ВСтрокеСкобка) {\n\n        // Операции встрече символа \"кавычка\" литерал\n        if (ТекущийСимвол === \"'\") {\n          // Нашли парную скобку - окрашиваем как комментарий\n          ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\n          ВСтрокеСкобка = false;\n          Токен = \"\";\n          ТокенДоТочки = true;\n        } else {\n          Токен = Токен + ТекущийСимвол;\n        };\n\n      } else if (ТекущийСимвол === \" \") {\n        // Операции при встрече символа табуляции или пробела\n        if (!ПустаяСтрока(Токен)) {\n          // Пробел после токена, значит\n          // токен - ключевое слово...\n          if (ВСтрокеТильда) {\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветСтроки);\n            ВСтрокеТильда = false;\n\n          } else if (isKeyword(Токен.trim())) {\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветКлючевогоСлова1);\n\n          } else if (!isNaN(parseInt(Токен, 10))) {\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветЧисла);\n\n          } else {\n            ДобавитьЧастьСтроки1С(Токен + \" \", мЦветФона);\n          };\n          Токен = \"\";\n        } else {\n          СтрокаРезультат = СтрокаРезультат + \" \";\n        };\n        ТокенДоТочки = true;\n\n      } else if (Спецсиволы.has(ТекущийСимвол)) {\n\n        // Встретился один из специальных символов\n        if (!ПустаяСтрока(Токен)) {\n          // Чтобы избежать окраски метода объекта с совпадающим именем\n          // с одним из ключевых слов, проверяем текущий символ на \".\"\n          if (ВСтрокеТильда) {\n\n            ДобавитьЧастьСтроки1С(Токен, мЦветСтроки);\n            ВСтрокеТильда = false;\n            ТокенДоТочки = (ТекущийСимвол !== \".\");\n\n          } else if (ТокенДоТочки && isKeyword(Токен)) {\n            ДобавитьЧастьСтроки1С(Токен, мЦветКлючевогоСлова1);\n            ТокенДоТочки = (ТекущийСимвол !== \".\");\n\n          } else {\n            // Не ключевое слово - значит число\n            if (!isNaN(parseInt(Токен, 10))) {\n              ДобавитьЧастьСтроки1С(Токен, мЦветЧисла);\n\n            } else {\n              ДобавитьЧастьСтроки1С(Токен, мЦветФона);\n            };\n            ТокенДоТочки = (ТекущийСимвол !== \".\");\n          };\n          Токен = \"\";\n        };\n        // Один из специальных символов\n        if (ТекущийСимвол === \".\" && ПоследнийЦвет === мЦветЧисла) {\n          // Продолжение числа\n          ДобавитьЧастьСтроки1С(ТекущийСимвол, мЦветЧисла);\n          continue;\n\n        } else if (ТекущийСимвол === \"=\" && Сред(СтрокаКода, Поз - 1, 1) === \"<\") {\n          // Знак \"меньше или равно\" - вторая ошибка движка Инфостарт\n          ПоследнийЦвет = undefined;\n\n        } else if (ТекущийСимвол === \"/\" && Сред(СтрокаКода, Поз + 1, 1) === \"/\") {\n          // Проверяется на комментарий\n          ДобавитьЧастьСтроки1С(Прав(СтрокаКода, СтрокаКода.length - Поз + 1), мЦветКомментария);\n          return;\n        };\n        ДобавитьЧастьСтроки1С(ТекущийСимвол, мЦветСпецСимвола);\n\n      } else if (ТекущийСимвол === '\"' || ТекущийСимвол === \"|\") {\n\n        // Операции встрече символа \"кавычка\"\n        // Первая кавычка, запоминаем позицию и взводим флаг нахождения в строке\n        if (ПустаяСтрока(Токен)) {\n          НачалоСтроки = Поз;\n          ВСтроке = true;\n        } else {\n          // Ошибка синтаксиса\n          ДобавитьЧастьСтроки1С(Токен + ТекущийСимвол, мЦветСтроки);\n          Токен = \"\";\n        };\n        ТокенДоТочки = true;\n\n      } else if (ТекущийСимвол === \"'\") {\n\n        // Операции встрече символа \"кавычка\" литерал\n        // Первая кавычка, запоминаем позицию и взводим флаг нахождения в строке\n        if (ПустаяСтрока(Токен)) {\n          НачалоСтроки = Поз;\n          ВСтрокеСкобка = true;\n        } else {\n          // Ошибка синтаксиса\n          ДобавитьЧастьСтроки1С(Токен + ТекущийСимвол, мЦветСтроки);\n          Токен = \"\";\n        };\n        ТокенДоТочки = true;\n\n      } else if (ТекущийСимвол === \"#\" || (ТекущийСимвол === \"&\" && ПустаяСтрока(СтрокаРезультат))) {\n\n        // Встретился символ препроцессора\n        ДобавитьЧастьСтроки1С(Прав(СтрокаКода, СтрокаКода.length - Поз + 1), мЦветПрепроцессора);\n        Поз = СтрокаКода.length;\n        break;\n\n      } else if (ТекущийСимвол === \"~\") {\n        Токен = Токен + ТекущийСимвол;\n        ВСтрокеТильда = true;\n      } else {\n        // Остальные символы\n        Токен = Токен + ТекущийСимвол;\n      }\n    }\n\n    if (ВСтроке) {\n\n      // Многострочная строка\n      ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\n\n    } else if (ВСтрокеСкобка) {\n\n      // Незавершенный литерал\n      ДобавитьЧастьСтроки1С(Сред(СтрокаКода, НачалоСтроки, Поз - НачалоСтроки + 1), мЦветСтроки);\n\n    } else if (!ПустаяСтрока(Токен)) {\n\n      // Анализируем последний токен строки кода\n      if (isKeyword(Токен)) {\n        ДобавитьЧастьСтроки1С(Токен, мЦветКлючевогоСлова1);\n\n      } else if (!isNaN(parseInt(Токен, 10))) {\n        ДобавитьЧастьСтроки1С(Токен, мЦветЧисла);\n\n      } else {\n        ДобавитьЧастьСтроки1С(Токен, мЦветФона);\n      };\n\n    };\n\n  }\n\n  ВСтроке = false;\n  Токен = \"\";\n  УстановленЦвет = false;\n  ПоследнийЦвет = undefined;\n  СтрокаРезультат = '';\n\n  let result = [];\n\n  for (let СтрокаКода of text.split('\\n')) {\n\n    if (ПустаяСтрока(СтрокаКода)) {\n      result.push('');\n      continue;\n    }\n\n    СтрокаРезультат = '';\n    РазукраситьСтроку(СтрокаКода);\n    if (УстановленЦвет && !ВСтроке) {\n      СтрокаРезультат += '</span>';\n      УстановленЦвет = false;\n      ПоследнийЦвет = '';\n      Токен = '';\n    } else if (!ВСтроке) {\n      ПоследнийЦвет = '';\n      Токен = '';\n    }\n\n    result.push(СтрокаРезультат);\n  }\n\n  return result.join('\\n');\n}\n\nexport default highlight;","import React, { FC, ReactElement, useCallback, useEffect } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { getTopicIfNeeded, getNewMessagesIfNeeded, clearTopicMessages } from 'src/data/topic/actions'\r\nimport { newMessageText } from 'src/data/newmessage/actions'\r\n\r\nimport Error from 'src/components/common/error'\r\nimport Pages from 'src/components/common/pages'\r\nimport Header from './header'\r\nimport TopicInfo from './topic_info'\r\nimport Row from './row'\r\nimport Footer from './footer'\r\nimport NewMessage from './new_message';\r\nimport { getMaxPage, extractTextFromHTML } from 'src/utils';\r\nimport { RootState, useAppDispatch } from 'src/data/store';\r\n\r\nimport './topic.css'\r\n\r\nvar scrolledToHash: boolean;\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    isFetching,\r\n    lastUpdated,\r\n    info,\r\n    item0,\r\n    items,\r\n    error\r\n  } = state.topic;\r\n\r\n  return {\r\n    login: state.login,\r\n    info,\r\n    item0,\r\n    items,\r\n    isFetching,\r\n    lastUpdated,\r\n    error,\r\n    options: state.options.items\r\n  }\r\n}\r\n\r\nconst getPageNumber = (locationPage: string | string[]): number | \"last20\" => {\r\n  if (!locationPage) return 1;\r\n  if (locationPage === \"last20\") return \"last20\";\r\n  if (isNaN(+locationPage)) return 1;\r\n  return +locationPage;\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst Topic: FC<ConnectedProps<typeof connector>> = ({ login, items, item0, info, error }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch()\r\n  const location = useLocation();\r\n\r\n  let locationParams = new URLSearchParams(location.search);\r\n  const topicId = +locationParams.get('id');\r\n  const page = getPageNumber(locationParams.get('page'));\r\n  const maxPage = getMaxPage(info.count);\r\n\r\n  const updateTopic = useCallback(() => {\r\n    let _item0 = item0;\r\n    if (topicId !== info.id)\r\n      _item0 = null\r\n\r\n    dispatch(getTopicIfNeeded(topicId, page, _item0));\r\n  }, [dispatch, topicId, page])\r\n\r\n\r\n  const updateNewMessages = useCallback(() => {\r\n    const isLastPage = (page === 'last20' || page === maxPage);\r\n    if (isLastPage)\r\n      dispatch(getNewMessagesIfNeeded());\r\n  }, [dispatch, page])\r\n\r\n  const onPostNewMessageSuccess = () => {\r\n    updateNewMessages();\r\n    dispatch(newMessageText(''));\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (info.title)\r\n      document.title = extractTextFromHTML(info.title);\r\n  }, [info.title]);\r\n\r\n  useEffect(() => {\r\n    updateTopic();\r\n  }, [updateTopic, topicId, page]);\r\n\r\n  useEffect(() => {\r\n\r\n    const timer = window.setInterval(updateNewMessages, 60 * 1000);\r\n\r\n    const clearStore = () => {\r\n      dispatch(clearTopicMessages());\r\n      scrolledToHash = undefined;\r\n      if (timer) clearInterval(timer);\r\n    }\r\n    return clearStore;\r\n\r\n  }, [dispatch, updateNewMessages]);\r\n\r\n  useEffect(() => {\r\n    if (!scrolledToHash &&\r\n      location.hash &&\r\n      items.length > 0) {\r\n      let nodeHash = document.getElementById(location.hash.slice(1));\r\n      if (nodeHash)\r\n        setTimeout(() => window.scrollTo(0, nodeHash.offsetTop), 1);\r\n      scrolledToHash = true;\r\n    }\r\n  });\r\n\r\n  return (\r\n    <div style={{ marginBottom: \"5px\" }}>\r\n      <Header />\r\n      {error && <Error text={error} />}\r\n      <div className=\"topic-table\">\r\n        <TopicInfo />\r\n        <Row key='0' data={item0} />\r\n        {items.map((item, i) => (\r\n          <Row key={item.n} data={item} />\r\n        ))}\r\n        {(maxPage > 1 || page === \"last20\") &&\r\n          <div className=\"tf\">\r\n            <Pages maxPage={maxPage} last20 />\r\n          </div>\r\n        }\r\n      </div>\r\n      <Footer page={page} />\r\n      {login.logged &&\r\n        <NewMessage onSubmitSuccess={onPostNewMessageSuccess} />\r\n      }\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default connector(Topic);","import { FC, ReactElement, useState } from 'react'\r\nimport { childrenToText } from 'src/utils'\r\nimport highlight from './code_highlight'\r\nimport './code1c.css'\r\n\r\nconst prepareText = (text: string): string => {\r\n\r\n  // replace double new-lines\r\n  let newtext = text\r\n    .replace(/\\n<br>/g, '\\n')\r\n    .replace(/<br>\\n/g, '\\n')\r\n    .replace(/\\r<br>/g, '\\n')\r\n    .replace(/<br>\\r/g, '\\n')\r\n    .replace(/<br>/g, '\\n');\r\n\r\n  // remove all leading|ending new-lines\r\n  while (newtext[0] === '\\n') {\r\n    newtext = newtext.substring(1);\r\n  }\r\n\r\n  while (newtext.substring(newtext.length - 1) === '\\n') {\r\n    newtext = newtext.substring(0, newtext.length - 1);\r\n  }\r\n\r\n  return highlight(newtext);\r\n}\r\n\r\nconst Code: FC = ({ children }): ReactElement => {\r\n\r\n  const [hidden, setHidden] = useState(true);\r\n\r\n  let text: string = \"\";\r\n  if (children) {\r\n\r\n    const textArr = childrenToText(children);\r\n    text = textArr.join('');\r\n\r\n    text = prepareText(text);\r\n  }\r\n\r\n  const onShowClick = () => {\r\n    setHidden(!hidden);\r\n  }\r\n\r\n  let buttonText: string;\r\n  let linesCount = 0;\r\n  if (text)\r\n    linesCount = text.split(\"\\n\").length;\r\n\r\n  if (hidden)\r\n    buttonText = `Показать: ${linesCount} строк`;\r\n  else\r\n    buttonText = 'Скрыть';\r\n\r\n  let buttonShow: ReactElement | null = null;\r\n  if (linesCount > 7)\r\n    buttonShow = (\r\n      <div className=\"expand-button-div\">\r\n        <span className=\"expand-button-span\" onClick={onShowClick}>{buttonText}</span>\r\n      </div>\r\n    );\r\n\r\n  let preStyle: React.CSSProperties = {\r\n  }\r\n\r\n  if (hidden && linesCount > 7) {\r\n    preStyle.overflow = \"hidden\";\r\n    preStyle.height = \"135px\";\r\n  } else {\r\n    preStyle.overflow = \"auto\";\r\n    preStyle.height = \"auto\";\r\n  }\r\n\r\n  return (\r\n    <div style={{ marginTop: \"5px\" }}>\r\n      <pre className=\"code-pre\" style={preStyle} dangerouslySetInnerHTML={{ __html: text }}>\r\n      </pre>\r\n      {buttonShow}\r\n    </div>\r\n  )\r\n\r\n\r\n}\r\n\r\nexport default Code;","//TODO: Refactor\r\nimport React, { Component } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport { showTooltip } from '../../data/tooltips/actions'\r\n\r\nimport { getMaxPage, childrenToText } from 'src/utils';\r\nimport { fetchTopicInfo } from 'src/api/topicinfo'\r\nimport { RootState } from 'src/data/store';\r\nimport { ITooltipKeys } from 'src/data/tooltips';\r\n\r\ntype IProps = {\r\n  topicId: string,\r\n  number: number,\r\n  style: {}\r\n}\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    items, info\r\n  } = state.topic;\r\n\r\n  return {\r\n    items,\r\n    info,\r\n    tooltipDelay: state.options.items['tooltipDelay']\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nclass LinkToPost extends Component<ConnectedProps<typeof connector> & IProps, { text: string }> {\r\n\r\n  timer: number;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const { children, number } = this.props;\r\n    if (children)\r\n      this.state = { text: childrenToText(children).join('') };\r\n    else\r\n      this.state = { text: String(number) };\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(props) {\r\n    if (!props.children) {\r\n      this.setState({ text: String(props.number) });\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n\r\n    if (this.state.text.startsWith(\"http\")) {\r\n\r\n      const { topicId } = this.props;\r\n      fetchTopicInfo(+topicId)\r\n        .then(response => {\r\n          this.setState({\r\n            text: response.title\r\n          })\r\n        });\r\n\r\n    }\r\n  }\r\n\r\n  onMouseOver = (e: React.MouseEvent<HTMLElement>) => {\r\n    e.persist();\r\n    const { tooltipDelay } = this.props;\r\n    this.timer = window.setTimeout(() => this.showToolTip(e), +tooltipDelay);\r\n  }\r\n\r\n  onClick = (e: React.MouseEvent<HTMLElement>) => {\r\n    e.stopPropagation();\r\n    clearTimeout(this.timer);\r\n    this.showToolTip(e);\r\n  }\r\n\r\n  onMouseOut = () => {\r\n    clearTimeout(this.timer);\r\n  }\r\n\r\n  showToolTip = (e: React.MouseEvent<HTMLElement>) => {\r\n    const { topicId, number, dispatch } = this.props;\r\n\r\n    const coords = {\r\n      x: e.pageX,\r\n      y: e.pageY - 50 // remove navbar margin-top\r\n    }\r\n\r\n    const keys: ITooltipKeys = {\r\n      topicId: +topicId,\r\n      number: +number\r\n    }\r\n    dispatch(showTooltip(\r\n      keys,\r\n      coords\r\n    ));\r\n  }\r\n\r\n  render() {\r\n\r\n    const { topicId, number, style, info } = this.props;\r\n    const page = getMaxPage(number);\r\n\r\n    let pageParam = '';\r\n    if (page > 1)\r\n      pageParam = `&page=${page}`;\r\n\r\n    let a;\r\n    if ((info && (+topicId === info.id)) || !isNaN(+this.state.text))\r\n      a = (\r\n        <span\r\n          onMouseOver={this.onMouseOver}\r\n          onMouseOut={this.onMouseOut}\r\n          onClick={this.onClick}\r\n          className='link'\r\n          style={{ ...style }}\r\n        >{this.state.text}</span>\r\n      )\r\n    else\r\n      a = (\r\n        <span>\r\n          <a href={`#/topic.php?id=${topicId}${pageParam}#${number}`}\r\n            style={{ ...style }}\r\n          >{this.state.text}</a>{' '}\r\n                    (<span onMouseOver={this.onMouseOver}\r\n            onMouseOut={this.onMouseOut}\r\n            onClick={this.onClick}\r\n            className='link'\r\n          >{number}</span>)\r\n        </span>\r\n      )\r\n\r\n    return a;\r\n  }\r\n}\r\n\r\nexport default connector(LinkToPost);","import React, { FC, ReactElement } from 'react'\r\n\r\ntype IProps = {\r\n  href: string\r\n}\r\n\r\nconst LinkToUser: FC<IProps> = ({ href, children }): ReactElement => {\r\n  return <a href={href} className=\"registered-user\">{children}</a>\r\n}\r\n\r\nexport default LinkToUser;","import React, { FC, ReactElement, useEffect, useState } from 'react';\r\n\r\ntype IProps = {\r\n  href: string,\r\n}\r\n\r\nconst getVideoId = (href: string): string | null => {\r\n\r\n  let fullHref = href;\r\n  if (href.search(/http/) === -1) fullHref = 'http://' + fullHref;\r\n\r\n  try {\r\n    var url = new URL(fullHref);\r\n  } catch (e)  {\r\n    return null;\r\n  }\r\n\r\n  if (url.hostname.search(/youtube/) !== -1) {\r\n    return url.searchParams.get('v');\r\n\r\n  } else if (url.hostname.search(/youtu\\.be/) !== -1) {\r\n    return url.pathname.substring(1)\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nconst getVideoParams = async (videoId: string): Promise<{ hrefName: string, title: string }> => {\r\n\r\n  const apiKey = localStorage.getItem('youtubeApiKey') || 'AIzaSyCztN2QW4Fxw_1YuAHBTOZdYLbzigPz25g';\r\n  let apiUrl = `https://www.googleapis.com/youtube/v3/videos?key=${apiKey}&fields=items(snippet(title))&part=snippet&id=${videoId}`;\r\n  const response = await fetch(apiUrl);\r\n  const json = await response.json();\r\n\r\n  let title = json.items[0].snippet.title;\r\n  let hrefName = title;\r\n  let maxLength = 50;\r\n  if (title.length > maxLength + 5)\r\n    hrefName = hrefName.substring(0, maxLength) + '...'\r\n\r\n  return {\r\n    hrefName,\r\n    title\r\n  }\r\n}\r\n\r\nconst YoutubeLink: FC<IProps> = ({ href }): ReactElement => {\r\n\r\n  let [state, setState] = useState({\r\n    hrefName: href,\r\n    title: ''\r\n  });\r\n\r\n  useEffect(() => {\r\n\r\n    const run = async () => {\r\n\r\n      const videoId = getVideoId(href);\r\n      if (!videoId)\r\n        return;\r\n\r\n      try {\r\n        const params = await getVideoParams(videoId);\r\n        setState({\r\n          ...params\r\n        });\r\n\r\n      } catch (e) {\r\n        console.error('youtube', e.message);\r\n      }\r\n    }\r\n\r\n    run();\r\n  }, [href])\r\n\r\n  const prefix = 'youtube';\r\n  return (\r\n    <a href={href} title={state.title}>{`${prefix}: ${state.hrefName}`}</a>\r\n  )\r\n}\r\n\r\nexport default YoutubeLink;","import { FC, ReactElement } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport URL from 'url-parse'\r\n\r\nimport LinkToPost from './link_to_post'\r\nimport LinkToUser from './link_to_user'\r\nimport YoutubeLink from './youtube_link'\r\n\r\nimport { childrenToText } from 'src/utils'\r\nimport { RootState } from 'src/data/store'\r\n\r\ntype IProps = {\r\n  href: string,\r\n  parentText: string,\r\n  target: string,\r\n  class: string,\r\n  rel: string,\r\n  showTooltipOnPostLink: string,\r\n  showYoutubeVideoTitle: string,\r\n  replaceCatalogMista: string,\r\n  fixBrokenLinks: string,\r\n}\r\n\r\nconst fixBrokenLink = (href: string, parentText: string): string => {\r\n  let escapedHref = href\r\n    .replace(/\\[/g, '\\\\[')\r\n    .replace(/\\]/g, '\\\\]')\r\n    .replace(/\\./g, '\\\\.')\r\n    .replace(/\\./g, '.')\r\n    .replace(/\\*/g, '\\\\*')\r\n    .replace(/\\+/g, '\\\\+')\r\n    .replace(/\\(/g, '\\\\(')\r\n    .replace(/\\)/g, '\\\\)')\r\n    .replace(/\\?/g, '\\\\?')\r\n    .replace(/\\//g, '\\\\/');\r\n\r\n  try {\r\n    let regExp = new RegExp(escapedHref + '<\\\\/a>(\\\\)|[а-яёА-ЯЁ0-9#\\\\-\\\\+\\\\_\\\\%\\\\?=]*)');\r\n    let arr = parentText.match(regExp);\r\n    if (arr && arr.length > 1) {\r\n      if (arr[1] === ')' && href.search('\\\\(') === -1) {\r\n        return href;\r\n      }\r\n      href = href + arr[1];\r\n      return href;\r\n    }\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n  return href;\r\n}\r\n\r\nconst isYoutube = (hostname: string): boolean => {\r\n  if (hostname.search(/youtube/) !== -1\r\n    || hostname.search(/youtu\\.be/) !== -1)\r\n    return true;\r\n  else\r\n    return false\r\n}\r\n\r\nconst isMistaCatalog = (hostname: string): boolean => {\r\n  if (hostname.search(/catalog\\.mista/) !== -1)\r\n    return true;\r\n  else\r\n    return false\r\n}\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    showYoutubeVideoTitle,\r\n    replaceCatalogMista,\r\n    fixBrokenLinks\r\n  } = state.options.items;\r\n\r\n  return {\r\n    showYoutubeVideoTitle,\r\n    replaceCatalogMista,\r\n    fixBrokenLinks\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst CustomLink: FC<ConnectedProps<typeof connector> & IProps> = (props): ReactElement => {\r\n\r\n  const { href, children, parentText,\r\n    showYoutubeVideoTitle, replaceCatalogMista, fixBrokenLinks } = props;\r\n\r\n  try {\r\n    var url = new URL(href, true);\r\n  } catch (e) {\r\n    console.error((e as Error).message, href);\r\n    return <a href={href}>{href}</a>;\r\n  }\r\n\r\n  let newHref = href;\r\n  if (newHref.startsWith('/')) {\r\n    url.set('protocol', 'https')\r\n    url.set('hostname', 'forum.mista.ru')\r\n    newHref = url.href;\r\n  }\r\n\r\n  if (url.hostname.search(/forum\\.mista.ru/) !== -1) {\r\n\r\n    if (url.pathname === '/topic.php') {\r\n      return (\r\n        <LinkToPost topicId={url.query.id} number={url.hash.replace('#', '') || \"0\"}>\r\n          {childrenToText(children)}\r\n        </LinkToPost>\r\n      )\r\n    } else if (url.pathname === '/users.php') {\r\n      return (\r\n        <LinkToUser href={url.href} >\r\n          {children}\r\n        </LinkToUser>\r\n      )\r\n    }\r\n\r\n    if (url.hostname === 'a-sitnikov.github.io' &&\r\n      url.pathname === '/react.mista/') {\r\n\r\n      if (Object.keys(url.query).length === 0) {\r\n\r\n        url = new URL(href.replace(/#\\//, ''), true);\r\n        if (url.pathname === '/react.mista/topic.php')\r\n          return (\r\n            <LinkToPost topicId={url.query.id} number={url.hash.replace('#', '') || \"0\"}>\r\n              {childrenToText(children)}\r\n            </LinkToPost>\r\n          )\r\n      }\r\n    }\r\n  }\r\n\r\n  if (showYoutubeVideoTitle === 'true')\r\n    if (isYoutube(url.hostname)) \r\n      return <YoutubeLink href={href} />\r\n\r\n  if (replaceCatalogMista === 'true')\r\n    if (isMistaCatalog(url.hostname)) {\r\n      url.set('hostname', 'infostart.ru')\r\n\r\n      return (\r\n        <a target={props.target}\r\n          className={props.class}\r\n          rel={props.rel}\r\n          href={url.href} >{url.href} </a>\r\n      )\r\n    }\r\n\r\n  if (fixBrokenLinks === 'true' && parentText) {\r\n    newHref = fixBrokenLink(newHref, parentText);\r\n  }\r\n\r\n  return (\r\n    <a target={props.target}\r\n      className={props.class}\r\n      rel={props.rel}\r\n      href={newHref} >{children}</a>\r\n  )\r\n}\r\n\r\nexport default connector(CustomLink);","import React, { FC, ReactElement } from 'react'\r\nimport { domain } from 'src/api'\r\n\r\nimport { IVotingItem } from 'src/data/topic'\r\n\r\ntype IProps = {\r\n  topicId: number,\r\n  data: IVotingItem,\r\n  colors: string[],\r\n  total: number,\r\n  n: number\r\n}\r\n\r\nconst VoteItem: FC<IProps> = ({ topicId, data, total, n, colors }): ReactElement => {\r\n\r\n  const img = `${domain}/css/voting${n}.png`;\r\n\r\n  let percent = 0;\r\n\r\n  if (total) {\r\n    percent = Math.round(100 * data.count / total);\r\n  }\r\n\r\n  const imgStyle = { maxWwidth: \"500px\", width: \"100%\", height: \"15px\" };\r\n\r\n  return (\r\n    <div className=\"voting-item\">\r\n      <div className=\"voting-title\">\r\n        <a rel=\"nofollow\" style={{ textDecoration: \"none\" }} href={`#/topic.php?id=${topicId}&sel=${n}`}>\r\n          <b><span style={{ color: colors[n - 1] }}>{`${n}. ${data.text}`}</span></b>\r\n        </a>\r\n      </div>\r\n      <div className=\"voting-percentage\">\r\n        {/*<div className=\"div-va-middle\">*/}\r\n        <b><span style={{ color: colors[n - 1] }}>{`${percent}% (${data.count})`}</span></b>\r\n        {/*</div>*/}\r\n      </div>\r\n      <div className=\"voting-bar\">\r\n        <div style={{ width: `${percent}%` }}>\r\n          <a href={img}>\r\n            <img src={img} style={imgStyle} alt={`п${n}`} />\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default VoteItem;","import { FC, ReactElement } from 'react'\r\nimport VoteItem from './vote_item'\r\nimport { IVotingItem } from 'src/data/topic'\r\n\r\ntype IProps = {\r\n  items: IVotingItem[],\r\n  topicId: number,\r\n  colors: string[]\r\n}\r\n\r\nconst VoteChart: FC<IProps> = ({ items, topicId, colors }): ReactElement => {\r\n\r\n  let total = Math.max(...items.map(item => item.count));\r\n\r\n  return (\r\n    <div style={{ marginBottom: \"10px\" }}>\r\n      {items.filter(item => item.text).map((data, i) => <VoteItem key={i} data={data} total={total} n={i + 1} topicId={topicId} colors={colors} />)}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default VoteChart;","import React, { FC, ReactElement } from 'react'\r\n\r\ntype IProps = {\r\n  colors: string[],\r\n  n: number,\r\n  text: string\r\n}\r\n\r\nconst Vote: FC<IProps> = ({ colors, n, text }): ReactElement => {\r\n\r\n  return (\r\n    <div style={{ marginTop: \"5px\" }}>\r\n      <b><span style={{ color: colors[n - 1] }}>{`${n}. ${text}`}</span></b>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Vote;","import { FC, ReactElement, useEffect, useState } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport activeHtml from 'react-active-html';\r\n\r\nimport Code from 'src/components/extensions/code1c'\r\nimport LinkToPost from 'src/components/extensions/link_to_post'\r\nimport CustomLink from 'src/components/extensions/custom_link'\r\n\r\nimport VoteChart from './vote_chart'\r\nimport Vote from './vote'\r\nimport { ITopicMessage } from 'src/data/topic';\r\nimport { RootState } from 'src/data/store';\r\nimport { fetchTopicInfo } from 'src/api/topicinfo';\r\n\r\ntype IProps = {\r\n  topicId: number,\r\n  n: number,\r\n  html: string,\r\n  vote: number,\r\n  data: ITopicMessage,\r\n  style?: {}\r\n}\r\n\r\nconst processLinksToPosts = (text: string, topicId: number): string => {\r\n\r\n  const regexp = /(\\()(\\d+)(\\))/gi; // (12)\r\n  return text.replace(regexp, (res, ...segments) => {\r\n    const number = segments[1];\r\n    return `(<link data-topicid='${topicId}' data-number='${number}' ></link>)`\r\n  });\r\n}\r\n\r\nconst processCode1C = (text: string): string => {\r\n\r\n  const regexp = /(\\[1[CС]\\])((.|\\n|\\r)*?)(\\[\\/1[CС]\\])/gi; // [1C] text [/1C]\r\n  return text.replace(regexp, (res, ...segments) => {\r\n    let txt = segments[1];\r\n\r\n    //remove first <br>\r\n    if (txt.substr(0, 4) === \"<br>\")\r\n      txt = txt.substr(4);\r\n    return `<code>${txt}</code>`\r\n  });\r\n}\r\n\r\nconst processText = (text: string, topicId: number): string | undefined => {\r\n\r\n  if (!text)\r\n    return text;\r\n\r\n  let newtext = processCode1C(text);\r\n  newtext = processLinksToPosts(newtext, topicId);\r\n\r\n  return newtext;\r\n}\r\n\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const { info } = state.topic;\r\n\r\n  return {\r\n    info,\r\n    voteColors: state.options.voteColors,\r\n    showTooltips: state.options.items['showTooltips']\r\n  }\r\n}\r\nconst connector = connect(mapState);\r\nconst MsgText: FC<ConnectedProps<typeof connector> & IProps> =\r\n  ({ topicId, n, html, vote, info, style, voteColors }): ReactElement => {\r\n\r\n    if (vote && info.voting && topicId === info.id)\r\n      var _voteText = info.voting[vote - 1].text;\r\n    else\r\n      _voteText = null;\r\n\r\n    const [voteText, setVoteText] = useState(_voteText);\r\n\r\n    const getVoteText = async () => {\r\n      try {\r\n        const _info = await fetchTopicInfo(topicId);\r\n        setVoteText(_info.voting[vote - 1].text);\r\n      } catch (e) {\r\n        console.error(e.message);\r\n      }\r\n    }\r\n\r\n    useEffect(() => {\r\n      if (vote) {\r\n        if (!(_voteText))\r\n          getVoteText();\r\n      } else {\r\n        if (voteText)\r\n          setVoteText(null)\r\n      }\r\n    }, [vote]);\r\n\r\n    const showVote = (vote !== 0) && (voteText !== null);\r\n    let voteChart: ReactElement;\r\n    if (n === 0 && info.isVoting && info.voting) {\r\n      voteChart = <VoteChart items={info.voting} topicId={topicId} colors={voteColors} />\r\n    }\r\n\r\n    let processedHtml = processText(html, topicId);\r\n    const componentsMap = {\r\n      link: (props: any) => <LinkToPost topicId={props['data-topicid']} number={props['data-number']} key={props.key} />,\r\n      code: (props: any) => <Code {...props} />,\r\n      a: (props: any) => <CustomLink {...props} parentText={processedHtml} />\r\n    };\r\n    const textComponent = activeHtml(processedHtml, componentsMap);\r\n\r\n    return (\r\n      <div className=\"message\" style={style}>\r\n        {voteChart}\r\n        <div>\r\n          {textComponent}\r\n        </div>\r\n        {showVote && <Vote text={voteText} n={vote} colors={voteColors} />}\r\n      </div>\r\n    )\r\n  }\r\n\r\nexport default connector(MsgText);","import React, { FC, ReactElement, useEffect, useState } from 'react'\r\nimport dateFormat from 'dateformat'\r\nimport classNames from 'classnames'\r\nimport { domain } from 'src/api'\r\n\r\nimport { addMessageText } from 'src/data/newmessage/actions'\r\nimport { useAppDispatch } from 'src/data/store'\r\nimport { ITopicMessage } from 'src/data/topic'\r\n\r\ntype IProps = {\r\n  data: ITopicMessage,\r\n  isAuthor: boolean,\r\n  isYou: boolean,\r\n  isTooltip?: boolean\r\n}\r\n\r\nconst UserInfo: FC<IProps> = (props): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const [imgDisplay, setImgDisplay] = useState('none');\r\n\r\n  const onClick = () => {\r\n    const { data } = props;\r\n    dispatch(addMessageText(`(${data.n})`));\r\n\r\n    let elem = document.getElementById('message_text');\r\n    if (elem)\r\n      window.scrollTo(0, elem.offsetTop);\r\n  }\r\n\r\n  const onImageLoad = () => {\r\n    setImgDisplay('inline');\r\n  }\r\n\r\n  const onImageError = () => {\r\n    setImgDisplay('none');\r\n  }\r\n\r\n  const { data, isAuthor, isYou, isTooltip } = props;\r\n  useEffect(() => {\r\n    setImgDisplay('none');\r\n  }, [data.n]);\r\n\r\n  const href = `${domain}/users.php?id=${data.userId}`;\r\n  let dataStr;\r\n  if (!data) {\r\n    dataStr = '';\r\n  } else if (data.n === 0) {\r\n    dataStr = dateFormat(new Date(data.time), 'dd.mm.yy - HH:MM');\r\n  } else {\r\n    dataStr = (\r\n      <>\r\n        <span className=\"message-number\">{data.n}</span>{' - ' + dateFormat(new Date(data.time), 'dd.mm.yy - HH:MM')}\r\n      </>\r\n    )\r\n  }\r\n\r\n  const userClassNames = classNames(\"registered-user\", {\r\n    \"is-author\": isAuthor,\r\n    \"is-you\": isYou\r\n  });\r\n\r\n  let imgElem;\r\n  if (window.innerWidth > 7680000)\r\n    imgElem = <img src={`${domain}/css/user_icons/${data.userId}_16x16.png`}\r\n      alt=\"user ico\"\r\n      onLoad={onImageLoad}\r\n      onError={onImageError}\r\n      style={{ display: imgDisplay, marginBottom: \"4px\", marginRight: \"1px\" }} />\r\n\r\n  let timeElem;\r\n  if (isTooltip) {\r\n    timeElem = <div className=\"ah\" style={{ display: \"inline-block\", marginLeft: \"5px\" }}>{dataStr}</div>;\r\n  } else {\r\n    timeElem =\r\n      <div className=\"message-time\">\r\n        <span className=\"ah\" >{dataStr}</span>\r\n        <button className=\"button ah\" onClick={onClick}>{dataStr}</button>\r\n      </div>\r\n  }\r\n\r\n  return (\r\n    <div className=\"user-info\">\r\n      {imgElem}\r\n      <a className={userClassNames} href={href}>{data.user}</a>\r\n      {timeElem}\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default UserInfo;","import { FC, ReactElement, useState, useEffect } from 'react'\r\n\r\nimport { fetchTopicMessage } from 'src/api/topicMessages'\r\n\r\nimport MsgText from 'src/components/topic/row/msg_text'\r\nimport { ITopicMessage } from 'src/data/topic'\r\nimport UserInfo from '../topic/row/user_info'\r\n\r\nimport './topic_preview.css'\r\n\r\ntype IProps = {\r\n  topicId: number,\r\n  n: number,\r\n  author: string,\r\n  loggedUserId: number,\r\n  onDataLoaded?: () => void\r\n}\r\n\r\nconst PreviewContent: FC<IProps> = ({ topicId, n, author, loggedUserId, onDataLoaded }): ReactElement => {\r\n\r\n  const [data, setData] = useState<ITopicMessage | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n\r\n    const getData = async () => {\r\n      try {\r\n        const _data = await fetchTopicMessage(topicId, n);\r\n        if (_data) {\r\n          setData(_data);\r\n          setError(null);\r\n          if (onDataLoaded) onDataLoaded();\r\n        } else {\r\n          setData(null);\r\n          setError(`Не найдено сообщение ${n}`);\r\n        }  \r\n      } catch (e) {\r\n        setData(null);\r\n        setError((e as Error).message);\r\n      }\r\n\r\n    }\r\n\r\n    getData();\r\n\r\n  }, [topicId, n, onDataLoaded])\r\n\r\n  if (!data && !error)\r\n    return null;\r\n\r\n  return (\r\n    <>\r\n      {data &&\r\n        <div className='preview-content'>\r\n          <div className='topic-preview-userinfo'>\r\n            <UserInfo data={data} isAuthor={data.user === author} isYou={data.userId === loggedUserId} isTooltip />\r\n          </div>\r\n          <MsgText\r\n            topicId={topicId}\r\n            n={n}\r\n            data={data}\r\n            html={data.text}\r\n            vote={data.vote}\r\n            style={{ overflowY: \"auto\", overflowWrap: \"break-word\" }}\r\n          />\r\n        </div>}\r\n      {error && <span>{error}</span>}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default PreviewContent;","import React, { FC, ReactElement, useState } from 'react'\r\nimport { SwipeEventData, useSwipeable } from 'react-swipeable'\r\nimport { fetchTopicInfo } from 'src/api/topicinfo'\r\n\r\nimport PreviewButtons from './preview_buttons'\r\nimport PreviewContent from './preview_content'\r\nimport './topic_preview.css'\r\n\r\ntype IProps = {\r\n  topicId: number,\r\n  initialMsgNumber: number,\r\n  author: string,\r\n  loggedUserId: number\r\n}\r\n\r\nconst TopicPreview: FC<IProps> = ({ topicId, initialMsgNumber, author, loggedUserId }): ReactElement => {\r\n\r\n  const [deltaX, setDeltaX] = useState(0);\r\n  const [display, setDispaly] = useState('none');\r\n  const [state, setState] = useState({\r\n    msgNumber: initialMsgNumber,\r\n    key: 0\r\n  })\r\n\r\n  const onClickFirst = () => {\r\n    setState({\r\n      msgNumber: 0,\r\n      key: state.key\r\n    });\r\n  }\r\n\r\n  const onClickNext = () => {\r\n    setState({\r\n      msgNumber: state.msgNumber + 1,\r\n      key: state.key\r\n    });\r\n  }\r\n\r\n  const onClickPrev = () => {\r\n    if (state.msgNumber > 0)\r\n      setState({\r\n        msgNumber: state.msgNumber - 1,\r\n        key: state.key\r\n      });\r\n  }\r\n\r\n  const onClickLast = async () => {\r\n    const info = await fetchTopicInfo(topicId);\r\n    setState({\r\n      msgNumber: info.count,\r\n      key: state.key\r\n    });    \r\n  }\r\n\r\n  const onSwiping = (eventData: SwipeEventData) => {\r\n    if (Math.abs(eventData.deltaX) < 35)\r\n      setDeltaX(0);\r\n    else\r\n      setDeltaX(eventData.deltaX);\r\n  }\r\n\r\n  const onSwiped = (eventData: SwipeEventData) => {\r\n\r\n    if (Math.abs(eventData.deltaX) > 150) {\r\n      if (eventData.dir === \"Left\") {\r\n        setState({\r\n          msgNumber: state.msgNumber + 1,\r\n          key: state.key + 1\r\n        });         \r\n      } else if (eventData.dir === \"Right\" && state.msgNumber > 0) {\r\n        setState({\r\n          msgNumber: state.msgNumber - 1,\r\n          key: state.key + 1\r\n        });           \r\n      }\r\n    }\r\n    setDeltaX(0);\r\n  }\r\n\r\n  const swipeable = useSwipeable({\r\n    onSwiping,\r\n    onSwiped,\r\n    delta: 15\r\n  });\r\n\r\n  const onContentLoaded = () => {\r\n    setDispaly('block');\r\n  }\r\n\r\n  let items = [state.msgNumber];\r\n\r\n  if (deltaX < 0)\r\n    items.push(state.msgNumber + 1);\r\n  else if (deltaX > 0 && state.msgNumber > 0)\r\n    items.push(state.msgNumber - 1);\r\n\r\n  const style: React.CSSProperties = {\r\n    transform: `translate3d(${deltaX}px, 0px, 0px)`,\r\n    flexDirection: deltaX > 0 ? 'row-reverse' : 'row'\r\n  }\r\n\r\n  return (\r\n    <div className=\"preview-container\" style={{ display }}>\r\n      <div className=\"topic-preview\">\r\n        <PreviewButtons\r\n          topicId={topicId}\r\n          onFirst={onClickFirst}\r\n          onLast={onClickLast}\r\n          onNext={onClickNext}\r\n          onPrev={onClickPrev}\r\n        />\r\n        <div className='preview-carousel' {...swipeable} style={style}>\r\n          <div className='preview-carousel-item' key={state.key} style={{ order: 0 }}>\r\n            <PreviewContent\r\n              topicId={topicId}\r\n              n={items[0]}\r\n              loggedUserId={loggedUserId}\r\n              author={author}\r\n              onDataLoaded={onContentLoaded}\r\n            />\r\n          </div>\r\n          {items.length > 1 &&\r\n            <div className='preview-carousel-item' key={state.key + 1} style={{ order: 1 }}>\r\n              <PreviewContent\r\n                topicId={topicId}\r\n                n={items[1]}\r\n                loggedUserId={loggedUserId}\r\n                author={author}\r\n              />\r\n            </div>}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default TopicPreview;","import React, { FC, ReactElement, useCallback, useEffect } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport { useLocation } from 'react-router-dom'\r\nimport queryString from 'query-string'\r\n\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\nimport { getTopicsListIfNeeded } from 'src/data/topicslist/actions'\r\n\r\nimport Header from './header'\r\nimport Row from './row'\r\nimport Pages from 'src/components/common/pages'\r\nimport NewTopic from './new_topic'\r\nimport Error from 'src/components/common/error'\r\n\r\nimport TopicPreview from 'src/components/preview/topic_preview'\r\n\r\nimport './topics_list.css'\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  return {\r\n    topicsList: state.topicsList,\r\n    sections: state.sections,\r\n    login: state.login,\r\n    options: state.options\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst TopicsList: FC<ConnectedProps<typeof connector>> = ({ topicsList, sections, login }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch()\r\n  const location = useLocation();\r\n\r\n  const updateTopicsList = useCallback((locationParams) => {\r\n    dispatch(getTopicsListIfNeeded(locationParams));\r\n  }, [dispatch])\r\n\r\n  useEffect(() => {\r\n    document.title = 'React.Mista';\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const locationParams = queryString.parse(location.search);\r\n    updateTopicsList(locationParams);\r\n  }, [location.search, updateTopicsList]);\r\n\r\n  let rows = [];\r\n  for (let item of topicsList.items) {\r\n\r\n    rows.push(<Row key={item.id} data={item} topicId={item.id}/>);\r\n    if (item.showPreview)\r\n      rows.push(\r\n        <TopicPreview \r\n          key={`preview${item.id}`} \r\n          topicId={item.id} \r\n          initialMsgNumber={item.previewMsgNumber}\r\n          author={item.author}\r\n          loggedUserId={login.userId}\r\n          />\r\n      )\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Header />\r\n      {topicsList.error && (<Error text={topicsList.error} />)}\r\n      <div className=\"topic-list-table\">\r\n        <div className=\"th\" style={{ position: \"sticky\", top: \"39px\" }}>\r\n          <div style={{ letterSpacing: \"-1px\" }}>Раздел</div>\r\n          <div></div>\r\n          <div>Тема</div>\r\n          <div>Re</div>\r\n          <div>Автор</div>\r\n          <div><span style={{ cursor: \"pointer\" }} title=\"Обновить список\" onClick={updateTopicsList}>{topicsList.isFetching ? \"Обновляется\" : \"Обновлено\"}</span></div>\r\n        </div>\r\n        {rows}\r\n        <div className=\"tf\">\r\n          <Pages maxPage={10} />\r\n        </div>\r\n      </div>\r\n      <div id=\"F\" className=\"newtopic\" style={{ marginBottom: \"10px\", marginTop: \"5px\", position: 'relative' }}>\r\n        <NewTopic \r\n          onSubmitSuccess={updateTopicsList}\r\n        />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default connector(TopicsList);","import React, { FC, ReactElement } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport { RootState } from 'src/data/store'\r\nimport Login from 'src/components/login'\r\nimport { Link } from 'react-router-dom';\r\n\r\nconst mapState = (state: RootState) => {\r\n  return {\r\n    info: state.topic.info,\r\n    login: state.login\r\n  }  \r\n}\r\nconst connector = connect(mapState);\r\n\r\nconst Header: FC<ConnectedProps<typeof connector>> =  ({ info, login }): ReactElement => {\r\n\r\n  const forums = {\r\n    '1c': '1С:Предприятие',\r\n    'life': 'О жизни',\r\n    'it': 'Информационные технологии',\r\n    'job': 'Работа'\r\n  };\r\n\r\n  return (\r\n\r\n    <div className=\"flex-row\">\r\n      <div className=\"header-left\">\r\n        <Login/>\r\n      </div>\r\n      <div className=\"header-right\">\r\n        <span id=\"forum_string\" className=\"bold120\">\r\n          <Link to={`/index.php?forum=${info.forum}`} style={{ textDecoration: \"none\" }}>{forums[info.forum]}</Link>\r\n        </span>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default connector(Header);","import React, { FC, ReactElement } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport { RootState } from 'src/data/store'\r\n\r\nimport { domain, urlTopicInfo, urlTopicMessages } from 'src/api'\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    info\r\n  } = state.topic;\r\n\r\n  return {\r\n    info\r\n  }\r\n}\r\nconst connector = connect(mapState);\r\nconst TopicInfo: FC<ConnectedProps<typeof connector>> = ({ info }): ReactElement => {\r\n\r\n  let yandexUrl = \"https://www.yandex.ru/search/?text=\" + encodeURIComponent(info.title);\r\n\r\n  return (\r\n    <div className=\"topic-row\">\r\n      <div className=\"cell-userinfo\">\r\n        <div className=\"topic-tools\">\r\n          <a title=\"API.info\" href={`${domain}/${urlTopicInfo}?id=${info.id}`} className=\"agh\" style={{ display: \"block\", lineHeight: \"1em\" }}>i</a>\r\n          <a title=\"API.messages\" href={`${domain}/${urlTopicMessages}?id=${info.id}&from=0&to=20`} className=\"agh\" style={{ display: \"block\", lineHeight: \"1em\" }}>m</a>\r\n          {/*<a href=\"add_voting.php?topic_id=815217\" title=\"Добавить голосование\">vote</a> &nbsp;&nbsp;*/}\r\n        </div>\r\n      </div>\r\n      <div className=\"cell-message\">\r\n        <div className=\"flex-row\">\r\n          <div style={{ flex: 1, textAlign: \"center\" }}>\r\n            <a href={`${domain}/topic.php?id=${info.id}`}>\r\n              <h1 className=\"topic-title\" dangerouslySetInnerHTML={{ __html: info.title }}></h1>\r\n            </a>\r\n            <div className=\"moder-action\"></div>\r\n          </div>\r\n          <div style={{ flex: \"0 0 20px\", position: \"relative\" }}>\r\n            <div className=\"div-va-middle\">\r\n              <a rel=\"noopener noreferrer\" href={yandexUrl} title=\"Искать в Яндексе\" target=\"_blank\" className=\"yandex\">Я</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default connector(TopicInfo);","import React, { FC, ReactElement } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport UserInfo from './user_info'\r\nimport MsgText from './msg_text'\r\nimport { RootState } from 'src/data/store'\r\nimport { ITopicMessage } from 'src/data/topic'\r\n\r\ntype IProps = {\r\n  data: ITopicMessage\r\n}\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    info,\r\n    item0,\r\n  } = state.topic || {\r\n    info: {},\r\n    item0: {},\r\n  }\r\n\r\n  return {\r\n    topicId: info.id,\r\n    author: item0 ? item0.user : '',\r\n    login: state.login\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst Row: FC<ConnectedProps<typeof connector> & IProps> = (props): ReactElement => {\r\n\r\n    const { data, author, topicId, login } = props;\r\n\r\n    if (!data)\r\n      return null;\r\n\r\n    return (\r\n      <div className=\"topic-row\" id={String(data.n)}>\r\n        <div className=\"cell-userinfo\">\r\n          <UserInfo data={data} isAuthor={data.user === author} isYou={data.user === login.userName} />\r\n        </div>\r\n        <div className=\"cell-message\">\r\n          <MsgText data={data} html={data.text} topicId={topicId} n={data.n} vote={data.vote} />\r\n        </div>\r\n      </div>\r\n    )\r\n}\r\n\r\nexport default connector(Row);","import React, { FC, ReactElement } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport { Button } from 'react-bootstrap'\r\n\r\nimport { getNewMessagesIfNeeded } from 'src/data/topic/actions'\r\nimport { getMaxPage } from 'src/utils'\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\nimport { defaultInfo } from 'src/data/topic';\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    isFetching,\r\n    lastUpdated,\r\n    info,\r\n  } = state.topic || {\r\n    isFetching: true,\r\n    info: defaultInfo,\r\n  }\r\n\r\n  return {\r\n    info,\r\n    isFetching,\r\n    lastUpdated\r\n  }\r\n}\r\nconst connector = connect(mapState);\r\ntype IProps = { page?: number | string };\r\n\r\nconst Footer: FC<ConnectedProps<typeof connector> & IProps> = ({ info, isFetching, page }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const onBookmarkClick = () => {\r\n    //dispatch(addBookmark(info));\r\n  }\r\n\r\n  const onRefreshClick = () => {\r\n    dispatch(getNewMessagesIfNeeded());\r\n  }\r\n\r\n  const maxPage = getMaxPage(info.count);\r\n\r\n  let showUpdateButton = false;\r\n  if (page === 'last20' || page === maxPage)\r\n    showUpdateButton = true;\r\n\r\n  return (\r\n    <div className=\"flex-row\" id=\"F\">\r\n      <div className=\"ta-left va-top\" style={{ width: \"50%\" }}>\r\n        <Button\r\n          onClick={onBookmarkClick}\r\n          disabled={false}\r\n          size=\"sm\"\r\n          className='button'\r\n          variant=\"light\">\r\n          {'Закладка'}\r\n        </Button>\r\n      </div>\r\n      <div className=\"ta-right va-middle\" style={{ marginLeft: \"auto\" }}>\r\n        {showUpdateButton &&\r\n          <Button\r\n            onClick={onRefreshClick}\r\n            disabled={isFetching}\r\n            size=\"sm\"\r\n            className='button'\r\n            variant=\"light\">\r\n            {isFetching ? 'Обновляется' : 'Обновить ветку'}\r\n          </Button>\r\n        }\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default connector(Footer);","import React, { FC, ReactElement, useState } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport { FormGroup, Form } from 'react-bootstrap'\r\n\r\nimport TextEditor from 'src/components/common/text_editor'\r\nimport { newMessageText, postNewMessage } from 'src/data/newmessage/actions'\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\n\r\nimport { PostNewmessageParams } from 'src/data/newmessage/actions'\r\n\r\ntype IProps = {\r\n  onSubmitSuccess?: () => void\r\n}\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  return {\r\n    info: state.topic.info,\r\n    newMessage: state.newMessage\r\n  };\r\n\r\n}\r\n\r\nconst connector = connect(mapState);\r\n\r\nconst NewMessage: FC<ConnectedProps<typeof connector> & IProps> = ({ info, newMessage, onSubmitSuccess }): ReactElement => {\r\n\r\n  const [voting, setVoting] = useState<number | undefined>();\r\n  const dispatch = useAppDispatch()\r\n\r\n  const onSubmit = (e: any) => {\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    let params: PostNewmessageParams = {\r\n      text: newMessage.text,\r\n      topicId: String(info?.id),\r\n      onSuccess: afterSubmit,\r\n      voting_select: undefined\r\n    };\r\n\r\n    if (voting) {\r\n      params.voting_select = voting;\r\n    }\r\n\r\n    dispatch(postNewMessage(params));\r\n  }\r\n\r\n  const afterSubmit = () => {\r\n\r\n    dispatch(newMessageText(''));\r\n\r\n    setVoting(undefined);\r\n\r\n    if (onSubmitSuccess) {\r\n      onSubmitSuccess();\r\n    }\r\n  }\r\n\r\n  const clearVoting = (e: React.MouseEvent<HTMLElement>) => {\r\n\r\n    e.preventDefault();\r\n    setVoting(undefined);\r\n\r\n  }\r\n\r\n  const setVotingOption = (i: number) => {\r\n    setVoting(i);\r\n  }\r\n\r\n  let votingElem;\r\n  if (info?.isVoting && info?.voting) {\r\n\r\n    let votingOptions = [];\r\n    for (let i = 1; i <= info.voting.length; i++) {\r\n\r\n      const item = info.voting[i - 1];\r\n      if (!item.text)\r\n        continue;\r\n\r\n      votingOptions.push(\r\n        <Form.Check\r\n          type=\"radio\"\r\n          key={i}\r\n          name=\"voting\"\r\n          checked={voting === i}\r\n          onChange={() => setVotingOption(i)}\r\n          label={`${i}. ${item.text}`}\r\n        />\r\n      );\r\n    }\r\n\r\n\r\n    votingElem = (\r\n      <FormGroup>\r\n        <legend>\r\n          <small>Ваш выбор:\r\n            <span id=\"voting_clear\" style={{ marginLeft: \"5px\", cursor: \"pointer\" }} onClick={clearVoting}>очистить</span>\r\n          </small>\r\n        </legend>\r\n        {votingOptions}\r\n        Обоснуйте свой выбор!\r\n      </FormGroup>\r\n    );\r\n\r\n  }\r\n\r\n  return (\r\n    <form style={{ marginTop: \"5px\" }} onSubmit={onSubmit}>\r\n      <div className=\"bold\">Добавить сообщение в тему:</div>\r\n      <div className=\"new-message-container\">\r\n        <div className=\"new-message-text\">\r\n          <TextEditor\r\n            isFetching={newMessage.isFetching}\r\n            text={newMessage.text}\r\n            placeholder=\"Сообщение\"\r\n            formName=\"NEW_MESSAGE\"\r\n          />\r\n        </div>\r\n        <div className=\"new-message-voting\">\r\n          {votingElem}\r\n        </div>\r\n      </div>\r\n    </form>\r\n  )\r\n\r\n}\r\n\r\nexport default connector(NewMessage);","import { FC, ReactElement } from 'react'\r\nimport { Form } from 'react-bootstrap'\r\n\r\ntype IProps = {\r\n  name: string,\r\n  label: string,\r\n  value: string,\r\n  values: Array<{ name: string, descr: string }>,\r\n  onChange: any,\r\n  oneLine: boolean\r\n}\r\n\r\nconst RadioOption: FC<IProps> = ({ name, label, value, values, oneLine, onChange }): ReactElement => {\r\n\r\n  const onChangeValue = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    onChange(e, name, e.target.value);\r\n  }\r\n\r\n  return (\r\n    <span>\r\n      <span style={{ marginRight: \"5px\" }}> {label} </span>\r\n      {oneLine && <br/>}\r\n      {values.map((item, i) =>\r\n        <Form.Check key={i}\r\n          type=\"radio\"\r\n          id={item.name}\r\n          label={item.descr}\r\n          name={label}\r\n          checked={item.name === value}\r\n          value={item.name}\r\n          inline={oneLine}\r\n          onChange={onChangeValue}\r\n        >\r\n        </Form.Check>\r\n      )}\r\n    </span>\r\n  );\r\n}\r\n\r\nexport default RadioOption;","import React, { FC, ReactElement } from 'react'\r\n\r\ntype IProps = {\r\n  name: string,\r\n  label: string,\r\n  value: string,\r\n  onChange: any,\r\n  postfix?: string\r\n}\r\n\r\nconst StringOption: FC<IProps> = (props): ReactElement => {\r\n\r\n  const onChange = (e: any) => {\r\n    const { name } = props;\r\n    props.onChange(e, name, e.target.value);\r\n  }\r\n\r\n  const { name, value, label, postfix } = props;\r\n\r\n  return (\r\n    <label htmlFor={name} style={{ marginRight: \"5px\" }}>\r\n      <span style={{ marginRight: \"5px\" }}>{label}</span>\r\n      <input type=\"string\" name={name} value={value} onChange={onChange} className='input' />\r\n      {postfix !== undefined ?\r\n        <span style={{ marginLeft: \"5px\" }}>{postfix}</span>\r\n        : null}\r\n    </label>\r\n  );\r\n}\r\n\r\nexport default StringOption;","export const formTabs = [\r\n  {\r\n    tabName: 'Общие',\r\n    rows: [\r\n      ['theme'],\r\n      ['topicsPerPage'],\r\n      ['autoRefreshTopicsList', 'autoRefreshTopicsListInterval'],\r\n      ['autoRefreshTopic', 'autoRefreshTopicInterval'],\r\n    ]\r\n  },\r\n  {\r\n    tabName: 'Тултипы',\r\n    rows: [\r\n      ['showTooltips', 'tooltipDelay'],\r\n      ['showTooltipOnPostLink']\r\n    ]\r\n  },\r\n  {\r\n    tabName: 'Ссылки',\r\n    rows: [\r\n      ['showYoutubeVideoTitle'],\r\n      ['replaceCatalogMista'],\r\n      ['fixBrokenLinks'],\r\n    ]\r\n  }\r\n];\r\n\r\nexport const formParams = {\r\n  'theme': {\r\n    type: 'radio',\r\n    label: 'Цветовая палитра:',\r\n    oneLine: true,\r\n    values: [\r\n      { name: 'yellow', descr: 'Золотая' },\r\n      { name: 'lightgray', descr: 'Серая' },\r\n      { name: 'dark', descr: 'Темная' }\r\n    ]\r\n  },\r\n  'topicsPerPage': {\r\n    type: 'number',\r\n    label: 'Тем на странице (max 99):',\r\n    min: 1,\r\n    max: 99\r\n  },\r\n  'autoRefreshTopicsList': {\r\n    type: 'checkbox',\r\n    label: 'Автообновление списка тем'\r\n  },\r\n  'autoRefreshTopicsListInterval': {\r\n    type: 'number',\r\n    label: '',\r\n    min: 60,\r\n    max: 1000000,\r\n    postfix: 'сек'\r\n  },\r\n  'autoRefreshTopic': {\r\n    type: 'checkbox',\r\n    label: 'Автообновление темы'\r\n  },\r\n  'autoRefreshTopicInterval': {\r\n    type: 'number',\r\n    label: '',\r\n    min: 60,\r\n    max: 1000000,\r\n    postfix: 'сек'\r\n  },\r\n  //Tooltips   \r\n  'showTooltips': {\r\n    type: 'checkbox',\r\n    label: 'Показывать тултипы, задержка'\r\n  },\r\n  'tooltipDelay': {\r\n    type: 'number',\r\n    max: 1000000,\r\n    label: '',\r\n    postfix: 'мс'\r\n  },\r\n  'showTooltipOnPostLink': {\r\n    type: 'checkbox',\r\n    label: 'Показывать тултип ссыки на другую ветку'\r\n  },\r\n  //links   \r\n  'showYoutubeVideoTitle': {\r\n    type: 'checkbox',\r\n    label: 'Показывать наименования роликов youtube'\r\n  },\r\n  'replaceCatalogMista': {\r\n    type: 'checkbox',\r\n    label: 'Обратно заменять catalog.mista.ru на infostart.ru'\r\n  },\r\n  'fixBrokenLinks': {\r\n    type: 'checkbox',\r\n    label: 'Чинить поломанные ссылки (с русскими символами)'\r\n  },\r\n}","import { FC, ReactElement } from \"react\";\r\n\r\ntype IProps = {\r\n  name: string\r\n}\r\n\r\nconst Tab: FC<IProps> = ({ name, children }): ReactElement => {\r\n  return (\r\n    <div>\r\n      <div className=\"tab-header\">\r\n        {name}\r\n      </div>\r\n      <div className=\"tab-content\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Tab;","import { FC, ReactElement, useState } from 'react'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport { Form, FormControl, Button } from 'react-bootstrap'\r\n\r\nimport RadioOption from './radio_option'\r\nimport StringOption from './string_option'\r\n\r\nimport { saveOptions } from 'src/data/options/actions'\r\n\r\nimport { defaultOptionsState } from 'src/data/options'\r\nimport { formTabs, formParams } from './formscheme'\r\nimport Tab from './tab'\r\n\r\nimport './options.css'\r\nimport { RootState, useAppDispatch } from 'src/data/store'\r\n\r\nconst mapState = (state: RootState) => {\r\n  return {\r\n    options: state.options\r\n  };\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst Options: FC<ConnectedProps<typeof connector>> = (props): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  const [state, setState] = useState({\r\n    items: props.options.items\r\n  })\r\n\r\n  const closeForm = () => {\r\n    navigate('/#');\r\n  }\r\n\r\n  const resetOptions = () => {\r\n    setState({\r\n      ...state,\r\n      items: Object.assign({}, defaultOptionsState.items)\r\n    })\r\n  }\r\n\r\n  const applyOptions = () => {\r\n\r\n    dispatch(saveOptions(state.items));\r\n    closeForm();\r\n  }\r\n\r\n  const onChange = (e, name, value) => {\r\n\r\n    let items = Object.assign({}, state.items);\r\n    items[name] = value;\r\n    setState({\r\n      ...state,\r\n      items\r\n    })\r\n  }\r\n\r\n  let tabs = [];\r\n  for (let tab of formTabs) {\r\n\r\n    let rows = [];\r\n    for (let i in tab.rows) {\r\n\r\n      const row = tab.rows[i];\r\n      let rowElem = [];\r\n      for (let name of row) {\r\n\r\n        const item = formParams[name];\r\n        if (!item) continue;\r\n\r\n        const value = state.items[name];\r\n\r\n        if (item.type === 'radio') {\r\n          rowElem.push(\r\n            <RadioOption\r\n              key={name}\r\n              name={name}\r\n              label={item.label}\r\n              values={item.values}\r\n              value={value}\r\n              oneLine={item.oneLine}\r\n              onChange={onChange}\r\n            />\r\n          );\r\n        } else if (item.type === 'number') {\r\n\r\n          if (item.label)\r\n            rowElem.push(\r\n              <label\r\n                htmlFor={name}\r\n                key={name + '_label'}\r\n                style={{ fontWeight: \"inherit\" }}>\r\n                {item.label}\r\n              </label>\r\n            );\r\n\r\n          rowElem.push(\r\n            <div className='options-number' key={name}>\r\n              <FormControl\r\n                type=\"number\"\r\n                min={item.min}\r\n                max={item.max}\r\n                value={value}\r\n                onChange={(e) => onChange(e, name, e.target.value)}\r\n                \r\n                className='input'\r\n                size=\"sm\"\r\n              >\r\n              </FormControl>\r\n              {item.postfix &&\r\n                <span key={name + '_postfix'} style={{ marginLeft: \"5px\", flex: \"0 0 auto\", }}>{item.postfix}</span>}\r\n            </div>\r\n          );\r\n\r\n        } else if (item.type === 'string') {\r\n          rowElem.push(\r\n            <StringOption\r\n              key={name}\r\n              name={name}\r\n              label={item.label}\r\n              postfix={item.postfix}\r\n              value={value}\r\n              onChange={onChange}\r\n            />\r\n          );\r\n        } else if (item.type === 'checkbox') {\r\n          rowElem.push(\r\n            <Form.Check\r\n              id={name}\r\n              type=\"checkbox\"\r\n              label={item.label}\r\n              key={name}\r\n              name={name}\r\n              checked={String(value) === 'true'}\r\n              onChange={(e) => onChange(e, name, e.target.checked)}\r\n              style={{ flex: \"0 0 auto\", margin: \"0px\" }}\r\n            />\r\n          );\r\n        }\r\n      }\r\n\r\n      rows.push(\r\n        <div key={i} className=\"options-row\">\r\n          {rowElem}\r\n        </div>\r\n      );\r\n\r\n    }\r\n\r\n    tabs.push(\r\n      <Tab key={tab.tabName} name={tab.tabName}>\r\n        {rows}\r\n      </Tab>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"options-form\">\r\n      <div className=\"options-header\" style={{ cursor: \"default\" }}>\r\n        <b>Настройки</b>\r\n      </div>\r\n      {tabs}\r\n      <div className=\"button-row\">\r\n        <Button\r\n          id=\"applyOptions\"\r\n          size=\"sm\"\r\n          variant=\"light\"\r\n          style={{ margin: \"5px\" }}\r\n          className='button'\r\n          onClick={applyOptions}>\r\n          OK\r\n        </Button>\r\n        <Button\r\n          id=\"cancelOptions\"\r\n          size=\"sm\"\r\n          variant=\"light\"\r\n          style={{ margin: \"5px\", float: \"left\" }}\r\n          className='button'\r\n          onClick={closeForm}>\r\n          Отмена\r\n        </Button>\r\n        <Button\r\n          id=\"defaultOptions\"\r\n          size=\"sm\"\r\n          variant=\"light\"\r\n          style={{ margin: \"5px\", float: \"right\" }}\r\n          className='button'\r\n          onClick={resetOptions}>\r\n          Сбросить настройки\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default connector(Options);","import React, { ReactElement } from 'react';\r\nimport { Routes, Route } from 'react-router-dom'\r\nimport { Container } from 'react-bootstrap';\r\n\r\nimport TopicsList from './topics_list'\r\nimport Topic from './topic'\r\nimport Options from './options'\r\nimport { clearTooltipsIfNeeded } from 'src/data/tooltips/actions'\r\n\r\nimport { useAppDispatch } from 'src/data/store';\r\n\r\nconst AppRoutes = (): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const onClick = () => {\r\n    dispatch(clearTooltipsIfNeeded());\r\n  }\r\n\r\n  return (\r\n    <div onClick={onClick} style={{ flex: \"auto\" }}>\r\n      <Container>\r\n        <Routes>\r\n          <Route path='/' element={<TopicsList />} />\r\n          <Route path='/index.php' element={<TopicsList />} />\r\n          <Route path='/topic.php' element={<Topic />} />\r\n          <Route path='/options.php' element={<Options />} />\r\n        </Routes>\r\n      </Container>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AppRoutes;","import React, { ReactElement } from 'react'\r\nimport { domain } from 'src/api'\r\n\r\nconst NavBarFooter = (): ReactElement => {\r\n\r\n    return (\r\n        <footer className=\"flex-row navbar-footer\">\r\n            <a href={`${domain}/rules.php`}>Правила</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/about.php`}>Описание</a>\r\n            <span className=\"separator\">|</span>\r\n            <b><a href={`${domain}/ad.php`}>Реклама на сайте</a>  </b>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/find.php`}>Поиск</a>\r\n            <span className=\"separator\">|</span>\r\n            <a rel=\"nofollow\" href={`${domain}/sections_list.php`}>Секции</a>\r\n            <span className=\"separator\">|</span>\r\n            <a rel=\"nofollow\" href={`${domain}/rating.php`}>Рейтинг</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href=\"http://kb.mista.ru\">Книга знаний</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href=\"http://wiki.mista.ru\">Вики-миста (КЗ2)</a>\r\n            <span className=\"separator\">|</span>\r\n            <a rel=\"nofollow\" href=\"http://m.mista.ru/\">Мобильная</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/archive.php`}>Архив</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/moders.php`}>Модераторы</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/users_gallery.php`}>Галерея</a>\r\n            <span className=\"separator\">|</span>\r\n            <a href={`${domain}/ban_list.php`}>Баны</a>\r\n            <span className=\"separator\">|</span>\r\n            <span>18+</span>\r\n        </footer>\r\n    )\r\n}\r\n\r\nexport default NavBarFooter;","import { FC, ReactElement } from 'react'\r\n\r\ntype IProps = {\r\n  closeWindow?: (e: any) => any\r\n}\r\n\r\nconst TooltipHeader: FC<IProps> = ({ children, closeWindow }): ReactElement => {\r\n  return (\r\n    <div className=\"tooltip-header\">\r\n      {children}\r\n      <div className=\"tooltip-close\" onClick={closeWindow} onTouchEnd={closeWindow}>\r\n        <i className=\"fa fa-angle-right\" aria-hidden=\"true\"></i>\r\n        <i className=\"fa fa-angle-left\" aria-hidden=\"true\" style={{ marginLeft: \"-2px\" }}></i>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default TooltipHeader;","import React, { FC, ReactElement } from 'react'\r\n\r\ntype IProps = {\r\n  onScroll?: (e: any) => any\r\n}\r\n\r\nconst TooltipBody: FC<IProps> = ({ children, onScroll }): ReactElement => {\r\n\r\n  let startX = 0;\r\n\r\n  const onTouchStart = (e: React.TouchEvent<HTMLElement>) => {\r\n    startX = e.nativeEvent.changedTouches[0].clientX;\r\n  }\r\n\r\n  const onTouchEnd = (e: React.TouchEvent<HTMLElement>) => {\r\n\r\n    if (!onScroll) return;\r\n\r\n    let endX = e.nativeEvent.changedTouches[0].clientX;\r\n    if (Math.abs(endX - startX) > 100)\r\n      onScroll(-endX + startX);\r\n  }\r\n\r\n  return (\r\n    <div className=\"tooltip-text\" onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}>\r\n      {children}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default TooltipBody;","import React, { FC, ReactElement } from 'react'\r\n\r\nimport Draggable from 'react-draggable';\r\n\r\nimport TooltipHeader from './tooltip_header'\r\nimport TooltipBody from './tooltip_body'\r\n\r\nimport './tooltip.css'\r\n\r\nimport { closeTooltip } from 'src/data/tooltips/actions'\r\nimport { useAppDispatch } from 'src/data/store';\r\nimport { ITooltipItem } from 'src/data/tooltips';\r\n\r\ntype IProps = {\r\n  tooltip: ITooltipItem,\r\n  zIndex?: number,\r\n}\r\n\r\nconst TooltipWindow: FC<IProps> = ({ tooltip, zIndex, children }): ReactElement => {\r\n\r\n  const dispatch = useAppDispatch();\r\n\r\n  const onCloseClick = () => {\r\n    dispatch(closeTooltip(tooltip.keys));\r\n  }\r\n\r\n  const { coords } = tooltip;\r\n\r\n  let axis: \"both\" | \"x\" | \"y\" | \"none\";;\r\n  let position: {\r\n    top: number,\r\n    left: number\r\n  };\r\n\r\n  if (window.innerWidth <= 768) {\r\n    axis = \"y\";\r\n    position = { top: coords.y, left: 5 };\r\n  } else {\r\n    axis = \"both\";\r\n    position = { top: coords.y, left: Math.min(coords.x, window.innerWidth - 670) }\r\n  }\r\n\r\n  let [header, body] = React.Children.toArray(children);\r\n\r\n  return (\r\n    <Draggable\r\n      axis={axis}\r\n      handle=\".tooltip-header\"\r\n      defaultClassNameDragging=\"dragging\"\r\n      key={zIndex}>\r\n\r\n      <div className=\"tooltip-window\" style={{ ...position }}>\r\n        <TooltipHeader closeWindow={onCloseClick}>\r\n          {(header as ReactElement).props.children}\r\n        </TooltipHeader>\r\n        <TooltipBody>\r\n          {(body as ReactElement).props.children}\r\n        </TooltipBody>\r\n      </div>\r\n    </Draggable>\r\n  )\r\n\r\n}\r\n\r\nexport default TooltipWindow;","import React, { FC, ReactElement, useCallback, useEffect, useState } from 'react';\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport { fetchTopicMessage } from 'src/api/topicMessages';\r\n\r\nimport MsgText from '../topic/row/msg_text'\r\nimport UserInfo from '../topic/row/user_info';\r\n\r\nimport TooltipWindow from './tooltip_window'\r\nimport TooltipHeader from './tooltip_header'\r\nimport TooltipBody from './tooltip_body'\r\nimport { ITooltipItem } from 'src/data/tooltips';\r\n\r\nimport './tooltip.css'\r\nimport { RootState } from 'src/data/store';\r\nimport { ITopicMessage } from 'src/data/topic';\r\n\r\ntype IProps = {\r\n  tooltip: ITooltipItem,\r\n  info: any,\r\n  items: any,\r\n  item0: any\r\n}\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    info,\r\n    items,\r\n    item0\r\n  } = state.topic;\r\n\r\n  return {\r\n    info,\r\n    items,\r\n    item0\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst Tooltip: FC<ConnectedProps<typeof connector> & IProps> = (props): ReactElement | null => {\r\n\r\n  const { tooltip, info, items, item0 } = props;\r\n  const { keys } = tooltip;\r\n\r\n  let text = '';\r\n  let data: ITopicMessage | undefined;\r\n  if (keys.topicId === info.id) {\r\n    if (keys.number === 0)\r\n      data = item0;\r\n    else\r\n      data = items.find((item: ITopicMessage) => item.n === keys.number);\r\n\r\n    if (data)\r\n      text = data.text;\r\n  }\r\n\r\n  const [state, setState] = useState({\r\n    data,\r\n    text\r\n  })\r\n\r\n  const fetchData = useCallback(async () => {\r\n\r\n    if (state.data) return;\r\n\r\n    let data: ITopicMessage;\r\n    let text = '';\r\n\r\n    try {\r\n      data = await fetchTopicMessage(keys.topicId, keys.number);\r\n      if (data)\r\n        text = data.text;\r\n      else\r\n        text = `Сообщение не найдено ${keys.number}`;\r\n\r\n    } catch (e) {\r\n      text = (e as Error).message;\r\n    }\r\n\r\n    setState({ data, text });\r\n  }, [keys.topicId, keys.number, state.data])\r\n\r\n  useEffect(() => {\r\n      fetchData();\r\n  }, [fetchData])\r\n\r\n  if (!state.text)\r\n    return null;\r\n\r\n  let header: ReactElement;\r\n  if (!state.data) {\r\n    header = <b>Заголовок</b>\r\n  } else {\r\n    header = <UserInfo data={state.data} isAuthor={false} isYou={false} isTooltip={true} />\r\n  }\r\n\r\n  return (\r\n    <TooltipWindow tooltip={props.tooltip}>\r\n      <TooltipHeader>\r\n        {header}\r\n      </TooltipHeader>\r\n      <TooltipBody>\r\n        <MsgText\r\n          data={state.data}\r\n          n={state.data?.n}\r\n          vote={state.data?.vote}\r\n          html={state.text}\r\n          topicId={keys.topicId}\r\n          style={{ maxHeight: \"min(550px, 80vh)\", overflowY: \"auto\" }}\r\n        />\r\n      </TooltipBody>\r\n    </TooltipWindow>\r\n  )\r\n\r\n}\r\n\r\nexport default connector(Tooltip);","import React, { FC, ReactElement } from 'react'\r\nimport { connect, ConnectedProps } from 'react-redux'\r\n\r\nimport { RootState } from 'src/data/store'\r\nimport Tooltip from './tooltip'\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  const {\r\n    items\r\n  } = state.tooltips\r\n\r\n  return {\r\n    items,\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst TooltipsList: FC<ConnectedProps<typeof connector>> = ({ items }): ReactElement => {\r\n\r\n  return (\r\n    <>\r\n      {items.map((item) => {\r\n        return (\r\n          <Tooltip key={item.hash} tooltip={item}>\r\n          </Tooltip>\r\n        )\r\n      }\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default connector(TooltipsList);","import React, { FC, ReactElement, useEffect } from 'react';\r\nimport { HashRouter } from 'react-router-dom'\r\n\r\nimport { connect, ConnectedProps } from 'react-redux'\r\nimport NavBar from './components/navigation/nav_bar';\r\nimport AppRoutes from './components/approutes';\r\nimport NavBarFooter from './components/navigation/nav_bar_footer';\r\nimport TooltipsList from './components/tooltips/tooltips_list';\r\nimport { RootState } from './data/store';\r\n\r\nconst mapState = (state: RootState) => {\r\n\r\n  return {\r\n    theme: state.options.items.theme\r\n  }\r\n}\r\n\r\nconst connector = connect(mapState);\r\nconst App: FC<ConnectedProps<typeof connector>> = ({theme}): ReactElement => {\r\n\r\n  useEffect(() => {\r\n    document.body.setAttribute('theme', theme);\r\n  }, [theme])\r\n\r\n  return (\r\n    <HashRouter>\r\n      <NavBar />\r\n      <AppRoutes />\r\n      <NavBarFooter />\r\n      <TooltipsList />\r\n    </HashRouter>\r\n  );\r\n}\r\n\r\nexport default connector(App);\r\n","import React, { ReactElement } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Provider } from 'react-redux'\r\n\r\nimport './index.css';\r\nimport App from './App';\r\nimport store from 'src/data/store'\r\n\r\nconst Root = ({ store }): ReactElement => (\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>\r\n)\r\n\r\nReactDOM.render(<Root store={store} />,\r\n  document.getElementById('root'));"],"sourceRoot":""}