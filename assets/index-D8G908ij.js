import{r as h,u as ne,j as t,I as re,D as qe,a as P,F as K,d as z,f as Je,b as q,c as Ge,e as Xe,g as Qe,h as J,i as G,k as A,l as ke,N as Q,L as I,m as W,n as _,o as Ze,p as et,q as tt,s as st,R as nt,P as rt,t as it,v as ot,w as at,x as ct,y as lt,z as dt,B as D,A as Ce,U as ye,C as ut,H as Se,$ as ht,E as pt,G as de,J as mt,K as $e,M as gt,O as ft,Q as xt,S as Z,T as jt,V as vt,W as yt,X as wt,Y as Nt,Z as bt,_ as Tt,a0 as kt}from"./vendor-CijNu1B4.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const Ct=()=>{const[e,s]=h.useState("Яндекс"),[n,r]=h.useState(""),i=h.useCallback(c=>{r(c.target.value)},[]),o=ne(c=>{c.key==="Enter"&&a()}),a=ne(()=>{let c;switch(e){case"Яндекс":c=`https://www.yandex.ru/search/?text=${n}&site=forum.mista.ru`;break;case"Google":c=`https://www.google.ru/search?q=${n}+site:forum.mista.ru`;break}window.open(c),r("")});return t.jsxs(re,{size:"sm",children:[t.jsxs(qe,{id:"search-engine",title:"",size:"sm",variant:"light",onSelect:s,children:[t.jsx(P.Item,{eventKey:"Яндекс",children:"Яндекс"}),t.jsx(P.Item,{eventKey:"Google",children:"Google"})]}),t.jsx(K,{type:"text",placeholder:`${e}: поиск`,className:"search-input input",onKeyDown:o,onChange:i,value:n}),t.jsx(re.Text,{className:"search-button",onClick:a,children:t.jsx("i",{className:"fa fa-search input",style:{zIndex:1e3}})})]})},O=(e,s=0)=>{if(!e)return s;if(typeof e=="number")return e;const n=parseInt(e,10);return isNaN(n)?s:n},St=(e,s)=>e.reduce((n,r)=>{const i=s(r);return n[i]||(n[i]=[]),n[i].push(r),n},{}),$t=e=>{try{return JSON.parse(e)}catch{}try{return e=e.replace(/\\</g,"<").replace(/\\>/g,">").replace(/\\&/g,"&").replace(/\\'/g,"'").replace(/\\"/g,"").replace(/ "/g,' \\"').replace(/""/g,'\\""').replace(/\t/g,"\\t").replace(/"(\.| |\?)/g,'\\"$1'),JSON.parse(e)}catch(s){return console.error(s.message),console.log(e),{}}},Le=e=>e?e==="last20"?"last20":O(e,1):1,pe=e=>e===-1||e===void 0?-1:Math.min(Math.ceil(e/100),10)||1,ie=e=>e?e.map(s=>typeof s=="string"?s:s.type==="br"?"<br>":s.type.displayName==="Connect(LinkToPost)"||s.type.displayName==="Connect(t)"?s.props.number:(console.log(s),s)):[""],Lt=e=>new DOMParser().parseFromString(e,"text/html").firstChild.innerText;function Pt(e){return z(e).isSame(new Date,"day")}const It=e=>e===2147483648e3?"":Pt(e)?z(e).format("HH:mm"):z(e).format("DD.MM.YY"),X=(e,s)=>{if(!s)return"";let n=new URLSearchParams;for(let i in s){const o=s[i];o!==void 0&&n.append(i,o)}let r=n.toString();return r.length>0?e+r:""},Pe=async(e,s,n)=>{let r=`${k}/${e}${X("?",s)}`,o=await(await Je(r)).json(),a;if(typeof o=="string")try{a=JSON.parse(o)}catch{a=$t(o)}else a=o;return a},oe=async(e,s,n)=>{let r=`${k}/${e}${X("?",s)}`;return n||(n={mode:"cors",credentials:"same-origin"}),await(await fetch(r,n)).json()};function Mt(e){const{session:s}=e;return{userId:Number(s?.user_id),userName:s?.user_name,userHash:s?.user_hash,lastError:s?.last_error}}async function Ie(){const e=await Pe(Wt);return Mt(e)}const Rt=async e=>{await fetch(`${k}/${zt}`,{method:"POST",body:X("",{user_name:e.username,user_password:e.password}),mode:"no-cors",credentials:"include",headers:{Accept:"text/html,application/xhtml+xml,application/xml","Content-Type":"application/x-www-form-urlencoded"},redirect:"follow"})},_t=async()=>{const e=`${k}/${Yt}`;await fetch(e,{mode:"no-cors",credentials:"include"})},Et=async e=>{const s=qt.replace(":id",e.topic_id),n={method:"POST",body:X("",e),mode:"no-cors",credentials:"include",headers:{Accept:"text/html,application/xhtml+xml,application/xml","Content-Type":"application/x-www-form-urlencoded"},redirect:"follow"};return await fetch(`${k}/${s}`,n)},Dt=async e=>{await fetch(`${k}/${Jt}`,{method:"POST",body:X("",e),mode:"no-cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"}})};function Ot(e){return{id:e.id,forum:e.forum,code:e.shortn,name:e.fulln}}const Ft=async()=>{const s=(await Pe(Kt)).map(Ot);return{items:s,tree:St(s,n=>n.forum)}};function At(e){let s=[];return e.voting&&(s=e.voting.map(n=>({text:n.select,count:n.result}))),{id:parseInt(e.id),title:e.text,forum:e.forum,sectionId:e.section,created:parseInt(e.created)*1e3,authorId:e.user_id,author:e.user_name,updated:parseInt(e.updated)*1e3,lastUser:e.updated_name,count:parseInt(e.answers_count),down:e.down,closed:e.closed,deleted:e.deleted,isVoting:e.is_voting===1,voting:s}}async function ae(e){const s=await oe(_e,{id:e});return At(s)}function Me(e){return{id:parseInt(e.id),n:parseInt(e.n),user:e.user,userId:parseInt(e.userId),text:e.text,time:parseInt(e.utime)*1e3,vote:e.vote}}async function Re(e){return(await oe(me,e)).map(Me)}async function ce(e,s){const n=s===0?s+1:s;return(await oe(me,{id:e,from:s,to:n})).map(Me).find(i=>i.n===s)}function Vt(e){const s=O(e.page,1),n=O(e.itemsPerPage,20)*s;return{topics:String(n),section_short_name:e.section,forum:e.forum,user_id:e.userId,mytopics:e.myTopics}}function Bt(e){return{id:e.id,forum:e.forum,section:e.sect1,sectionCode:e.sect2,author:e.user0,lastUser:e.user,created:e.created*1e3,updated:e.utime*1e3,count:e.answ,text:e.text,closed:e.closed===1,down:e.down===1,pinned:e.utime===2147483648,isVoting:e.is_voting===1}}async function Ut(e){const s=Vt(e),n=O(e?.itemsPerPage,20);return(await oe(Ht,s)).map(Bt).slice(-n)}const k=localStorage.getItem("domain")||"https://dev.mista.ru",Ht=localStorage.getItem("urlTopicsList")||"api/topic.php",_e=localStorage.getItem("urlTopicInfo")||"ajax_gettopic.php",me=localStorage.getItem("urlTopicMessages")||"api/message.php",zt=localStorage.getItem("urlLogin")||"users.php?action=do_enter",Yt=localStorage.getItem("urlLogout")||"users.php?action=exit",Wt=localStorage.getItem("urlCookies")||"ajax_cookie.php",Kt=localStorage.getItem("urlSections")||"ajax_getsectionslist.php",qt=localStorage.getItem("urlNewMessage")||"topic.php?id=:id&page=1",Jt=localStorage.getItem("urlNewTopic")||"index.php";localStorage.getItem("urlAddBookmark");localStorage.getItem("urlSearch");var F=(e=>(e.Sections="sections",e.TopicsList="topics-list",e.TopicMessages="topic-messages",e.TopicMessageData="topic-message-data",e.UpdateTopicMessages="update-topic-messages",e))(F||{});const Ee=e=>q({queryKey:[F.Sections],queryFn:Ft,placeholderData:{items:[],tree:{}},...e}),U=()=>Xe(),C=Ge,H=e=>{const s=U();return h.useMemo(()=>Qe(e,s),[e,s])},De=({searchParams:e},s)=>{const n=C(r=>r.options.items.topicsPerPage);return q({queryKey:[F.TopicsList,Object.fromEntries(e)],queryFn:async({queryKey:r})=>{const i=r[1];return Ut({itemsPerPage:n,...i})},placeholderData:r=>r??[],...s})},Gt={status:"init",logged:!1},Xt=J("login/check",async()=>await Ie()),ee=J("login/login",async(e,{dispatch:s})=>(await Rt(e),Ie())),ue=J("login/logout",async()=>await _t()),Oe=({login:e})=>e?e.status!=="loading":!0,Qt=(e,s)=>(n,r)=>{if(Oe(r()))return n(ee({username:e,password:s}))},Zt=()=>(e,s)=>{if(Oe(s()))return e(Xt())},es=G({name:"login",initialState:Gt,reducers:{},extraReducers:e=>{e.addCase(ee.pending,s=>{s.status="loading",delete s.error}).addCase(ee.fulfilled,(s,{payload:n})=>{s.status="success",s.userId=n.userId,s.userName=n.userName,s.userHash=n.userHash,s.logged=!0,delete s.error}).addCase(ee.rejected,(s,{error:n})=>{s.status="error",s.error=n?.message}).addCase(ue.pending,s=>{s.status="loading",delete s.error}).addCase(ue.fulfilled,s=>{s.status="success",s.logged=!1,delete s.userId,delete s.userName,delete s.userHash,delete s.error}).addCase(ue.rejected,(s,{error:n})=>{s.status="error",s.error=n?.message})}}),{actions:ts,reducer:ss}=es,ns={status:"init",section:null,text:"",subject:"",forum:"1C",isVoting:!1},te=J("newTopic/post",async e=>{let s={message_text:e.text,topic_text:e.subject,target_section:String(e.section),target_forum:e.forum.toLowerCase(),action:"new",rnd:Math.round(Math.random()*1e10),voting:e.isVoting?1:0};if(e.votingItems)for(let n=0;n<e.votingItems.length;n++)s[`section${n+1}`]=e.votingItems[n];await Dt(s)}),rs=({newTopic:e})=>!(!e||e.status==="loading"),is=e=>(s,n)=>{const r=n();if(rs(r))return s(te(e))},we=e=>{e.status="init",e.text="",e.subject="",e.forum="",e.isVoting=!1},os=G({name:"newTopic",initialState:ns,reducers:{clear:we,changeSubject:(e,{payload:s})=>{e.subject=s},changeText:(e,{payload:s})=>{e.text=s},changeSection:(e,{payload:s})=>{e.section=s,e.forum=s?.forum.toLowerCase()},showVoting:(e,{payload:s})=>{e.isVoting=s},setError:(e,{payload:s})=>{e.error=s}},extraReducers:e=>{e.addCase(te.pending,s=>{s.status="loading",delete s.error}).addCase(te.fulfilled,s=>{we(s),delete s.error}).addCase(te.rejected,(s,{error:n})=>{s.status="error",s.error=n?.message})}}),{actions:Fe,reducer:as}=os,Ae={voteColors:["#FF1616","#1A861A","#0023FF","#FF6B18","#9B3A6E","#567655","#233345","#CC0000","#00CCCC","#0000CC"],items:{theme:"lightgray",topicsPerPage:"20",autoRefreshTopicsList:"false",autoRefreshTopicsListInterval:"60",autoRefreshTopic:"true",autoRefreshTopicInterval:"60",showTooltips:"true",tooltipDelay:"500",showTooltipOnPostLink:"true",showYoutubeVideoTitle:"true",replaceCatalogMista:"true",fixBrokenLinks:"true"}},cs=G({name:"options",initialState:Ae,reducers:{save:(e,{payload:s})=>{for(let n in s){const r=String(s[n]);e.items[n]=r}}}}),{actions:ls,reducer:ds}=cs,us={items:[]},hs=(e,{payload:s})=>{const n=JSON.stringify(s.keys),r=e.items.findIndex(o=>o.hash===n);let i=0;e.items.length&&(i=e.items[e.items.length-1].zIndex+1),r===-1?e.items.push({keys:s.keys,coords:s.coords,hash:n,zIndex:i}):e.items[e.items.length-1].zIndex=i},ps=G({name:"tooltips",initialState:us,reducers:{show:hs,close:(e,{payload:s})=>{const n=JSON.stringify(s);e.items=e.items.filter(r=>r.hash!==n)},closeAll:e=>{e.items=[]}}}),{actions:ge,reducer:ms}=ps,gs=(e,s)=>{if(s==="last20")return e===-1?[0,1010]:[Math.max(0,e-19),e];const n=O(s,1)-1;return[n*100,n*100+99]},fs=async({topicId:e,page:s,item0:n})=>{let r;try{r=await ae(e)}catch(u){console.error(u),r={id:e,title:"",count:-1}}let[i,o]=gs(r.count,s);i===0&&n&&(i=1);let a=await Re({id:e,from:i,to:o}),c=n;return i===0?c=a.shift():c=await ce(e,0),r.count===0&&a.length>0&&(r.count=a[a.length-1].n),s==="last20"&&a.length>20&&(a=a.slice(-20)),{info:r,item0:c,list:a}},xs={status:"init",text:""},se=J("newMessage/post",async e=>{let s={message_text:e.text,action:"new",topic_id:e.topicId,rnd:Math.round(Math.random()*1e10)};e.voting_select&&(s.voting_select=e.voting_select),await Et(s)}),js=G({name:"newMessage",initialState:xs,reducers:{changeText:(e,{payload:s})=>{e.text=s}},extraReducers:e=>{e.addCase(se.pending,s=>{s.status="loading",delete s.error}).addCase(se.fulfilled,s=>{s.text="",delete s.error}).addCase(se.rejected,(s,{error:n})=>{s.status="error",s.error=n?.message})}}),{actions:fe,reducer:vs}=js,Y=({topicId:e},s)=>{const[n]=A(),r=n.get("page");return q({queryKey:[F.TopicMessages,e,r],queryFn:({client:i})=>{const o=xe(i,e);return fs({topicId:e,page:r,item0:o?.item0})},placeholderData:i=>i,...s})},Ve=({topicId:e},s)=>{const[n]=A(),r=n.get("page");return q({queryKey:[F.UpdateTopicMessages,e],queryFn:async({client:i})=>{const o=xe(i,e);if(!o)return!0;const a=await Re({id:e,from:o.info.count+1,to:1050});return a.length===0||i.setQueryData([F.TopicMessages,e,r],c=>({info:{...c.info,count:a.at(-1).n},item0:c.item0,list:[...c.list,...a]})),!0},initialData:!0,refetchOnMount:!1,...s})},xe=(e,s)=>{const n=e.getQueriesData({queryKey:[F.TopicMessages,s]});if(n.length!==0)return n[0][1]},ys=({topicId:e,number:s})=>q({queryKey:[F.TopicMessageData,e,s],queryFn:async({client:n})=>{const r=xe(n,e);if(r){if(s===0)return r.item0;{const o=r.list.find(a=>a.n===s);if(o)return o}}const i=await ce(e,s);if(i===void 0)throw new Error(`Сообщение ${s} не найдено`);return i}}),ws=()=>{const e=ke(),[s]=A(),n=s.get("forum"),{refetch:r}=De({searchParams:s},{enabled:!1}),i=c=>{e.pathname==="/"&&s.size===0&&(c.preventDefault(),r())},o=[{name:"1C",link:"/index.php?forum=1C"},{name:"IT",link:"/index.php?forum=IT"},{name:"JOB",link:"/index.php?forum=JOB"},{name:"LIFE",link:"/index.php?forum=LIFE"},{name:"Настройки",link:"/options.php"}],a=[{name:"Wiki",link:"https://wiki.mista.ru"},{name:"Книга знаний",link:"https://kb.mista.ru"}];return t.jsxs(Q,{bg:"dark",variant:"dark",expand:"md",fixed:"top",children:[t.jsx(Q.Brand,{as:I,to:"/",onClick:i,children:"React.Mista"}),t.jsx(Q.Toggle,{"aria-controls":"basic-navbar-nav"}),t.jsxs(Q.Collapse,{children:[t.jsxs(W,{className:"me-auto",children:[o.map((c,u)=>t.jsx(W.Item,{children:t.jsx(W.Link,{to:c.link,active:c.name===n,as:I,children:c.name})},"i"+u)),a.map((c,u)=>t.jsx(W.Item,{children:t.jsx(W.Link,{href:c.link,children:c.name})},"e"+u))]}),t.jsx(_,{className:"d-flex",children:t.jsx(Ct,{})})]})]})},Ns={key:"options",storage:lt},bs=Ze({options:ct(Ns,ds),login:ss,tooltips:ms,newTopic:as,newMessage:vs}),Be=et({reducer:bs,middleware:e=>e({serializableCheck:{ignoredActions:[st,nt,rt,it,ot,at]}}),devTools:!1}),Ts=tt(Be),ks=dt.forwardRef(({children:e,onClick:s},n)=>t.jsx("span",{ref:n,style:{cursor:"pointer"},className:"link",onClick:r=>{r.preventDefault(),s(r)},children:e})),Cs=({userId:e,userName:s})=>{const n=H(ts),r=o=>{o.preventDefault(),n.doLogout()},i=(o,a)=>{o==="exit"&&r(a)};return t.jsx("div",{style:{float:"left"},children:t.jsxs(P,{id:"dropdown-custom-menu",onSelect:i,children:[t.jsx("span",{children:"Привет, "}),t.jsxs(P.Toggle,{as:ks,children:[s," ▼"]}),t.jsxs(P.Menu,{children:[t.jsx(P.Item,{eventKey:"profile",href:`${k}/users.php?id=${e}`,children:"Профиль"}),t.jsx(P.Item,{eventKey:"myTopics",href:`#/index.php?user_id=${e}`,children:"Мои темы"}),t.jsx(P.Divider,{}),t.jsx(P.Item,{eventKey:"options",href:"#/options.php",children:"Настройки"}),t.jsx(P.Divider,{}),t.jsx(P.Item,{eventKey:"exit",children:"Выход"})]})]})})},Ss=()=>{const e=U(),[s,n]=h.useState(""),[r,i]=h.useState(""),o=a=>{a.preventDefault(),e(Qt(s,r))};return t.jsxs("div",{children:[t.jsxs("form",{name:"enterform",className:"flex-row",style:{flexWrap:"wrap"},children:[t.jsx(K,{id:"username",type:"text",placeholder:"Имя",value:s,onChange:a=>n(a.target.value),size:"sm",className:"input",style:{marginRight:"5px",flex:"0 1 300px"}}),t.jsx(K,{id:"password",type:"password",placeholder:"Пароль",maxLength:20,autoComplete:"off",value:r,onChange:a=>i(a.target.value),size:"sm",className:"input",style:{marginRight:"5px",flex:"0 1 300px"}}),t.jsx(D,{size:"sm",variant:"light",className:"button",onClick:o,children:"Войти"})]}),t.jsxs("p",{style:{margin:"0px"},children:["Войти можно на сайте"," ",t.jsx("a",{href:"https://forum.mista.ru/",children:"forum.mista.ru"})]}),t.jsx("a",{rel:"nofollow",href:"https://forum.mista.ru/user_registration.php",children:"Регистрация"}),t.jsx("span",{style:{margin:"5px"},children:"|"}),t.jsx("a",{rel:"nofollow",href:"https://forum.mista.ru/remember_password.php",children:"Забыли пароль?"})]})},le=({text:e})=>e?t.jsx("div",{className:"error",dangerouslySetInnerHTML:{__html:e}}):null,Ue=()=>{const e=U(),s=C(o=>o.login.logged),n=C(o=>o.login.userId),r=C(o=>o.login.userName),i=C(o=>o.login.error);return h.useEffect(()=>{e(Zt())},[e]),t.jsxs(t.Fragment,{children:[s?t.jsx(Cs,{userId:n,userName:r}):t.jsx(Ss,{}),i&&t.jsx(le,{text:i})]})},He=({id:e,defaultValue:s,selected:n,style:r,size:i,onChange:o})=>{const{data:a}=Ee(),c=u=>{if(!o)return;const d=u.currentTarget.value,j=a.items.find(b=>b.code===d);o(u,j)};return t.jsxs(_.Select,{"aria-label":"Секция",onChange:c,value:n,style:r,className:"input",size:i,id:e,children:[t.jsx("option",{value:"",children:s}),Object.keys(a.tree).map(u=>t.jsx("optgroup",{label:u,children:a.tree[u].map(d=>t.jsx("option",{value:d.code,children:d.name},d.id))},u))]})},$s=()=>{const[e,s]=A(),n=(r,i)=>{s(o=>{const a=new URLSearchParams(o);return i?a.set("section",i.code):a.delete("section"),a})};return t.jsxs("div",{className:"flex-row",children:[t.jsx("div",{className:"header-left",children:t.jsx(Ue,{})}),t.jsx("div",{className:"header-right",children:t.jsx(He,{id:"sect",defaultValue:"--Все секции--",selected:e.get("section")??"",onChange:n,size:"sm"})})]})},Ls=({isLoading:e,onUpdateClick:s})=>t.jsxs("div",{className:"table-header",children:[t.jsx("div",{style:{letterSpacing:"-1px"},children:"Раздел"}),t.jsx("div",{}),t.jsx("div",{children:"Тема"}),t.jsx("div",{children:"Re"}),t.jsx("div",{children:"Автор"}),t.jsx("div",{children:t.jsx("span",{style:{cursor:"pointer"},title:"Обновить список",onClick:s,children:e?"Обновляется":"Обновлено"})})]}),Ps=({item:e})=>t.jsx("div",{className:"cell-author",children:t.jsxs("div",{className:"cell-author--inner",children:[t.jsx("i",{"aria-hidden":"true",className:"fa fa-user-circle",style:{marginRight:"3px"}}),e.author]})}),Is=({item:e,onClick:s})=>t.jsx("div",{className:"cell-answ",onClick:s,children:t.jsxs("div",{className:"cell-answ--inner",children:[t.jsx("i",{className:"fa fa-comments-o","aria-hidden":"true",style:{marginRight:"3px"}}),t.jsx("span",{children:e.count})]})}),Ms=({item:e})=>t.jsx("div",{className:"cell-forum",children:t.jsx("div",{className:"cell-forum--inner",children:e.forum})}),Rs=({item:e})=>t.jsx("div",{className:"cell-last20",children:t.jsx(I,{to:`/topic.php?id=${e.id}&page=last20#F`,style:{color:"inherit",display:"block",width:"100%",textAlign:"center"},children:t.jsx("i",{className:"fa fa-angle-right","aria-hidden":"true"})})}),_s=({item:e})=>{const[s,n]=h.useState(e.updated);return h.useEffect(()=>{if(!e.pinned)return;(async()=>{const i=await ce(e.id,e.count);n(i.time)})()},[e.pinned,e.id,e.count]),h.useEffect(()=>{n(e.updated)},[e.updated]),t.jsx("div",{className:"cell-lastuser",children:t.jsxs("div",{className:"cell-author--inner",children:[t.jsx("span",{className:"cell-lastuser-time",children:It(s)}),t.jsx("span",{className:"cell-lastuser-user",children:e.lastUser})]})})},Es=({expanded:e,onClick:s})=>t.jsx("div",{className:"cell-preview-link",onClick:s,children:t.jsx("span",{children:e?t.jsx("i",{className:"fa fa-minus-square-o agh","aria-hidden":"true"}):t.jsx("i",{className:"fa fa-plus-square-o agh","aria-hidden":"true"})})}),Ds=({count:e,topicId:s})=>{let n=[];if(e>100){let r=pe(e);for(let i=1;i<=r;i++)n.push(t.jsx(I,{className:"agh",style:{margin:"3px"},to:`/topic.php?id=${s}&page=${i}`,children:i>3&&i<r?"•":String(i)},i))}return e>20&&n.push(t.jsx(I,{className:"agh",style:{margin:"3px"},to:`/topic.php?id=${s}&page=last20#F`,children:"»"},"last20")),t.jsx("span",{className:"topic-pages",children:n})},Os=(e,s,n)=>s==="life"&&!e.startsWith("OFF")?"OFF: "+e:n==="job"&&!e.startsWith("JOB")?"JOB: "+e:n==="v7"&&!e.startsWith("v7")?"v7: "+e:e,Fs=({data:e})=>{const s=C(r=>r.login.userName);let n=Os(e.text,e.forum,e.sectionCode);return t.jsx("div",{className:"cell-title",children:t.jsxs("div",{className:"cell-title--inner",children:[e.pinned&&t.jsx("i",{className:"fa fa-thumb-tack agh","aria-hidden":"true",style:{marginRight:"5px"}}),t.jsx(I,{to:`/topic.php?id=${e.id}`,className:Ce("agb","mr5",{bold:e.count>=100,mytopics:e.author===s,pinned:e.pinned}),dangerouslySetInnerHTML:{__html:n},style:{overflowWrap:"anywhere"}}),e.isVoting&&t.jsx("span",{className:"agh separator",children:"[±]"}),t.jsx(Ds,{count:e.count,topicId:e.id}),e.closed&&t.jsx("span",{className:"agh",children:"Ø"}),e.down&&t.jsx("span",{className:"agh",children:"↓"}),e.section&&t.jsxs("span",{className:"topic-section",children:[t.jsx("span",{className:"agh",style:{margin:"0px 5px"},children:"/"}),t.jsx(I,{rel:"nofollow",className:"agh",to:`/index.php?section=${e.sectionCode}`,children:e.section},"1")]})]})})},As=({topicId:e,onFirst:s,onPrev:n,onNext:r,onLast:i,close:o})=>t.jsxs("div",{className:"topic-preview-rewind",children:[t.jsx("div",{className:"topic-preview-button flex-small",onClick:s,title:"К первому",children:t.jsx("i",{className:"fa fa-angle-double-left","aria-hidden":"true"})}),t.jsx("div",{className:"topic-preview-button flex-large",onClick:n,title:"К предыдущему",children:t.jsx("i",{className:"fa fa-angle-left","aria-hidden":"true"})}),t.jsx("div",{className:"topic-preview-button flex-large",onClick:r,title:"К следующему",children:t.jsx("i",{className:"fa fa-angle-right","aria-hidden":"true"})}),t.jsx("div",{className:"topic-preview-button flex-small",onClick:i,title:"К последнему",children:t.jsx("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})}),t.jsxs("div",{className:"topic-preview-button close-preview",onClick:o,children:[t.jsx("i",{className:"fa fa-angle-right","aria-hidden":"true"}),t.jsx("i",{className:"fa fa-angle-left","aria-hidden":"true",style:{marginLeft:"-2px"}})]}),t.jsx("div",{className:"topic-preview-button edit-preview",children:t.jsx(I,{to:`/topic.php?id=${e}&page=last20#F`,children:t.jsx("i",{className:"fa fa-pencil","aria-hidden":"true",style:{color:"var(--font-color)"}})})})]}),Vs=({topicId:e,data:s,total:n,n:r,colors:i})=>{const o=`${k}/css/voting${r}.png`,a=n?Math.round(100*s.count/n):0,c={maxWidth:"500px",width:"100%",height:"15px"};return t.jsxs("li",{className:"voting-item",children:[t.jsx("div",{className:"voting-title",children:t.jsx("a",{rel:"nofollow",style:{textDecoration:"none"},href:`#/topic.php?id=${e}&sel=${r}`,children:t.jsx("b",{children:t.jsx("span",{style:{color:i[r-1]},children:`${r}. ${s.text}`})})})}),t.jsx("div",{className:"voting-percentage",children:t.jsx("b",{children:t.jsx("span",{style:{color:i[r-1]},children:`${a}% (${s.count})`})})}),t.jsx("div",{className:"voting-bar",children:t.jsx("div",{style:{width:`${a}%`},children:t.jsx("a",{href:o,children:t.jsx("img",{src:o,style:c,alt:`вариант ${r}`})})})})]})},Bs=({items:e,topicId:s,colors:n})=>{let r=Math.max(...e.map(i=>i.count));return t.jsx("ul",{style:{paddingLeft:0},children:e.filter(i=>i.text).map((i,o)=>t.jsx(Vs,{data:i,total:r,n:o+1,topicId:s,colors:n},o))})},Us=h.memo(({colors:e,n:s,text:n})=>t.jsx("div",{style:{marginTop:"5px"},children:t.jsx("b",{children:t.jsx("span",{style:{color:e[s-1]},children:`${s}. ${n}`})})}));function Hs(e){const s=new Set("if|если|then|тогда|elsif|иначеесли|else|иначе|endif|конецесли|do|цикл|for|для|to|по|each|каждого|in|из|while|пока|enddo|конеццикла|procedure|процедура|endprocedure|конецпроцедуры|function|функция|endfunction|конецфункции|var|перем|export|экспорт|goto|перейти|and|и|or|или|not|не|val|знач|break|прервать|continue|продолжить|return|возврат|try|попытка|except|исключение|endtry|конецпопытки|raise|вызватьисключение|false|ложь|true|истина|undefined|неопределено|null|new|новый|execute|выполнить|асинх|async|ждать|wait".split("|")),n=new Set("():;.,=+-*<>?[]%/".split("")),r="<span class=",i="</span>",o="bg>",a="num>",c="str>",u="com>",d="sp>",j="pr>",b="key>";let v,x,m,p=!1,l="";function N(w){return w.trim()===""}function y(w,L,B){return w.substring(L-1,L-1+B)}function f(w,L){return w.substring(w.length-L)}function S(w){return s.has(w.toLowerCase().trim())}function g(w,L){w===" "||m===L?v=v+w:(x&&(v=v+i,x=!1),v=v+r+L+w,x=!0,m=L)}function V(w){let L=!1,B=!1,M=1,R=!0,$=1;for($=1;$<=w.length;$++){let T=w.charAt($-1);if(p)T==='"'?(g(y(w,M,$-M+1),c),p=!1,l="",R=!0):l=l+T;else if(L)T==="'"?(g(y(w,M,$-M+1),c),L=!1,l="",R=!0):l=l+T;else if(T===" ")N(l)?v=v+" ":(B?(g(l+" ",c),B=!1):S(l.trim())?g(l+" ",b):isNaN(parseInt(l,10))?g(l+" ",o):g(l+" ",a),l=""),R=!0;else if(n.has(T)){if(N(l)||(B?(g(l,c),B=!1,R=T!=="."):R&&S(l)?(g(l,b),R=T!=="."):(isNaN(parseInt(l,10))?g(l,o):g(l,a),R=T!=="."),l=""),T==="."&&m===a){g(T,a);continue}else if(T==="="&&y(w,$-1,1)==="<")m=void 0;else if(T==="/"&&y(w,$+1,1)==="/"){g(f(w,w.length-$+1),u);return}g(T,d)}else if(T==='"'||T==="|")N(l)?(M=$,p=!0):(g(l+T,c),l=""),R=!0;else if(T==="'")N(l)?(M=$,L=!0):(g(l+T,c),l=""),R=!0;else if(T==="#"||T==="&"&&N(v)){g(f(w,w.length-$+1),j),$=w.length;break}else T==="~"?(l=l+T,B=!0):l=l+T}p||L?g(y(w,M,$-M+1),c):N(l)||(S(l)?g(l,b):isNaN(parseInt(l,10))?g(l,o):g(l,a))}p=!1,l="",x=!1,m=void 0,v="";let E=[];for(let w of e.split(`
`)){if(N(w)){E.push("");continue}v="",V(w),x&&!p?(v+="</span>",x=!1,m="",l=""):p||(m="",l=""),E.push(v)}return E.join(`
`)}const zs=e=>{let s=0,n=e.length;for(;s<n&&(e[s]===`
`||e[s]==="\r");)s++;for(;n>s&&(e[n-1]===`
`||e[n-1]==="\r");)n--;return e.substring(s,n)},Ys=e=>{let s=e.replace(/\n<br>/g,`
`).replace(/<br>\n/g,`
`).replace(/\r<br>/g,`
`).replace(/<br>\r/g,`
`).replace(/<br>/g,`
`).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt");return s=zs(s),Hs(s)},Ws=({children:e})=>{const[s,n]=h.useState(!0),[r,i]=h.useMemo(()=>{if(!e)return["",0];let c=ie(e).join("");return c=Ys(c),[c,c.split(`
`).length]},[e]),o=()=>{n(c=>!c)};let a={};return s&&i>7?(a.overflow="hidden",a.height="135px"):(a.overflow="auto",a.height="auto"),t.jsxs("div",{style:{marginTop:"5px"},children:[t.jsx("pre",{className:"code-pre",style:a,dangerouslySetInnerHTML:{__html:r}}),i>7&&t.jsx("div",{className:"expand-button-div",children:t.jsx("span",{className:"expand-button-span",onClick:o,children:s?`Показать: ${i} строк`:"Скрыть"})})]})},he=({topicId:e,number:s,children:n,style:r})=>{const i=h.useRef(null),o=H(ge),[a]=A(),c=O(a.get("id"),-1),u=C(l=>+l.options.items.tooltipDelay);let d="";n?d=ie(n).join(""):d=String(s);const[j,b]=h.useState(d);h.useEffect(()=>{let l=!0;if(!d.startsWith("http")){b(d);return}return(async()=>{const{title:y}=await ae(e);l&&b(y)})(),()=>{l=!1}},[d,e]);const v=l=>{l.persist(),i.current=setTimeout(()=>p(l),u)},x=()=>{i.current&&clearTimeout(i.current)},m=l=>{l.stopPropagation(),i.current&&clearTimeout(i.current),p(l)},p=l=>{const N={x:l.pageX,y:l.pageY-50},y={topicId:+e,number:+s};o.show({keys:y,coords:N})};if(e===c||!isNaN(+j))return t.jsx("span",{onMouseOver:v,onMouseOut:x,onClick:m,className:"link",style:{...r},role:"button",children:j});{const l=pe(s);let N="";return l>1&&(N=`&page=${l}`),t.jsxs("span",{children:[t.jsx("a",{href:`#/topic.php?id=${e}${N}#${s}`,style:{...r},children:j})," ","(",t.jsx("span",{onMouseOver:v,onMouseOut:x,onClick:m,className:"link",role:"button",children:s}),")"]})}},Ks=({href:e,children:s})=>t.jsx("a",{href:e,className:"registered-user",children:s}),qs=e=>{let s=e;e.search(/http/)===-1&&(s="http://"+s);try{var n=new URL(s)}catch{return null}return n.hostname.search(/youtube/)!==-1?n.searchParams.get("v"):n.hostname.search(/youtu\.be/)!==-1?n.pathname.substring(1):null},Js=async(e,s)=>{let r=`https://www.googleapis.com/youtube/v3/videos?key=${localStorage.getItem("youtubeApiKey")||"AIzaSyCztN2QW4Fxw_1YuAHBTOZdYLbzigPz25g"}&fields=items(snippet(title))&part=snippet&id=${e}`;const o=await(await fetch(r,{signal:s})).json();if(o.items.length===0)return{hrefName:"",title:"",notFound:!0};const a=o.items[0].snippet.title;let c=a,u=50;return a.length>u+5&&(c=c.substring(0,u)+"..."),{hrefName:c,title:a,notFound:!1}},Gs=({href:e})=>{let[s,n]=h.useState(e),[r,i]=h.useState("");return h.useEffect(()=>{const a=new AbortController;return(async()=>{const u=qs(e);if(u)try{const d=await Js(u,a.signal);d.notFound?n(e+" (видео не найдено)"):(n(d.hrefName),i(d.title))}catch(d){console.error("youtube",u,d.message)}})(),()=>a.abort()},[e]),t.jsx("a",{href:e,title:r,children:`youtube: ${s}`})},Xs=(e,s)=>{let n=e.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\./g,"\\.").replace(/\./g,".").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\?/g,"\\?").replace(/\//g,"\\/");try{let r=new RegExp(n+"<\\/a>(\\)|[а-яёА-ЯЁ0-9#\\-\\+\\_\\%\\?=]*)"),i=s.match(r);if(i&&i.length>1)return i[1]===")"&&e.search("\\(")===-1||(e=e+i[1]),e}catch(r){console.error(r)}return e},Qs=e=>e.search(/youtube/)!==-1||e.search(/youtu\.be/)!==-1,Zs=e=>e.search(/catalog\.mista/)!==-1,en=({href:e,children:s,parentText:n,...r})=>{const i=C(d=>d.options.items.showYoutubeVideoTitle==="true"),o=C(d=>d.options.items.replaceCatalogMista==="true"),a=C(d=>d.options.items.fixBrokenLinks==="true");try{var c=new ye(e,!0)}catch(d){return console.error(d.message,e),t.jsx("a",{href:e,children:e})}let u=e;if(u.startsWith("/")&&(c.set("protocol","https"),c.set("hostname","forum.mista.ru"),u=c.href),c.hostname.search(/forum\.mista.ru/)!==-1){if(c.pathname==="/topic.php")return t.jsx(he,{topicId:c.query.id,number:c.hash.replace("#","")||"0",children:ie(s)});if(c.pathname==="/users.php")return t.jsx(Ks,{href:c.href,children:s})}return c.hostname==="a-sitnikov.github.io"&&c.pathname==="/react.mista/"&&Object.keys(c.query).length===0&&(c=new ye(e.replace(/#\//,""),!0),c.pathname==="/react.mista/topic.php")?t.jsx(he,{topicId:c.query.id,number:c.hash.replace("#","")||"0",children:ie(s)}):i&&Qs(c.hostname)?t.jsx(Gs,{href:e}):o&&Zs(c.hostname)?(c.set("hostname","infostart.ru"),t.jsxs("a",{target:r?.target,className:r?.class,rel:r?.rel,href:c.href,children:[c.href," "]})):(a&&n&&(u=Xs(u,n)),t.jsx("a",{target:r?.target,className:r?.class,rel:r?.rel,href:u,children:s}))},tn=({idx:e,topicId:s,topicDate:n,messageNumber:r})=>{const o=`https://forum.mista.ru/topics/files/${z(n).format("YYYY/MM/DD")}/${s}/${r}`,a=`${o}/${e}_preview.png`,c=`${o}/${e}.png`;return t.jsx(ut,{src:c,children:t.jsx("img",{src:a,alt:"",style:{maxWidth:"100%",cursor:"pointer"}})})},sn=h.memo(tn),nn=(e,s)=>{const n=/(\()(\d+)(\))(?![^<>]*<\/)/gi;return e.replace(n,(r,...i)=>{const o=i[1];return`(<link data-topicid='${s}' data-number='${o}'></link>)`})},rn=e=>e.replace(/\[1[CС]\]/gi,"<code>").replace(/<1[CС]>/gi,"<code>").replace(/\[\/1[CС]\]/gi,"</code>").replace(/<\/1[CС]>/gi,"</code>"),on=(e,s,n,r)=>{const i=/\[IMG_(\d*)\]/gi;return e.replace(i,(o,...a)=>`<int_img idx='${a[0]}'></int_img>`)},an=(e,s,n,r)=>{if(!e)return e;let i=rn(e);return i=nn(i,s),i=on(i),i},cn=Se.Parser(),ln=Se.ProcessNodeDefinitions(),dn=()=>!0,un={shouldProcessNode:e=>e?.name==="link",processNode:(e,s,n)=>{const r=e.attribs["data-topicid"],i=e.attribs["data-number"];return t.jsx(he,{topicId:r,number:i},n)}},hn={shouldProcessNode:e=>e?.name==="code"||e?.name==="pre",processNode:(e,s,n)=>t.jsx(Ws,{children:s},n)},pn=e=>({shouldProcessNode:s=>s?.name==="a",processNode:function(s,n,r){const i=s.attribs.href;return t.jsx(en,{href:i,parentText:e,children:n},r)}}),mn=(e,s,n)=>({shouldProcessNode:r=>r?.name==="int_img",processNode:function(r,i,o){const a=r.attribs.idx;return t.jsx(sn,{topicId:e,topicDate:s,messageNumber:n,idx:a},o)}}),gn=({html:e,topicId:s,topicDate:n,messageNumber:r})=>{const i=an(e,s),o=[un,hn,pn(i),mn(s,n,r),{shouldProcessNode:()=>!0,processNode:ln.processDefaultNode}],a=cn.parseWithInstructions(i,dn,o);return t.jsx(t.Fragment,{children:a})},fn=h.memo(gn),je=({topicId:e,topicDate:s,n,html:r,vote:i,style:o})=>{const{data:a}=Y({topicId:e},{enabled:!1,select:x=>x?.info}),c=C(x=>x.options.voteColors);let u=null;i&&a.voting&&e===a.id&&(u=a.voting[i-1].text);const[d,j]=h.useState(u);h.useEffect(()=>{i&&!u&&(async()=>{try{const m=await ae(e);j(m.voting[i-1].text)}catch(m){console.error(m.message)}})()},[i,u,e]);const b=n===0&&a?.isVoting&&a?.voting,v=i!==0&&d!==null;return t.jsxs("div",{className:"message",style:o,children:[b&&t.jsx(Bs,{items:a.voting,topicId:e,colors:c}),t.jsx("div",{children:t.jsx(ht,{children:t.jsx(fn,{html:r,topicId:e,topicDate:s,messageNumber:n})})}),v&&t.jsx(Us,{text:d,n:i,colors:c})]})},xn=({data:e})=>{const[s,n]=h.useState("none"),r=()=>{n("inline")},i=()=>{n("none")};return h.useEffect(()=>{n("none")},[e.n]),window.innerWidth<=768?null:t.jsx("img",{src:`${k}/css/user_icons/${e.userId}_16x16.png`,alt:"user ico",onLoad:r,onError:i,style:{display:s,marginBottom:"4px",marginRight:"1px"}})},ve=({data:e,isAuthor:s,isYou:n,isTooltip:r})=>{const i=H(fe),o=()=>{i.changeText(`(${e.n})`);let u=document.getElementById("message_text");u&&window.scrollTo(0,u.offsetTop)};let a=h.useMemo(()=>{if(e)return e.n===0?z(e.time).format("DD.MM.YY - HH:mm"):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"message-number",children:e.n})," - "+z(e.time).format("DD.MM.YY - HH:mm")]})},[e]);const c=Ce("registered-user",{"is-author":s,"is-you":n});return t.jsxs("div",{className:"user-info",children:[t.jsx(xn,{data:e}),t.jsx("a",{className:c,href:`${k}/users.php?id=${e.userId}`,children:e.user}),r?t.jsx("div",{className:"ah",style:{display:"inline-block",marginLeft:"5px"},children:a}):t.jsxs("div",{className:"message-time",children:[t.jsx("span",{className:"ah",children:a}),t.jsx("button",{className:"button ah",onClick:o,children:a})]})]})},Ne=({topicId:e,n:s,author:n,loggedUserId:r,onDataLoaded:i})=>{const[o,a]=h.useState(null),[c,u]=h.useState(null);return h.useEffect(()=>{(async()=>{try{const j=await ce(e,s);j?(a(j),u(null),i&&i()):(a(null),u(`Не найдено сообщение ${s}`))}catch(j){a(null),u(j.message)}})()},[e,s,i]),!o&&!c?null:t.jsxs(t.Fragment,{children:[o&&t.jsxs("div",{className:"preview-content",children:[t.jsx("div",{className:"topic-preview-userinfo",children:t.jsx(ve,{data:o,isAuthor:o.user===n,isYou:o.userId===r,isTooltip:!0})}),t.jsx(je,{topicId:e,topicDate:o.time,n:s,html:o.text,vote:o.vote,style:{overflowY:"auto",overflowWrap:"break-word"}})]}),c&&t.jsx("span",{children:c})]})},jn=({topicId:e,initialMsgNumber:s,author:n,close:r})=>{const i=C(g=>g.login.userId),[o,a]=h.useState(0),[c,u]=h.useState("none"),[d,j]=h.useState({msgNumber:s,key:0}),b=()=>{j({msgNumber:0,key:d.key})},v=()=>{j({msgNumber:d.msgNumber+1,key:d.key})},x=()=>{d.msgNumber>0&&j({msgNumber:d.msgNumber-1,key:d.key})},m=async()=>{const g=await ae(e);j({msgNumber:g.count,key:d.key})},N=pt({onSwiping:g=>{Math.abs(g.deltaX)<35?a(0):a(g.deltaX)},onSwiped:g=>{Math.abs(g.deltaX)>150&&(g.dir==="Left"?j({msgNumber:d.msgNumber+1,key:d.key+1}):g.dir==="Right"&&d.msgNumber>0&&j({msgNumber:d.msgNumber-1,key:d.key+1})),a(0)},delta:15}),y=h.useCallback(()=>{u("block")},[]);let f=[d.msgNumber];o<0?f.push(d.msgNumber+1):o>0&&d.msgNumber>0&&f.push(d.msgNumber-1);const S={transform:`translate3d(${o}px, 0px, 0px)`,flexDirection:o>0?"row-reverse":"row"};return t.jsx("div",{className:"preview-container",style:{display:c},children:t.jsxs("div",{className:"topic-preview",children:[t.jsx(As,{topicId:e,onFirst:b,onLast:m,onNext:v,onPrev:x,close:r}),t.jsxs("div",{className:"preview-carousel",...N,style:S,children:[t.jsx("div",{className:"preview-carousel-item",style:{order:0},children:t.jsx(Ne,{topicId:e,n:f[0],loggedUserId:i,author:n,onDataLoaded:y})},d.key),f.length>1&&t.jsx("div",{className:"preview-carousel-item",style:{order:1},children:t.jsx(Ne,{topicId:e,n:f[1],loggedUserId:i,author:n})},d.key+1)]})]})})},vn=({item:e,isFetching:s})=>{const[n,r]=h.useState();h.useEffect(()=>{s&&r(void 0)},[s]);const i=()=>{r(n===void 0?0:void 0)},o=()=>{n===void 0||n!==e.count?r(e.count):r(void 0)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"topics-list-row",children:[t.jsx(Ms,{item:e}),t.jsx("div",{className:"cell-section",children:e.section}),t.jsx(Is,{item:e,onClick:o}),t.jsx(Es,{expanded:n!==void 0,onClick:i}),t.jsx(Fs,{data:e}),t.jsx(Ps,{item:e}),t.jsx(_s,{item:e}),t.jsx(Rs,{item:e})]}),n!==void 0&&t.jsx(jn,{topicId:e.id,initialMsgNumber:n,author:e.author,close:()=>r(void 0)})]})},ze=({maxPage:e,last20:s})=>{const[n]=A(),r=Le(n.get("page"));let i=[];const o=new URLSearchParams(n);for(let a=1;a<=e;a++)a===1?o.delete("page"):o.set("page",String(a)),i.push(t.jsx(de.Item,{active:r===a,as:I,to:"?"+o.toString(),children:a},a));return s===!0&&(o.set("page","last20"),i.push(t.jsx(de.Item,{active:r==="last20",as:I,to:"?"+o.toString(),children:"»"},"last20"))),t.jsx(de,{style:{margin:"0px"},children:i})},Ye=({placeholder:e,showVoting:s,isVoting:n,isFetching:r,text:i,formRef:o,onChange:a,onShowVotingChange:c})=>{const u=h.useRef(),d=x=>{x.preventDefault();const m=`[1C]
`,p=`
[/1C]`,l=u.current,N=l.selectionStart,y=l.selectionEnd,f=l.value,S=f.length,g=f.substring(N,y),V=m+g+p;let E=f.substring(0,N)+V+f.substring(y,S);a&&a(E)},j=h.useCallback(x=>{c&&c(x.currentTarget.checked)},[c]),b=h.useCallback(x=>{a&&a(x.currentTarget.value)},[a]),v=x=>{o&&o.current&&x.key==="Enter"&&x.ctrlKey&&o.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))};return t.jsxs("div",{children:[t.jsx(K,{as:"textarea","aria-label":"Сообщение",placeholder:e,cols:70,rows:3,value:i,onChange:b,onKeyUp:v,ref:u,className:"text-editor input","data-lpignore":!0}),t.jsxs("div",{className:"flex-row",children:[t.jsxs(mt,{children:[t.jsx(D,{size:"sm",variant:"light",onClick:d,style:{marginRight:"5px"},className:"button",children:"Код 1С"}),t.jsx(D,{size:"sm",variant:"light",disabled:r,type:"submit",className:"button",children:r?"Отправляется":"Отправить"})]}),s&&t.jsx(_.Check,{id:"show_voting",type:"checkbox",checked:n,onChange:j,label:"Голосование",style:{margin:"auto 0px auto auto"}})]})]})},yn=({onSubmitSuccess:e})=>{const{data:s}=Ee(),n=C(f=>f.newTopic),[r,i]=h.useState(null),[o,a]=h.useState(Array(10).fill("")),c=h.useRef(null),u=U(),d=H(Fe),j=ne((f,S)=>{i(S),d.changeSection(S)}),b=f=>S=>{let g=o.slice();g[f]=S.target.value,a(g)},v=ne(f=>{if(f.preventDefault(),!r){d.setError("Не выбрана секция");return}let S=n.subject;if(!S){d.setError("Не указана тема");return}if(!n.text){d.setError("Не указано сообщение");return}let g={subject:S,text:n.text,section:r.id,forum:r.forum,isVoting:n.isVoting,votingItems:[],onSuccess:l};if(n.isVoting){g.votingItems=[];for(let V=1;V<=10;V++){let E=o[V-1];E&&g.votingItems.push(E)}}u(is(g))}),x=h.useCallback(f=>{d.changeSubject(f.target.value)},[d]),m=h.useCallback(f=>{d.changeText(f)},[d]),p=h.useCallback(f=>{d.showVoting(f)},[d]),l=()=>{d.clear(),e&&e()};let N=[];for(let f in s.tree)N.push(t.jsx("option",{value:f.toLowerCase(),children:f},f));let y=[];if(n.isVoting){y.push(t.jsx("div",{children:"Варианты:"},"p"));for(let f=1;f<=10;f++)y.push(t.jsxs(re,{size:"sm",style:{marginBottom:"3px",width:"100%"},children:[t.jsx(re.Text,{style:{width:"40px"},className:"input",children:`${f}.`}),t.jsx(_.Control,{type:"text","aria-label":`Вариант ${f}`,maxLength:50,className:"input",value:o[f-1],onChange:b(f-1)})]},f))}return t.jsxs("form",{className:"new-topic-container",onSubmit:v,ref:c,children:[t.jsxs("div",{id:"newtopic_form",className:"new-topic-text",children:[t.jsx("div",{children:t.jsx("b",{children:"Новая тема:"})}),n.error&&t.jsx(le,{text:n.error}),t.jsxs("div",{className:"flex-row",style:{marginBottom:"3px"},children:[t.jsx(_.Select,{disabled:!0,size:"sm",value:n.forum,style:{flex:"0 1 90px"},className:"input",children:N}),t.jsx(He,{id:"target_section",defaultValue:"Секция",selected:n.section?.code,size:"sm",style:{flex:"1 1 auto"},onChange:j})]}),t.jsx(_.Control,{type:"text","aria-label":"Тема",placeholder:"Тема",size:"sm",value:n.subject,onChange:x,style:{marginBottom:"3px"},className:"input",maxLength:90}),t.jsx(Ye,{placeholder:"Сообщение",showVoting:!0,isVoting:n.isVoting,text:n.text,isFetching:n.status==="loading",onChange:m,onShowVotingChange:p,formRef:c})]}),t.jsx($e,{className:"new-topic-voting",children:y})]})},be=()=>{const[e]=A(),{isFetching:s,data:n,error:r,refetch:i}=De({searchParams:e});return h.useEffect(()=>{document.title="React.Mista"},[]),h.useEffect(()=>{window.scrollTo(0,0)},[e]),t.jsxs("div",{children:[t.jsx($s,{}),r&&t.jsx(le,{text:r.message}),t.jsxs("div",{className:"topic-list-table",children:[t.jsx(Ls,{onUpdateClick:i,isLoading:s}),n.map(o=>t.jsx(vn,{item:o,isFetching:s},o.id)),t.jsx("div",{className:"table-footer",children:t.jsx(ze,{maxPage:10})})]}),t.jsx("div",{id:"F",className:"newtopic",style:{marginBottom:"10px",marginTop:"5px",position:"relative"},children:t.jsx(yn,{onSubmitSuccess:i})})]})},wn={"1c":"1С:Предприятие",life:"О жизни",it:"Информационные технологии",job:"Работа"},Nn=({topicId:e})=>{const{data:s}=Y({topicId:e},{enabled:!1,select:n=>n?.info.forum});return t.jsxs("div",{className:"flex-row",children:[t.jsx("div",{className:"header-left",children:t.jsx(Ue,{})}),t.jsx("div",{className:"header-right",children:t.jsx("span",{id:"forum_string",className:"bold120",children:t.jsx(I,{to:`/index.php?forum=${s}`,style:{textDecoration:"none"},children:wn[s]})})})]})},bn=({topicId:e})=>{const{data:s}=Y({topicId:e},{select:r=>r?.info.title});let n="https://www.yandex.ru/search/?text="+encodeURIComponent(s);return t.jsxs("div",{className:"topic-row",children:[t.jsx("div",{className:"cell-userinfo",children:t.jsxs("div",{className:"topic-tools",children:[t.jsx("a",{title:"API.info",href:`${k}/${_e}?id=${e}`,className:"agh",style:{display:"block",lineHeight:"1em"},children:"i"}),t.jsx("a",{title:"API.messages",href:`${k}/${me}?id=${e}&from=0&to=20`,className:"agh",style:{display:"block",lineHeight:"1em"},children:"m"})]})}),t.jsx("div",{className:"cell-message",children:t.jsxs("div",{className:"flex-row",children:[t.jsxs("div",{style:{flex:1,textAlign:"center"},children:[t.jsx("a",{href:`https://forum.mista.ru/topic/${e}`,children:t.jsx("h1",{className:"topic-title",dangerouslySetInnerHTML:{__html:s}})}),t.jsx("div",{className:"moder-action"})]}),t.jsx("div",{style:{flex:"0 0 20px",position:"relative"},children:t.jsx("div",{className:"div-va-middle",children:t.jsx("a",{rel:"noopener noreferrer",href:n,title:"Искать в Яндексе",target:"_blank",className:"yandex",children:"Я"})})})]})})]})},Te=({item:e,topicId:s})=>{const n=C(o=>o.login),{data:r}=Y({topicId:s},{enabled:!1}),i=r?.item0?.user||"";return e?t.jsxs("div",{className:"topic-row",id:String(e.n),children:[t.jsx("div",{className:"cell-userinfo",children:t.jsx(ve,{data:e,isAuthor:e.user===i,isYou:e.user===n.userName})}),t.jsx("div",{className:"cell-message",children:t.jsx(je,{html:e.text,topicId:s,topicDate:e.time,n:e.n,vote:e.vote})})]}):null},Tn=({topicId:e,isLastPage:s})=>{const{isFetching:n,refetch:r}=Ve({topicId:e},{enabled:!1}),i=()=>{};return t.jsxs("div",{className:"flex-row",id:"F",children:[t.jsx("div",{className:"ta-left va-top",style:{width:"50%"},children:t.jsx(D,{onClick:i,disabled:!1,size:"sm",className:"button",variant:"light",children:"Закладка"})}),t.jsx("div",{className:"ta-right va-middle",style:{marginLeft:"auto"},children:s&&t.jsx(D,{onClick:()=>r(),disabled:n,size:"sm",className:"button",variant:"light",children:n?"Обновляется":"Обновить ветку"})})]})},kn=({topicId:e,onSubmitSuccess:s})=>{const[n,r]=h.useState(),i=U(),o=H(fe),{data:{info:a}}=Y({topicId:e}),c=C(m=>m.newMessage),u=m=>{m.preventDefault(),m.stopPropagation();let p={text:c.text,topicId:String(a?.id),onSuccess:d,voting_select:void 0};n&&(p.voting_select=n),i(se(p))},d=()=>{o.changeText(""),r(void 0),s&&s()},j=m=>{m.preventDefault(),r(void 0)},b=m=>{r(m)},v=h.useCallback(m=>{i(Fe.changeText(m))},[i]);let x;if(a?.isVoting&&a?.voting){let m=[];for(let p=1;p<=a.voting.length;p++){const l=a.voting[p-1];l.text&&m.push(t.jsx(_.Check,{type:"radio",name:"voting",checked:n===p,onChange:()=>b(p),label:`${p}. ${l.text}`},p))}x=t.jsxs($e,{children:[t.jsx("legend",{children:t.jsxs("small",{children:["Ваш выбор:",t.jsx("span",{id:"voting_clear",style:{marginLeft:"5px",cursor:"pointer"},onClick:j,children:"очистить"})]})}),m,"Обоснуйте свой выбор!"]})}return t.jsxs("form",{style:{marginTop:"5px"},onSubmit:u,children:[t.jsx("div",{className:"bold",children:"Добавить сообщение в тему:"}),t.jsxs("div",{className:"new-message-container",children:[t.jsx("div",{className:"new-message-text",children:t.jsx(Ye,{isFetching:c.status==="loading",text:c.text,placeholder:"Сообщение",onChange:v})}),t.jsx("div",{className:"new-message-voting",children:x})]})]})},Cn=({isLastPage:e})=>{const[s,n]=C(o=>[o.options.items.autoRefreshTopic,O(o.options.items.autoRefreshTopicInterval,60)*1e3]),[r,i]=h.useState(!1);return h.useEffect(()=>{s==="true"&&e&&setTimeout(()=>i(!0),n)},[s,n,e]),{enableUpdater:r,refreshInterval:n}},Sn=()=>{const e=U(),{hash:s}=ke(),[n]=A(),r=O(n.get("id"),-1),{data:i,error:o,isPending:a}=Y({topicId:r}),{info:c,item0:u,list:d=[]}=i??{},j=C(y=>y.login),b=Le(n.get("page")),v=pe(c?.count),x=b==="last20"||b===v,{enableUpdater:m,refreshInterval:p}=Cn({isLastPage:x}),{refetch:l}=Ve({topicId:r},{refetchInterval:p,enabled:m}),N=()=>{l(),e(fe.changeText(""))};return h.useEffect(()=>{c?.title&&(document.title=Lt(c.title))},[c?.title]),h.useEffect(()=>{if(a||!s)return;const y=document.getElementById(s.slice(1));y&&window.scrollTo(0,y.offsetTop)},[a,s]),t.jsxs("div",{style:{marginBottom:"5px"},children:[t.jsx(Nn,{topicId:r}),o&&t.jsx(le,{text:o.message}),t.jsxs("div",{className:"topic-table",children:[t.jsx(bn,{topicId:r}),t.jsx(Te,{item:u,topicId:r}),d.map((y,f)=>t.jsx(Te,{item:y,topicId:r},y.n)),(v>1||b==="last20")&&t.jsx("div",{className:"table-footer",children:t.jsx(ze,{maxPage:v,last20:!0})})]}),t.jsx(Tn,{topicId:r,isLastPage:x}),j.logged&&t.jsx(kn,{topicId:r,onSubmitSuccess:N})]})},$n=({name:e,label:s,value:n,values:r,oneLine:i,onChange:o})=>{const a=c=>{o(c,e,c.target.value)};return t.jsxs("span",{children:[t.jsxs("span",{style:{marginRight:"5px"},children:[" ",s," "]}),i&&t.jsx("br",{}),r.map((c,u)=>t.jsx(_.Check,{type:"radio",id:c.name,label:c.descr,name:s,checked:c.name===n,value:c.name,inline:i,onChange:a},u))]})},Ln=({name:e,value:s,label:n,postfix:r,onChange:i})=>{const o=a=>{i(a,e,a.target.value)};return t.jsxs("label",{htmlFor:e,style:{marginRight:"5px"},children:[t.jsx("span",{style:{marginRight:"5px"},children:n}),t.jsx("input",{type:"string",name:e,value:s,onChange:o,className:"input"}),r!==void 0?t.jsx("span",{style:{marginLeft:"5px"},children:r}):null]})},Pn=[{tabName:"Общие",rows:[["theme"],["topicsPerPage"],["autoRefreshTopicsList","autoRefreshTopicsListInterval"],["autoRefreshTopic","autoRefreshTopicInterval"]]},{tabName:"Тултипы",rows:[["showTooltips","tooltipDelay"],["showTooltipOnPostLink"]]},{tabName:"Ссылки",rows:[["showYoutubeVideoTitle"],["replaceCatalogMista"],["fixBrokenLinks"]]}],In={theme:{type:"radio",label:"Цветовая палитра:",oneLine:!0,values:[{name:"yellow",descr:"Золотая"},{name:"lightgray",descr:"Серая"},{name:"dark",descr:"Темная"}]},topicsPerPage:{type:"number",label:"Тем на странице (max 99):",min:1,max:99},autoRefreshTopicsList:{type:"checkbox",label:"Автообновление списка тем"},autoRefreshTopicsListInterval:{type:"number",label:"",min:60,max:1e6,postfix:"сек"},autoRefreshTopic:{type:"checkbox",label:"Автообновление темы"},autoRefreshTopicInterval:{type:"number",label:"",min:60,max:1e6,postfix:"сек"},showTooltips:{type:"checkbox",label:"Показывать тултипы, задержка",disabled:!0},tooltipDelay:{type:"number",max:1e6,label:"",postfix:"мс",disabled:!0},showTooltipOnPostLink:{type:"checkbox",label:"Показывать тултип ссыки на другую ветку",disabled:!0},showYoutubeVideoTitle:{type:"checkbox",label:"Показывать наименования роликов youtube"},replaceCatalogMista:{type:"checkbox",label:"Обратно заменять catalog.mista.ru на infostart.ru"},fixBrokenLinks:{type:"checkbox",label:"Чинить поломанные ссылки (с русскими символами)"}},Mn=({name:e,children:s})=>t.jsxs("div",{children:[t.jsx("div",{className:"tab-header",children:e}),t.jsx("div",{className:"tab-content",children:s})]}),Rn=()=>{const e=U(),s=gt(),n=C(j=>j.options),[r,i]=h.useState({items:n.items}),o=()=>{s("/#")},a=()=>{i({...r,items:Object.assign({},Ae.items)})},c=()=>{e(ls.save(r.items)),o()},u=(j,b,v)=>{let x=Object.assign({},r.items);x[b]=v,i({...r,items:x})};let d=[];for(let j of Pn){let b=[];for(let v in j.rows){const x=j.rows[v];let m=[];for(let p of x){const l=In[p];if(!l)continue;const N=r.items[p];l.type==="radio"?m.push(t.jsx($n,{name:p,label:l.label,values:l.values,value:N,oneLine:l.oneLine,onChange:u},p)):l.type==="number"?(l.label&&m.push(t.jsx("label",{htmlFor:p,style:{fontWeight:"inherit"},children:l.label},p+"_label")),m.push(t.jsxs("div",{className:"options-number",children:[t.jsx(K,{type:"number",min:l.min,max:l.max,value:N,disabled:l.disabled,onChange:y=>u(y,p,y.target.value),className:"input",size:"sm"}),l.postfix&&t.jsx("span",{style:{marginLeft:"5px",flex:"0 0 auto"},children:l.postfix},p+"_postfix")]},p))):l.type==="string"?m.push(t.jsx(Ln,{name:p,label:l.label,postfix:l.postfix,value:N,onChange:u},p)):l.type==="checkbox"&&m.push(t.jsx(_.Check,{id:p,type:"checkbox",label:l.label,name:p,checked:String(N)==="true",disabled:l.disabled,onChange:y=>u(y,p,String(y.target.checked)),style:{flex:"0 0 auto",margin:"0px",maxWidth:"100%"}},p))}b.push(t.jsx("div",{className:"options-row",children:m},v))}d.push(t.jsx(Mn,{name:j.tabName,children:b},j.tabName))}return t.jsxs("div",{className:"options-form",children:[t.jsx("div",{className:"options-header",style:{cursor:"default"},children:t.jsx("b",{children:"Настройки"})}),d,t.jsxs("div",{className:"button-row",children:[t.jsx(D,{id:"applyOptions",size:"sm",variant:"light",style:{margin:"5px"},className:"button",onClick:c,children:"OK"}),t.jsx(D,{id:"cancelOptions",size:"sm",variant:"light",style:{margin:"5px",float:"left"},className:"button",onClick:o,children:"Отмена"}),t.jsx(D,{id:"defaultOptions",size:"sm",variant:"light",style:{margin:"5px",float:"right"},className:"button",onClick:a,children:"Сбросить настройки"})]})]})},_n=()=>t.jsx(ft,{children:t.jsxs(xt,{children:[t.jsx(Z,{path:"/",element:t.jsx(be,{})}),t.jsx(Z,{path:"/index.php",element:t.jsx(be,{})}),t.jsx(Z,{path:"/topic.php",element:t.jsx(Sn,{})}),t.jsx(Z,{path:"/options.php",element:t.jsx(Rn,{})})]})}),En=()=>t.jsxs("footer",{className:"flex-row navbar-footer",children:[t.jsx("a",{href:`${k}/rules.php`,children:"Правила"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:`${k}/about.php`,children:"Описание"}),t.jsx("span",{className:"separator",children:"|"}),t.jsxs("b",{children:[t.jsx("a",{href:`${k}/ad.php`,children:"Реклама на сайте"})," "]}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:`${k}/find.php`,children:"Поиск"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{rel:"nofollow",href:`${k}/sections_list.php`,children:"Секции"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{rel:"nofollow",href:`${k}/rating.php`,children:"Рейтинг"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:"http://kb.mista.ru",children:"Книга знаний"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:"http://wiki.mista.ru",children:"Вики-миста (КЗ2)"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{rel:"nofollow",href:"http://m.mista.ru/",children:"Мобильная"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:`${k}/archive.php`,children:"Архив"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:`${k}/moders.php`,children:"Модераторы"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:`${k}/users_gallery.php`,children:"Галерея"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("a",{href:`${k}/ban_list.php`,children:"Баны"}),t.jsx("span",{className:"separator",children:"|"}),t.jsx("span",{children:"18+"})]}),We=({children:e,closeWindow:s})=>t.jsxs("div",{className:"tooltip-header",children:[e,t.jsxs("div",{className:"tooltip-close",onClick:s,onTouchEnd:s,children:[t.jsx("i",{className:"fa fa-angle-right","aria-hidden":"true"}),t.jsx("i",{className:"fa fa-angle-left","aria-hidden":"true",style:{marginLeft:"-2px"}})]})]}),Ke=({children:e,onScroll:s})=>{let n=0;const r=o=>{n=o.nativeEvent.changedTouches[0].clientX},i=o=>{if(!s)return;let a=o.nativeEvent.changedTouches[0].clientX;Math.abs(a-n)>100&&s(-a+n)};return t.jsx("div",{className:"tooltip-text",onTouchStart:r,onTouchEnd:i,children:e})},Dn=({tooltip:e,zIndex:s,children:n})=>{const r=H(ge),i=()=>{r.close(e.keys)},{coords:o}=e;let a,c;window.innerWidth<=768?(a="y",c={top:o.y,left:5}):(a="both",c={top:o.y,left:Math.min(o.x,window.innerWidth-670)});let[u,d]=h.Children.toArray(n);return t.jsx(jt,{axis:a,handle:".tooltip-header",defaultClassNameDragging:"dragging",children:t.jsxs("div",{className:"tooltip-window",style:{...c},children:[t.jsx(We,{closeWindow:i,children:u.props.children}),t.jsx(Ke,{children:d.props.children})]})},s)},On=({tooltip:e})=>{const{keys:s}=e,{data:n,isPending:r,isError:i,error:o}=ys({topicId:s.topicId,number:s.number});return r?null:t.jsxs(Dn,{tooltip:e,children:[t.jsx(We,{children:i?t.jsx("b",{children:"Ошибка"}):t.jsx(ve,{data:n,isAuthor:!1,isYou:!1,isTooltip:!0})}),t.jsx(Ke,{children:t.jsx(je,{n:n?.n,vote:n?.vote,html:i?o.message:n.text,topicId:s.topicId,topicDate:n?.time,style:{maxHeight:"min(550px, 80vh)",overflowY:"auto"}})})]})},Fn=()=>{const e=C(i=>i.tooltips.items),s=H(ge),n=h.useRef(null);return vt(n,()=>{s.closeAll()}),t.jsx("div",{ref:n,children:e.map(i=>t.jsx(On,{tooltip:i},i.hash))})},An=()=>{const e=C(s=>s.options.items.theme);return h.useLayoutEffect(()=>{document.body.setAttribute("data-theme",e)},[e]),t.jsxs(yt,{children:[t.jsx(ws,{}),t.jsx(_n,{}),t.jsx(En,{}),t.jsx(Fn,{})]})},Vn=new wt({defaultOptions:{queries:{refetchOnWindowFocus:!1}}}),Bn=({store:e})=>t.jsx(bt,{client:Vn,children:t.jsx(Tt,{store:e,children:t.jsx(kt,{loading:null,persistor:Ts,children:t.jsx(An,{})})})}),Un=document.getElementById("root"),Hn=Nt.createRoot(Un);Hn.render(t.jsx(Bn,{store:Be}));
